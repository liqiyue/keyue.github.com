<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ASA:MPF实验一：部署网管流量限制</title>
    <url>/2020/07/18/2020-07-ASA-MPF%E5%AE%9E%E9%AA%8C%E4%B8%80%EF%BC%9A%E9%83%A8%E7%BD%B2%E7%BD%91%E7%AE%A1%E6%B5%81%E9%87%8F%E9%99%90%E5%88%B6.html</url>
    <content><![CDATA[<h2 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h2><ul>
<li>针对抵达防火墙DMZ区域接口的以下流量执行限制<ul>
<li>Telnet</li>
<li>SSH</li>
</ul>
</li>
<li>限制最大连接数为1，超时时间10分钟。</li>
</ul>
<h2 id="拓扑："><a href="#拓扑：" class="headerlink" title="拓扑："></a>拓扑：</h2><p><img src="../../../images/ASA:MPF%E5%AE%9E%E9%AA%8C%E4%B8%80%EF%BC%9A%E9%83%A8%E7%BD%B2%E7%BD%91%E7%AE%A1%E6%B5%81%E9%87%8F%E9%99%90%E5%88%B6/mpf-1024x284.png" alt="img"></p>
<h2 id="配置："><a href="#配置：" class="headerlink" title="配置："></a>配置：</h2><h3 id="配置接口IP和默认路由"><a href="#配置接口IP和默认路由" class="headerlink" title="配置接口IP和默认路由"></a>配置接口IP和默认路由</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASAv(config)<span class="comment"># int g0/0</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment"># ip add 7.7.2.1 255.255.255.0</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment"># no shutdown</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment"># security-level 0</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment"># nameif Outside</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment"># int g0/1</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment"># ip add 7.7.1.1 255.255.255.0</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment"># no shutdown</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment"># security-level 50</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment"># nameif DMZ</span></span><br><span class="line">Outside(config)<span class="comment">#int e0/0</span></span><br><span class="line">Outside(config-<span class="keyword">if</span>)<span class="comment">#ip add 7.7.2.2 255.255.255.0</span></span><br><span class="line">Outside(config-<span class="keyword">if</span>)<span class="comment">#no shutdown</span></span><br><span class="line">Outside(config-<span class="keyword">if</span>)<span class="comment">#ip route 0.0.0.0 0.0.0.0 7.7.2.1</span></span><br><span class="line">DMZ(config)<span class="comment">#int e0/0</span></span><br><span class="line">DMZ(config-<span class="keyword">if</span>)<span class="comment">#ip add 7.7.1.2 255.255.255.0</span></span><br><span class="line">DMZ(config-<span class="keyword">if</span>)<span class="comment">#no shutdown</span></span><br><span class="line">DMZ(config-<span class="keyword">if</span>)<span class="comment">#ip route 0.0.0.0 0.0.0.0 7.7.1.1</span></span><br></pre></td></tr></table></figure>

<h3 id="配置telnet-ssh服务"><a href="#配置telnet-ssh服务" class="headerlink" title="配置telnet/ssh服务"></a>配置telnet/ssh服务</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DMZ(config)<span class="comment">#username cisco privilege 15 password cisco</span></span><br><span class="line">DMZ(config)<span class="comment">#line vty  0 4</span></span><br><span class="line">DMZ(config-line)<span class="comment">#login local</span></span><br><span class="line">DMZ(config-line)<span class="comment">#transport input telnet ssh</span></span><br></pre></td></tr></table></figure>

<h3 id="定义对象组"><a href="#定义对象组" class="headerlink" title="定义对象组"></a>定义对象组</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">object-group service DM_INLINE_TCP_1 tcp</span><br><span class="line"> port-object eq ssh</span><br><span class="line"> port-object eq telnet</span><br></pre></td></tr></table></figure>

<h3 id="匹配放行流量并应用到接口"><a href="#匹配放行流量并应用到接口" class="headerlink" title="匹配放行流量并应用到接口"></a>匹配放行流量并应用到接口</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">access-list outside_mpc extended permit tcp host <span class="number">7.7</span><span class="number">.2</span><span class="number">.2</span> host <span class="number">7.7</span><span class="number">.1</span><span class="number">.2</span> object-group DM_INLINE_TCP_1</span><br><span class="line">access-group outside_mpc <span class="keyword">in</span> interface Outside</span><br></pre></td></tr></table></figure>

<h3 id="创建Class-Map"><a href="#创建Class-Map" class="headerlink" title="创建Class-Map"></a>创建Class-Map</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>-<span class="title">map</span> <span class="title">Cisco</span>-<span class="title">class</span></span></span><br><span class="line"><span class="class"> <span class="title">match</span> <span class="title">access</span>-<span class="title">list</span> <span class="title">outside_mpc</span></span></span><br></pre></td></tr></table></figure>

<h3 id="创建Policy-Map并关联Class-Map"><a href="#创建Policy-Map并关联Class-Map" class="headerlink" title="创建Policy-Map并关联Class-Map"></a>创建Policy-Map并关联Class-Map</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">policy-map Cisco-policy</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cisco</span>-<span class="title">class</span></span></span><br><span class="line"><span class="class">  <span class="title">set</span> <span class="title">connection</span> <span class="title">timeout</span> <span class="title">idle</span> 0:</span><span class="number">10</span>:<span class="number">00</span> reset</span><br><span class="line">  set connection conn-max <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="应用到接口生效"><a href="#应用到接口生效" class="headerlink" title="应用到接口生效"></a>应用到接口生效</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">service-policy Cisco-policy interface outside</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>Firewall</tag>
        <tag>MPF</tag>
      </tags>
  </entry>
  <entry>
    <title>ASA模块化策略框架MPF</title>
    <url>/2020/07/18/2020-07-ASA%E6%A8%A1%E5%9D%97%E5%8C%96%E7%AD%96%E7%95%A5%E6%A1%86%E6%9E%B6MPF.html</url>
    <content><![CDATA[<p><strong>MPF</strong>（modular policy framework），模块化策略框架，类似于Qos里面的MQC（modular Qos command）模块化的QOS命令行。我们可以通过MPF来做一些QOS或者内容过滤，入侵防范，协议监测，高级TCP设置，限速等流量控制。能过对一些流量分类做标记，针对这些流量再依次制定相应的policy，然后调用生效。 有以下三个模块组成：</p>
<ul>
<li>Class-map：流量分类，抓取流量</li>
<li>Policy-map：定义策略，决定被抓流量处理方式</li>
<li>Service-policy: 策略调用，决定执行地点</li>
</ul>
<blockquote>
<p>正常情况下，在防火墙里面，class-map只能match一个，而一个policy却能调用多个class。</p>
<p>只有在以下特殊情况，防火墙才会允许Class-Map匹配两个条件：</p>
<p>1，match default-inspenction-traffic + match access-list</p>
<p>2，match tunnel group</p>
</blockquote>
<h2 id="路由器中也有Class-map，和ASA有何不同？"><a href="#路由器中也有Class-map，和ASA有何不同？" class="headerlink" title="路由器中也有Class-map，和ASA有何不同？"></a>路由器中也有Class-map，和ASA有何不同？</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#路由器：</span></span><br><span class="line">Inside_1(config)<span class="comment">#class-map ?</span></span><br><span class="line">  WORD       <span class="class"><span class="keyword">class</span>-<span class="title">map</span> <span class="title">name</span></span></span><br><span class="line"><span class="class">  <span class="title">match</span>-<span class="title">all</span>  <span class="title">Logical</span>-<span class="title">AND</span> <span class="title">all</span> <span class="title">matching</span> <span class="title">statements</span> <span class="title">under</span> <span class="title">this</span> <span class="title">classmap</span></span></span><br><span class="line"><span class="class">  <span class="title">match</span>-<span class="title">any</span>  <span class="title">Logical</span>-<span class="title">OR</span> <span class="title">all</span> <span class="title">matching</span> <span class="title">statements</span> <span class="title">under</span> <span class="title">this</span> <span class="title">classmap</span></span></span><br><span class="line"><span class="class">  <span class="title">type</span>       <span class="title">Configure</span> <span class="title">CPL</span> <span class="title">Class</span> <span class="title">Map</span></span></span><br><span class="line"><span class="class">#<span class="title">ASA</span>:</span></span><br><span class="line">ASAv(config)<span class="comment"># class-map ?</span></span><br><span class="line"></span><br><span class="line">configure mode commands/options:</span><br><span class="line">  WORD &lt; <span class="number">129</span> char  <span class="class"><span class="keyword">class</span>-<span class="title">map</span> <span class="title">name</span></span></span><br><span class="line"><span class="class">  <span class="title">type</span>             <span class="title">Specifies</span> <span class="title">the</span> <span class="title">type</span> <span class="title">of</span> <span class="title">class</span>-<span class="title">map</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ASA中的Class-map为Match-all！！！</p>
<p>Match-all：匹配所有条件，才能触发对应效果</p>
<p>Match-any：只要匹配众多条件中的一个，就可以触发对应的效果</p>
</blockquote>
<h2 id="Class-Map配置参数与步骤"><a href="#Class-Map配置参数与步骤" class="headerlink" title="Class-Map配置参数与步骤"></a>Class-Map配置参数与步骤</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.创建Class-Map</span></span><br><span class="line">ASAv(config)<span class="comment"># class-map Class_1</span></span><br><span class="line"><span class="comment">#2.关联参数</span></span><br><span class="line">ASAv(config-cmap)<span class="comment"># match ?</span></span><br><span class="line"></span><br><span class="line">mpf-<span class="class"><span class="keyword">class</span>-<span class="title">map</span> <span class="title">mode</span> <span class="title">commands</span>/<span class="title">options</span>:</span></span><br><span class="line">  access-list                 Match an Access List</span><br><span class="line">  any                         Match any packet</span><br><span class="line">  default-inspection-traffic  Match default inspection traffic: </span><br><span class="line">                              ctiqbe----tcp-<span class="number">-2748</span>      dns-------udp-<span class="number">-53</span>       </span><br><span class="line">                              ftp-------tcp-<span class="number">-21</span>        gtp-------udp-<span class="number">-2123</span>,<span class="number">3386</span></span><br><span class="line">                              h323-h225-tcp-<span class="number">-1720</span>      h323-ras--udp-<span class="number">-1718</span><span class="number">-1719</span></span><br><span class="line">                              http------tcp-<span class="number">-80</span>        icmp------icmp          </span><br><span class="line">                              ils-------tcp-<span class="number">-389</span>       ip-options-----rsvp     </span><br><span class="line">                              mgcp------udp-<span class="number">-2427</span>,<span class="number">2727</span> netbios---udp-<span class="number">-137</span><span class="number">-138</span>  </span><br><span class="line">                              radius-acct----udp-<span class="number">-1646</span> rpc-------udp-<span class="number">-111</span>      </span><br><span class="line">                              rsh-------tcp-<span class="number">-514</span>       rtsp------tcp-<span class="number">-554</span>      </span><br><span class="line">                              sip-------tcp-<span class="number">-5060</span>      sip-------udp-<span class="number">-5060</span>     </span><br><span class="line">                              skinny----tcp-<span class="number">-2000</span>      smtp------tcp-<span class="number">-25</span>       </span><br><span class="line">                              sqlnet----tcp-<span class="number">-1521</span>      tftp------udp-<span class="number">-69</span>       </span><br><span class="line">                              vxlan-----udp-<span class="number">-4789</span>      waas------tcp-<span class="number">-1</span><span class="number">-65535</span>  </span><br><span class="line">                              xdmcp-----udp-<span class="number">-177</span>      </span><br><span class="line">  dscp                        Match IP DSCP (DiffServ CodePoints)</span><br><span class="line">  flow                        Flow based Policy</span><br><span class="line">  port                        Match TCP/UDP port(s)</span><br><span class="line">  precedence                  Match IP precedence</span><br><span class="line">  rtp                         Match RTP port numbers</span><br><span class="line">  tunnel-group                Match a Tunnel Group</span><br></pre></td></tr></table></figure>

<h2 id="Policy-Map配置参数与步骤"><a href="#Policy-Map配置参数与步骤" class="headerlink" title="Policy-Map配置参数与步骤"></a>Policy-Map配置参数与步骤</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.创建Policy-Map</span></span><br><span class="line">ASAv(config)<span class="comment"># policy-map Policy_1</span></span><br><span class="line"><span class="comment">#2.匹配Class-Map</span></span><br><span class="line">ASAv(config-pmap)<span class="comment"># class Class_1</span></span><br><span class="line"><span class="comment">#3.配置执行的参数</span></span><br><span class="line">ASAv(config-pmap-c)<span class="comment"># ?            </span></span><br><span class="line"></span><br><span class="line">MPF policy-map <span class="class"><span class="keyword">class</span> <span class="title">configuration</span> <span class="title">commands</span>:</span></span><br><span class="line">  exit             Exit <span class="keyword">from</span> MPF <span class="class"><span class="keyword">class</span> <span class="title">action</span> <span class="title">configuration</span> <span class="title">mode</span></span></span><br><span class="line"><span class="class">  <span class="title">help</span>             <span class="title">Help</span> <span class="title">for</span> <span class="title">MPF</span> <span class="title">policy</span>-<span class="title">map</span> <span class="title">class</span>/<span class="title">match</span> <span class="title">submode</span> <span class="title">commands</span></span></span><br><span class="line"><span class="class">  <span class="title">no</span>               <span class="title">Negate</span> <span class="title">or</span> <span class="title">set</span> <span class="title">default</span> <span class="title">values</span> <span class="title">of</span> <span class="title">a</span> <span class="title">command</span></span></span><br><span class="line"><span class="class">  <span class="title">police</span>           <span class="title">Rate</span> <span class="title">limit</span> <span class="title">traffic</span> <span class="title">for</span> <span class="title">this</span> <span class="title">class</span>  //针对对应的流量执行限速</span></span><br><span class="line"><span class="class">  <span class="title">priority</span>         <span class="title">Strict</span> <span class="title">scheduling</span> <span class="title">priority</span> <span class="title">for</span> <span class="title">this</span> <span class="title">class</span>  //针对对应的流量实施<span class="title">QOS</span></span></span><br><span class="line"><span class="class">  <span class="title">quit</span>             <span class="title">Exit</span> <span class="title">from</span> <span class="title">MPF</span> <span class="title">class</span> <span class="title">action</span> <span class="title">configuration</span> <span class="title">mode</span></span></span><br><span class="line"><span class="class">  <span class="title">set</span>              <span class="title">Set</span> <span class="title">connection</span> <span class="title">values</span></span></span><br><span class="line"><span class="class">  <span class="title">user</span>-<span class="title">statistics</span>  <span class="title">configure</span> <span class="title">user</span> <span class="title">statistics</span> <span class="title">for</span> <span class="title">identity</span> <span class="title">firewall</span></span></span><br><span class="line"><span class="class">  &lt;<span class="title">cr</span>&gt;</span></span><br><span class="line"><span class="class">  <span class="title">flow</span>-<span class="title">export</span>      <span class="title">Configure</span> <span class="title">filters</span> <span class="title">for</span> <span class="title">NetFlow</span> <span class="title">events</span></span></span><br><span class="line"><span class="class">  <span class="title">inspect</span>          <span class="title">Protocol</span> <span class="title">inspection</span> <span class="title">services</span>       //针对对应的流量执行状态话监控</span></span><br></pre></td></tr></table></figure>

<h2 id="Policy-Map部署注意事项"><a href="#Policy-Map部署注意事项" class="headerlink" title="Policy-Map部署注意事项"></a>Policy-Map部署注意事项</h2><ul>
<li>一个Policy-Map可包含多个Class-Map策略</li>
<li>一个策略包含一个Class-Map和它关联的行为</li>
<li>在一个Policy-Map中，一个行为类型，一个数据包只匹配一个Class-Map</li>
<li>状态话处理的数据包，仅仅只会匹配上第一个策略</li>
<li>每个接口只允许存在一个Policy-Map，全局也只允许存在一个Policy-Mao</li>
</ul>
<h2 id="Service-Policy配置参数与步骤"><a href="#Service-Policy配置参数与步骤" class="headerlink" title="Service-Policy配置参数与步骤"></a>Service-Policy配置参数与步骤</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.应用于接口</span></span><br><span class="line">ASAv(config)<span class="comment"># service-policy policy_1 interface Outside</span></span><br><span class="line"><span class="comment">#2.应用于全局</span></span><br><span class="line">ASAv(config)<span class="comment"># service-policy policy_1 global</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>Firewall</tag>
        <tag>MPF</tag>
      </tags>
  </entry>
  <entry>
    <title>ASA策略路由PBR配置</title>
    <url>/2020/07/18/2020-07-ASA%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1PBR%E9%85%8D%E7%BD%AE.html</url>
    <content><![CDATA[<h2 id="策略路由PBR特点"><a href="#策略路由PBR特点" class="headerlink" title="策略路由PBR特点"></a>策略路由PBR特点</h2><ul>
<li>等价访问和基于源地址选路</li>
<li>服务质量</li>
<li>节省开销</li>
<li>负载均衡</li>
</ul>
<h2 id="策略路由实验"><a href="#策略路由实验" class="headerlink" title="策略路由实验"></a>策略路由实验</h2><h3 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h3><ul>
<li>解决默认ICMP无法Ping问题</li>
<li>Source IP：7.7.1.1 Destration IP：1.1.1.1下一跳PBR设置为150.1.7.1</li>
<li>Source IP：7.7.2.1 Destration IP：1.1.1.1下一跳PBR设置为202.200.200.1</li>
</ul>
<img src="../../../images/ASA%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1PBR%E9%85%8D%E7%BD%AE/1592989758275-1024x473.jpg" alt="img" style="zoom:75%;" />

<h3 id="配置策略路由PBR："><a href="#配置策略路由PBR：" class="headerlink" title="配置策略路由PBR："></a>配置策略路由PBR：</h3><h4 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Inside</span></span><br><span class="line">Inside(config)<span class="comment">#int e0/0</span></span><br><span class="line">Inside(config-<span class="keyword">if</span>)<span class="comment">#no shutdown</span></span><br><span class="line">Inside(config-<span class="keyword">if</span>)<span class="comment">#ip add 7.7.1.1 255.255.255.0</span></span><br><span class="line">Inside(config-<span class="keyword">if</span>)<span class="comment">#ip add 7.7.1.2 255.255.255.0 secondary </span></span><br><span class="line">Inside(config-<span class="keyword">if</span>)<span class="comment">#ip route 0.0.0.0 0.0.0.0 7.7.1.10</span></span><br><span class="line"><span class="comment">#DMZ</span></span><br><span class="line">DMZ(config)<span class="comment">#int e0/0</span></span><br><span class="line">DMZ(config-<span class="keyword">if</span>)<span class="comment">#no shutdown</span></span><br><span class="line">DMZ(config-<span class="keyword">if</span>)<span class="comment">#ip add 150.1.7.1 255.255.255.0</span></span><br><span class="line">DMZ(config-<span class="keyword">if</span>)<span class="comment">#int lo0</span></span><br><span class="line">DMZ(config-<span class="keyword">if</span>)<span class="comment">#ip add 1.1.1.1 255.255.255.0</span></span><br><span class="line">DMZ(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 150.1.7.10</span></span><br><span class="line"><span class="comment">#Outside</span></span><br><span class="line">Outside(config)<span class="comment">#int e0/0</span></span><br><span class="line">Outside(config-<span class="keyword">if</span>)<span class="comment">#ip add 202.200.200.1 255.255.255.0</span></span><br><span class="line">Outside(config-<span class="keyword">if</span>)<span class="comment">#no shutdown</span></span><br><span class="line">Outside(config-<span class="keyword">if</span>)<span class="comment">#int lo0</span></span><br><span class="line">Outside(config-<span class="keyword">if</span>)<span class="comment">#ip add 1.1.1.1 255.255.255.0</span></span><br><span class="line">Outside(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 202.200.200.10</span></span><br><span class="line"><span class="comment">#ASAv</span></span><br><span class="line">ASAv(config)<span class="comment">#interface GigabitEthernet0/0</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#no shutdown</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#nameif Inside</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#security-level 100</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#ip address 7.7.1.10 255.255.255.0 </span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#interface GigabitEthernet0/1</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#no shutdown</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#nameif DMZ</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#security-level 50</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#ip address 150.1.7.10 255.255.255.0 </span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#interface GigabitEthernet0/2</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#no shutdown</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#nameif Outside</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#security-level 0</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment">#ip address 202.200.200.10 255.255.255.0</span></span><br></pre></td></tr></table></figure>

<h4 id="ASA配置路由保证互通"><a href="#ASA配置路由保证互通" class="headerlink" title="ASA配置路由保证互通"></a>ASA配置路由保证互通</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASAv(config)<span class="comment"># route Outside 0.0.0.0 0.0.0.0 202.200.200.1</span></span><br><span class="line">ASAv(config)<span class="comment"># route DMZ 1.1.1.0 255.255.255.0 150.1.7.1</span></span><br></pre></td></tr></table></figure>

<h4 id="ASA添加ICMP监控，使其可以穿越防火墙"><a href="#ASA添加ICMP监控，使其可以穿越防火墙" class="headerlink" title="ASA添加ICMP监控，使其可以穿越防火墙"></a>ASA添加ICMP监控，使其可以穿越防火墙</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASAv(config)<span class="comment"># policy-map global_policy</span></span><br><span class="line">ASAv(config-pmap)<span class="comment">#  class inspection_default</span></span><br><span class="line">ASAv(config-pmap-c)<span class="comment"># inspect icmp</span></span><br></pre></td></tr></table></figure>

<h4 id="Outside和DMZ开启debug查看流量去往路径"><a href="#Outside和DMZ开启debug查看流量去往路径" class="headerlink" title="Outside和DMZ开启debug查看流量去往路径"></a>Outside和DMZ开启debug查看流量去往路径</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DMZ<span class="comment">#debug ip icmp </span></span><br><span class="line">Outside<span class="comment">#debug ip icmp</span></span><br></pre></td></tr></table></figure>

<h4 id="配置ACL抓取感兴趣流"><a href="#配置ACL抓取感兴趣流" class="headerlink" title="配置ACL抓取感兴趣流"></a>配置ACL抓取感兴趣流</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASAv(config)<span class="comment"># access-list 7.7.1.1-to-1 extended permit ip host 7.7.1.1 host 1.1.1.1 </span></span><br><span class="line">ASAv(config)<span class="comment"># access-list 7.7.1.2-to-1 extended permit ip host 7.7.1.2 host 1.1.1.1</span></span><br></pre></td></tr></table></figure>

<h4 id="配置route-map"><a href="#配置route-map" class="headerlink" title="配置route-map"></a>配置route-map</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建route-map，名为to-1，序号为10，匹配ACL7.7.1.1-to-1，送到150.1.7.1</span></span><br><span class="line">ASAv(config-route-map)<span class="comment"># route-map to-1 10           </span></span><br><span class="line">ASAv(config-route-map)<span class="comment"># match ip address 7.7.1.1-to-1</span></span><br><span class="line">ASAv(config-route-map)<span class="comment"># set ip next-hop 150.1.7.1</span></span><br><span class="line"><span class="comment">#创建route-map，名为to-1，序号为20，匹配ACL7.7.1.2-to-1，送到202.200.200.1</span></span><br><span class="line">ASAv(config-route-map)<span class="comment"># route-map to-1 20            </span></span><br><span class="line">ASAv(config-route-map)<span class="comment"># match ip address 7.7.1.2-to-1</span></span><br><span class="line">ASAv(config-route-map)<span class="comment"># set ip next-hop 202.200.200.1</span></span><br></pre></td></tr></table></figure>

<h4 id="将route-map挂载接口上，不挂载不生效"><a href="#将route-map挂载接口上，不挂载不生效" class="headerlink" title="将route-map挂载接口上，不挂载不生效"></a>将route-map挂载接口上，不挂载不生效</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASAv(config-subif)<span class="comment"># int gigabitEthernet 0/0</span></span><br><span class="line">ASAv(config-<span class="keyword">if</span>)<span class="comment"># policy-route route-map to-1</span></span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside<span class="comment">#ping 1.1.1.1 source 7.7.1.2</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">7.7</span><span class="number">.1</span><span class="number">.2</span> </span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">1</span>/<span class="number">1</span>/<span class="number">3</span> ms</span><br><span class="line">Inside<span class="comment">#ping 1.1.1.1 source 7.7.1.1</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">1</span>/<span class="number">1</span>/<span class="number">2</span> ms</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DMZ<span class="comment">#</span></span><br><span class="line">*Jun <span class="number">24</span> <span class="number">09</span>:<span class="number">40</span>:<span class="number">20.101</span>: ICMP: echo reply sent, src <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, dst <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span>, topology BASE, dscp <span class="number">0</span> topoid <span class="number">0</span></span><br><span class="line">*Jun <span class="number">24</span> <span class="number">09</span>:<span class="number">40</span>:<span class="number">20.103</span>: ICMP: echo reply sent, src <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, dst <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span>, topology BASE, dscp <span class="number">0</span> topoid <span class="number">0</span></span><br><span class="line">*Jun <span class="number">24</span> <span class="number">09</span>:<span class="number">40</span>:<span class="number">20.104</span>: ICMP: echo reply sent, src <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, dst <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span>, topology BASE, dscp <span class="number">0</span> topoid <span class="number">0</span></span><br><span class="line">*Jun <span class="number">24</span> <span class="number">09</span>:<span class="number">40</span>:<span class="number">20.105</span>: ICMP: echo reply sent, src <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, dst <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span>, topology BASE, dscp <span class="number">0</span> topoid <span class="number">0</span></span><br><span class="line">*Jun <span class="number">24</span> <span class="number">09</span>:<span class="number">40</span>:<span class="number">20.106</span>: ICMP: echo reply sent, src <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, dst <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span>, topology BASE, dscp <span class="number">0</span> topoid <span class="number">0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Outside<span class="comment">#</span></span><br><span class="line">*Jun <span class="number">24</span> <span class="number">09</span>:<span class="number">40</span>:<span class="number">16.461</span>: ICMP: echo reply sent, src <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, dst <span class="number">7.7</span><span class="number">.1</span><span class="number">.2</span>, topology BASE, dscp <span class="number">0</span> topoid <span class="number">0</span></span><br><span class="line">*Jun <span class="number">24</span> <span class="number">09</span>:<span class="number">40</span>:<span class="number">16.462</span>: ICMP: echo reply sent, src <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, dst <span class="number">7.7</span><span class="number">.1</span><span class="number">.2</span>, topology BASE, dscp <span class="number">0</span> topoid <span class="number">0</span></span><br><span class="line">*Jun <span class="number">24</span> <span class="number">09</span>:<span class="number">40</span>:<span class="number">16.463</span>: ICMP: echo reply sent, src <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, dst <span class="number">7.7</span><span class="number">.1</span><span class="number">.2</span>, topology BASE, dscp <span class="number">0</span> topoid <span class="number">0</span></span><br><span class="line">*Jun <span class="number">24</span> <span class="number">09</span>:<span class="number">40</span>:<span class="number">16.464</span>: ICMP: echo reply sent, src <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, dst <span class="number">7.7</span><span class="number">.1</span><span class="number">.2</span>, topology BASE, dscp <span class="number">0</span> topoid <span class="number">0</span></span><br><span class="line">*Jun <span class="number">24</span> <span class="number">09</span>:<span class="number">40</span>:<span class="number">16.466</span>: ICMP: echo reply sent, src <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, dst <span class="number">7.7</span><span class="number">.1</span><span class="number">.2</span>, topology BASE, dscp <span class="number">0</span> topoid <span class="number">0</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>Firewall</tag>
        <tag>PBR</tag>
      </tags>
  </entry>
  <entry>
    <title>ASA网络访问控制ACL</title>
    <url>/2020/07/18/2020-07-ASA%E7%BD%91%E7%BB%9C%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6ACL.html</url>
    <content><![CDATA[<h2 id="路由器访问控制列表特性："><a href="#路由器访问控制列表特性：" class="headerlink" title="路由器访问控制列表特性："></a>路由器访问控制列表特性：</h2><ul>
<li>控制穿越流量</li>
<li>控制抵达路由器自身的流量</li>
<li>控制返回流量</li>
<li>无法控制自身发起的流量</li>
</ul>
<h2 id="防火墙访问控制列表特性："><a href="#防火墙访问控制列表特性：" class="headerlink" title="防火墙访问控制列表特性："></a>防火墙访问控制列表特性：</h2><ul>
<li>控制穿越流量</li>
<li>无法控制抵达防火墙自身的流量</li>
<li>无法控制返回流量</li>
<li>无法控制自身发起的流量</li>
</ul>
<h2 id="在ASA上配置ACL有两个作用："><a href="#在ASA上配置ACL有两个作用：" class="headerlink" title="在ASA上配置ACL有两个作用："></a>在ASA上配置ACL有两个作用：</h2><ul>
<li>允许入站连接</li>
<li>控制出站流量</li>
</ul>
<p>ASA的默认规则是禁止入站连接，如果要允许入站连接，就需要配置ACL</p>
<h2 id="基于对象分组的访问控制Object-Group"><a href="#基于对象分组的访问控制Object-Group" class="headerlink" title="基于对象分组的访问控制Object-Group"></a>基于对象分组的访问控制Object-Group</h2><ul>
<li>为了减少配置文件中ACE的数量，思科ASA推出对象分组功能</li>
<li>对象分组功能，是为了把类似事物分组在一起的一种方法</li>
<li>ASA支持6种类型对象执行分组<ul>
<li>协议</li>
<li>网络</li>
<li>服务</li>
<li>本地用户组</li>
<li>安全组</li>
<li>ICMPType</li>
</ul>
</li>
</ul>
<h3 id="ASA基于对象分组实验："><a href="#ASA基于对象分组实验：" class="headerlink" title="ASA基于对象分组实验："></a>ASA基于对象分组实验：</h3><h4 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h4><ul>
<li>放行外部网络去往lnside_FTP,ESP,DNS, ICMP流量，并开启日志推送</li>
<li>放行外部网络去往DMZ_HTTP,HTTPS, Telnet流量，并开启日志推送</li>
<li>请将以上两点求用一条ACL实现放行</li>
</ul>
<p><img src="../../../images/ASA%E7%BD%91%E7%BB%9C%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6ACL/asa-1024x506.jpg" alt="img"></p>
<h4 id="配置接口-默认路由："><a href="#配置接口-默认路由：" class="headerlink" title="配置接口/默认路由："></a>配置接口/默认路由：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ASAv</span></span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span></span><br><span class="line"> nameif Inside_1</span><br><span class="line"> security-level <span class="number">100</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>           </span><br><span class="line">interface GigabitEthernet0/<span class="number">1</span></span><br><span class="line"> nameif DMZ</span><br><span class="line"> security-level <span class="number">50</span></span><br><span class="line"> ip address <span class="number">150.1</span><span class="number">.7</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line">interface GigabitEthernet0/<span class="number">2</span></span><br><span class="line"> nameif Outside</span><br><span class="line"> security-level <span class="number">0</span></span><br><span class="line"> ip address <span class="number">202.200</span><span class="number">.200</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line">interface GigabitEthernet0/<span class="number">3</span></span><br><span class="line"> nameif Inside_2</span><br><span class="line"> security-level <span class="number">100</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.2</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Inside_1</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">end</span><br><span class="line"><span class="comment">#Inside_2</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.2</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.10</span></span><br><span class="line"><span class="comment">#DMZ</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">150.1</span><span class="number">.7</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">150.1</span><span class="number">.7</span><span class="number">.10</span></span><br><span class="line"><span class="comment">#Outside</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.10</span></span><br></pre></td></tr></table></figure>

<h4 id="开启telnet服务"><a href="#开启telnet服务" class="headerlink" title="开启telnet服务"></a>开启telnet服务</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Inside_1/Inside_2/Outside/DMZ</span></span><br><span class="line">line vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line"> password cisco</span><br><span class="line"> login</span><br><span class="line"> transport input telnet</span><br></pre></td></tr></table></figure>

<h4 id="创建网络对象分组"><a href="#创建网络对象分组" class="headerlink" title="创建网络对象分组"></a>创建网络对象分组</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">object-group network Inside</span><br><span class="line"> network-object <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> network-object <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">object-group network Outside</span><br><span class="line"> network-object <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h4 id="创建服务对象分组"><a href="#创建服务对象分组" class="headerlink" title="创建服务对象分组"></a>创建服务对象分组</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">object-group service Protocol</span><br><span class="line"> service-object tcp destination eq ftp </span><br><span class="line"> service-object esp </span><br><span class="line"> service-object icmp </span><br><span class="line"> service-object tcp-udp destination eq domain</span><br></pre></td></tr></table></figure>

<h4 id="创建ACL并部署在接口上"><a href="#创建ACL并部署在接口上" class="headerlink" title="创建ACL并部署在接口上"></a>创建ACL并部署在接口上</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASAv(config)<span class="comment">#access-list out-to-in extended permit object-group Protocol object-group Outside object-group Inside log </span></span><br><span class="line">ASAv(config)<span class="comment">#access-group out-to-in in interface outside</span></span><br></pre></td></tr></table></figure>

<h4 id="查看部署后的ACL"><a href="#查看部署后的ACL" class="headerlink" title="查看部署后的ACL"></a>查看部署后的ACL</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASAv(config)<span class="comment"># sh access-list </span></span><br><span class="line">access-list cached ACL log flows: total <span class="number">0</span>, denied <span class="number">0</span> (deny-flow-max <span class="number">4096</span>)</span><br><span class="line">            alert-interval <span class="number">300</span></span><br><span class="line">access-list out-to-<span class="keyword">in</span>; <span class="number">10</span> elements; name hash: <span class="number">0x87e8c3b0</span></span><br><span class="line">access-list out-to-<span class="keyword">in</span> line <span class="number">1</span> extended permit object-group Protocol object-group Outside object-group Inside log informational interval <span class="number">300</span> (hitcnt=<span class="number">0</span>) <span class="number">0x004e13a0</span> </span><br><span class="line">  access-list out-to-<span class="keyword">in</span> line <span class="number">1</span> extended permit tcp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq ftp log informational interval <span class="number">300</span> (hitcnt=<span class="number">0</span>) <span class="number">0x363596ac</span> </span><br><span class="line">  access-list out-to-<span class="keyword">in</span> line <span class="number">1</span> extended permit tcp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq ftp log informational interval <span class="number">300</span> (hitcnt=<span class="number">0</span>) <span class="number">0xa067be2b</span> </span><br><span class="line">  access-list out-to-<span class="keyword">in</span> line <span class="number">1</span> extended permit esp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> log informational interval <span class="number">300</span> (hitcnt=<span class="number">0</span>) <span class="number">0xe1c57bae</span> </span><br><span class="line">  access-list out-to-<span class="keyword">in</span> line <span class="number">1</span> extended permit esp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> log informational interval <span class="number">300</span> (hitcnt=<span class="number">0</span>) <span class="number">0x0ea017ea</span> </span><br><span class="line">  access-list out-to-<span class="keyword">in</span> line <span class="number">1</span> extended permit icmp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> log informational interval <span class="number">300</span> (hitcnt=<span class="number">0</span>) <span class="number">0x618042df</span> </span><br><span class="line">  access-list out-to-<span class="keyword">in</span> line <span class="number">1</span> extended permit icmp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> log informational interval <span class="number">300</span> (hitcnt=<span class="number">0</span>) <span class="number">0xfb49871b</span> </span><br><span class="line">  access-list out-to-<span class="keyword">in</span> line <span class="number">1</span> extended permit tcp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq domain log informational interval <span class="number">300</span> (hitcnt=<span class="number">0</span>) <span class="number">0x4d0b0a3e</span> </span><br><span class="line">  access-list out-to-<span class="keyword">in</span> line <span class="number">1</span> extended permit tcp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq domain log informational interval <span class="number">300</span> (hitcnt=<span class="number">0</span>) <span class="number">0x89328454</span> </span><br><span class="line">  access-list out-to-<span class="keyword">in</span> line <span class="number">1</span> extended permit udp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq domain log informational interval <span class="number">300</span> (hitcnt=<span class="number">0</span>) <span class="number">0x94df893c</span> </span><br><span class="line">  access-list out-to-<span class="keyword">in</span> line <span class="number">1</span> extended permit udp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq domain log informational interval <span class="number">300</span> (hitcnt=<span class="number">0</span>) <span class="number">0x6093cce5</span></span><br></pre></td></tr></table></figure>

<h3 id="ASA访问控制实验："><a href="#ASA访问控制实验：" class="headerlink" title="ASA访问控制实验："></a>ASA访问控制实验：</h3><h4 id="需求1："><a href="#需求1：" class="headerlink" title="需求1："></a>需求1：</h4><ul>
<li>Outside接口配置入方向ACL</li>
<li>放行Outside网络访问Inside_1和Inside_2的telnet流量</li>
<li>放行Outside网络访问Inside_1和Inside_2的ssh流量</li>
<li>放行Outside网络访问DMZ的HTTP流量</li>
<li>配置默认拒绝所有ACL，启用LOG，记录丢弃数据包</li>
</ul>
<h4 id="需求2"><a href="#需求2" class="headerlink" title="需求2:"></a>需求2:</h4><ul>
<li>在日志查看界面创建ACL，放行Outside网络访问Inside_1和Inside_2的ICMP流量</li>
<li>插入一条序号为2的ACL，放行Outside网络访问DMZ的ICMP流量</li>
<li>禁用但不删除序号为2的ACL</li>
</ul>
<h4 id="ASA配置ACL"><a href="#ASA配置ACL" class="headerlink" title="ASA配置ACL"></a>ASA配置ACL</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">access-list out-to-<span class="keyword">in</span> extended permit tcp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq telnet </span><br><span class="line">access-list out-to-<span class="keyword">in</span> extended permit tcp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq telnet </span><br><span class="line">access-list out-to-<span class="keyword">in</span> extended permit tcp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq ssh </span><br><span class="line">access-list out-to-<span class="keyword">in</span> extended permit tcp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq ssh </span><br><span class="line">access-list out-to-<span class="keyword">in</span> extended permit tcp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">150.1</span><span class="number">.7</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq www </span><br><span class="line">access-list out-to-<span class="keyword">in</span> extended deny ip any any log</span><br></pre></td></tr></table></figure>

<h4 id="调用ACL"><a href="#调用ACL" class="headerlink" title="调用ACL"></a>调用ACL</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASAv(config)<span class="comment"># access-group out-to-in in interface outside</span></span><br></pre></td></tr></table></figure>

<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Outside<span class="comment">#telnet 7.7.1.1</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Password: </span><br><span class="line">Inside_1&gt;</span><br><span class="line"></span><br><span class="line">Outside<span class="comment">#telnet 7.7.1.1 80</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span>, <span class="number">80</span> ... </span><br><span class="line">% Connection timed out; remote host <span class="keyword">not</span> responding</span><br><span class="line"></span><br><span class="line">Outside<span class="comment">#telnet 150.1.7.1 80</span></span><br><span class="line">Trying <span class="number">150.1</span><span class="number">.7</span><span class="number">.1</span>, <span class="number">80</span> ... </span><br><span class="line">% Connection refused by remote host</span><br></pre></td></tr></table></figure>

<h4 id="ASA查看ACL匹配数"><a href="#ASA查看ACL匹配数" class="headerlink" title="ASA查看ACL匹配数"></a>ASA查看ACL匹配数</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASAv<span class="comment"># sh access-list </span></span><br><span class="line"><span class="comment">#查看（hitcnt=4）是否不为0，不为0则为匹配。</span></span><br></pre></td></tr></table></figure>

<h4 id="插入一条序号为2的ACL做法：-加上参数line-2即可"><a href="#插入一条序号为2的ACL做法：-加上参数line-2即可" class="headerlink" title="插入一条序号为2的ACL做法：(加上参数line 2即可)"></a>插入一条序号为2的ACL做法：(<font color="#dd00">加上参数line 2即可</font>)</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">access-list out-to-<span class="keyword">in</span> line <span class="number">2</span> extended permit icmp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">150.1</span><span class="number">.7</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h4 id="禁用ACL但不删除用法：（在要禁用的条目后方加上inactive参数）"><a href="#禁用ACL但不删除用法：（在要禁用的条目后方加上inactive参数）" class="headerlink" title="禁用ACL但不删除用法：（在要禁用的条目后方加上inactive参数）"></a>禁用ACL但不删除用法：（<font color="#dd00">在要禁用的条目后方加上inactive参数</font>）</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">access-list out-to-<span class="keyword">in</span> line <span class="number">2</span> extended permit icmp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">150.1</span><span class="number">.7</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> inactive</span><br></pre></td></tr></table></figure>

<h3 id="基础ACL配置实验-2"><a href="#基础ACL配置实验-2" class="headerlink" title="基础ACL配置实验_2"></a>基础ACL配置实验_2</h3><ul>
<li>ASA依据系统时钟来判断基于时间的ACL<ul>
<li>若处于配置时间范围内，则该ACE生效</li>
<li>若处于配置时间范围外，则该ACE失效</li>
</ul>
</li>
<li>安全工程师必确保ASA时钟同步的准确性（NTP）</li>
<li>可以结合拓展ACL、IPv6 ACL、WebType ACL—起使用</li>
<li>激活基于时间的ACL,已经建立连接的网络不受影响</li>
</ul>
<h4 id="创建Time-Rang"><a href="#创建Time-Rang" class="headerlink" title="创建Time-Rang"></a>创建Time-Rang</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建Time-range，名称为WorkStation，使用absolute绝对时间参数，基于开始/结束生效</span></span><br><span class="line">time-range WorkStation</span><br><span class="line"> absolute start <span class="number">08</span>:<span class="number">30</span> <span class="number">01</span> January <span class="number">2020</span> end <span class="number">17</span>:<span class="number">30</span> <span class="number">30</span> December <span class="number">2035</span></span><br><span class="line"> <span class="comment">#创建Time-range，名称为WorkStation1，使用periodic时间周期参数，基于循环时间来执行生效</span></span><br><span class="line"> time-range WorkStation1</span><br><span class="line">  periodic weekdays <span class="number">8</span>:<span class="number">30</span> to <span class="number">17</span>:<span class="number">30</span></span><br><span class="line">   periodic Saturday <span class="number">8</span>:<span class="number">30</span> to <span class="number">12</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>

<h4 id="关联ACL"><a href="#关联ACL" class="headerlink" title="关联ACL"></a>关联ACL</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">access-list out-to-<span class="keyword">in</span> extended permit tcp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq telnet time-range WorkStation</span><br><span class="line">access-list out-to-<span class="keyword">in</span> extended permit tcp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq telnet time-range WorkStation1</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>Firewall</tag>
        <tag>Acl</tag>
      </tags>
  </entry>
  <entry>
    <title>ASA网络地址转换技术NAT</title>
    <url>/2020/07/18/2020-07-ASA%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%E6%8A%80%E6%9C%AFNAT.html</url>
    <content><![CDATA[<h2 id="NAT阐述："><a href="#NAT阐述：" class="headerlink" title="NAT阐述："></a>NAT阐述：</h2><ul>
<li>Network_Address_Translation,网络地址转换</li>
<li>主要作用：<ul>
<li>缓解全球地址耗尽IPV4</li>
<li>维持内部地址规划</li>
<li>隐藏内部网络拓扑</li>
</ul>
</li>
<li>NAT分类：<ul>
<li>静态NAT：一个持久的映射，映射一个真实地址到一个映射后地址，允许双向流量</li>
<li>动态NAT：一组真实地址映射到另一个组映射后的地址，映射后地址往往比真实地址数量少遵循先来后到服务的原则，只有真实的主机才可以发起连接</li>
<li>动态PAT：一组真实地址映射到一个使用唯一源端口的映射地址</li>
<li>Identity NAT：一个地址被静态的转换到自己，本质是旁路掉NAT</li>
</ul>
</li>
<li>时间：动态1对1转换超时时间为3h，动态多对一转换为30s，静态为永久</li>
</ul>
<h2 id="静态NAT配置："><a href="#静态NAT配置：" class="headerlink" title="静态NAT配置："></a>静态NAT配置：</h2><blockquote>
<p>静态NAT中Outside-Nat-Address不能配置出接口IP</p>
</blockquote>
<p>例：将内部主机1.1.1.1映射到外部全局地址2.2.2.2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">object network Inside-Nat-Address</span><br><span class="line">host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">object network Outside-Nat-Address</span><br><span class="line">host <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line">object network Inside-Nat-Address</span><br><span class="line">nat (inside,outside) static Outside-Nat-Address</span><br></pre></td></tr></table></figure>

<h2 id="动态NAT配置："><a href="#动态NAT配置：" class="headerlink" title="动态NAT配置："></a>动态NAT配置：</h2><p>例：将内部网络1.1.1.0转换为外部地址池2.2.2.10-2.2.2.20</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">object network Inside-Nat-Address</span><br><span class="line">subnet <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">object network Outside-Nat-Address</span><br><span class="line">range <span class="number">2.2</span><span class="number">.2</span><span class="number">.10</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.20</span></span><br><span class="line">object network Inside-Nat-Address</span><br><span class="line">nat (inside,outside) dynamic Outside-Nat-Address</span><br><span class="line"><span class="comment">#修改转换超时时间,默认为：</span></span><br><span class="line">timeout xlate <span class="number">3</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">  clear xlate</span><br></pre></td></tr></table></figure>

<h2 id="配置静态与动态PAT"><a href="#配置静态与动态PAT" class="headerlink" title="配置静态与动态PAT"></a>配置静态与动态PAT</h2><h3 id="静态PAT配置"><a href="#静态PAT配置" class="headerlink" title="静态PAT配置"></a>静态PAT配置</h3><ul>
<li>转换inside区域1.1.1.1:80到Outside地址2.2.2.2:80</li>
<li>转换inside区域1.1.1.1:443到Outside地址2.2.2.3:443</li>
<li>实现双向流量(2.2.2.1为外部网络)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">object network Inside_http</span><br><span class="line">host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">nat (inside,outside) static <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> service tcp www www</span><br><span class="line">object network Inside_https</span><br><span class="line">host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">nat (inside,outside) static <span class="number">2.2</span><span class="number">.2</span><span class="number">.3</span> service tcp https https</span><br><span class="line"><span class="comment">##放行Inbound流量</span></span><br><span class="line">access-list out extended permit tcp host <span class="number">2.2</span><span class="number">.2</span><span class="number">.1</span> host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> eq www</span><br><span class="line">access-list out extended permit tcp host <span class="number">2.2</span><span class="number">.2</span><span class="number">.1</span> host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> eq https</span><br><span class="line">access-group out <span class="keyword">in</span> <span class="keyword">in</span> outside</span><br></pre></td></tr></table></figure>

<h3 id="动态PAT配置"><a href="#动态PAT配置" class="headerlink" title="动态PAT配置"></a>动态PAT配置</h3><blockquote>
<p>每个地址最多承载65535-1023个会话<br>支持使用ASA接口地址为转换后地址<br>转换时间默认30s</p>
</blockquote>
<ul>
<li>PAT转换Inside区域7.7.1.0/24到DMZ区域地址150.1.7.200</li>
<li>PAT转换Inside区域7.7.1.0/24到Outside区域地址202.200.200.100-200</li>
<li>当Outside地址池耗尽后，PAT转换到Outside_Interface_Address（出接口IP）</li>
<li>PAT转换DMZ区域150.1.7.0/24到Outside地址池202.200.200.202-202.200.200.210，启用循环使用机制</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#需求1配置</span></span><br><span class="line">object network Inside-Address</span><br><span class="line">subnet <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">object network DMZ<span class="number">-1</span></span><br><span class="line">host <span class="number">150.1</span><span class="number">.7</span><span class="number">.200</span></span><br><span class="line">object network Inside-Address</span><br><span class="line">nat (inside,DMZ) dynamic DMZ-Address</span><br><span class="line"><span class="comment">#需求2-3配置</span></span><br><span class="line">object network Inside-Address<span class="number">-1</span></span><br><span class="line">subnet <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">object network Outside-Pool</span><br><span class="line">range <span class="number">202.200</span><span class="number">.200</span><span class="number">.100</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.200</span></span><br><span class="line">object network Inside-Address<span class="number">-1</span></span><br><span class="line">nat (inside,outside) dynamic pat-pool Outside-Pool [interface]</span><br><span class="line"><span class="comment">#需求4配置</span></span><br><span class="line">object network DMZ<span class="number">-2</span></span><br><span class="line">subnet <span class="number">150.1</span><span class="number">.7</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">object network Outside-Pool<span class="number">-2</span></span><br><span class="line">range <span class="number">202.200</span><span class="number">.200</span><span class="number">.201</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.210</span></span><br><span class="line">nat (dmz,outside) dynamic pat-pool Outside-Pool<span class="number">-2</span> round-robin</span><br></pre></td></tr></table></figure>

<h2 id="Twice-NAT两次NAT"><a href="#Twice-NAT两次NAT" class="headerlink" title="Twice_NAT两次NAT"></a>Twice_NAT两次NAT</h2><img src="../../../images/ASA%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%E6%8A%80%E6%9C%AFNAT/asa1-1024x732.png" alt="img" style="zoom:75%;" />

<ul>
<li>根据流量的源和目的实现不同的转换</li>
<li>当Inside_1网络7.7.1.0/24去往Outside地址202.200.200.1时转换内部网络7.7.1.0/24到Outside区域地址202.200.200.150</li>
<li>当Inside_2网络7.7.2.0/24去往内部网络地址7.7.2.105时会被转送到目的地址202.200.200.1同时源网络7.7.2.0/24转换为Outside区域地址202.200.200.111</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#需求1配置</span></span><br><span class="line">object network Outside</span><br><span class="line"> host <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line">object network Inside_1</span><br><span class="line"> subnet <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">object network Nat-Address</span><br><span class="line"> host <span class="number">202.200</span><span class="number">.200</span><span class="number">.150</span></span><br><span class="line">nat (Inside_1,Outside) source dynamic Inside_1 Nat-Address destination static Outside Outside</span><br><span class="line"><span class="comment">#需求2配置（配置前清空上一个需求配置）</span></span><br><span class="line">object network Inside_2</span><br><span class="line"> subnet <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">object network Inside-nat-address</span><br><span class="line"> host <span class="number">7.7</span><span class="number">.2</span><span class="number">.105</span></span><br><span class="line">object network Outside-address</span><br><span class="line"> host <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line">object network Outside-nat-address</span><br><span class="line"> host <span class="number">202.200</span><span class="number">.200</span><span class="number">.111</span></span><br><span class="line">nat (Inside_2,Outside) source dynamic Inside_2 Outside-nat-address destination static Inside-nat-address Outside-address</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>Firewall</tag>
        <tag>NAT</tag>
      </tags>
  </entry>
  <entry>
    <title>ASA管理访问以及简单配置</title>
    <url>/2020/07/15/2020-07-ASA%E7%AE%A1%E7%90%86%E8%AE%BF%E9%97%AE%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE.html</url>
    <content><![CDATA[<h3 id="初始化-恢复出厂配置"><a href="#初始化-恢复出厂配置" class="headerlink" title="初始化/恢复出厂配置"></a>初始化/恢复出厂配置</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#恢复出场/初始化</span></span><br><span class="line">ciscoasa(config)<span class="comment"># configure factory-default </span></span><br><span class="line"><span class="comment">#清除全部配置</span></span><br><span class="line">ciscoasa(config)<span class="comment"># clear configure all</span></span><br><span class="line"><span class="comment">#清除启动配置</span></span><br><span class="line">ciscoasa(config)<span class="comment"># write erase</span></span><br><span class="line"><span class="comment">#清除指定配置</span></span><br><span class="line">ciscoasa(config)<span class="comment"># clear configure &lt;options&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="接口配置"><a href="#接口配置" class="headerlink" title="接口配置"></a>接口配置</h3><ul>
<li>每个接口都有一个安全级别。范围0-100，数值越低，安全级别越低</li>
<li>✅从高级别到低级别接口流量通过</li>
<li>❌从低级别到高级别接口流量通过</li>
<li>❌相同级别接口流量通过，可通过设置放行</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#接口配置</span></span><br><span class="line">interface GigabitEthernet0/<span class="number">1</span></span><br><span class="line"> nameif Outside                      //命名接口</span><br><span class="line"> security-level <span class="number">0</span>    //配置安全级别，<span class="number">0</span>最低<span class="number">100</span>最高</span><br><span class="line"> ip address <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#子接口配置</span></span><br><span class="line">interface GigabitEthernet0/<span class="number">2</span>     //物理接口必须no shutdown</span><br><span class="line"> no nameif    </span><br><span class="line"> no security-level</span><br><span class="line"> no ip address</span><br><span class="line">interface GigabitEthernet0/<span class="number">2.10</span></span><br><span class="line"> vlan <span class="number">10</span>                      //绑定vlan</span><br><span class="line"> nameif Inside_1              //命名接口</span><br><span class="line"> security-level <span class="number">100</span>            //配置安全级别</span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line"><span class="comment">#配置管理接口</span></span><br><span class="line">interface Management0/<span class="number">0</span></span><br><span class="line"> management-only              //只用于管理</span><br><span class="line"> nameif management            //命名接口</span><br><span class="line"> security-level <span class="number">100</span>           //配置安全级别</span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h3 id="ASDM配置"><a href="#ASDM配置" class="headerlink" title="ASDM配置"></a>ASDM配置</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看设备是否安装了ASDM</span></span><br><span class="line">ciscoasa<span class="comment"># dir</span></span><br><span class="line">Directory of disk0:/</span><br><span class="line"><span class="number">7</span>      -rwx  <span class="number">0</span>            <span class="number">04</span>:<span class="number">46</span>:<span class="number">52</span> Oct <span class="number">09</span> <span class="number">2016</span>  use_ttyS0</span><br><span class="line"><span class="number">10</span>     drwx  <span class="number">4096</span>         <span class="number">13</span>:<span class="number">44</span>:<span class="number">04</span> Jun <span class="number">08</span> <span class="number">2020</span>  smart-log</span><br><span class="line"><span class="number">8</span>      drwx  <span class="number">4096</span>         <span class="number">13</span>:<span class="number">43</span>:<span class="number">00</span> Jun <span class="number">08</span> <span class="number">2020</span>  log</span><br><span class="line"><span class="number">12</span>     drwx  <span class="number">4096</span>         <span class="number">13</span>:<span class="number">44</span>:<span class="number">14</span> Jun <span class="number">08</span> <span class="number">2020</span>  coredumpinfo</span><br><span class="line"><span class="number">81</span>     -rwx  <span class="number">6</span>            <span class="number">22</span>:<span class="number">15</span>:<span class="number">26</span> Jun <span class="number">08</span> <span class="number">2020</span>  <span class="number">1.l</span>og</span><br><span class="line"><span class="number">82</span>     -rwx  <span class="number">45989</span>        <span class="number">22</span>:<span class="number">17</span>:<span class="number">22</span> Jun <span class="number">08</span> <span class="number">2020</span>  ciscoasa.backup<span class="number">.2020</span><span class="number">-06</span><span class="number">-08</span><span class="number">-222517.</span>tar.gz</span><br><span class="line"><span class="number">8571076608</span> bytes total (<span class="number">8559792128</span> bytes free)</span><br><span class="line"><span class="comment">#指定ASDM位置</span></span><br><span class="line">ciscoasa(config)<span class="comment"># asdm image disk0:/xxx.bin</span></span><br></pre></td></tr></table></figure>

<h3 id="默认相同安全级别接口流量无法互通，互通配置："><a href="#默认相同安全级别接口流量无法互通，互通配置：" class="headerlink" title="默认相同安全级别接口流量无法互通，互通配置："></a>默认相同安全级别接口流量无法互通，互通配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置同一接口进出流量通信</span></span><br><span class="line">ciscoasa(config)<span class="comment"># same-security-traffic permit intre-interface </span></span><br><span class="line"><span class="comment">#配置相同安全级别接口通信</span></span><br><span class="line">ciscoasa(config)<span class="comment"># same-security-traffic permit intre-interface</span></span><br></pre></td></tr></table></figure>

<h3 id="DHCP配置"><a href="#DHCP配置" class="headerlink" title="DHCP配置"></a>DHCP配置</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dhcpd address <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span><span class="number">-192.168</span><span class="number">.1</span><span class="number">.10</span> Inside</span><br><span class="line">dhcpd dns <span class="number">114.114</span><span class="number">.114</span><span class="number">.114</span> interface Inside</span><br><span class="line">dhcpd lease <span class="number">86400</span> interface Inside</span><br><span class="line">dhcpd domain cisco.com interface Inside</span><br><span class="line">dhcpd enable Inside</span><br></pre></td></tr></table></figure>

<h3 id="启用http服务器并配置远程可信管理IP"><a href="#启用http服务器并配置远程可信管理IP" class="headerlink" title="启用http服务器并配置远程可信管理IP"></a>启用http服务器并配置远程可信管理IP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http server enable</span><br><span class="line">http &lt;trust-ip&gt; &lt;trust-mask&gt; &lt;zone-name&gt;</span><br><span class="line"><span class="comment">#允许所有网段</span></span><br><span class="line">http <span class="number">0</span> <span class="number">0</span> &lt;zone-name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="启用Telnet服务器并配置远程可信管理IP"><a href="#启用Telnet服务器并配置远程可信管理IP" class="headerlink" title="启用Telnet服务器并配置远程可信管理IP"></a>启用Telnet服务器并配置远程可信管理IP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#不配置enable password的话无法登陆，必须要配置</span></span><br><span class="line">enable password &lt;password&gt;</span><br><span class="line">username &lt;user-name&gt; password &lt;password&gt; privilege &lt;<span class="number">0</span><span class="number">-15</span>&gt;</span><br><span class="line">telnet &lt;trust-ip&gt; &lt;trust-mask&gt; &lt;zone-name&gt;</span><br><span class="line"><span class="comment">##例如：允许来自Inside区域，ip为192.168.1.2的流量telnet到ASA</span></span><br><span class="line">telnet <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span> Inside</span><br><span class="line">aaa authentication telnet console LOCAL   //LOCAL为大写</span><br><span class="line"><span class="comment">#允许所有网段</span></span><br><span class="line">telnet <span class="number">0</span> <span class="number">0</span> &lt;zone-name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="启用SSH服务器并配置远程可信管理IP"><a href="#启用SSH服务器并配置远程可信管理IP" class="headerlink" title="启用SSH服务器并配置远程可信管理IP"></a>启用SSH服务器并配置远程可信管理IP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#不配置enable password的话无法登陆，必须要配置</span></span><br><span class="line">enable password &lt;password&gt;</span><br><span class="line">username &lt;user-name&gt; password &lt;password&gt; privilege &lt;<span class="number">0</span><span class="number">-15</span>&gt;</span><br><span class="line">ssh version <span class="number">2</span></span><br><span class="line"><span class="comment">#8.X------旧版本配置</span></span><br><span class="line">domain-name cisco.com</span><br><span class="line">crypto key generate rsa modulus <span class="number">1024</span></span><br><span class="line">ssh &lt;trust-ip&gt; &lt;trust-mask&gt; &lt;zone-name&gt;</span><br><span class="line"><span class="comment">##例如：允许来自Inside区域，ip为192.168.1.2的流量ssh到ASA</span></span><br><span class="line">ssh <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span> Inside</span><br><span class="line">aaa authentication ssh console LOCAL     //LOCAL为大写</span><br><span class="line"><span class="comment">#9.X------新版本配置</span></span><br><span class="line">ssh &lt;trust-ip&gt; &lt;trust-mask&gt; &lt;zone-name&gt;</span><br><span class="line"><span class="comment">##例如：允许来自Inside区域，ip为192.168.1.2的流量ssh到ASA</span></span><br><span class="line">ssh <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span> Inside</span><br><span class="line">aaa authentication ssh console LOCAL     //LOCAL为大写</span><br><span class="line"><span class="comment">#允许所有网段</span></span><br><span class="line">ssh <span class="number">0</span> <span class="number">0</span> &lt;zone-name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="配置ntp同步"><a href="#配置ntp同步" class="headerlink" title="配置ntp同步"></a>配置ntp同步</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ntp authenticate                //开启NTP认证</span><br><span class="line">ntp authentication-key <span class="number">1</span> md5 &lt;key&gt;        //配置认证密钥，ID为<span class="number">1</span>，密钥为...</span><br><span class="line">ntp trust-key <span class="number">1</span>                  //可信任的密钥ID为<span class="number">1</span></span><br><span class="line">ntp server &lt;ntp-server-ip&gt; key <span class="number">1</span> source &lt;zone-name&gt;    //指定NTP服务器，并使用ID为<span class="number">1</span>的密钥做认证，指定数据包从哪个安全域发出</span><br><span class="line"><span class="comment">#验证ntp是否同步</span></span><br><span class="line">ciscoasa(config)<span class="comment"># show ntp status</span></span><br></pre></td></tr></table></figure>

<h3 id="配置DNS服务器"><a href="#配置DNS服务器" class="headerlink" title="配置DNS服务器"></a>配置DNS服务器</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dns domain-lookup &lt;zone-name&gt;          //指定DNS服务器所在安全区域</span><br><span class="line">dns server-group                       //进入DNS组，直接回车</span><br><span class="line">domain-name &lt;domain-name&gt;              //配置域名</span><br><span class="line">name-server &lt;dns-server-ip&gt;            //指定DNS服务器IP地址</span><br></pre></td></tr></table></figure>

<h3 id="日志管理"><a href="#日志管理" class="headerlink" title="日志管理"></a>日志管理</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">logging enable                  //开启日志</span><br><span class="line">logging debug-trace             //将debug信息作为日志发送到服务器</span><br><span class="line">logging asdm <span class="number">7</span>                  //将等级为<span class="number">7</span>的日志信息发到asdm上</span><br><span class="line">logging timetamp                //给日志关联时间戳</span><br><span class="line">logging host &lt;zone-name&gt; &lt;syslog-server-ip&gt;     //将等级为<span class="number">7</span>的日志发送到syslog服务器上</span><br><span class="line"><span class="comment">#日志信息过滤：只允许发送级别为6的ospf日志信息</span></span><br><span class="line">logging list Permit_OSPF level informational <span class="class"><span class="keyword">class</span> <span class="title">ospf</span></span></span><br><span class="line"><span class="class"><span class="title">logging</span> <span class="title">asdm</span> <span class="title">Permit_OSPF</span></span></span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>Asdm</tag>
        <tag>Dhcp</tag>
        <tag>Managent</tag>
      </tags>
  </entry>
  <entry>
    <title>ASA虚拟化防火墙</title>
    <url>/2020/07/18/2020-07-ASA%E8%99%9A%E6%8B%9F%E5%8C%96%E9%98%B2%E7%81%AB%E5%A2%99.html</url>
    <content><![CDATA[<h2 id="虚拟化防火墙"><a href="#虚拟化防火墙" class="headerlink" title="虚拟化防火墙"></a>虚拟化防火墙</h2><p>也被成为多模式防火墙，在虚拟防火墙环境中，安全设备可分为3类：</p>
<ul>
<li>系统执行空间</li>
<li>管理虚拟防火墙（管理墙）</li>
<li>用户虚拟防火墙（子墙）</li>
</ul>
<h2 id="单模式和多模式防火墙的对比"><a href="#单模式和多模式防火墙的对比" class="headerlink" title="单模式和多模式防火墙的对比"></a>单模式和多模式防火墙的对比</h2><table>
<thead>
<tr>
<th>特性</th>
<th>单模</th>
<th>多模</th>
</tr>
</thead>
<tbody><tr>
<td>接口</td>
<td>所有物理接口可直接使用</td>
<td>只能使用分配接口</td>
</tr>
<tr>
<td>文件管理</td>
<td>允许管理员复制系统镜像与文件</td>
<td>子墙管理员只能管理对应子墙文件，管理墙除外</td>
</tr>
<tr>
<td>许可证</td>
<td>不需要通过许可证开启单模</td>
<td>需要通过许可证开启多模</td>
</tr>
<tr>
<td>路由协议</td>
<td>RIP、EIGRP、OSPF</td>
<td>从9.0（1）开始支持EIGRP和OSPF V2</td>
</tr>
<tr>
<td>Failover</td>
<td>不支持双A的故障置换模式</td>
<td>支持双A的故障置换模式</td>
</tr>
<tr>
<td>Cluster</td>
<td>支持集群</td>
<td>支持集群</td>
</tr>
<tr>
<td>QOS</td>
<td>支持QOS</td>
<td>不支持QOS</td>
</tr>
<tr>
<td>组播</td>
<td>支持PIM-SM组播</td>
<td>不支持，但组播流量可穿越防火墙</td>
</tr>
<tr>
<td>透明防火墙</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>IPSecVPN</td>
<td>支持</td>
<td>从9.0（1）开始支持</td>
</tr>
<tr>
<td>SSLVPN</td>
<td>支持</td>
<td>不支持</td>
</tr>
</tbody></table>
<h2 id="配置实验："><a href="#配置实验：" class="headerlink" title="配置实验："></a>配置实验：</h2><ul>
<li>拓扑如图</li>
<li>配置虚拟化防火墙<ul>
<li>创建管理墙Admin</li>
<li>创建子墙Vir</li>
</ul>
</li>
<li>解决共享接口问题</li>
<li>针对子墙进行资源管控<ul>
<li>限制admin子墙的网管流量均为两个会话，资源分类名字为Level1</li>
<li>限制Vir子墙的连接数为60%资源分类名字为Level2</li>
</ul>
</li>
</ul>
<img src="../../../images/ASA%E8%99%9A%E6%8B%9F%E5%8C%96%E9%98%B2%E7%81%AB%E5%A2%99/asa-2-1-1024x896.png" alt="img" style="zoom:50%;" />

<h3 id="预配置："><a href="#预配置：" class="headerlink" title="预配置："></a>预配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Outside配置</span></span><br><span class="line">interface e0/<span class="number">0</span></span><br><span class="line">  ip add <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  no shutdown</span><br><span class="line"><span class="comment">#Inside配置</span></span><br><span class="line">interface e0/<span class="number">0</span></span><br><span class="line">  ip add <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  no shutdown</span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line"><span class="comment">#Admin_DMZ配置</span></span><br><span class="line">interface e0/<span class="number">0</span></span><br><span class="line">  ip add <span class="number">150.1</span><span class="number">.7</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  no shutdown</span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">150.1</span><span class="number">.7</span><span class="number">.10</span></span><br><span class="line"><span class="comment">#Vir_DMZ配置</span></span><br><span class="line">interface e0/<span class="number">0</span></span><br><span class="line">  ip add <span class="number">7.7</span><span class="number">.2</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  no shutdown</span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.20</span></span><br><span class="line"><span class="comment">#SW配置</span></span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">interface Ethernet1/<span class="number">0</span></span><br><span class="line"> switchport access vlan <span class="number">3</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet1/<span class="number">1</span></span><br><span class="line"> switchport access vlan <span class="number">5</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet1/<span class="number">2</span></span><br><span class="line"> switchport access vlan <span class="number">4</span></span><br><span class="line"> switchport mode access</span><br></pre></td></tr></table></figure>

<h3 id="配置ASA"><a href="#配置ASA" class="headerlink" title="配置ASA"></a>配置ASA</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#切换防火墙模式为多模</span></span><br><span class="line">ASA(config)<span class="comment"># mode multiple  //一旦切换模式，配置将被清空并重启，旧的running-config配置被保存到Flash下，命名为old_running.cfg</span></span><br><span class="line"><span class="comment">##如何切换为单模</span></span><br><span class="line">ASA(config)<span class="comment"># mode singel</span></span><br><span class="line"><span class="comment">##查看防火墙模式</span></span><br><span class="line">ASA(config)<span class="comment"># show mode </span></span><br><span class="line">Security context mode: multiple</span><br><span class="line"><span class="comment">#配置系统执行空间</span></span><br><span class="line"><span class="comment">##开启物理接口</span></span><br><span class="line">interface ethernet <span class="number">0</span></span><br><span class="line">no shutdown</span><br><span class="line">interface ethernet <span class="number">1</span> </span><br><span class="line">no shutdown</span><br><span class="line"><span class="comment">##配置子接口</span></span><br><span class="line">interface ethernet <span class="number">1.3</span></span><br><span class="line">description To_Admin</span><br><span class="line">vlan <span class="number">3</span></span><br><span class="line">interface ethernet <span class="number">1.4</span>    </span><br><span class="line">description To_Inside</span><br><span class="line">vlan <span class="number">4</span></span><br><span class="line">interface ethernet <span class="number">1.5</span>     </span><br><span class="line">description To_Vir   </span><br><span class="line">vlan <span class="number">5</span> </span><br><span class="line"><span class="comment">#创建管理墙admin</span></span><br><span class="line">ASA(config)<span class="comment"># delete flash:admin.cfg</span></span><br><span class="line">Delete filename [admin.cfg]?     //删除位于flash中残余的admin.cfg文件</span><br><span class="line">Delete disk0:/admin.cfg? [confirm]   </span><br><span class="line">ASA(config)<span class="comment"># admin-context admin   //指定名为admin的子墙为管理墙</span></span><br><span class="line">ASA(config)<span class="comment"># context admin</span></span><br><span class="line">ASA(config-ctx)<span class="comment"># allocate-interface Ethernet0</span></span><br><span class="line">ASA(config-ctx)<span class="comment"># allocate-interface Ethernet1.3-Ethernet1.4</span></span><br><span class="line">ASA(config-ctx)<span class="comment"># config-url disk0:/admin.cfg   //关联物理或逻辑接口到子防火墙，并指派子防火墙配置文件备份路径</span></span><br><span class="line"><span class="comment">#创建用户墙Vir</span></span><br><span class="line">ASA(config-ctx)<span class="comment"># context Vir</span></span><br><span class="line">Creating context <span class="string">'Vir'</span>... Done. (<span class="number">2</span>)</span><br><span class="line">ASA(config-ctx)<span class="comment"># allocate-interface Ethernet0             </span></span><br><span class="line">ASA(config-ctx)<span class="comment"># allocate-interface Ethernet1.4-Ethernet1.5</span></span><br><span class="line">ASA(config-ctx)<span class="comment"># config-url disk0:/Vir.cfg</span></span><br><span class="line"><span class="comment">#配置管理墙admin</span></span><br><span class="line">ASA(config-ctx)<span class="comment"># changeto context admin   //切换到管理墙</span></span><br><span class="line">interface ethernet <span class="number">0</span></span><br><span class="line">no shutdown</span><br><span class="line">nameif Outside</span><br><span class="line">ip add <span class="number">7.7</span><span class="number">.3</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface ethernet <span class="number">1.3</span></span><br><span class="line">ip add <span class="number">150.1</span><span class="number">.7</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">nameif DMZ</span><br><span class="line">security-level <span class="number">50</span></span><br><span class="line">interface ethernet <span class="number">1.4</span></span><br><span class="line">nameif Inside</span><br><span class="line">security-level <span class="number">100</span></span><br><span class="line">ip add <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#配置用户墙Vir</span></span><br><span class="line">ASA/admin(config-<span class="keyword">if</span>)<span class="comment"># changeto context Vir</span></span><br><span class="line">interface ethernet <span class="number">0</span></span><br><span class="line">no shutdown</span><br><span class="line">nameif Outside</span><br><span class="line">ip add <span class="number">7.7</span><span class="number">.3</span><span class="number">.20</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">security-level <span class="number">100</span></span><br><span class="line">interface ethernet <span class="number">1.5</span>       </span><br><span class="line">nameif DMZ                   </span><br><span class="line">ip add <span class="number">7.7</span><span class="number">.2</span><span class="number">.20</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">security-level <span class="number">50</span></span><br></pre></td></tr></table></figure>

<h4 id="Vir子墙配置静态NAT，并测试："><a href="#Vir子墙配置静态NAT，并测试：" class="headerlink" title="Vir子墙配置静态NAT，并测试："></a>Vir子墙配置静态NAT，并测试：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">object network Vir-DMZ</span><br><span class="line"> host <span class="number">7.7</span><span class="number">.2</span><span class="number">.1</span></span><br><span class="line"> nat (DMZ,Outside) static <span class="number">7.7</span><span class="number">.3</span><span class="number">.100</span></span><br><span class="line">access-list out extended permit tcp host <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> host <span class="number">7.7</span><span class="number">.2</span><span class="number">.1</span> eq telnet </span><br><span class="line"><span class="comment">###############################测试###################################</span></span><br><span class="line">Outside<span class="comment">#telnet 7.7.3.100</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.3</span><span class="number">.100</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Username: cisco</span><br><span class="line">Password: </span><br><span class="line">Vir_DMZ<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h4 id="Admin管理墙配置静态NAT，并测试："><a href="#Admin管理墙配置静态NAT，并测试：" class="headerlink" title="Admin管理墙配置静态NAT，并测试："></a>Admin管理墙配置静态NAT，并测试：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">object network Inside</span><br><span class="line"> subnet <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> nat (Inside,Outside) dynamic interface</span><br><span class="line"><span class="comment">###############################测试###################################</span></span><br><span class="line">Inside<span class="comment">#telnet 7.7.3.1</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> ... </span><br><span class="line">% Connection timed out; remote host <span class="keyword">not</span> responding</span><br></pre></td></tr></table></figure>

<h3 id="解决共享Inside接口问题："><a href="#解决共享Inside接口问题：" class="headerlink" title="解决共享Inside接口问题："></a>解决共享Inside接口问题：</h3><h4 id="方法1-分别为admin和Vir墙手动指定Inside接口Mac，并测试："><a href="#方法1-分别为admin和Vir墙手动指定Inside接口Mac，并测试：" class="headerlink" title="方法1:分别为admin和Vir墙手动指定Inside接口Mac，并测试："></a>方法1:分别为admin和Vir墙手动指定Inside接口Mac，并测试：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASA/admin(config)<span class="comment"># interface ethernet1.4</span></span><br><span class="line">ASA/admin(config-<span class="keyword">if</span>)<span class="comment"># mac-address 0001.0001.0001</span></span><br><span class="line">ASA/admin(config-<span class="keyword">if</span>)<span class="comment"># changeto context Vir</span></span><br><span class="line">ASA/Vir(config)<span class="comment"># interface ethernet1.4</span></span><br><span class="line">ASA/Vir(config-<span class="keyword">if</span>)<span class="comment"># mac-address 0002.0002.0002</span></span><br><span class="line"><span class="comment">###############################测试###################################</span></span><br><span class="line">Inside<span class="comment">#telnet 7.7.3.1</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Username: cisco</span><br><span class="line">Password: </span><br><span class="line">Outside<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h4 id="方法2-自动产生Mac地址，并测试："><a href="#方法2-自动产生Mac地址，并测试：" class="headerlink" title="方法2:自动产生Mac地址，并测试："></a>方法2:自动产生Mac地址，并测试：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在系统执行空间下进行配置</span></span><br><span class="line">ASA/Vir(config-<span class="keyword">if</span>)<span class="comment"># changeto system </span></span><br><span class="line">ASA(config)<span class="comment"># mac-address auto</span></span><br><span class="line"><span class="comment">###############################测试###################################</span></span><br><span class="line">Inside<span class="comment">#telnet 7.7.3.1</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Username: cisco</span><br><span class="line">Password: </span><br><span class="line">Outside<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h3 id="测试admin防火墙和其他防火墙的区别："><a href="#测试admin防火墙和其他防火墙的区别：" class="headerlink" title="测试admin防火墙和其他防火墙的区别："></a>测试admin防火墙和其他防火墙的区别：</h3><h4 id="admin和Vir子墙同时允许Inside-Telnet网管"><a href="#admin和Vir子墙同时允许Inside-Telnet网管" class="headerlink" title="admin和Vir子墙同时允许Inside Telnet网管"></a>admin和Vir子墙同时允许Inside Telnet网管</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASA/admin(config)<span class="comment"># username admin password cisco privilege 15</span></span><br><span class="line">ASA/admin(config)<span class="comment"># telnet 7.7.1.1 255.255.255.255 inside </span></span><br><span class="line">ASA/Vir(config)<span class="comment"># username admin password cisco privilege 15</span></span><br><span class="line">ASA/Vir(config)<span class="comment"># telnet 7.7.1.1 255.255.255.255 inside</span></span><br></pre></td></tr></table></figure>

<h4 id="测试1-telnet-admin子墙"><a href="#测试1-telnet-admin子墙" class="headerlink" title="测试1:telnet admin子墙"></a>测试1:telnet admin子墙</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside<span class="comment">#telnet 7.7.1.10</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Password: </span><br><span class="line">Type help <span class="keyword">or</span> <span class="string">'?'</span> <span class="keyword">for</span> a list of available commands.</span><br><span class="line">ASA/admin&gt; en</span><br><span class="line">Password: </span><br><span class="line">ASA/admin<span class="comment"># changeto context Vir</span></span><br><span class="line">ASA/Vir<span class="comment"># changeto context admin</span></span><br><span class="line">ASA/admin<span class="comment"># changeto system </span></span><br><span class="line">ASA<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h4 id="测试2-telnet-Vir子墙"><a href="#测试2-telnet-Vir子墙" class="headerlink" title="测试2:telnet Vir子墙"></a>测试2:telnet Vir子墙</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside<span class="comment">#telnet 7.7.1.20</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.1</span><span class="number">.20</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Password: </span><br><span class="line">Type help <span class="keyword">or</span> <span class="string">'?'</span> <span class="keyword">for</span> a list of available commands.</span><br><span class="line">ASA/Vir&gt; en</span><br><span class="line">Password:  </span><br><span class="line">ASA/Vir<span class="comment"># changeto context admin</span></span><br><span class="line">Command <span class="keyword">not</span> valid <span class="keyword">in</span> current execution space</span><br><span class="line">ASA/Vir<span class="comment"># changeto system       </span></span><br><span class="line">Command <span class="keyword">not</span> valid <span class="keyword">in</span> current execution space</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>结论：telnet到管理墙，可以进入system、Vir子墙<br>telnet到Vir子墙，只能在Vir子墙配置</strong></p>
</blockquote>
<h2 id="资源管理"><a href="#资源管理" class="headerlink" title="资源管理"></a>资源管理</h2><ul>
<li>默认状态下，子墙可以无限制使用ASA的硬件资源。</li>
<li>资源管理限制来每个子墙对硬件资源的使用</li>
<li>防止一个子墙把资源耗尽，这样可能会导致其他的子墙性能或连通性的问题</li>
</ul>
<h3 id="防火墙默认资源分类："><a href="#防火墙默认资源分类：" class="headerlink" title="防火墙默认资源分类："></a>防火墙默认资源分类：</h3><ul>
<li>ASA通过指派子防火墙到资源类，来管理系统资源</li>
<li>默认情况下，每一个子墙属于一个默认分类，这个默认的分类是有预定义限制的</li>
<li>每一个新创建的资源分类都继承来自于默认分类的所有的限制</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">default</span></span></span><br><span class="line"><span class="class">  <span class="title">limit</span>-<span class="title">resource</span> <span class="title">All</span> 0</span></span><br><span class="line"><span class="class">  <span class="title">limit</span>-<span class="title">resource</span> <span class="title">ASDM</span> 5</span></span><br><span class="line"><span class="class">  <span class="title">limit</span>-<span class="title">resource</span> <span class="title">SSH</span> 5</span></span><br><span class="line"><span class="class">  <span class="title">limit</span>-<span class="title">resource</span> <span class="title">Telnet</span> 5</span></span><br></pre></td></tr></table></figure>

<h3 id="为成员类分配资源"><a href="#为成员类分配资源" class="headerlink" title="为成员类分配资源"></a>为成员类分配资源</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASA(config)<span class="comment"># class Level1</span></span><br><span class="line">ASA(config-<span class="class"><span class="keyword">class</span>)# <span class="title">limit</span>-<span class="title">resource</span> <span class="title">telnet</span> 2</span></span><br><span class="line"><span class="class"><span class="title">ASA</span><span class="params">(config-class)</span># <span class="title">limit</span>-<span class="title">resource</span> <span class="title">ssh</span> 2   </span></span><br><span class="line"><span class="class"><span class="title">ASA</span><span class="params">(config-class)</span># <span class="title">limit</span>-<span class="title">resource</span> <span class="title">asdm</span> 2</span></span><br><span class="line"><span class="class"><span class="title">ASA</span><span class="params">(config)</span># <span class="title">class</span> <span class="title">Level2</span></span></span><br><span class="line"><span class="class"><span class="title">ASA</span><span class="params">(config-class)</span># <span class="title">limit</span>-<span class="title">resource</span> <span class="title">Conns</span> 60%</span></span><br></pre></td></tr></table></figure>

<h3 id="将成员类映射给对应的虚拟防火墙"><a href="#将成员类映射给对应的虚拟防火墙" class="headerlink" title="将成员类映射给对应的虚拟防火墙"></a>将成员类映射给对应的虚拟防火墙</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASA(config)<span class="comment"># context admin</span></span><br><span class="line">ASA(config-ctx)<span class="comment"># member Level1</span></span><br><span class="line">ASA(config)<span class="comment"># context Vir</span></span><br><span class="line">ASA(config-ctx)<span class="comment"># member Level2</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>Firewall</tag>
        <tag>虚拟化</tag>
      </tags>
  </entry>
  <entry>
    <title>ASA高可用性</title>
    <url>/2020/07/15/2020-07-ASA%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7.html</url>
    <content><![CDATA[<h2 id="以太通道"><a href="#以太通道" class="headerlink" title="以太通道"></a>以太通道</h2><h3 id="交换机以太通道阐述"><a href="#交换机以太通道阐述" class="headerlink" title="交换机以太通道阐述"></a>交换机以太通道阐述</h3><ul>
<li>冗余接口只允许一主一备，无法充分利用两个接口，这将导致利用率更高的EtherChannel技术加入到ASA中</li>
<li>EtherChannel允许最多8个物理链路捆绑到一个逻辑链路中（IEEE standard is 802.3ad）</li>
<li>端口必须具有相同的功能：duplex，speed，等等</li>
<li>EtherChannel具有load-balancing和HA功能</li>
<li>可以部署在两台交换机之间或服务器与交换机之间</li>
</ul>
<h3 id="ASA以太通道阐述"><a href="#ASA以太通道阐述" class="headerlink" title="ASA以太通道阐述"></a>ASA以太通道阐述</h3><ul>
<li>支持802.3ad和标准的LACP</li>
<li>最多支持8个主用和8个备用链路</li>
<li>支持所有的模式（transparent，routed，multi-context）</li>
<li>可以配置HASH算法（default issrc / dest IP）（实现负载均衡）</li>
<li>成员可以共享MAC-address</li>
<li>5505不支持EtherChannel</li>
</ul>
<h3 id="ASA-EtherChannel-实验配置"><a href="#ASA-EtherChannel-实验配置" class="headerlink" title="ASA EtherChannel 实验配置"></a>ASA EtherChannel 实验配置</h3><img src="../../../images/%E6%A8%A1%E6%9D%BF%20(copy)/QQ20200630-194859@2x.png" alt="img" style="zoom:75%;" />

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ASA EtherChannel配置</span></span><br><span class="line">interface ethernet <span class="number">0</span></span><br><span class="line">  channel-group <span class="number">1</span> mode active</span><br><span class="line">  no shutdown</span><br><span class="line">interface ethernet <span class="number">1</span></span><br><span class="line">  channel-group <span class="number">1</span> mode active</span><br><span class="line">  no shutdown</span><br><span class="line">interface ethernet <span class="number">2</span></span><br><span class="line">  channel-group <span class="number">1</span> mode active</span><br><span class="line">  no shutdown  </span><br><span class="line">interface port-channel <span class="number">1</span></span><br><span class="line">  nameif Inside</span><br><span class="line">  security-level <span class="number">100</span></span><br><span class="line">  ip address <span class="number">7.7</span><span class="number">.1</span><span class="number">.254</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#交换机配置</span></span><br><span class="line">interface range ethernet <span class="number">0</span>/<span class="number">0</span><span class="number">-2</span></span><br><span class="line">  switchport mode access</span><br><span class="line">  switchport access vlan <span class="number">1</span></span><br><span class="line">  channel-group <span class="number">1</span> mode active</span><br><span class="line">interface port-channel1</span><br><span class="line">switch mode access</span><br><span class="line">interface vlan <span class="number">1</span></span><br><span class="line">  ip add <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#交换机查看Etherchannel状态</span></span><br><span class="line">Switch<span class="comment">#show etherchannel summary </span></span><br><span class="line">Group  Port-channel  Protocol    Ports</span><br><span class="line">------+-------------+-----------+-----------------------------------------------</span><br><span class="line"><span class="number">1</span>      Po1(SU)         LACP      Et0/<span class="number">0</span>(P)    Et0/<span class="number">1</span>(P)    Et0/<span class="number">2</span>(P)  </span><br><span class="line"><span class="comment">#ASA查看Etherchannel状态</span></span><br><span class="line">ASA<span class="comment"># sh port-channel summary                                                 </span></span><br><span class="line">Group  Port-channel  Protocol    Ports</span><br><span class="line">------+-------------+-----------+-----------------------------------------------</span><br><span class="line"><span class="number">1</span>      Po1(U)            LACP    Et0(P)   Et1(P)   Et2(P) </span><br><span class="line">  </span><br><span class="line">ASA<span class="comment"># show interface port-channel 1</span></span><br><span class="line">Interface Port-channel1 <span class="string">"Inside"</span>, <span class="keyword">is</span> up, line protocol <span class="keyword">is</span> up</span><br><span class="line">  Hardware <span class="keyword">is</span> EtherChannel/LACP, BW <span class="number">300</span> Mbps, DLY <span class="number">100</span> usec</span><br><span class="line">        Auto-Duplex(Full-duplex), Auto-Speed(<span class="number">100</span> Mbps)</span><br><span class="line">        Input flow control <span class="keyword">is</span> unsupported, output flow control <span class="keyword">is</span> unsupported</span><br><span class="line">        MAC address <span class="number">5000.0001</span><span class="number">.0000</span>, MTU <span class="number">1500</span></span><br><span class="line">        IP address <span class="number">7.7</span><span class="number">.1</span><span class="number">.254</span>, subnet mask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  Members <span class="keyword">in</span> this channel:</span><br><span class="line">      Active:   Et0 Et1 Et2  </span><br><span class="line"><span class="comment">#关闭E0再次查看</span></span><br><span class="line">ASA<span class="comment"># sh interface port-channel 1</span></span><br><span class="line">Interface Port-channel1 <span class="string">"Inside"</span>, <span class="keyword">is</span> up, line protocol <span class="keyword">is</span> up</span><br><span class="line">  Hardware <span class="keyword">is</span> EtherChannel/LACP, BW <span class="number">200</span> Mbps, DLY <span class="number">100</span> usec</span><br><span class="line">        Auto-Duplex(Full-duplex), Auto-Speed(<span class="number">100</span> Mbps)</span><br><span class="line">        Input flow control <span class="keyword">is</span> unsupported, output flow control <span class="keyword">is</span> unsupported</span><br><span class="line">        MAC address <span class="number">5000.0001</span><span class="number">.0000</span>, MTU <span class="number">1500</span></span><br><span class="line">        IP address <span class="number">7.7</span><span class="number">.1</span><span class="number">.254</span>, subnet mask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  Members <span class="keyword">in</span> this channel:</span><br><span class="line">      Active:   Et1 Et2 </span><br><span class="line">      Inactive: Et0</span><br></pre></td></tr></table></figure>

<h2 id="冗余接口"><a href="#冗余接口" class="headerlink" title="冗余接口"></a>冗余接口</h2><h3 id="冗余接口阐述"><a href="#冗余接口阐述" class="headerlink" title="冗余接口阐述"></a>冗余接口阐述</h3><ul>
<li>一对物理接口可以捆绑进入一个冗余接口并提供接口级别的冗余</li>
<li>这些组成冗余接口的物理接口叫做成员（members）</li>
<li>一个成员是主用接口，另一个成员是备用接口，如果主坏备切</li>
<li>在冗余接口下可以执行所有的接口配置</li>
</ul>
<h3 id="冗余接口部署指导方针"><a href="#冗余接口部署指导方针" class="headerlink" title="冗余接口部署指导方针"></a>冗余接口部署指导方针</h3><ul>
<li>可以配置多达8个冗余接口对</li>
<li>不能够指派一个子接口到一个冗余接口</li>
<li>不支持使用专用的物理管理接口</li>
<li>不支持Cisco_ASA_5505</li>
<li>所有接口硬件类型一致</li>
<li>按照输入顺序，先输入为主用，后输入为备用</li>
<li>逻辑冗余接口启用的MAC地址为主用接口的MAC地址</li>
<li>两个冗余接口可以连接到一个交换机，也可以分别连接一个交换机</li>
</ul>
<h2 id="当冗余主用接口出现问题，ASA会执行以下步骤"><a href="#当冗余主用接口出现问题，ASA会执行以下步骤" class="headerlink" title="当冗余主用接口出现问题，ASA会执行以下步骤"></a>当冗余主用接口出现问题，ASA会执行以下步骤</h2><ul>
<li>一个冗余接口使用添加到捆绑的第一个物理接口的MAC地址</li>
<li>当一个备用接口成为主用时，防火墙通过新的主用接口发送一个免费的ARP回应，用此更新交换机的CAM表</li>
</ul>
<h2 id="ASA冗余接口实验配置"><a href="#ASA冗余接口实验配置" class="headerlink" title="ASA冗余接口实验配置"></a>ASA冗余接口实验配置</h2><p><img src="../../../images/ASA%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7/QQ20200630-194859@2x-20200717134706874.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ASA配置</span></span><br><span class="line">interface ethernet <span class="number">0</span></span><br><span class="line">  no shutdown</span><br><span class="line">interface ethernet <span class="number">1</span></span><br><span class="line">  no shutdown</span><br><span class="line">interface Redundant1</span><br><span class="line">member-interface ethernet <span class="number">0</span></span><br><span class="line">member-interface ethernet <span class="number">1</span></span><br><span class="line">nameif Security</span><br><span class="line">security <span class="number">80</span></span><br><span class="line">ip address <span class="number">7.7</span><span class="number">.3</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#SW配置</span></span><br><span class="line">interface vlan <span class="number">1</span></span><br><span class="line">  ip address <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  no shutdown</span><br><span class="line">interface range ethernet <span class="number">0</span><span class="number">-1</span></span><br><span class="line">  switchport mode access</span><br><span class="line">  switchport access vlan <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看冗余接口状态</span></span><br><span class="line">ciscoasa(config-<span class="keyword">if</span>)<span class="comment"># show interface redundant 1                              </span></span><br><span class="line">Interface Redundant1 <span class="string">"Security"</span>, <span class="keyword">is</span> up, line protocol <span class="keyword">is</span> up</span><br><span class="line">  Hardware <span class="keyword">is</span> i82559, BW <span class="number">100</span> Mbps, DLY <span class="number">100</span> usec</span><br><span class="line">        Auto-Duplex(Full-duplex), Auto-Speed(<span class="number">100</span> Mbps)</span><br><span class="line">        Input flow control <span class="keyword">is</span> unsupported, output flow control <span class="keyword">is</span> unsupported</span><br><span class="line">        MAC address <span class="number">5000.0001</span><span class="number">.0000</span>, MTU <span class="number">1500</span></span><br><span class="line">        IP address <span class="number">7.7</span><span class="number">.3</span><span class="number">.2</span>, subnet mask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  Redundancy Information:</span><br><span class="line">        Member Ethernet0(Active), Ethernet1</span><br><span class="line">        Last switchover at <span class="number">16</span>:<span class="number">22</span>:<span class="number">41</span> UTC Jun <span class="number">30</span> <span class="number">2020</span></span><br><span class="line"></span><br><span class="line">          </span><br><span class="line">Switch<span class="comment">#show mac address-table  </span></span><br><span class="line">          Mac Address Table</span><br><span class="line">-------------------------------------------</span><br><span class="line"></span><br><span class="line">Vlan    Mac Address       Type        Ports</span><br><span class="line">----    -----------       --------    -----</span><br><span class="line">   <span class="number">1</span>    <span class="number">5000.0001</span><span class="number">.0000</span>    DYNAMIC     Et0/<span class="number">0</span></span><br><span class="line">Total Mac Addresses <span class="keyword">for</span> this criterion: <span class="number">1</span>          </span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭Ethernet0，再次查看</span></span><br><span class="line">ciscoasa(config-<span class="keyword">if</span>)<span class="comment"># show interface redundant 1                              </span></span><br><span class="line">Interface Redundant1 <span class="string">"Security"</span>, <span class="keyword">is</span> up, line protocol <span class="keyword">is</span> up</span><br><span class="line">  Hardware <span class="keyword">is</span> i82559, BW <span class="number">100</span> Mbps, DLY <span class="number">100</span> usec</span><br><span class="line">        Auto-Duplex(Full-duplex), Auto-Speed(<span class="number">100</span> Mbps)</span><br><span class="line">        Input flow control <span class="keyword">is</span> unsupported, output flow control <span class="keyword">is</span> unsupported</span><br><span class="line">        MAC address <span class="number">5000.0001</span><span class="number">.0000</span>, MTU <span class="number">1500</span></span><br><span class="line">        IP address <span class="number">7.7</span><span class="number">.3</span><span class="number">.2</span>, subnet mask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  Redundancy Information:</span><br><span class="line">        Member Ethernet1(Active), Ethernet0</span><br><span class="line">        Last switchover at <span class="number">16</span>:<span class="number">22</span>:<span class="number">41</span> UTC Jun <span class="number">30</span> <span class="number">2020</span></span><br><span class="line"></span><br><span class="line">Switch<span class="comment">#show mac address-table  </span></span><br><span class="line">          Mac Address Table</span><br><span class="line">-------------------------------------------</span><br><span class="line"></span><br><span class="line">Vlan    Mac Address       Type        Ports</span><br><span class="line">----    -----------       --------    -----</span><br><span class="line">   <span class="number">1</span>    <span class="number">5000.0001</span><span class="number">.0000</span>    DYNAMIC     Et0/<span class="number">1</span></span><br><span class="line">Total Mac Addresses <span class="keyword">for</span> this criterion: <span class="number">1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>接口冗余不会自动抢占，可以手动切换。命令：<br><code>redundant-interface redundant 1 active-member ethernet 0</code></p>
</blockquote>
]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>高可用性</tag>
      </tags>
  </entry>
  <entry>
    <title>ASA静态路由与路由监测</title>
    <url>/2020/07/18/2020-07-ASA%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E4%B8%8E%E8%B7%AF%E7%94%B1%E7%9B%91%E6%B5%8B.html</url>
    <content><![CDATA[<h3 id="配置静态路由"><a href="#配置静态路由" class="headerlink" title="配置静态路由"></a>配置静态路由</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ciscoasa(config)<span class="comment"># route outside 3.3.3.0 255.255.255.0 202.200.200.1</span></span><br></pre></td></tr></table></figure>

<h3 id="配置静态路由监测"><a href="#配置静态路由监测" class="headerlink" title="配置静态路由监测"></a>配置静态路由监测</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sla monitor <span class="number">10</span>      //创建SLA监测，序号为<span class="number">10</span></span><br><span class="line">  type echo protocol ipIcmpEcho <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span> interface Inside_1      //通过从Inside_1接口发送ICMP Echo，监测IP为<span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span>网关</span><br><span class="line">  num-packets <span class="number">2</span>      //每次发送两个ICMP Echo执行探测</span><br><span class="line">  timeout <span class="number">4000</span>       //<span class="number">4</span>s时间内，仍然没有收到回包=路径失败，启用备用路径</span><br><span class="line">  frequency <span class="number">10</span>       //每<span class="number">10</span>s执行一次探测</span><br><span class="line">sla monitor schedule <span class="number">10</span> life forever start-time now     //启用探测，并且不间断运行</span><br><span class="line">track <span class="number">20</span> rtr <span class="number">10</span> reachability        //创建一个静态路由跟踪实例，关联SLA10</span><br><span class="line">route inside_1 <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span> <span class="number">1</span> track <span class="number">20</span>      //配置主路径，并关联跟踪实例</span><br><span class="line">route inside_2 <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.1</span> <span class="number">100</span>          //配置备用路径</span><br></pre></td></tr></table></figure>

<h3 id="查看正常情况下Track-Status与路由"><a href="#查看正常情况下Track-Status与路由" class="headerlink" title="查看正常情况下Track Status与路由"></a>查看正常情况下Track Status与路由</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看Track Status</span></span><br><span class="line">ciscoasa<span class="comment"># sh track</span></span><br><span class="line">Track <span class="number">20</span></span><br><span class="line">  Response Time Reporter <span class="number">10</span> reachability</span><br><span class="line">  Reachability <span class="keyword">is</span> Up                               //Up</span><br><span class="line">  <span class="number">2</span> changes, last change <span class="number">00</span>:<span class="number">00</span>:<span class="number">02</span></span><br><span class="line">  Latest operation <span class="keyword">return</span> code: OK</span><br><span class="line">  Latest RTT (millisecs) <span class="number">5</span></span><br><span class="line">  Tracked by:</span><br><span class="line">    STATIC-IP-ROUTING <span class="number">0</span></span><br><span class="line"><span class="comment">#查看路由</span></span><br><span class="line">ciscoasa<span class="comment"># sh route</span></span><br><span class="line">S*    <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> [<span class="number">1</span>/<span class="number">0</span>] via <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span>, Inside_1</span><br></pre></td></tr></table></figure>

<h3 id="测试切换并查看路由"><a href="#测试切换并查看路由" class="headerlink" title="测试切换并查看路由"></a>测试切换并查看路由</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#关闭Inside_1接口</span></span><br><span class="line">ciscoasa(config)<span class="comment"># int g0/2.10</span></span><br><span class="line">ciscoasa(config-subif)<span class="comment"># shutdown</span></span><br><span class="line"><span class="comment">#查看Track Status</span></span><br><span class="line">ciscoasa<span class="comment"># sh track</span></span><br><span class="line">Track <span class="number">20</span></span><br><span class="line">  Response Time Reporter <span class="number">10</span> reachability</span><br><span class="line">  Reachability <span class="keyword">is</span> Down                            //Down</span><br><span class="line">  <span class="number">3</span> changes, last change <span class="number">00</span>:<span class="number">02</span>:<span class="number">03</span></span><br><span class="line">  Latest operation <span class="keyword">return</span> code: Timeout</span><br><span class="line">  Tracked by:</span><br><span class="line">    STATIC-IP-ROUTING <span class="number">0</span></span><br><span class="line"><span class="comment">#查看路由</span></span><br><span class="line">ciscoasa<span class="comment"># sh route</span></span><br><span class="line">S*    <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> [<span class="number">100</span>/<span class="number">0</span>] via <span class="number">7.7</span><span class="number">.2</span><span class="number">.1</span>, Inside_2</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>Firewall</tag>
        <tag>SLA</tag>
      </tags>
  </entry>
  <entry>
    <title>ASA透明防火墙模式Transparent</title>
    <url>/2020/07/18/2020-07-ASA%E9%80%8F%E6%98%8E%E9%98%B2%E7%81%AB%E5%A2%99%E6%A8%A1%E5%BC%8FTransparent.html</url>
    <content><![CDATA[<h2 id="ASA支持两种模式防火墙的运行"><a href="#ASA支持两种模式防火墙的运行" class="headerlink" title="ASA支持两种模式防火墙的运行"></a>ASA支持两种模式防火墙的运行</h2><ul>
<li>路由模式</li>
<li>透明模式</li>
</ul>
<h2 id="透明模式防火墙与路由模式防火墙区分"><a href="#透明模式防火墙与路由模式防火墙区分" class="headerlink" title="透明模式防火墙与路由模式防火墙区分"></a>透明模式防火墙与路由模式防火墙区分</h2><table>
<thead>
<tr>
<th>特性</th>
<th>路由防火墙</th>
<th>透明防火墙</th>
</tr>
</thead>
<tbody><tr>
<td>地址转换</td>
<td>支持动态、静态NAT与PAT</td>
<td>支持静态/动态NAT，不支持接口PAT</td>
</tr>
<tr>
<td>路由协议</td>
<td>支持RIP、EIGRP、OSPF</td>
<td>不参与任何路由协议</td>
</tr>
<tr>
<td>非IP流量</td>
<td>不允许IP与非IP流量穿越自己</td>
<td>允许IP与非IP流量穿越自己</td>
</tr>
<tr>
<td>服务质量</td>
<td>支持QOS</td>
<td>不支持QOS</td>
</tr>
<tr>
<td>监控</td>
<td>对3层或更高数据包头执行监控</td>
<td>对2层或更高数据包头执行监控</td>
</tr>
<tr>
<td>动态DNS</td>
<td>支持DDNS</td>
<td>不支持DDNS</td>
</tr>
<tr>
<td>DHCP中继</td>
<td>支持DHCP中继</td>
<td>不支持DHCP中继</td>
</tr>
<tr>
<td>IPsecVPN</td>
<td>支持远程访问和站点到站点的IPSecVPN</td>
<td>仅支持以管理为目的发起的站点到站点VPN</td>
</tr>
<tr>
<td>SSLVPN</td>
<td>支持SSLVPN隧道</td>
<td>不支持SSLVPN隧道</td>
</tr>
</tbody></table>
<h2 id="透明模式防火墙配置指南"><a href="#透明模式防火墙配置指南" class="headerlink" title="透明模式防火墙配置指南"></a>透明模式防火墙配置指南</h2><ul>
<li>内外接口直连网络必须在同一子网内部</li>
<li>必须要配置一个网管IP</li>
<li>网管IP必须和内外网段相同</li>
<li>网络IP不能作为网关使用</li>
<li>组播和广播流量需要明确放行</li>
<li>可以指定一个特定接口抵达的IP作为默认网关，这条路由只能起到网管作用</li>
<li>每一个接口必须在不同的VLAN</li>
<li>所有的流量都可以通过拓展访问控制列表或以太访问控制列表来放行</li>
<li>ARP默认可以穿越防火墙，可以通过ARP监控这个技术来控制</li>
<li>CDP是无法穿越的，无论是否放行</li>
</ul>
<h2 id="透明防火墙对入方向和出方向流量MAC处理："><a href="#透明防火墙对入方向和出方向流量MAC处理：" class="headerlink" title="透明防火墙对入方向和出方向流量MAC处理："></a>透明防火墙对入方向和出方向流量MAC处理：</h2><blockquote>
<p>ASA添加源MAC地址到MAC地址表中</p>
<p>如果目的MAC地址在表中，ASA从对应接口转发出去</p>
<p>如果不在表中，ASA尝试查询对应MAC地址</p>
</blockquote>
<h2 id="模式切换命令："><a href="#模式切换命令：" class="headerlink" title="模式切换命令："></a>模式切换命令：</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#切换到透明模式：</span></span><br><span class="line">ASAv(config)<span class="comment"># firewall transparent </span></span><br><span class="line"><span class="comment">#切换到路由模式</span></span><br><span class="line">ASAv(config)<span class="comment"># no firewall transparent </span></span><br><span class="line"><span class="comment">#查看当前模式</span></span><br><span class="line">ciscoasa(config)<span class="comment"># show firewall </span></span><br><span class="line">Firewall mode: Transparent</span><br></pre></td></tr></table></figure>



<h2 id="非IP流量如图"><a href="#非IP流量如图" class="headerlink" title="非IP流量如图"></a>非IP流量如图</h2><table>
<thead>
<tr>
<th>Non-IP Traffic</th>
<th>十六进制位</th>
</tr>
</thead>
<tbody><tr>
<td>IP</td>
<td>0x0800</td>
</tr>
<tr>
<td>ARP</td>
<td>0x0806</td>
</tr>
<tr>
<td>RARP</td>
<td>0x8035</td>
</tr>
<tr>
<td>Dot1Q</td>
<td>0x8100</td>
</tr>
<tr>
<td>IPX/SPX</td>
<td>0x8137</td>
</tr>
<tr>
<td>IPV6</td>
<td>0x86DD</td>
</tr>
<tr>
<td>LACP</td>
<td>0x8809</td>
</tr>
<tr>
<td>MPLS unicast</td>
<td>0x8847</td>
</tr>
<tr>
<td>MPLS multicast</td>
<td>0x8848</td>
</tr>
<tr>
<td>PPPoE discovery</td>
<td>0x8863</td>
</tr>
<tr>
<td>PPPoE session</td>
<td>0x8864</td>
</tr>
<tr>
<td>802.1x</td>
<td>0x888E</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>Firewall</tag>
        <tag>Transparent</tag>
      </tags>
  </entry>
  <entry>
    <title>ASA高可用性Failover</title>
    <url>/2020/07/18/2020-07-ASA%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7Failover.html</url>
    <content><![CDATA[<h2 id="Failover阐述"><a href="#Failover阐述" class="headerlink" title="Failover阐述"></a>Failover阐述</h2><ul>
<li>一对ASA能够配对成为一个A/SFailover组，提供设备级冗余</li>
<li>一个Failover组，存在两组角色：<ul>
<li>关于Primary/Secondary<ul>
<li>一个物理设备被指定为Primary设备</li>
<li>一个物理设备被指定为Secondary设备</li>
<li>Primary和Secondary是物理的概念，不会被切换</li>
</ul>
</li>
<li>关于Active/Standby<ul>
<li>一个物理设备被选择成为Active（转发流量）</li>
<li>一个设备被选择成为Standby（热备用状态，等待）</li>
<li>Active和Standby是逻辑概念，可以互相切换</li>
</ul>
</li>
</ul>
</li>
<li>设备的健康状况是通过Lan-F0接口来监控的</li>
</ul>
<h2 id="部署Failover的必要条件："><a href="#部署Failover的必要条件：" class="headerlink" title="部署Failover的必要条件："></a>部署Failover的必要条件：</h2><ul>
<li>HardwareRequirements（硬件需求）<ul>
<li>相同类型的硬件型号，物理接口，特性模块</li>
</ul>
</li>
<li>SoftwareRequirements（软件需求）<ul>
<li>相同的操作模式，相同的主版本和子版本</li>
</ul>
</li>
<li>LicenseRequirements（授权需求）<ul>
<li>8.3（1）之前必须要求一致许可</li>
<li>8.3（1）之后，只有下列设备依然要求一致许可<ul>
<li>ASA5505、5510、5512-X都必须具备Security_Plus授权许可</li>
<li>两台设备的3DES-AES许可证必须一致</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Failover的部署方式"><a href="#Failover的部署方式" class="headerlink" title="Failover的部署方式"></a>Failover的部署方式</h2><ul>
<li>无状态化的F0<ul>
<li>只提供硬件冗余</li>
<li>当切换发生时，所有已经建立的状态话跟踪的连接都将被丢弃</li>
<li>用户必须重新建立连接</li>
</ul>
</li>
<li>状态话的F0<ul>
<li>扩展来无状态化F0的功能</li>
<li>提供了硬件和状态话表项的冗余</li>
<li>故障切换期间，连接依旧保持</li>
<li>用户没必要重新建立连接</li>
<li>在两个设备之间需要一个状态话链路（是LAN-F0</li>
<li>链路之外的另外一条链路）</li>
</ul>
</li>
</ul>
<h2 id="Failover的接口类型："><a href="#Failover的接口类型：" class="headerlink" title="Failover的接口类型："></a>Failover的接口类型：</h2><ul>
<li>LANF0接口：用来确定每一个但愿的运行状态并复制和同步配置</li>
<li>Link F0接口：（状态话接口）<ul>
<li>用于传递状态信息到Standby单元</li>
<li>可以是一个独立的接口，或者和其他接口共享，包括F0接口（不推荐，最好是独立接口）</li>
<li>可以考虑将两个功能置于一根线上，不推荐</li>
</ul>
</li>
</ul>
<h2 id="Failover部署方针："><a href="#Failover部署方针：" class="headerlink" title="Failover部署方针："></a>Failover部署方针：</h2><ul>
<li>部暑F0时，考虑如下的部署方针:<ul>
<li>可以使用密钥来保护FO通讯</li>
<li>如果状态化链路和FO链路共享接口，需要使用一个可用的高速率的接口</li>
<li>调整F0的各项参数来矣现快速切换</li>
<li>在active和standby设备上手动指定MAC地址，来阻止一些可能阻断网络流量的偶然事件</li>
<li>在所有连接防火墙设备的交换机接口上，考虑配置端口快速（PortFast）</li>
</ul>
</li>
<li>如果发现备用配置与主用有区分，可通过‘write standby’命令，实现现有主备配置完全覆盖备用设备配置</li>
<li>备用设备用于不参与路由进程</li>
</ul>
<h2 id="无状态化故障倒换实验（A-S）"><a href="#无状态化故障倒换实验（A-S）" class="headerlink" title="无状态化故障倒换实验（A/S）"></a>无状态化故障倒换实验（A/S）</h2><p><img src="../../../images/ASA%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7Failover/asa222-1024x671.png" alt="img"></p>
<h3 id="预配："><a href="#预配：" class="headerlink" title="预配："></a>预配：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Inside配置</span></span><br><span class="line">interface e0/<span class="number">0</span></span><br><span class="line">  ip add <span class="number">7.7</span><span class="number">.1</span><span class="number">.30</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  no shutdown</span><br><span class="line"><span class="comment">#Outside配置</span></span><br><span class="line">interface e0/<span class="number">0</span></span><br><span class="line">  ip add <span class="number">7.7</span><span class="number">.3</span><span class="number">.30</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  no shutdown</span><br><span class="line"><span class="comment">#SW配置</span></span><br><span class="line">vlan <span class="number">10</span> </span><br><span class="line">vlan <span class="number">20</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> switchport access vlan <span class="number">20</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> switchport access vlan <span class="number">10</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet1/<span class="number">0</span></span><br><span class="line"> switchport access vlan <span class="number">20</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet1/<span class="number">1</span></span><br><span class="line"> switchport access vlan <span class="number">10</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet2/<span class="number">0</span></span><br><span class="line"> switchport access vlan <span class="number">10</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet2/<span class="number">1</span></span><br><span class="line"> switchport access vlan <span class="number">20</span></span><br><span class="line"> switchport mode access</span><br></pre></td></tr></table></figure>

<h3 id="配置Failover"><a href="#配置Failover" class="headerlink" title="配置Failover"></a>配置Failover</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#初始化ASA1_Primary接口</span></span><br><span class="line">no cluster interface-mode   //所有支持Cluster新技术的防火墙都需要先去掉此命令</span><br><span class="line">interface Ethernet0</span><br><span class="line"> nameif Outside</span><br><span class="line"> security-level <span class="number">0</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.3</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> standby <span class="number">7.7</span><span class="number">.3</span><span class="number">.20</span> </span><br><span class="line">interface Ethernet1</span><br><span class="line"> nameif Inside</span><br><span class="line"> security-level <span class="number">100</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> standby <span class="number">7.7</span><span class="number">.1</span><span class="number">.20</span> </span><br><span class="line"><span class="comment">#配置Primary FO</span></span><br><span class="line">interface ethernet <span class="number">2</span></span><br><span class="line">  no shutdown</span><br><span class="line">failover lan unit primary  //指定本设备为primary</span><br><span class="line">failover lan interface FO ethernet2   //指定ethernet2为FO链路，接口名为FO</span><br><span class="line">failover key cisco   //可选项，指定密钥</span><br><span class="line">failover interface ip FO <span class="number">150.1</span><span class="number">.7</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> standby <span class="number">150.1</span><span class="number">.7</span><span class="number">.20</span></span><br><span class="line">failover     //启用故障倒换，启用顺序为先主后备</span><br><span class="line"><span class="comment">#配置Secondary FO</span></span><br><span class="line">no cluster interface-mode   //所有支持Cluster新技术的防火墙都需要先去掉此命令</span><br><span class="line">interface ethernet <span class="number">2</span></span><br><span class="line">  no shutdown</span><br><span class="line">failover lan unit secondary  //指定本设备为secondary</span><br><span class="line">failover lan interface FO ethernet2   //指定ethernet2为FO链路，接口名为FO</span><br><span class="line">failover key cisco   //可选项，指定密钥</span><br><span class="line">failover interface ip FO <span class="number">150.1</span><span class="number">.7</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> standby <span class="number">150.1</span><span class="number">.7</span><span class="number">.20</span></span><br><span class="line">failover</span><br></pre></td></tr></table></figure>

<h3 id="查看Failover状态"><a href="#查看Failover状态" class="headerlink" title="查看Failover状态"></a>查看Failover状态</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASA1<span class="comment"># show failover </span></span><br><span class="line">Failover On </span><br><span class="line">Failover unit Primary</span><br><span class="line">Failover LAN Interface: FO Ethernet2 (up)</span><br><span class="line">Unit Poll frequency <span class="number">1</span> seconds, holdtime <span class="number">15</span> seconds</span><br><span class="line">Interface Poll frequency <span class="number">5</span> seconds, holdtime <span class="number">25</span> seconds</span><br><span class="line">Interface Policy <span class="number">1</span></span><br><span class="line">Monitored Interfaces <span class="number">2</span> of <span class="number">60</span> maximum</span><br><span class="line">Version: Ours <span class="number">8.4</span>(<span class="number">2</span>), Mate <span class="number">8.4</span>(<span class="number">2</span>)</span><br><span class="line">Last Failover at: <span class="number">18</span>:<span class="number">43</span>:<span class="number">37</span> UTC Jun <span class="number">28</span> <span class="number">2020</span></span><br><span class="line">        This host: Primary - Active </span><br><span class="line">                Active time: <span class="number">432</span> (sec)</span><br><span class="line">                  Interface Outside (<span class="number">7.7</span><span class="number">.3</span><span class="number">.10</span>): Normal (Monitored)</span><br><span class="line">                  Interface Inside (<span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span>): Normal (Monitored)</span><br><span class="line">        Other host: Secondary - Standby Ready </span><br><span class="line">                Active time: <span class="number">0</span> (sec)</span><br><span class="line">                  Interface Outside (<span class="number">7.7</span><span class="number">.3</span><span class="number">.20</span>): Normal (Monitored)</span><br><span class="line">                  Interface Inside (<span class="number">7.7</span><span class="number">.1</span><span class="number">.20</span>): Testing (Monitored)</span><br><span class="line"></span><br><span class="line">Stateful Failover Logical Update Statistics</span><br><span class="line">        Link : Unconfigured.</span><br></pre></td></tr></table></figure>

<h3 id="测试故障切换"><a href="#测试故障切换" class="headerlink" title="测试故障切换"></a>测试故障切换</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 7.7.1.10</span></span><br><span class="line">Inside(config)<span class="comment">#username cisco privilege 15 password  cisco</span></span><br><span class="line">Inside(config)<span class="comment">#line vty 0 4</span></span><br><span class="line">Inside(config-line)<span class="comment"># login local</span></span><br><span class="line">Inside(config-line)<span class="comment"># transport input all</span></span><br><span class="line">Outside(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 7.7.3.10</span></span><br><span class="line">Outside(config)<span class="comment">#username cisco privilege 15 password cisco</span></span><br><span class="line">Outside(config)<span class="comment">#line vty 0 4</span></span><br><span class="line">Outside(config-line)<span class="comment">#login local </span></span><br><span class="line">Outside(config-line)<span class="comment">#transport input all </span></span><br><span class="line">Inside<span class="comment">#telnet 7.7.3.30</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.3</span><span class="number">.30</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Username: cisco</span><br><span class="line">Password: </span><br><span class="line">Outside<span class="comment">#</span></span><br><span class="line"><span class="comment">#查看状态话信息</span></span><br><span class="line">ASA1<span class="comment"># sh conn </span></span><br><span class="line"><span class="number">7</span> <span class="keyword">in</span> use, <span class="number">7</span> most used</span><br><span class="line">TCP Outside <span class="number">7.7</span><span class="number">.3</span><span class="number">.30</span>:<span class="number">23</span> Inside <span class="number">7.7</span><span class="number">.1</span><span class="number">.30</span>:<span class="number">50639</span>, idle <span class="number">0</span>:<span class="number">00</span>:<span class="number">08</span>, bytes <span class="number">140</span>, flags UIO</span><br><span class="line">ASA1<span class="comment"># show conn      //备用设备无法查询到任何状态话表项</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">in</span> use, <span class="number">6</span> most used</span><br><span class="line">ASA1<span class="comment"># </span></span><br><span class="line"><span class="comment">#测试故障切换</span></span><br><span class="line">Switch(config)<span class="comment">#interface e0/1</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="comment">#shutdown </span></span><br><span class="line"></span><br><span class="line">ASA1<span class="comment"># </span></span><br><span class="line">        Switching to Standby      //本设备切换为Standby</span><br><span class="line"><span class="comment">#查看ASA2的FO状态</span></span><br><span class="line">ASA1<span class="comment"># show failover </span></span><br><span class="line">Failover On </span><br><span class="line">Failover unit Secondary</span><br><span class="line">Failover LAN Interface: FO Ethernet2 (up)</span><br><span class="line">Unit Poll frequency <span class="number">1</span> seconds, holdtime <span class="number">15</span> seconds</span><br><span class="line">Interface Poll frequency <span class="number">5</span> seconds, holdtime <span class="number">25</span> seconds</span><br><span class="line">Interface Policy <span class="number">1</span></span><br><span class="line">Monitored Interfaces <span class="number">2</span> of <span class="number">60</span> maximum</span><br><span class="line">Version: Ours <span class="number">8.4</span>(<span class="number">2</span>), Mate <span class="number">8.4</span>(<span class="number">2</span>)</span><br><span class="line">Last Failover at: <span class="number">18</span>:<span class="number">53</span>:<span class="number">27</span> UTC Jun <span class="number">28</span> <span class="number">2020</span></span><br><span class="line">        This host: Secondary - Active        //ASA2切换为Active状态</span><br><span class="line">                Active time: <span class="number">32</span> (sec)</span><br><span class="line">                  Interface Outside (<span class="number">7.7</span><span class="number">.3</span><span class="number">.10</span>): Normal (Monitored)</span><br><span class="line">                  Interface Inside (<span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span>): Normal (Waiting)</span><br><span class="line">        Other host: Primary - Failed </span><br><span class="line">                Active time: <span class="number">442</span> (sec)</span><br><span class="line">                  Interface Outside (<span class="number">7.7</span><span class="number">.3</span><span class="number">.20</span>): Normal (Waiting)</span><br><span class="line">                  Interface Inside (<span class="number">7.7</span><span class="number">.1</span><span class="number">.20</span>): Failed (Waiting)</span><br><span class="line"></span><br><span class="line">Stateful Failover Logical Update Statistics</span><br><span class="line">        Link : Unconfigured.</span><br><span class="line"><span class="comment">#再次测试telnet</span></span><br><span class="line">Inside<span class="comment">#telnet 7.7.3.30</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.3</span><span class="number">.30</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Username: cisco</span><br><span class="line">Password: </span><br><span class="line">Outside<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h3 id="测试抢占"><a href="#测试抢占" class="headerlink" title="测试抢占"></a>测试抢占</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Switch(config)<span class="comment">#interface e0/1</span></span><br><span class="line">Switch(config-<span class="keyword">if</span>)<span class="comment">#no shutdown</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>没有出现任何提示，表示<font color="#dd00">FO没有抢占功能，只能手动切换</font></p>
</blockquote>
<h3 id="手动切换"><a href="#手动切换" class="headerlink" title="手动切换"></a>手动切换</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASA1(config)<span class="comment"># failover active </span></span><br><span class="line"></span><br><span class="line">        Switching to Active</span><br></pre></td></tr></table></figure>

<h2 id="状态化故障倒换实验（A-S）"><a href="#状态化故障倒换实验（A-S）" class="headerlink" title="状态化故障倒换实验（A/S）"></a>状态化故障倒换实验（A/S）</h2><p>在上一个实验基础上增加eth3链路</p>
<p><img src="../../../images/ASA%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7Failover/aaaa-1024x800.png" alt="img"></p>
<h3 id="配置状态化链路"><a href="#配置状态化链路" class="headerlink" title="配置状态化链路"></a>配置状态化链路</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Switch配置</span></span><br><span class="line">vlan <span class="number">100</span></span><br><span class="line">interface Ethernet1/<span class="number">3</span></span><br><span class="line"> switchport access vlan <span class="number">100</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet0/<span class="number">3</span></span><br><span class="line"> switchport access vlan <span class="number">100</span></span><br><span class="line"> switchport mode access</span><br><span class="line"><span class="comment">#ASA1配置</span></span><br><span class="line">interface ethernet <span class="number">3</span></span><br><span class="line">no shutdown </span><br><span class="line">failover link stateful e3   //指定Stateful链路为eth3，接口名为stateful</span><br><span class="line">failover interface ip stateful <span class="number">150.1</span><span class="number">.8</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> standby <span class="number">150.1</span><span class="number">.8</span><span class="number">.20</span>    //配置Stateful链路ip地址</span><br><span class="line">//无需在ASA2上配置，因为FO链路会自动同步</span><br></pre></td></tr></table></figure>

<h3 id="测试状态化信息同步"><a href="#测试状态化信息同步" class="headerlink" title="测试状态化信息同步"></a>测试状态化信息同步</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside<span class="comment">#telnet 7.7.3.30</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.3</span><span class="number">.30</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Username: cisco</span><br><span class="line">Password: </span><br><span class="line">Outside<span class="comment">#</span></span><br><span class="line">ASA1<span class="comment"># sh conn</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">in</span> use, <span class="number">9</span> most used</span><br><span class="line">TCP Outside <span class="number">7.7</span><span class="number">.3</span><span class="number">.30</span>:<span class="number">23</span> Inside <span class="number">7.7</span><span class="number">.1</span><span class="number">.30</span>:<span class="number">13027</span>, idle <span class="number">0</span>:<span class="number">00</span>:<span class="number">06</span>, bytes <span class="number">0</span>, flags U</span><br><span class="line">ASA1<span class="comment"># sh conn   //同步成功</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">in</span> use, <span class="number">9</span> most used</span><br><span class="line">TCP Outside <span class="number">7.7</span><span class="number">.3</span><span class="number">.30</span>:<span class="number">23</span> Inside <span class="number">7.7</span><span class="number">.1</span><span class="number">.30</span>:<span class="number">13027</span>, idle <span class="number">0</span>:<span class="number">00</span>:<span class="number">06</span>, bytes <span class="number">0</span>, flags U</span><br></pre></td></tr></table></figure>

<h2 id="A-A-Failover-介绍"><a href="#A-A-Failover-介绍" class="headerlink" title="A/A_Failover_ 介绍"></a>A/A_Failover_ 介绍</h2><ul>
<li>安全设备可以成对搭配成A/A的FO来提供设备级的冗余和负载分担</li>
<li>两个设备在彼此互为备份同时，也能同时转发流量（负载均衡）</li>
<li>使用虚拟子防火墙是必须的，子防火墙被归为两个FO姐</li>
<li>一个物理防火墙只会在一个FO组中成为active</li>
</ul>
<h2 id="A-A-Failover-部署方针"><a href="#A-A-Failover-部署方针" class="headerlink" title="A/A_Failover_部署方针"></a>A/A_Failover_部署方针</h2><ul>
<li>部暑方针和A/S高可用性FO基本一样</li>
<li>要求和限制同A/S髙可用性FO—样，下面罗列了额外的问题:<ul>
<li>A/A的F0只有设备是多模模式才可使用</li>
<li>不支持动态路由协议</li>
<li>不支持组描IP路由</li>
<li>不支持DHCP中继</li>
<li>不支特DHCPv6 staeless server</li>
<li>不支持动态DNS</li>
<li>不支持QOS</li>
</ul>
</li>
<li>ASA5505不支持 A/A 的 Failover.</li>
</ul>
<h2 id="状态化故障倒换实验（A-A）"><a href="#状态化故障倒换实验（A-A）" class="headerlink" title="状态化故障倒换实验（A/A）"></a>状态化故障倒换实验（A/A）</h2><ul>
<li>需求：<ul>
<li>实验拓扑如下：</li>
<li>制造并处理异步路由</li>
<li>不间断升级ASAOS</li>
</ul>
</li>
</ul>
<p><img src="../../../images/ASA%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7Failover/2222222-1024x738.png" alt="img"></p>
<h3 id="预配如下："><a href="#预配如下：" class="headerlink" title="预配如下："></a>预配如下：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#inside接口配置</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0</span></span><br><span class="line">  no shutdown</span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0.2</span></span><br><span class="line">  encapsulation dot1q <span class="number">20</span></span><br><span class="line">  ip add <span class="number">7.7</span><span class="number">.2</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0.40</span></span><br><span class="line">  encapsulation dot1q <span class="number">40</span></span><br><span class="line">  ip add <span class="number">7.7</span><span class="number">.4</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#ISP-1接口配置</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0</span></span><br><span class="line">  no shutdown</span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0.1</span></span><br><span class="line">  encapsulation dot1q <span class="number">10</span></span><br><span class="line">  ip add <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0.200</span></span><br><span class="line">  encapsulation dot1q <span class="number">200</span></span><br><span class="line">  ip add <span class="number">2.2</span><span class="number">.2</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#ISP-2接口配置</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0</span></span><br><span class="line">  no shutdown</span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0.3</span></span><br><span class="line">  encapsulation dot1q <span class="number">30</span></span><br><span class="line">  ip add <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0.200</span></span><br><span class="line">  encapsulation dot1q <span class="number">200</span></span><br><span class="line">  ip add <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#SW接口及vlan配置</span></span><br><span class="line">Switch<span class="comment"># show vlan</span></span><br><span class="line"></span><br><span class="line">VLAN Name                             Status    Ports</span><br><span class="line">---- -------------------------------- --------- -------------------------------</span><br><span class="line"><span class="number">1</span>    default                          active    Et2/<span class="number">3</span></span><br><span class="line"><span class="number">10</span>   ISP<span class="number">-1</span>-UP                         active    Et0/<span class="number">0</span>, Et1/<span class="number">0</span></span><br><span class="line"><span class="number">20</span>   ISP<span class="number">-1</span>-Down                       active    </span><br><span class="line"><span class="number">30</span>   ISP<span class="number">-2</span>-UP                         active    Et0/<span class="number">1</span>, Et1/<span class="number">1</span></span><br><span class="line"><span class="number">40</span>   ISP<span class="number">-2</span>-Down                       active    </span><br><span class="line"><span class="number">100</span>  FO-Stateful                      active    Et0/<span class="number">2</span>, Et1/<span class="number">2</span></span><br><span class="line"><span class="number">200</span>  Test-link                        active    </span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> description To-ASA1-Eth0</span><br><span class="line"> switchport access vlan <span class="number">10</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> description To-ASA1-Eth1</span><br><span class="line"> switchport access vlan <span class="number">30</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> description To-ASA1-Eth2</span><br><span class="line"> switchport access vlan <span class="number">100</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet0/<span class="number">3</span></span><br><span class="line"> description To-ASA1-Eth3</span><br><span class="line"> switchport trunk allowed vlan <span class="number">20</span>,<span class="number">40</span></span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line"> spanning-tree portfast edge</span><br><span class="line">interface Ethernet1/<span class="number">0</span></span><br><span class="line"> description To-ASA2-Eth0</span><br><span class="line"> switchport access vlan <span class="number">10</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet1/<span class="number">1</span></span><br><span class="line"> description To-ASA2-Eth1</span><br><span class="line"> switchport access vlan <span class="number">30</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet1/<span class="number">2</span></span><br><span class="line"> description To-ASA2-Eth2</span><br><span class="line"> switchport access vlan <span class="number">100</span></span><br><span class="line"> switchport mode access</span><br><span class="line">interface Ethernet1/<span class="number">3</span></span><br><span class="line"> description To-ASA2-Eth3</span><br><span class="line"> switchport trunk allowed vlan <span class="number">20</span>,<span class="number">40</span></span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line"> spanning-tree portfast edge</span><br><span class="line">interface Ethernet2/<span class="number">0</span></span><br><span class="line"> description To-ISP1</span><br><span class="line"> switchport trunk allowed vlan <span class="number">10</span>,<span class="number">200</span></span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line"> spanning-tree portfast edge</span><br><span class="line">interface Ethernet2/<span class="number">1</span></span><br><span class="line"> description To-ISP2</span><br><span class="line"> switchport trunk allowed vlan <span class="number">30</span>,<span class="number">200</span></span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line"> spanning-tree portfast edge</span><br><span class="line">interface Ethernet2/<span class="number">2</span></span><br><span class="line"> description To-Inside</span><br><span class="line"> switchport trunk allowed vlan <span class="number">20</span>,<span class="number">40</span></span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line"> spanning-tree portfast edge</span><br><span class="line"><span class="comment">#路由配置</span></span><br><span class="line">ISP1(config)<span class="comment">#ip route 7.7.2.0 255.255.255.0 7.7.1.10</span></span><br><span class="line">ISP2(config)<span class="comment">#ip route 7.7.4.0 255.255.255.0 7.7.3.10</span></span><br><span class="line">Inside(config)<span class="comment">#ip route 7.7.1.0 255.255.255.0 7.7.2.10</span></span><br><span class="line">Inside(config)<span class="comment">#ip route 7.7.3.0 255.255.255.0 7.7.4.10</span></span><br></pre></td></tr></table></figure>

<h3 id="ASA配置"><a href="#ASA配置" class="headerlink" title="ASA配置"></a>ASA配置</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ASA切换为多模</span></span><br><span class="line">ASA1(config)<span class="comment"># mode multiple </span></span><br><span class="line">ASA2(config)<span class="comment"># mode multiple </span></span><br><span class="line"><span class="comment">#清空.cfg文件</span></span><br><span class="line">ASA1(config)<span class="comment"># delete flash:*.cfg</span></span><br><span class="line">Delete filename [*.cfg]? </span><br><span class="line">Delete disk0:/old_running.cfg? [confirm]</span><br><span class="line">Delete disk0:/admin.cfg? [confirm]</span><br><span class="line"></span><br><span class="line">ASA2(config)<span class="comment"># delete flash:*.cfg</span></span><br><span class="line">Delete filename [*.cfg]? </span><br><span class="line">Delete disk0:/old_running.cfg? [confirm]</span><br><span class="line">Delete disk0:/admin.cfg? [confirm]</span><br><span class="line"><span class="comment">#修改提示符</span></span><br><span class="line">ASA1(config)<span class="comment"># prompt hostname priority state context </span></span><br><span class="line">ASA2(config)<span class="comment"># prompt hostname priority state context </span></span><br><span class="line"><span class="comment">#配置Failover Group</span></span><br><span class="line">ASA1/sec/actNoFailover(config)<span class="comment"># failover group 1</span></span><br><span class="line">ASA1/sec/actNoFailover(config-fover-group)<span class="comment"># preempt   //配置抢占</span></span><br><span class="line">ASA1/sec/actNoFailover(config-fover-group)<span class="comment"># failover group 2</span></span><br><span class="line">ASA1/sec/actNoFailover(config-fover-group)<span class="comment"># secondary </span></span><br><span class="line">ASA1/sec/actNoFailover(config-fover-group)<span class="comment"># preempt   //配置抢占</span></span><br><span class="line"></span><br><span class="line">ASA2/sec/actNoFailover(config)<span class="comment"># failover group 1</span></span><br><span class="line">ASA2/sec/actNoFailover(config-fover-group)<span class="comment"># secondary     </span></span><br><span class="line">ASA2/sec/actNoFailover(config-fover-group)<span class="comment"># preempt</span></span><br><span class="line">ASA2/sec/actNoFailover(config-fover-group)<span class="comment"># failover group 2</span></span><br><span class="line">ASA2/sec/actNoFailover(config-fover-group)<span class="comment"># preempt</span></span><br><span class="line"><span class="comment">#ASA1开启所有需要使用的接口和子接口</span></span><br><span class="line">interface Ethernet0</span><br><span class="line">  no shutdown</span><br><span class="line">interface Ethernet1</span><br><span class="line">  no shutdown</span><br><span class="line">interface Ethernet2</span><br><span class="line">  no shutdown</span><br><span class="line">interface Ethernet3</span><br><span class="line">  no shutdown</span><br><span class="line">interface Ethernet3<span class="number">.2</span></span><br><span class="line">  vlan <span class="number">20</span></span><br><span class="line">interface Ethernet3<span class="number">.4</span></span><br><span class="line">  vlan <span class="number">40</span></span><br><span class="line"><span class="comment">#定义管理墙</span></span><br><span class="line">admin-context admin</span><br><span class="line">context admin</span><br><span class="line">config-url disk0:/admin.cfg</span><br><span class="line">context c1</span><br><span class="line">allocate-interface e0</span><br><span class="line">allocate-interface e3<span class="number">.2</span></span><br><span class="line">config-url disk0:/c1.cfg</span><br><span class="line">join-failover-group <span class="number">1</span></span><br><span class="line">context c2</span><br><span class="line">allocate-interface e1</span><br><span class="line">allocate-interface e3<span class="number">.4</span></span><br><span class="line">config-url disk0:/c2.cfg</span><br><span class="line">join-failover-group <span class="number">2</span></span><br><span class="line"><span class="comment">#初始化子墙c1</span></span><br><span class="line">ASA1/sec/actNoFailover/c1(config-<span class="keyword">if</span>)<span class="comment"># show run interface </span></span><br><span class="line">interface Ethernet0</span><br><span class="line"> nameif Outside</span><br><span class="line"> security-level <span class="number">0</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> standby <span class="number">7.7</span><span class="number">.1</span><span class="number">.20</span> </span><br><span class="line">interface Ethernet3<span class="number">.2</span></span><br><span class="line"> nameif Inside</span><br><span class="line"> security-level <span class="number">100</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.2</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> standby <span class="number">7.7</span><span class="number">.2</span><span class="number">.20</span> </span><br><span class="line"><span class="comment">#初始化子墙c2</span></span><br><span class="line">ASA1/sec/actNoFailover/c2(config)<span class="comment"># show run interface </span></span><br><span class="line">interface Ethernet1</span><br><span class="line"> nameif Outside</span><br><span class="line"> security-level <span class="number">0</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.3</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> standby <span class="number">7.7</span><span class="number">.3</span><span class="number">.20</span> </span><br><span class="line">interface Ethernet3<span class="number">.4</span></span><br><span class="line"> nameif Inside</span><br><span class="line"> security-level <span class="number">100</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.4</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> standby <span class="number">7.7</span><span class="number">.4</span><span class="number">.20</span> </span><br><span class="line"><span class="comment">#测试Outbound流量</span></span><br><span class="line">Inside<span class="comment">#telnet 7.7.1.1</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Username: cisco</span><br><span class="line">Password: </span><br><span class="line">ISP1<span class="comment">#</span></span><br><span class="line">Inside<span class="comment">#telnet 7.7.3.1</span></span><br><span class="line">Trying <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Username: cisco</span><br><span class="line">Password: </span><br><span class="line">ISP2<span class="comment">#</span></span><br><span class="line"><span class="comment">#ASA1配置FO/Stateful Link</span></span><br><span class="line">failover lan unit primary</span><br><span class="line">failover lan interface fo/sta Ethernet2</span><br><span class="line">failover key cisco</span><br><span class="line">failover link fo/sta Ethernet2</span><br><span class="line">failover interface ip fo/sta <span class="number">150.1</span><span class="number">.7</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> standby <span class="number">150.1</span><span class="number">.7</span><span class="number">.20</span></span><br><span class="line">failover </span><br><span class="line"><span class="comment">#ASA2配置FO/Stateful Link</span></span><br><span class="line">failover lan unit secondary</span><br><span class="line">failover lan interface fo/sta Ethernet2</span><br><span class="line">failover key cisco</span><br><span class="line">failover link fo/sta Ethernet2</span><br><span class="line">failover interface ip fo/sta <span class="number">150.1</span><span class="number">.7</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> standby <span class="number">150.1</span><span class="number">.7</span><span class="number">.20</span></span><br><span class="line">failover //ethernet <span class="number">2</span>口一定要no shutdown</span><br><span class="line">failover active group <span class="number">2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>什么是异步路由？</p>
<p>数据包不从始发的设备返回，这就叫异步路由。</p>
</blockquote>
<h3 id="制造异步路由"><a href="#制造异步路由" class="headerlink" title="制造异步路由"></a>制造异步路由</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Inside</span></span><br><span class="line">interface lo0</span><br><span class="line">ip add <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.10</span></span><br><span class="line"><span class="comment">#ASA1/pri/act/c1</span></span><br><span class="line">route Outside <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.1</span>  </span><br><span class="line">route Inside <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.1</span></span><br><span class="line"><span class="comment">#ASA1/pri/act/c2</span></span><br><span class="line">route Inside <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span> <span class="number">7.7</span><span class="number">.4</span><span class="number">.1</span></span><br><span class="line">access-list <span class="number">100</span> extended permit ip  any any </span><br><span class="line">access-group <span class="number">100</span> <span class="keyword">in</span> <span class="keyword">in</span> outside  </span><br><span class="line"><span class="comment">#ISP1</span></span><br><span class="line">interface lo0</span><br><span class="line">ip add <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line"><span class="comment">#ISP2</span></span><br><span class="line">ip route <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.10</span></span><br></pre></td></tr></table></figure>

<h3 id="测试异步路由"><a href="#测试异步路由" class="headerlink" title="测试异步路由"></a>测试异步路由</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside<span class="comment">#ping 1.1.1.1 so lo0</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">3.3</span><span class="number">.3</span><span class="number">.3</span> </span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">1</span>/<span class="number">93</span>/<span class="number">463</span> ms</span><br><span class="line"></span><br><span class="line">Inside<span class="comment">#telnet 1.1.1.1 /source-interface lo0</span></span><br><span class="line">Trying <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> ......</span><br><span class="line">% Connection timed out;remote host <span class="keyword">not</span> responding</span><br></pre></td></tr></table></figure>

<h3 id="解决异步路由"><a href="#解决异步路由" class="headerlink" title="解决异步路由"></a>解决异步路由</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASA1/pri/act/c1(config)<span class="comment"># interface e0</span></span><br><span class="line">ASA1/pri/act/c1(config-<span class="keyword">if</span>)<span class="comment"># asr-group 1</span></span><br><span class="line">ASA1/sec/act/c2(config)<span class="comment"># interface e1</span></span><br><span class="line">ASA1/sec/act/c2(config-<span class="keyword">if</span>)<span class="comment"># asr-group 1</span></span><br></pre></td></tr></table></figure>

<h3 id="再次测试"><a href="#再次测试" class="headerlink" title="再次测试"></a>再次测试</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside<span class="comment">#telnet 1.1.1.1 /source-interface lo0</span></span><br><span class="line">Trying <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Username: cisco</span><br><span class="line">Password: </span><br><span class="line">ISP1<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="关于无间断升级ASAOS步骤"><a href="#关于无间断升级ASAOS步骤" class="headerlink" title="关于无间断升级ASAOS步骤"></a>关于无间断升级ASAOS步骤</h2><ul>
<li>下载新的软件到两个设备并且指定加载新的镜像</li>
<li>重启备用单元</li>
<li>强迫active单元切换到standby单元</li>
<li>重启前任active单元</li>
<li>恢复原active单元到active状态</li>
</ul>
]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>Firewall</tag>
        <tag>高可用性</tag>
        <tag>Failover</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco VPN：GETVPN</title>
    <url>/2020/07/18/2020-07-Cisco-VPN%EF%BC%9AGETVPN.html</url>
    <content><![CDATA[<h2 id="传统IPSec部署内网存在的问题："><a href="#传统IPSec部署内网存在的问题：" class="headerlink" title="传统IPSec部署内网存在的问题："></a>传统IPSec部署内网存在的问题：</h2><ul>
<li>不支持QOS</li>
<li>单向、点对点的安全关联<ul>
<li>配置复杂，配置量大</li>
<li>需要维护过多的SA</li>
<li>无法实现任意到任意通信</li>
<li>无法加密组播流量</li>
<li>无法实现即时连接</li>
</ul>
</li>
<li>路由覆盖<ul>
<li>如果运行SVTI，必须配置动态路由协议，基于隧道建立邻居关系</li>
<li>将导致覆盖路由问题。增加路由复杂度，提高运维成本</li>
</ul>
</li>
</ul>
<h2 id="GETVPN介绍："><a href="#GETVPN介绍：" class="headerlink" title="GETVPN介绍："></a>GETVPN介绍：</h2><ul>
<li>12.4（11）T之后才支持，思科私有</li>
<li>组加密传输VPN</li>
<li>部署环境：属于高扩展性VPN，适用于企业级大规模“内网”部署</li>
<li>组成员Group Member向密钥服务器Key Server注册，KS上配置策略，产生一个ipsec sa，向同一组的GM推送sa和感兴趣流。</li>
<li>组内成员可以实现any-to-any通讯，支持单播和组播</li>
<li>IP_Header_Preservation，实现原始IP头部保留，优化了QOS与组播，提高了运用性能</li>
<li>支持各种介质：LAN/WAN，FR/ATM（帧中继/异步传输模式），IP，MPLS</li>
<li>有以下模块组成：<ul>
<li>GDOI GETVPN 通讯协议</li>
<li>GCKS 密钥服务器</li>
<li>GM 组成员</li>
</ul>
</li>
</ul>
<h2 id="GETVPN工作流程："><a href="#GETVPN工作流程：" class="headerlink" title="GETVPN工作流程："></a>GETVPN工作流程：</h2><ul>
<li>所有GETVPN流量，都只工作在UDP_848号端口</li>
<li>第一阶段协商，使用主模式，6个包，产生一个IKE_SA</li>
<li>GDOI交互的四个包将由IKE_SA执行保护</li>
</ul>
<h2 id="GETVPN三大安全关联"><a href="#GETVPN三大安全关联" class="headerlink" title="GETVPN三大安全关联"></a>GETVPN三大安全关联</h2><ul>
<li>IKE安全关联<ul>
<li>认证与加密GDOI流量</li>
</ul>
</li>
<li>密钥更新安全关联<ul>
<li>加密周期性的密钥更新信息（KEK）</li>
</ul>
</li>
<li>IPSec安全关联<ul>
<li>加密组成员实际通信流量（TEK）</li>
</ul>
</li>
</ul>
<img src="../../../images/Cisco%20VPN%EF%BC%9AGETVPN/GETVPN%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B-1024x882.png" alt="img" style="zoom:50%;" />

<h2 id="配置："><a href="#配置：" class="headerlink" title="配置："></a>配置：</h2><h3 id="KS（Key-Server）配置："><a href="#KS（Key-Server）配置：" class="headerlink" title="KS（Key Server）配置："></a>KS（Key Server）配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#生成rsa密钥，用于前面rekey,</span></span><br><span class="line">ip domain name nbma.info</span><br><span class="line">crypto key gemerate ras label GETVPN_KEY modulus <span class="number">1024</span> exportable</span><br><span class="line"></span><br><span class="line"><span class="comment">#ike第一阶段，所有ks和gm的预共享密钥</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> authentication pre-share</span><br><span class="line">crypto isakmp key PRE-KEY address <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">crypto isakmp key PRE-KEY address <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">crypto isakmp key PRE-KEY address <span class="number">10.1</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#感兴趣流</span></span><br><span class="line">ip access-list ex GETVPN_traffic</span><br><span class="line"> primit ip <span class="number">10.1</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.255</span><span class="number">.255</span> <span class="number">10.1</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.255</span><span class="number">.255</span></span><br><span class="line"><span class="comment">#rekey更新流量</span></span><br><span class="line">ip access-list ex GETVPN_muiltucast</span><br><span class="line"> primit udp host <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> eq <span class="number">848</span> host <span class="number">239.1</span><span class="number">.1</span><span class="number">.1</span> eq <span class="number">848</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义转换集和profile</span></span><br><span class="line">crypto ipsec transform-set TRANS esp<span class="number">-3</span>des esp-md5-hmac</span><br><span class="line">crypto ipsec profile IPSPROF</span><br><span class="line"> set transform-set TRANS</span><br><span class="line"></span><br><span class="line"><span class="comment">#GDOI组，组名本地有效</span></span><br><span class="line">crypto gdoi group GDOI_GROUP</span><br><span class="line"> <span class="comment">#所有的KS,GM的id要一致</span></span><br><span class="line"> identity number <span class="number">66666</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#指定本地作为KS服务器</span></span><br><span class="line"> server local</span><br><span class="line">  address ipv4 <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定rsa用于签名</span></span><br><span class="line">  rekey authentication mypubkey rsa GETVPN_KEY</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果用单播rekey还需要敲：rekey transport unicast</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对rekey的加密算法（可选，默认3des）</span></span><br><span class="line">  rekey algorithm aes <span class="number">256</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#rekey更新流量</span></span><br><span class="line">  rekey address ipv4 GETVPN_muiltucast</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置ipsec sa </span></span><br><span class="line">  sa ipsec <span class="number">1</span></span><br><span class="line">   match address ipv4 GETVPN_traffic</span><br><span class="line">   profile IPSPROF</span><br><span class="line">   reply time windows-size <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h3 id="GM配置："><a href="#GM配置：" class="headerlink" title="GM配置："></a>GM配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> authentication pre-share</span><br><span class="line"></span><br><span class="line"><span class="comment">#只需要配置主备ks的预共享密钥</span></span><br><span class="line">crypto isakmp key PRE-KEY address <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">crypto isakmp key PRE-KEY address <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">crypto gdoi group GDOI-GROUP</span><br><span class="line"> identity number <span class="number">66666</span></span><br><span class="line"> server address ipv4 <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"> server address ipv4 <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">crypto map GDOI-MAP <span class="number">10</span> gdoi</span><br><span class="line"> set group GDOI-GROUP</span><br><span class="line"></span><br><span class="line">inerface e0/<span class="number">0</span></span><br><span class="line"> crypto map GDOI-MAP</span><br></pre></td></tr></table></figure>

<h3 id="其他配置："><a href="#其他配置：" class="headerlink" title="其他配置："></a>其他配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在ks上查看GM注册信息</span></span><br><span class="line">show crypto gdoi ks member </span><br><span class="line"></span><br><span class="line"><span class="comment">#在gm上查看gdoi</span></span><br><span class="line">show crypto gdoi</span><br><span class="line"></span><br><span class="line"><span class="comment">#在GM上设置bypass流量，只能deny</span></span><br><span class="line">ip access-list external GM-ACL</span><br><span class="line"> deny ip <span class="number">10.1</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.255</span><span class="number">.255</span> <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">crypto map GDOI-MAP <span class="number">10</span> gdoi</span><br><span class="line"> match address GM-ACL</span><br></pre></td></tr></table></figure>

<h3 id="主备KS配置："><a href="#主备KS配置：" class="headerlink" title="主备KS配置："></a>主备KS配置：</h3><p>手动同步。手敲相同的配置，包括rsa密钥对，感兴趣流，转换及，ipsec sa的lifetime</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在KS1上</span></span><br><span class="line">crypto gdoi group GDOI_GROUP</span><br><span class="line"> server local</span><br><span class="line">  redundancy</span><br><span class="line">   peer address ipv4 <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">   local priority <span class="number">100</span>(越大越优先)</span><br><span class="line"></span><br><span class="line"><span class="comment">#导出KS1的key </span></span><br><span class="line">crypto key export rsa GETVPN_KEY pem terminal <span class="number">3</span>des csico123</span><br><span class="line"></span><br><span class="line"><span class="comment">#在KS2上导入密钥</span></span><br><span class="line">crypto key <span class="keyword">import</span> rsa GETVPN_KEY pem terminal <span class="number">3</span>des csico123</span><br><span class="line">复制公钥</span><br><span class="line">复制私钥</span><br><span class="line">quit </span><br><span class="line"></span><br><span class="line"><span class="comment">#（策略-略）</span></span><br><span class="line"></span><br><span class="line">crypto gdoi group GDOI_GROUP</span><br><span class="line"> server local</span><br><span class="line">  redundancy</span><br><span class="line">   peer address ipv4 <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">   local priority <span class="number">75</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>VPN</tag>
        <tag>GETVPN</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco VPN:IPSec解决方案</title>
    <url>/2020/07/17/2020-07-Cisco-VPN%EF%BC%9AIPSec%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html</url>
    <content><![CDATA[<h1 id="IPSec协议模块框架"><a href="#IPSec协议模块框架" class="headerlink" title="IPSec协议模块框架"></a>IPSec协议模块框架</h1><p><strong>IPsec</strong>协议工作在OSI 模型的第三层，使其在单独使用时适于保护基于<a href="https://baike.baidu.com/item/TCP" target="_blank" rel="noopener">TCP</a>或<a href="https://baike.baidu.com/item/UDP" target="_blank" rel="noopener">UDP</a>的协议（如 安全套接子层（<a href="https://baike.baidu.com/item/SSL" target="_blank" rel="noopener">SSL</a>）就不能保护UDP层的通信流）。这就意味着，与传输层或更高层的协议相比，IPsec协议必须处理可靠性和分片的问题，这同时也增加了它的复杂性和处理开销。相对而言，<a href="https://baike.baidu.com/item/SSL" target="_blank" rel="noopener">SSL</a>/<a href="https://baike.baidu.com/item/TLS" target="_blank" rel="noopener">TLS</a>依靠更高层的<a href="https://baike.baidu.com/item/TCP" target="_blank" rel="noopener">TCP</a>（OSI的第四层）来管理可靠性和分片。</p>
<h2 id="安全协议"><a href="#安全协议" class="headerlink" title="安全协议"></a><strong>安全协议</strong></h2><ul>
<li>AH(AuthenticationHeader) 协议：<ul>
<li><ul>
<li>认证头协议</li>
<li>IP协议号51</li>
<li>提供数据完整性、源认证、防重放服务</li>
<li>缺点：<ul>
<li>不提供私密性</li>
<li>无法穿越地址转换技术NAT</li>
</ul>
</li>
</ul>
</li>
<li>ESP(EncapsulatedSecurityPayload) 协议：<ul>
<li>安全载荷协议ESP，提供私密性、数据完整性、源认证、防重放服务</li>
<li>IP协议号50。网络层协议</li>
<li>ESP支持两种工作模式：<ul>
<li>传输模式Transport</li>
<li>隧道模式Tunnel</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="安全关联SA"><a href="#安全关联SA" class="headerlink" title="安全关联SA"></a><strong>安全关联SA</strong></h2><ul>
<li>IKE SA双向<ul>
<li>决定了IKE协议处理相关细节</li>
<li>默认有效期一天</li>
</ul>
</li>
<li>IPSec SA<ul>
<li>单向</li>
<li>与封装协议相关</li>
<li>决定了具体加密流量的处理方式</li>
<li>默认有效期一个小时</li>
</ul>
</li>
<li>两种类型的SA都由IKE协议协商产生</li>
</ul>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a><strong>数据库</strong></h2><ul>
<li>安全策略数据库SPD<ul>
<li>用于存放IPSec_VPN的策略，这些策略用来定义哪些流量需要走IPSec</li>
<li>SPD存储策略内容如下<ul>
<li>源、目的IP地址</li>
<li>源、目的端口号</li>
<li>封装协议</li>
<li>工作模式</li>
</ul>
</li>
<li>SPD有三种执行行为<ul>
<li>旁路：当数据包源和目的IP不匹配SPD记录的策略时，直接按照路由表转发</li>
<li>IPSec加密：当匹配SPD记录时，将交给AH或ESP执行IPSec处理</li>
<li>丢弃：</li>
</ul>
</li>
</ul>
</li>
<li>安全关联数据库SADB<ul>
<li>存储了IPSEC_SA的所有参数，包括：<ul>
<li>SPI</li>
<li>封装协议<ul>
<li>加密算法</li>
<li>完整性算法</li>
</ul>
</li>
<li>工作模式</li>
</ul>
</li>
<li>当一个IPSec_SA被创建，SADB更新所有关于这个SA的参数</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>是否要处理由SPD决定，具体如何处理由SADB决定。</strong></p>
</blockquote>
<h1 id="IPSec安全特性："><a href="#IPSec安全特性：" class="headerlink" title="IPSec安全特性："></a>IPSec安全特性：</h1><ul>
<li>不可否认性</li>
<li>反重播性</li>
<li>数据完整性</li>
<li>数据可靠性</li>
</ul>
<h1 id="IKEv1：因特网密钥交换协议，版本1，是IPSec技术的核心组成部分"><a href="#IKEv1：因特网密钥交换协议，版本1，是IPSec技术的核心组成部分" class="headerlink" title="IKEv1：因特网密钥交换协议，版本1，是IPSec技术的核心组成部分"></a>IKEv1：因特网密钥交换协议，版本1，是<strong>IPSec技术的核心</strong>组成部分</h1><p>三大组成部分：</p>
<ul>
<li>SKEME：定义如何通过DH实现密钥交换</li>
<li>Oakley：提供了IPSec对各种算法的支持</li>
<li>ISAKMAP：定义了消息交换的体系结构，是<strong>IKE的核心</strong>组成部分</li>
</ul>
<h1 id="IKEv1工作流程："><a href="#IKEv1工作流程：" class="headerlink" title="IKEv1工作流程："></a>IKEv1工作流程：</h1><h2 id="阶段1："><a href="#阶段1：" class="headerlink" title="阶段1："></a>阶段1：</h2><ul>
<li>阶段1的主要协商任务<ul>
<li>管理连接</li>
<li>密钥交换协议：DH</li>
<li>设备验证</li>
</ul>
</li>
<li>为完成以上协商任务，有两种模式可供选择<ul>
<li>主模式（Main_Mode）<br>该模式定义通过6个包，三次交互来完成阶段一协商（思科默认）</li>
<li>主动模式（Aggressive_Mode）<br>定义通过3个包，三次交互来完成阶段一协商，安全性低于主模式，协商特性少于主模式，不提供对等体认证，不推荐使用</li>
</ul>
</li>
<li>阶段一所有协商流量均工作在UDP_500端口</li>
<li>阶段一完成协商后，产生一条双向的IKE安全关联</li>
</ul>
<h2 id="阶段2"><a href="#阶段2" class="headerlink" title="阶段2:"></a>阶段2:</h2><ul>
<li>阶段2的主要协商任务<ul>
<li>转换集<ul>
<li>封装协议</li>
<li>工作模式</li>
<li>加密和完整性校验使用的算法</li>
</ul>
</li>
<li>感兴趣流</li>
</ul>
</li>
<li>为完成以上协商任务，只有一种模式可供选择<ul>
<li>快速模式（Quicky_Mode）<br>该模式定义通过3个包，三次交互来完成阶段2协商</li>
</ul>
</li>
<li>阶段二所有协商的流量均工作在UDP_500端口，由第一阶段的IKE安全关联提供保护</li>
<li>阶段二完成协商后，产生两条单向的IPSec安全关联：<ul>
<li>一条用于发送加密数据</li>
<li>一条用于接收加密数据</li>
<li>实际通信数据均由协商的封装协议执行封装</li>
</ul>
</li>
</ul>
<h1 id="IKEv1实验"><a href="#IKEv1实验" class="headerlink" title="IKEv1实验"></a>IKEv1实验</h1><h2 id="实验1-基于IOS部署站点到站点VPN"><a href="#实验1-基于IOS部署站点到站点VPN" class="headerlink" title="实验1:基于IOS部署站点到站点VPN"></a>实验1:基于IOS部署站点到站点VPN</h2><ul>
<li>实验拓扑如图</li>
<li>需求<ul>
<li>部署站点到站点VPN，保护实际通信点流量穿越互联网</li>
</ul>
</li>
</ul>
<img src="../../../images/Cisco%20VPN%EF%BC%9AIPSec%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/IKEv1%E5%AE%9E%E9%AA%8C1-1-1024x605.png" alt="img" style="zoom:75%;" />

<h3 id="预配"><a href="#预配" class="headerlink" title="预配"></a>预配</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ip接口配置</span></span><br><span class="line">zongbu#sh <span class="builtin-name">run</span> | s interface</span><br><span class="line">interface Loopback0</span><br><span class="line"><span class="built_in"> ip address </span>1.1.1.1 255.255.255.0</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"><span class="built_in"> ip address </span>10.1.1.2 255.255.255.0</span><br><span class="line">Site_1#sh <span class="builtin-name">run</span> | s interface</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"><span class="built_in"> ip address </span>10.1.1.1 255.255.255.0</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"><span class="built_in"> ip address </span>20.1.1.1 255.255.255.0</span><br><span class="line">Internet#sh <span class="builtin-name">run</span> | s interface</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"><span class="built_in"> ip address </span>20.1.1.100 255.255.255.0</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"><span class="built_in"> ip address </span>30.1.1.100 255.255.255.0</span><br><span class="line">Site_2#sh <span class="builtin-name">run</span> | s interface</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"><span class="built_in"> ip address </span>40.1.1.1 255.255.255.0</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"><span class="built_in"> ip address </span>30.1.1.1 255.255.255.0</span><br><span class="line">fenbu#sh <span class="builtin-name">run</span> | s interface</span><br><span class="line">interface Loopback0</span><br><span class="line"><span class="built_in"> ip address </span>2.2.2.2 255.255.255.0</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"><span class="built_in"> ip address </span>40.1.1.2 255.255.255.0</span><br><span class="line"><span class="comment">#路由配置</span></span><br><span class="line">zongbu#sh <span class="builtin-name">run</span> | s route</span><br><span class="line">ip<span class="built_in"> route </span>2.2.2.0 255.255.255.0 10.1.1.1</span><br><span class="line">Site_1#sh <span class="builtin-name">run</span> | s route</span><br><span class="line">ip<span class="built_in"> route </span>1.1.1.0 255.255.255.0 10.1.1.2</span><br><span class="line">ip<span class="built_in"> route </span>2.2.2.0 255.255.255.0 20.1.1.100</span><br><span class="line">ip<span class="built_in"> route </span>30.1.1.0 255.255.255.0 20.1.1.100</span><br><span class="line">Site_2#sh <span class="builtin-name">run</span> | s route</span><br><span class="line">ip<span class="built_in"> route </span>1.1.1.0 255.255.255.0 30.1.1.100</span><br><span class="line">ip<span class="built_in"> route </span>2.2.2.0 255.255.255.0 40.1.1.2</span><br><span class="line">ip<span class="built_in"> route </span>20.1.1.0 255.255.255.0 30.1.1.100</span><br><span class="line">fenbu#sh <span class="builtin-name">run</span> | s route</span><br><span class="line">ip<span class="built_in"> route </span>1.1.1.0 255.255.255.0 40.1.1.1</span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">#Site_1配置</span><br><span class="line">##配置IKE第一阶段策略</span><br><span class="line">crypto isakmp policy <span class="number">10</span>       <span class="comment">//创建ISAKMP策略，优先级为10</span></span><br><span class="line"> encr <span class="number">3</span>des              <span class="comment">//IKE数据包加密算法使用3des，默认为des</span></span><br><span class="line"> hash md5               <span class="comment">//IKE数据包完整性校验的散列算法使用MD5，默认为SHA-1</span></span><br><span class="line"> authentication pre-share<span class="comment">//IKE第一阶段5-6个包，认证方式为预共享密钥验证，默认为RSA数字签名认证</span></span><br><span class="line"> group <span class="number">2</span>         <span class="comment">//IKE第一阶段3-4个包，DH交换使用GROUP_2，1024位，默认为GROUP_1，768位</span></span><br><span class="line">crypto isakmp <span class="type">key</span> cisco address <span class="number">30.1</span><span class="number">.1</span><span class="number">.1</span>      </span><br><span class="line">  <span class="comment">//IKE第一个阶段5-6个包，预共享密钥为cisco，两端必须一致，该KEY仅用于认证对等体</span></span><br><span class="line">##配置IKE第二阶段策略</span><br><span class="line">ip access-<span class="type">list</span> extended vpn        <span class="comment">//定义感兴趣流</span></span><br><span class="line"> permit ip <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span>       </span><br><span class="line">crypto ipsec transform-set IKEv1-lab esp<span class="number">-3</span>des esp-md5-hmac   </span><br><span class="line">  <span class="comment">//配置ipsec策略（转换集）提案名为IKEv1-lab，封装使用esp,加密使用3des，完整性校验使用Md5</span></span><br><span class="line"> mode tunnel    <span class="comment">//默认为tunnel</span></span><br><span class="line">crypto map cry-map <span class="number">10</span> ipsec-isakmp    </span><br><span class="line">  <span class="comment">//一个ID_10标识一个vpn，一个MAP可以配置多个ID，一个接口只能运用一个MAP  </span></span><br><span class="line"> set peer <span class="number">30.1</span><span class="number">.1</span><span class="number">.1</span>             <span class="comment">//设置与哪一个设备建立VPN</span></span><br><span class="line"> set transform-set IKEv1-lab            <span class="comment">//设置转换数据策略</span></span><br><span class="line"> match address vpn                <span class="comment">//匹配感兴趣流</span></span><br><span class="line"> set security-association lifetime seconds <span class="number">1800</span>      <span class="comment">//设置IPSec SA的生存期（可选配置）</span></span><br><span class="line"> set pfs group2               <span class="comment">//启用PFS，完美向前保密（可选配置）</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">1</span>          <span class="comment">//调用Crypto Map到接口下</span></span><br><span class="line">  crypto map cry-map </span><br><span class="line">#Site_2配置</span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp <span class="type">key</span> cisco address <span class="number">20.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">ip access-<span class="type">list</span> extended vpn</span><br><span class="line"> permit ip <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span>       </span><br><span class="line">crypto ipsec transform-set IKEv1-lab esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map cry-map <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set peer <span class="number">20.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"> set transform-set IKEv1-lab </span><br><span class="line"> match address vpn</span><br><span class="line"> set security-association lifetime seconds <span class="number">1800</span>      <span class="comment">//设置IPSec SA的生存期（可选配置）</span></span><br><span class="line"> set pfs group2               <span class="comment">//启用PFS，完美向前保密（可选配置）</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">1</span></span><br><span class="line"> crypto map cry-map</span><br></pre></td></tr></table></figure>

<h3 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h3><h4 id="查看数据包实际加解密数量"><a href="#查看数据包实际加解密数量" class="headerlink" title="查看数据包实际加解密数量"></a>查看数据包实际加解密数量</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Site_2#show crypto engine connections active </span><br><span class="line">Crypto Engine Connections</span><br><span class="line">   ID <span class="built_in"> Type </span>   Algorithm           Encrypt  Decrypt LastSeqN IP-Address</span><br><span class="line">    3 <span class="built_in"> IPsec </span>  3DES+MD5                  0    10064    10064 30.1.1.1</span><br><span class="line">    4 <span class="built_in"> IPsec </span>  3DES+MD5              10010        0        0 30.1.1.1</span><br><span class="line"> 1002  IKE     MD5+3DES                  0        0        0 30.1.1.1</span><br></pre></td></tr></table></figure>

<h4 id="查看感兴趣流是否匹配"><a href="#查看感兴趣流是否匹配" class="headerlink" title="查看感兴趣流是否匹配"></a>查看感兴趣流是否匹配</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Site_2#  sh access-lists </span><br><span class="line">Extended<span class="built_in"> IP </span>access list vpn</span><br><span class="line">    10 permit<span class="built_in"> ip </span>2.2.2.0 0.0.0.255 1.1.1.0 0.0.0.255 (10010 matches)</span><br></pre></td></tr></table></figure>

<h4 id="查看IPSec-SA"><a href="#查看IPSec-SA" class="headerlink" title="查看IPSec SA"></a>查看IPSec SA</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Site_2#show crypto<span class="built_in"> ipsec </span>sa </span><br><span class="line">interface: Ethernet0/1</span><br><span class="line">    Crypto map tag: cry-map, local addr 30.1.1.1</span><br><span class="line">   protected vrf: (none)</span><br><span class="line">   local  ident (addr/mask/prot/port): (2.2.2.0/255.255.255.0/0/0)</span><br><span class="line">   remote ident (addr/mask/prot/port): (1.1.1.0/255.255.255.0/0/0)</span><br><span class="line">   current_peer 20.1.1.1<span class="built_in"> port </span>500</span><br><span class="line">     PERMIT, flags=&#123;origin_is_acl,&#125;</span><br><span class="line">     #pkts encaps: 10005, #pkts encrypt: 10005, #pkts digest: 10005</span><br><span class="line">     #pkts decaps: 10059, #pkts decrypt: 10059, #pkts verify: 10059</span><br><span class="line">     local crypto endpt.: 30.1.1.1, remote crypto endpt.: 20.1.1.1</span><br><span class="line">     plaintext mtu 1446, path mtu 1500,<span class="built_in"> ip </span>mtu 1500,<span class="built_in"> ip </span>mtu idb Ethernet0/1</span><br><span class="line">     current outbound spi: 0x3D444108(1027883272)</span><br><span class="line">     PFS (Y/N): N, DH group: none</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">     inbound esp sas:</span><br><span class="line">      spi: 0x6590B83F(1703983167)</span><br><span class="line">        transform: esp-3des esp-md5-hmac ,</span><br><span class="line">        <span class="keyword">in</span> use<span class="built_in"> settings </span>=&#123;Tunnel, &#125;</span><br><span class="line">        conn id: 3, flow_id: SW:3, sibling_flags 80000040, crypto map: cry-map</span><br><span class="line">        sa timing: remaining key lifetime (k/sec): (4298127/1993)</span><br><span class="line">        IV size: 8 bytes</span><br><span class="line">        replay detection support: Y</span><br><span class="line">        Status: ACTIVE(ACTIVE)</span><br><span class="line"></span><br><span class="line">     outbound esp sas:</span><br><span class="line">      spi: 0x3D444108(1027883272)</span><br><span class="line">        transform: esp-3des esp-md5-hmac ,</span><br><span class="line">        <span class="keyword">in</span> use<span class="built_in"> settings </span>=&#123;Tunnel, &#125;</span><br><span class="line">        conn id: 4, flow_id: SW:4, sibling_flags 80000040, crypto map: cry-map</span><br><span class="line">        sa timing: remaining key lifetime (k/sec): (4298135/1993)</span><br><span class="line">        IV size: 8 bytes</span><br><span class="line">        replay detection support: Y</span><br><span class="line">        Status: ACTIVE(ACTIVE)</span><br></pre></td></tr></table></figure>

<h4 id="如何清空安全关联从而触发VPN？"><a href="#如何清空安全关联从而触发VPN？" class="headerlink" title="如何清空安全关联从而触发VPN？"></a>如何清空安全关联从而触发VPN？</h4><ul>
<li>清除IKE SA<br>clear crypto isakmp</li>
<li>清除IPSec SA<br>clear crypto sa</li>
</ul>
<h2 id="实验2-基于ASAOS部署站点到站点VPN"><a href="#实验2-基于ASAOS部署站点到站点VPN" class="headerlink" title="实验2:基于ASAOS部署站点到站点VPN"></a>实验2:基于ASAOS部署站点到站点VPN</h2><ul>
<li>实验拓扑如图</li>
<li>需求<ul>
<li>部署站点到站点VPN，保护实际通信点流量穿越互联网</li>
</ul>
</li>
</ul>
<img src="../../../images/Cisco%20VPN%EF%BC%9AIPSec%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/ASAOS-IKEv1.png" alt="img" style="zoom:50%;" />

<h3 id="路由配置：解决底层路由连通性"><a href="#路由配置：解决底层路由连通性" class="headerlink" title="路由配置：解决底层路由连通性"></a>路由配置：解决底层路由连通性</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Outside(config)#ip<span class="built_in"> route </span>1.1.1.0 255.255.255.0 20.1.1.1</span><br><span class="line">Outside(config)#ip<span class="built_in"> route </span>202.200.200.0 255.255.255.0 20.1.1.1</span><br><span class="line">Inside(config)#ip<span class="built_in"> route </span>2.2.2.0 255.255.255.0 10.1.1.100</span><br><span class="line">ASA(config)#<span class="built_in"> route </span>inside 1.1.1.0 255.255.255.0 10.1.1.1</span><br><span class="line">ASA(config)#<span class="built_in"> route </span>outside 2.2.2.0 255.255.255.0 202.200.200.1  </span><br><span class="line">ASA(config)#<span class="built_in"> route </span>outside 20.1.1.0 255.255.255.0 202.200.200.1</span><br></pre></td></tr></table></figure>

<h3 id="ASA配置IKEv1"><a href="#ASA配置IKEv1" class="headerlink" title="ASA配置IKEv1"></a>ASA配置IKEv1</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">crypto ikev1 enable outside     <span class="comment">//激活ISAKMP</span></span><br><span class="line">#配置第一阶段策略</span><br><span class="line">crypto ikev1 policy <span class="number">10</span>       </span><br><span class="line">authentication pre-share </span><br><span class="line">encryption <span class="number">3</span>des </span><br><span class="line">hash md5 </span><br><span class="line">group <span class="number">2</span></span><br><span class="line">lifetime <span class="number">86400</span></span><br><span class="line">#配置预共享密钥认证</span><br><span class="line">tunnel-group <span class="number">20.1</span><span class="number">.1</span><span class="number">.2</span> type ipsec-l2l </span><br><span class="line">tunnel-group <span class="number">20.1</span><span class="number">.1</span><span class="number">.2</span> ipsec-attributes </span><br><span class="line">   ikev1 pre-<span class="keyword">shared</span>-key cisco</span><br><span class="line">#抓取感兴趣流</span><br><span class="line">access-list vpn permit ip <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">#配置第二阶段策略</span><br><span class="line">crypto ipsec ikev1 transform-<span class="keyword">set</span> IKEv1-lab esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line">crypto map cry-map <span class="number">10</span> match address vpn</span><br><span class="line">crypto map cry-map <span class="number">10</span> <span class="keyword">set</span> peer <span class="number">20.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">crypto map cry-map <span class="number">10</span> <span class="keyword">set</span> ikev1 transform-<span class="keyword">set</span> IKEv1-lab</span><br><span class="line">crypto map cry-map <span class="keyword">interface</span> <span class="symbol">Outside</span></span><br></pre></td></tr></table></figure>

<h3 id="Outside配置IKEv1"><a href="#Outside配置IKEv1" class="headerlink" title="Outside配置IKEv1"></a>Outside配置IKEv1</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">crypto isakmp<span class="built_in"> policy </span>10</span><br><span class="line"> encr 3des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"><span class="built_in"> group </span>2</span><br><span class="line">crypto isakmp key cisco<span class="built_in"> address </span>202.200.200.100</span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit<span class="built_in"> ip </span>2.2.2.0 0.0.0.255 1.1.1.0 0.0.0.255</span><br><span class="line">crypto<span class="built_in"> ipsec </span>transform-<span class="builtin-name">set</span> IKEv1-lab esp-3des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map cry-map 10 ipsec-isakmp </span><br><span class="line"> <span class="builtin-name">set</span><span class="built_in"> peer </span>202.200.200.100</span><br><span class="line"> <span class="builtin-name">set</span> transform-<span class="builtin-name">set</span> IKEv1-lab </span><br><span class="line"> match<span class="built_in"> address </span>vpn</span><br><span class="line"> crypto map cry-map</span><br></pre></td></tr></table></figure>

<h3 id="测试：-1"><a href="#测试：-1" class="headerlink" title="测试："></a>测试：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Outside#telnet 1.1.1.1 /source-interface lo0</span><br><span class="line">Trying 1.1.1.1 <span class="built_in">..</span>. Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Username: cisco</span><br><span class="line">Password: </span><br><span class="line">Inside#</span><br></pre></td></tr></table></figure>

<h3 id="为何telnet可以直接通？查看ASA，系统默认放行VPN流量"><a href="#为何telnet可以直接通？查看ASA，系统默认放行VPN流量" class="headerlink" title="为何telnet可以直接通？查看ASA，系统默认放行VPN流量"></a>为何telnet可以直接通？查看ASA，系统默认放行VPN流量</h3><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">ASA# <span class="keyword">show</span> run <span class="keyword">all</span> sysopt </span><br><span class="line"><span class="keyword">no</span> sysopt <span class="keyword">connection</span> timewait</span><br><span class="line">sysopt <span class="keyword">connection</span> tcpmss <span class="number">1380</span></span><br><span class="line">sysopt <span class="keyword">connection</span> tcpmss minimum <span class="number">0</span></span><br><span class="line">sysopt <span class="keyword">connection</span> permit-vpn          //可<span class="keyword">no</span>掉该命令，然后通过ACL来执行访问控制</span><br><span class="line">sysopt <span class="keyword">connection</span> reclassify-vpn</span><br></pre></td></tr></table></figure>

<h3 id="ASA如何手动清除安全关联"><a href="#ASA如何手动清除安全关联" class="headerlink" title="ASA如何手动清除安全关联"></a>ASA如何手动清除安全关联</h3><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">clear</span> crypto ikev1 <span class="keyword">sa</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ESP</tag>
        <tag>Ikev1</tag>
        <tag>IPSec</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco VPN：SVTI技术</title>
    <url>/2020/07/18/2020-07-Cisco-VPN%EF%BC%9ASVTI%E6%8A%80%E6%9C%AF.html</url>
    <content><![CDATA[<h2 id="SVTI技术"><a href="#SVTI技术" class="headerlink" title="SVTI技术"></a>SVTI技术</h2><ul>
<li>IOS_12.4推出的新特性</li>
<li>通过配置虚拟隧道接口，让流量直接在隧道中传输</li>
<li>该技术的优势在于相对于传统的Crypto-map，能够在隧道接口部署动态路由协议</li>
<li>对于<strong>GRE_OVER_IPSec来说，SVTI同时减少使用GRE四个字节的头部</strong></li>
</ul>
<h2 id="SVTI实验：基于SVTI部署IPSec高可用"><a href="#SVTI实验：基于SVTI部署IPSec高可用" class="headerlink" title="SVTI实验：基于SVTI部署IPSec高可用"></a>SVTI实验：基于SVTI部署IPSec高可用</h2><h3 id="实验需求与预配"><a href="#实验需求与预配" class="headerlink" title="实验需求与预配"></a>实验需求与预配</h3><ul>
<li>前提1：双出口公网链路</li>
<li>前提2：允许混合厂商部署</li>
<li>实现IPsec链路级高可用</li>
<li>预配置：<br>Outside、Primary、Secondary默认路由到Internet<br>内部跑OSPF、宣告30.1.1.0/24和2.2.2.2</li>
</ul>
<img src="../../../images/Cisco%20VPN%EF%BC%9ASVTI%E6%8A%80%E6%9C%AF/vpn-dpd-657x1024.png" alt="img" style="zoom:75%;" />

<h3 id="预配："><a href="#预配：" class="headerlink" title="预配："></a>预配：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Out-Site1</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip add <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Primary</span></span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Secondary</span></span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> ip address <span class="number">20.1</span><span class="number">.1</span><span class="number">.20</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">3</span></span><br><span class="line"> ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.20</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#In-Site2</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Internet</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip add <span class="number">202.200</span><span class="number">.200</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> ip address <span class="number">20.1</span><span class="number">.1</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h3 id="路由配置："><a href="#路由配置：" class="headerlink" title="路由配置："></a>路由配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Primary</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">30.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line"><span class="comment">#In-Site2</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">30.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"> network <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"><span class="comment">#Secondary</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">30.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">20.1</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line"><span class="comment">#Out-Site1</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.100</span></span><br></pre></td></tr></table></figure>

<h3 id="VPN配置："><a href="#VPN配置：" class="headerlink" title="VPN配置："></a>VPN配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Out-Site配置</span></span><br><span class="line"><span class="comment">##第一阶段</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">10.1</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">20.1</span><span class="number">.1</span><span class="number">.20</span></span><br><span class="line"><span class="comment">##第二阶段</span></span><br><span class="line">crypto ipsec transform-set SVTIVPN esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto ipsec profile vpn</span><br><span class="line"> set transform-set SVTIVPN</span><br><span class="line"><span class="comment">##配置SVTI接口</span></span><br><span class="line">interface tunnel <span class="number">10</span>    //<span class="number">10</span>用来和primary沟通</span><br><span class="line">ip add <span class="number">172.16</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">tunnel source <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span>   //隧道源地址</span><br><span class="line">tunnel mode ipsec ipv4       //隧道类型</span><br><span class="line">tunnel destination <span class="number">10.1</span><span class="number">.1</span><span class="number">.10</span>       //隧道目的地址</span><br><span class="line">tunnel protection ipsec profile vpn        //调用IPSec来保护隧道</span><br><span class="line">interface tunnel <span class="number">20</span></span><br><span class="line">ip add <span class="number">172.16</span><span class="number">.2</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">tunnel source <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line">tunnel mode ipsec ipv4</span><br><span class="line">tunnel destination <span class="number">20.1</span><span class="number">.1</span><span class="number">.20</span></span><br><span class="line">tunnel protection ipsec profile vpn</span><br><span class="line"><span class="comment">#Primary配置</span></span><br><span class="line"><span class="comment">##第一阶段</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span>  </span><br><span class="line"><span class="comment">##第二阶段</span></span><br><span class="line">crypto ipsec transform-set SVTIVPN esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto ipsec profile vpn</span><br><span class="line"> set transform-set SVTIVPN </span><br><span class="line"><span class="comment">##配置SVTI接口</span></span><br><span class="line">interface Tunnel10</span><br><span class="line"> ip address <span class="number">172.16</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> tunnel source <span class="number">10.1</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line"> tunnel mode ipsec ipv4</span><br><span class="line"> tunnel destination <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> tunnel protection ipsec profile vpn</span><br><span class="line"><span class="comment">#Secondary配置</span></span><br><span class="line"><span class="comment">##第一阶段</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span>  </span><br><span class="line"><span class="comment">##第二阶段</span></span><br><span class="line">crypto ipsec transform-set SVTIVPN esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto ipsec profile vpn</span><br><span class="line"> set transform-set SVTIVPN </span><br><span class="line"><span class="comment">##配置SVTI接口</span></span><br><span class="line">interface Tunnel10</span><br><span class="line"> ip address <span class="number">172.16</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> tunnel source <span class="number">20.1</span><span class="number">.1</span><span class="number">.20</span></span><br><span class="line"> tunnel mode ipsec ipv4</span><br><span class="line"> tunnel destination <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> tunnel protection ipsec profile vpn</span><br></pre></td></tr></table></figure>

<h3 id="SVTI部署OSPF："><a href="#SVTI部署OSPF：" class="headerlink" title="SVTI部署OSPF："></a>SVTI部署OSPF：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Out-Site1配置</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"> network <span class="number">172.16</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"> network <span class="number">172.16</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"><span class="comment">#Primary配置</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">172.16</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"><span class="comment">#Secondary配置</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">172.16</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="测试VPN："><a href="#测试VPN：" class="headerlink" title="测试VPN："></a>测试VPN：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Outside<span class="comment">#ping 2.2.2.2 source lo0</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">6</span>/<span class="number">7</span>/<span class="number">8</span> ms</span><br><span class="line"><span class="comment">#查看加解密数据包</span></span><br><span class="line">Outside<span class="comment">#show crypto eng</span></span><br><span class="line">Outside<span class="comment">#show crypto engine conn act</span></span><br><span class="line">Crypto Engine Connections</span><br><span class="line">   ID  Type    Algorithm           Encrypt  Decrypt LastSeqN IP-Address</span><br><span class="line">    <span class="number">1</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">0</span>       <span class="number">24</span>       <span class="number">24</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line">    <span class="number">2</span>  IPsec   <span class="number">3</span>DES+MD5                 <span class="number">46</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line">    <span class="number">3</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">0</span>       <span class="number">24</span>       <span class="number">24</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line">    <span class="number">4</span>  IPsec   <span class="number">3</span>DES+MD5                 <span class="number">47</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> <span class="number">1001</span>  IKE     MD5+<span class="number">3</span>DES                  <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> <span class="number">1002</span>  IKE     MD5+<span class="number">3</span>DES                  <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> <span class="number">1003</span>  IKE     MD5+<span class="number">3</span>DES                  <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>VPN</tag>
        <tag>SVTI</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco VPN：动态MAP实验（分支站点无固定IP）</title>
    <url>/2020/07/18/2020-07-Cisco-VPN%EF%BC%9A%E5%8A%A8%E6%80%81MAP%E5%AE%9E%E9%AA%8C%EF%BC%88%E5%88%86%E6%94%AF%E7%AB%99%E7%82%B9%E6%97%A0%E5%9B%BA%E5%AE%9AIP%EF%BC%89.html</url>
    <content><![CDATA[<h1 id="实验一：基于IOS"><a href="#实验一：基于IOS" class="headerlink" title="实验一：基于IOS"></a>实验一：基于IOS</h1><h2 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h2><ul>
<li>在分支站点无固定IP情况下，通过部署动态MAP技术成功建立VPN隧道保护流量传输</li>
<li>预配置：Inside默认路由指向Internet</li>
<li>Internet配置DHCP服务器：<br>下发网段为10.1.1.0/24<br>排除10.1.1.100地址<br>指定下一跳为10.1.1.100</li>
</ul>
<img src="../../../images/Cisco%20VPN%EF%BC%9A%E5%8A%A8%E6%80%81MAP%E5%AE%9E%E9%AA%8C%EF%BC%88%E5%88%86%E6%94%AF%E7%AB%99%E7%82%B9%E6%97%A0%E5%9B%BA%E5%AE%9AIP%EF%BC%89/%E5%8A%A8%E6%80%81map-ios.png" alt="img" style="zoom:50%;" />

<h2 id="实验配置："><a href="#实验配置：" class="headerlink" title="实验配置："></a>实验配置：</h2><h3 id="接口路由配置："><a href="#接口路由配置：" class="headerlink" title="接口路由配置："></a>接口路由配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Inside</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">20.1</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">20.1</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line">interface Loopback <span class="number">0</span></span><br><span class="line">  ip add <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Outside</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address dhcp</span><br><span class="line">interface Loopback <span class="number">0</span></span><br><span class="line">  ip add <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Internet</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">20.1</span><span class="number">.1</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h3 id="Internet配置DHCP服务器："><a href="#Internet配置DHCP服务器：" class="headerlink" title="Internet配置DHCP服务器："></a>Internet配置DHCP服务器：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ip dhcp excluded-address <span class="number">10.1</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line">ip dhcp pool <span class="number">1</span></span><br><span class="line"> network <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> default-router <span class="number">10.1</span><span class="number">.1</span><span class="number">.100</span> </span><br><span class="line"><span class="comment">#测试底层路由</span></span><br><span class="line">Outside(config)<span class="comment">#do ping 20.1.1.10</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">20.1</span><span class="number">.1</span><span class="number">.10</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">1</span>/<span class="number">1</span>/<span class="number">1</span> ms</span><br></pre></td></tr></table></figure>

<h3 id="配置VPN："><a href="#配置VPN：" class="headerlink" title="配置VPN："></a>配置VPN：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Inside</span></span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit ip host <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>            </span><br><span class="line">crypto ipsec transform-set MAPVPN esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto dynamic-map MAP <span class="number">10</span>        </span><br><span class="line"> set transform-set MAPVPN  </span><br><span class="line"> match address vpn</span><br><span class="line"> crypto map MAP <span class="number">1000</span> ipsec-isakmp dynamic MAP   //明细置前，动态置后</span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0</span></span><br><span class="line">  crypto map MAP</span><br><span class="line"><span class="comment">#Outside</span></span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit ip host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> host <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">20.1</span><span class="number">.1</span><span class="number">.10</span>            </span><br><span class="line">crypto ipsec transform-set MAPVPN esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map  MAP <span class="number">10</span> ipsec-isakmp</span><br><span class="line"> set transform-set MAPVPN </span><br><span class="line"> match address vpn</span><br><span class="line"> set peer <span class="number">20.1</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0</span></span><br><span class="line">  crypto map MAP</span><br></pre></td></tr></table></figure>

<h3 id="测试VPN："><a href="#测试VPN：" class="headerlink" title="测试VPN："></a>测试VPN：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#只能从动态一方发起</span></span><br><span class="line">Outside<span class="comment">#ping 2.2.2.2 source lo0</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">.!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">80</span> percent (<span class="number">4</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">3</span>/<span class="number">4</span>/<span class="number">5</span> ms</span><br><span class="line"><span class="comment">#查看加解密数据包：</span></span><br><span class="line">Inside<span class="comment">#show crypto engine connections active </span></span><br><span class="line">Crypto Engine Connections</span><br><span class="line">   ID  Type    Algorithm           Encrypt  Decrypt LastSeqN IP-Address</span><br><span class="line">    <span class="number">1</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">0</span>        <span class="number">4</span>        <span class="number">4</span> <span class="number">20.1</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">    <span class="number">2</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">4</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">20.1</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line"> <span class="number">1001</span>  IKE     MD5+<span class="number">3</span>DES                  <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">20.1</span><span class="number">.1</span><span class="number">.10</span></span><br></pre></td></tr></table></figure>

<h1 id="实验二：基于ASAOS"><a href="#实验二：基于ASAOS" class="headerlink" title="实验二：基于ASAOS"></a>实验二：基于ASAOS</h1><h2 id="实验需求："><a href="#实验需求：" class="headerlink" title="实验需求："></a>实验需求：</h2><ul>
<li>在分支站点无固定IP情况下，通过部署动态MAP技术成功建立VPN隧道保护流量传输</li>
<li>预配置：<br>R2默认路由指向ASA2<br>ASA2解决本端通信点路由、对端加解密点、对端通信点路由<br>ASA1配置DHCP：下发网段为10.1.1.0/24</li>
</ul>
<img src="../../../images/Cisco%20VPN%EF%BC%9A%E5%8A%A8%E6%80%81MAP%E5%AE%9E%E9%AA%8C%EF%BC%88%E5%88%86%E6%94%AF%E7%AB%99%E7%82%B9%E6%97%A0%E5%9B%BA%E5%AE%9AIP%EF%BC%89/asa-map.png" alt="img" style="zoom:50%;" />

<h2 id="实验配置：-1"><a href="#实验配置：-1" class="headerlink" title="实验配置："></a>实验配置：</h2><h3 id="预配置："><a href="#预配置：" class="headerlink" title="预配置："></a>预配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ASAv1</span></span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span></span><br><span class="line"> nameif Inside</span><br><span class="line"> security-level <span class="number">100</span></span><br><span class="line"> ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line">interface GigabitEthernet0/<span class="number">1</span></span><br><span class="line"> nameif Outside</span><br><span class="line"> security-level <span class="number">0</span></span><br><span class="line"> ip address <span class="number">20.1</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">dhcpd address <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">-10.1</span><span class="number">.1</span><span class="number">.9</span> Inside</span><br><span class="line">dhcpd enable Inside</span><br><span class="line"><span class="comment">#ASAv2</span></span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span></span><br><span class="line"> nameif Inside</span><br><span class="line"> security-level <span class="number">100</span></span><br><span class="line"> ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.20</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line">interface GigabitEthernet0/<span class="number">1</span></span><br><span class="line"> nameif Outside</span><br><span class="line"> security-level <span class="number">0</span></span><br><span class="line"> ip address <span class="number">20.1</span><span class="number">.1</span><span class="number">.20</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">route Outside <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">20.1</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">route Inside <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">30.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line"><span class="comment">#R1</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address dhcp</span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#R2</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h3 id="VPN配置："><a href="#VPN配置：" class="headerlink" title="VPN配置："></a>VPN配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#R1</span></span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit ip host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> host <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">20.1</span><span class="number">.1</span><span class="number">.20</span>          </span><br><span class="line">crypto ipsec transform-set MAPVPN esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map  MAP <span class="number">10</span> ipsec-isakmp</span><br><span class="line"> set transform-set MAPVPN </span><br><span class="line"> match address vpn</span><br><span class="line"> set peer <span class="number">20.1</span><span class="number">.1</span><span class="number">.20</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0</span></span><br><span class="line">  crypto map MAP</span><br><span class="line"><span class="comment">#ASAv2</span></span><br><span class="line">crypto ikev1 enable Outside</span><br><span class="line">crypto ikev1 policy <span class="number">10</span></span><br><span class="line"> authentication pre-share</span><br><span class="line"> encryption <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">tunnel-group DefaultL2LGroup ipsec-attributes   //全局下不显示，默认隐藏show run all tunnel-group</span><br><span class="line"> ikev1 pre-shared-key cisco</span><br><span class="line">access-list vpn extended permit ip host <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">crypto ipsec ikev1 transform-set MAPVPN esp<span class="number">-3</span>des esp-md5-hmac</span><br><span class="line">crypto dynamic-map dymap <span class="number">1</span> match address vpn</span><br><span class="line">crypto dynamic-map dymap <span class="number">1</span> set ikev1 transform-set MAPVPN</span><br><span class="line">crypto map MAP <span class="number">1000</span> ipsec-isakmp dynamic dymap</span><br><span class="line">crypto map MAP interface Outside</span><br><span class="line"><span class="comment">#ASAv1放行ESP流量</span></span><br><span class="line">access-list out permit esp host <span class="number">20.1</span><span class="number">.1</span><span class="number">.20</span> any</span><br><span class="line">access-group out <span class="keyword">in</span> interface outside</span><br></pre></td></tr></table></figure>

<h3 id="测试VPN：-1"><a href="#测试VPN：-1" class="headerlink" title="测试VPN："></a>测试VPN：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#只能从动态IP方发起</span></span><br><span class="line">R1<span class="comment">#ping 2.2.2.2 source lo0</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">.!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">80</span> percent (<span class="number">4</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">7</span>/<span class="number">9</span>/<span class="number">12</span> ms</span><br><span class="line"><span class="comment">#查看加解密数据包</span></span><br><span class="line">R1<span class="comment"># show crypto engine connections active </span></span><br><span class="line">Crypto Engine Connections</span><br><span class="line">   ID  Type    Algorithm           Encrypt  Decrypt LastSeqN IP-Address</span><br><span class="line">    <span class="number">1</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">0</span>        <span class="number">4</span>        <span class="number">4</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">    <span class="number">2</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">4</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"> <span class="number">1001</span>  IKE     MD5+<span class="number">3</span>DES                  <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>VPN</tag>
        <tag>MAP</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco VPN：网络穿越</title>
    <url>/2020/07/18/2020-07-Cisco-VPN%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%A9%BF%E8%B6%8A.html</url>
    <content><![CDATA[<h2 id="实验1-VPN流量穿越中间设备"><a href="#实验1-VPN流量穿越中间设备" class="headerlink" title="实验1:VPN流量穿越中间设备"></a>实验1:VPN流量穿越中间设备</h2><h3 id="实验需求："><a href="#实验需求：" class="headerlink" title="实验需求："></a>实验需求：</h3><ul>
<li><p>拓扑图如下</p>
</li>
<li><p>Outside预配置：</p>
<ul>
<li>IP：202.200.200.1</li>
<li>Loopback 0 ：2.2.2.2</li>
<li>默认路由指向ASA</li>
</ul>
</li>
<li><p>Inside预配置：</p>
<ul>
<li><p>IP：10.1.1.1</p>
</li>
<li><p>Loopback 0 ：1.1.1.1</p>
</li>
<li><p>默认路由指向ASA</p>
</li>
</ul>
</li>
<li><p>ASA预配置</p>
<ul>
<li>IP：.10</li>
<li>放行Outside的ICMP流量，测试连通性后删掉（可选）</li>
</ul>
</li>
<li><p>Outside与Inside配置L2LVPN，成功建立VPN并穿越ASA</p>
</li>
</ul>
<p><img src="../../../images/Cisco%20VPN%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%A9%BF%E8%B6%8A/VPN%E7%A9%BF%E8%B6%8A%E4%B8%AD%E9%97%B4%E8%AE%BE%E5%A4%87lab1.png" alt="img"></p>
<h3 id="实验配置："><a href="#实验配置：" class="headerlink" title="实验配置："></a>实验配置：</h3><h4 id="预配："><a href="#预配：" class="headerlink" title="预配："></a>预配：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置接口</span></span><br><span class="line"><span class="comment">##ASA配置</span></span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span></span><br><span class="line"> nameif Inside</span><br><span class="line"> security-level <span class="number">100</span></span><br><span class="line"> ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line">interface GigabitEthernet0/<span class="number">1</span></span><br><span class="line"> nameif Outside</span><br><span class="line"> security-level <span class="number">0</span></span><br><span class="line"> ip address <span class="number">202.200</span><span class="number">.200</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line"><span class="comment">##Inside配置</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">##Outside配置</span></span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#配置底层路由连通性</span></span><br><span class="line">Inside(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 10.1.1.10</span></span><br><span class="line">Outdside(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 202.200.200.10</span></span><br><span class="line"><span class="comment">#ASA放行Outside的ICMP流量</span></span><br><span class="line">access-list <span class="number">101</span> extended permit icmp <span class="number">202.200</span><span class="number">.200</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">access-group <span class="number">101</span> <span class="keyword">in</span> interface Outside</span><br></pre></td></tr></table></figure>

<h4 id="测试底层路由："><a href="#测试底层路由：" class="headerlink" title="测试底层路由："></a>测试底层路由：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Outdside<span class="comment">#ping 10.1.1.1</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">1</span>/<span class="number">1</span>/<span class="number">2</span> ms</span><br></pre></td></tr></table></figure>

<h4 id="配置站点到站点VPN："><a href="#配置站点到站点VPN：" class="headerlink" title="配置站点到站点VPN："></a>配置站点到站点VPN：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Inside配置</span></span><br><span class="line"><span class="comment">##匹配感兴趣流</span></span><br><span class="line">ip access-list extended VPN</span><br><span class="line"> permit ip <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"><span class="comment">##配置L2LVPN</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key Cisco address <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line">crypto ipsec transform-set L2LVPN esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map VPN-MAP <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set peer <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> set transform-set L2LVPN </span><br><span class="line"> match address VPN</span><br><span class="line"><span class="comment">##应用到接口</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> crypto map VPN-MAP</span><br><span class="line"><span class="comment">##Outside配置</span></span><br><span class="line"><span class="comment">##匹配感兴趣流</span></span><br><span class="line">ip access-list extended VPN</span><br><span class="line"> permit ip <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line"><span class="comment">##配置L2LVPN</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key Cisco address <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span>       </span><br><span class="line">crypto ipsec transform-set L2LVPN esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map VPN-MAP <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set peer <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"> set transform-set L2LVPN </span><br><span class="line"> match address VPN</span><br><span class="line"><span class="comment">##应用到接口</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> crypto map VPN-MAP</span><br></pre></td></tr></table></figure>

<h4 id="测试连通性："><a href="#测试连通性：" class="headerlink" title="测试连通性："></a>测试连通性：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside<span class="comment">#ping 2.2.2.2 so lo0 </span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">.....</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">0</span> percent (<span class="number">0</span>/<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<h4 id="查看安全关联："><a href="#查看安全关联：" class="headerlink" title="查看安全关联："></a>查看安全关联：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside<span class="comment">#show cry eng connections active </span></span><br><span class="line">Crypto Engine Connections</span><br><span class="line">   ID  Type    Algorithm           Encrypt  Decrypt LastSeqN IP-Address</span><br><span class="line">    <span class="number">3</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">    <span class="number">4</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">4</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"> <span class="number">1002</span>  IKE     MD5+<span class="number">3</span>DES                  <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line">Outdside<span class="comment">#show cry eng conn ac</span></span><br><span class="line">Crypto Engine Connections</span><br><span class="line"></span><br><span class="line">   ID  Type    Algorithm           Encrypt  Decrypt LastSeqN IP-Address</span><br><span class="line">    <span class="number">5</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">0</span>        <span class="number">4</span>        <span class="number">4</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line">    <span class="number">6</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">4</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> <span class="number">1003</span>  IKE     MD5+<span class="number">3</span>DES                  <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>现象：Outside有加解密，Inside有加密没解密</strong></p>
</blockquote>
<h4 id="查看被ASA默认规则干掉的数据包："><a href="#查看被ASA默认规则干掉的数据包：" class="headerlink" title="查看被ASA默认规则干掉的数据包："></a>查看被ASA默认规则干掉的数据包：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASAv(config)<span class="comment"># show asp dro frame </span></span><br><span class="line">  Flow <span class="keyword">is</span> denied by configured rule (acl-drop)                                <span class="number">17</span></span><br></pre></td></tr></table></figure>

<h4 id="解决问题：ASA放行ESP流量，默认ISAMKP已被监控（放行）"><a href="#解决问题：ASA放行ESP流量，默认ISAMKP已被监控（放行）" class="headerlink" title="解决问题：ASA放行ESP流量，默认ISAMKP已被监控（放行）"></a>解决问题：ASA放行ESP流量，默认ISAMKP已被监控（放行）</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">access-list <span class="number">101</span> extended permit esp host <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span> host <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h4 id="再次测试："><a href="#再次测试：" class="headerlink" title="再次测试："></a>再次测试：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Outdside<span class="comment">#ping 1.1.1.1 so lo0 </span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> </span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">5</span>/<span class="number">6</span>/<span class="number">7</span> ms</span><br></pre></td></tr></table></figure>

<h2 id="实验2-VPN流量穿越边界设备"><a href="#实验2-VPN流量穿越边界设备" class="headerlink" title="实验2:VPN流量穿越边界设备"></a>实验2:VPN流量穿越边界设备</h2><h3 id="实验需求：-1"><a href="#实验需求：-1" class="headerlink" title="实验需求："></a>实验需求：</h3><ul>
<li>基于上一个实验进行</li>
<li>控制VPN流量只能允许telnet</li>
</ul>
<h3 id="实验配置：-1"><a href="#实验配置：-1" class="headerlink" title="实验配置："></a>实验配置：</h3><h4 id="配置入方向ACL控制加密流量："><a href="#配置入方向ACL控制加密流量：" class="headerlink" title="配置入方向ACL控制加密流量："></a>配置入方向ACL控制加密流量：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#清空安全关联，在Outside配置入方向ACL并应用在接口入方向</span></span><br><span class="line">ip access-list extended Inbound-acl</span><br><span class="line"> permit esp host <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> host <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> permit udp host <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> host <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span> eq isakmp</span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip access-group Inbound-acl <span class="keyword">in</span></span><br><span class="line"><span class="comment">#再次测试隧道流量</span></span><br><span class="line">Inside<span class="comment">#ping 2.2.2.2 source lo0</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">6</span>/<span class="number">7</span>/<span class="number">10</span> ms</span><br><span class="line"><span class="comment">#查看入方向ACL匹配项</span></span><br><span class="line">Outdside<span class="comment">#sh access-lists </span></span><br><span class="line">Extended IP access list Inbound-acl</span><br><span class="line">    <span class="number">10</span> permit udp host <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> host <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span> eq isakmp (<span class="number">5</span> matches)</span><br><span class="line">    <span class="number">20</span> permit esp host <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> host <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span> (<span class="number">4</span> matches)</span><br></pre></td></tr></table></figure>

<h4 id="配置Crypto-Map-ACL控制解密后流量"><a href="#配置Crypto-Map-ACL控制解密后流量" class="headerlink" title="配置Crypto-Map_ACL控制解密后流量"></a>配置Crypto-Map_ACL控制解密后流量</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#清空安全关联，在Outside配置Crypto-Map_ACL</span></span><br><span class="line">ip access-list extended Crypto-ACL</span><br><span class="line"> permit tcp host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> host <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> eq telnet</span><br><span class="line">crypto map VPN-MAP <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set ip access-group Crypto-ACL <span class="keyword">in</span></span><br><span class="line"><span class="comment">#测试放行流量telnet</span></span><br><span class="line">Inside<span class="comment">#telnet 2.2.2.2 /source-interface lo0</span></span><br><span class="line">Trying <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> ... Open</span><br><span class="line"></span><br><span class="line">User Access Verification</span><br><span class="line"></span><br><span class="line">Username: cisco</span><br><span class="line">Password: </span><br><span class="line">Outdside<span class="comment">#</span></span><br><span class="line"><span class="comment">#测试未放行流量icmp</span></span><br><span class="line">Inside<span class="comment">#ping 2.2.2.2 source loopback 0                 </span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">.....</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">0</span> percent (<span class="number">0</span>/<span class="number">5</span>)</span><br><span class="line"><span class="comment">#查看ACL匹配项</span></span><br><span class="line">Outdside<span class="comment">#show access-lists Crypto-ACL</span></span><br><span class="line">Extended IP access list Crypto-ACL</span><br><span class="line">    <span class="number">10</span> permit tcp host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> host <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> eq telnet (<span class="number">5</span> matches)</span><br></pre></td></tr></table></figure>

<h2 id="实验3-VPN流量穿越地址转换"><a href="#实验3-VPN流量穿越地址转换" class="headerlink" title="实验3:VPN流量穿越地址转换"></a>实验3:VPN流量穿越地址转换</h2><h3 id="NAT对VPN流量的影响："><a href="#NAT对VPN流量的影响：" class="headerlink" title="NAT对VPN流量的影响："></a>NAT对VPN流量的影响：</h3><ul>
<li>AH技术对IP头部的源IP地址与目的IP地址执行完整性校验，所以无法穿越任何地址转换</li>
<li>ESP隧道模式可以穿越NAT，但穿越PAT时会遇到问题，NAT-T技术将解决这个问题</li>
</ul>
<table>
<thead>
<tr>
<th>封装协议</th>
<th>能否穿越NAT（静态一对一）</th>
<th>能否穿越PAT</th>
</tr>
</thead>
<tbody><tr>
<td>AH</td>
<td>否</td>
<td>否</td>
</tr>
<tr>
<td>ESP</td>
<td>TCP/UDP不能，其他三层协议可以</td>
<td>否</td>
</tr>
</tbody></table>
<h3 id="ESP穿越PAT会遇到什么问题？"><a href="#ESP穿越PAT会遇到什么问题？" class="headerlink" title="ESP穿越PAT会遇到什么问题？"></a>ESP穿越PAT会遇到什么问题？</h3><ul>
<li>PAT不仅要转换源IP地址，还要转换传输层（四层）源端口号</li>
<li>ESP为三层技术，没有传输层头部和端口号</li>
<li>所以ASA无法使用PAT技术对其进行转换，直接丢弃</li>
</ul>
<h3 id="NAT-T技术如何解决该问题？"><a href="#NAT-T技术如何解决该问题？" class="headerlink" title="NAT-T技术如何解决该问题？"></a>NAT-T技术如何解决该问题？</h3><ul>
<li>数据封装格式：<br>加密前明文数据 IP DATA<br>ESP加密后数据 IP ESP IP DATA<br>NAT-T封装后数据 IP UDP（UDP/4500）None-IKE ESP IP DATA</li>
<li>思科IOS版本在12.2（13）T以后支持NAT-T</li>
<li>将ESP数据包封装到UDP数据包内（UDP（UDP/4500）None-IKE）</li>
<li>使得NAT设备按照处理一个普通的UDP数据包方式对它进行处理</li>
<li>路由器和ASA都支持NAT-T记住，路由器该技术默认开启，ASA一旦激活ISAKMP，NAT-T也随之开启</li>
</ul>
<h3 id="实验需求：-2"><a href="#实验需求：-2" class="headerlink" title="实验需求："></a>实验需求：</h3><ul>
<li>基于上一个拓扑</li>
<li>部署以下PAT<ul>
<li>转换源：10.1.1.0/24</li>
<li>PAT转换到防火墙出接口</li>
</ul>
</li>
<li>部署站点到站点VPN</li>
</ul>
<h3 id="实验配置：-2"><a href="#实验配置：-2" class="headerlink" title="实验配置："></a>实验配置：</h3><h4 id="部署PAT："><a href="#部署PAT：" class="headerlink" title="部署PAT："></a>部署PAT：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">object network Inside-network</span><br><span class="line"> subnet <span class="number">10.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> nat (Inside,Outside) dynamic interface</span><br></pre></td></tr></table></figure>

<h4 id="部署站点到站点VPN："><a href="#部署站点到站点VPN：" class="headerlink" title="部署站点到站点VPN："></a>部署站点到站点VPN：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Outside路由器配置</span></span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit ip <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">202.200</span><span class="number">.200</span><span class="number">.10</span> </span><br><span class="line">crypto ipsec transform-set vpn-nat esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map nat-map <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set peer <span class="number">202.200</span><span class="number">.200</span><span class="number">.10</span></span><br><span class="line"> set transform-set vpn-nat </span><br><span class="line"> match address vpn</span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0</span></span><br><span class="line"> crypto map nat-map</span><br><span class="line"><span class="comment">#Inside路由器配置</span></span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit ip <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span>  </span><br><span class="line">crypto ipsec transform-set vpn-nat esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map nat-map <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set peer <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> set transform-set vpn-nat </span><br><span class="line"> match address vpn</span><br><span class="line"> crypto map nat-map</span><br></pre></td></tr></table></figure>

<h4 id="测试VPN"><a href="#测试VPN" class="headerlink" title="测试VPN"></a>测试VPN</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside<span class="comment">#ping 2.2.2.2 source loopback 0</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">6</span>/<span class="number">7</span>/<span class="number">9</span> ms</span><br></pre></td></tr></table></figure>

<blockquote>
<p>为何直接可以通信？<br>1、该技术在ASA以及路由器上是默认开启的<br>2、若要关闭此技术，则执行以下命令：<br>ASA关闭：<font color="#dd00">no crypto isakmp nat-traversal</font><br>IOS关闭：<font color="#dd00">no crypto ipsec nat-transparency udp-encapsulation</font></p>
</blockquote>
]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>Firewall</tag>
        <tag>VPN</tag>
        <tag>IPSec</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco VPN：高可用性</title>
    <url>/2020/07/18/2020-07-Cisco-VPN%EF%BC%9A%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7.html</url>
    <content><![CDATA[<h1 id="高可用性组成模块"><a href="#高可用性组成模块" class="headerlink" title="高可用性组成模块"></a>高可用性组成模块</h1><h2 id="模块一、DPD死亡对等体监测"><a href="#模块一、DPD死亡对等体监测" class="headerlink" title="模块一、DPD死亡对等体监测"></a>模块一、DPD死亡对等体监测</h2><ul>
<li><p>需要主/备同时开启</p>
</li>
<li><p>开启DPD技术，需要将安全关联清掉，才生效</p>
</li>
<li><p>DPD两种工作模式：</p>
<ul>
<li><p>Dead_Peer_Detection_Periodic（周期性工作模式）<br>设置一个计时器，设备按照该计时器周期发送DPD<br>默认连续发五次探测包，超过5次对等体还没回应，将判定为死亡对等体<br>该模式优劣势：快速检测到有问题的对等体，但较占资源</p>
</li>
<li><p>Dead_Peer_Detection_on-demand（按需工作模式）（<strong>默认</strong>）<br>若两个对等体发送数据包，加解密正常，不发DPD<br>若两个对等体没有互发加密数据包，不发DPD<br>当路由器发出加密数据但在一定时间内没有解密任何源自对等体的数据的清空下<br>按需DPD才会发出，同时发现问题对等体<br>该模式优劣势：占有资源少，但检测时间相对周期长</p>
</li>
</ul>
</li>
</ul>
<h2 id="模块二、RRI反向路由注入"><a href="#模块二、RRI反向路由注入" class="headerlink" title="模块二、RRI反向路由注入"></a>模块二、RRI反向路由注入</h2><ul>
<li>内网必须使用动态路由协议</li>
<li>主/备设备上都启用反向路由技术</li>
<li>反向路由技术产生静态路由</li>
<li>需要执行重分布，将静态路由重分布到内网动态路由协议中，从而实现VPN网关随设备的切换而切换</li>
</ul>
<h1 id="实验一、链路备份"><a href="#实验一、链路备份" class="headerlink" title="实验一、链路备份"></a>实验一、链路备份</h1><h2 id="需求和前提："><a href="#需求和前提：" class="headerlink" title="需求和前提："></a>需求和前提：</h2><ul>
<li>拓扑图如下</li>
<li>公司具备两条出口公网链路</li>
<li>需要两个公网IP地址</li>
<li>实现链路级别IPSec_VPN的高可用性</li>
<li>Outside、Primary、Secondary默认路由到Internet</li>
<li>内部运行OSPF、宣告30.1.1.0/24和2.2.2.2</li>
</ul>
<img src="../../../images/Cisco%20VPN%EF%BC%9A%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7/vpn-dpd-657x1024-20200718020939565.png" alt="img" style="zoom:75%;" />

<h2 id="实验配置："><a href="#实验配置：" class="headerlink" title="实验配置："></a>实验配置：</h2><h3 id="接口配置："><a href="#接口配置：" class="headerlink" title="接口配置："></a>接口配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Out-Site1</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip add <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Primary</span></span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Secondary</span></span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> ip address <span class="number">20.1</span><span class="number">.1</span><span class="number">.20</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">3</span></span><br><span class="line"> ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.20</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#In-Site2</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Internet</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip add <span class="number">202.200</span><span class="number">.200</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> ip address <span class="number">20.1</span><span class="number">.1</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h3 id="路由配置："><a href="#路由配置：" class="headerlink" title="路由配置："></a>路由配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Primary</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">30.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line"><span class="comment">#In-Site2</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">30.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"> network <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"><span class="comment">#Secondary</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">30.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">20.1</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line"><span class="comment">#Out-Site1</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.100</span></span><br></pre></td></tr></table></figure>

<h3 id="VPN配置："><a href="#VPN配置：" class="headerlink" title="VPN配置："></a>VPN配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Out-Site1</span></span><br><span class="line"><span class="comment">##抓取感兴趣流</span></span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit ip host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> host <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line"><span class="comment">##配置IPSec_VPN</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">10.1</span><span class="number">.1</span><span class="number">.10</span>      //配置顺序，先主后备</span><br><span class="line">crypto isakmp key cisco address <span class="number">20.1</span><span class="number">.1</span><span class="number">.20</span>      </span><br><span class="line">crypto isakmp keepalive <span class="number">10</span> periodic            //开启周期性死亡对等体检测</span><br><span class="line">crypto ipsec transform-set DPDVPN esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map DPD <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set peer <span class="number">10.1</span><span class="number">.1</span><span class="number">.10</span> default       //优先关联Default参数的对等体尝试建立连接</span><br><span class="line"> set peer <span class="number">20.1</span><span class="number">.1</span><span class="number">.20</span></span><br><span class="line"> set security-association idle-time <span class="number">180</span>  //配置闲置时间，超过闲置时间的安全关联被删除</span><br><span class="line"> set transform-set DPDVPN </span><br><span class="line"> match address vpn</span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">0</span></span><br><span class="line">  crypto map DPD</span><br><span class="line"><span class="comment">#Primary</span></span><br><span class="line"><span class="comment">##抓取感兴趣流</span></span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit ip host <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"><span class="comment">##配置IPSec_VPN</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span>     </span><br><span class="line">crypto isakmp keepalive <span class="number">10</span> periodic            //开启周期性死亡对等体检测</span><br><span class="line">crypto ipsec transform-set DPDVPN esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map DPD <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set peer <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span>      </span><br><span class="line"> set security-association idle-time <span class="number">180</span>  //配置闲置时间，超过闲置时间的安全关联被删除</span><br><span class="line"> set transform-set DPDVPN </span><br><span class="line"> reverse-route static             //开启反向路由注入</span><br><span class="line"> set reverse-route tag <span class="number">10</span>         //给注入的路由打上标签<span class="number">10</span></span><br><span class="line"> match address vpn</span><br><span class="line">route-map VPN              //创建Route-map，匹配tag <span class="number">10</span></span><br><span class="line"> match tag <span class="number">10</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line">  redistribute static subnets route-map VPN     //执行路由重分布</span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">1</span></span><br><span class="line">  crypto map DPD</span><br><span class="line"><span class="comment">#Secondary</span></span><br><span class="line"><span class="comment">##抓取感兴趣流</span></span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit ip host <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> host <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"><span class="comment">##配置IPSec_VPN</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span>     </span><br><span class="line">crypto isakmp keepalive <span class="number">10</span> periodic          //开启周期性死亡对等体检测</span><br><span class="line">crypto ipsec transform-set DPDVPN esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map DPD <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set peer <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span>      </span><br><span class="line"> set security-association idle-time <span class="number">180</span>  //配置闲置时间，超过闲置时间的安全关联被删除</span><br><span class="line"> set transform-set DPDVPN </span><br><span class="line"> match address vpn</span><br><span class="line"> reverse-route static             //开启反向路由注入</span><br><span class="line"> set reverse-route tag <span class="number">10</span>         //给注入的路由打上标签<span class="number">10</span></span><br><span class="line">route-map VPN              //创建Route-map，匹配tag <span class="number">10</span></span><br><span class="line"> match tag <span class="number">10</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line">  redistribute static subnets route-map VPN     //执行路由重分布</span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">2</span></span><br><span class="line">  crypto map DPD</span><br></pre></td></tr></table></figure>

<h3 id="测试VPN："><a href="#测试VPN：" class="headerlink" title="测试VPN："></a>测试VPN：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In-Site2<span class="comment"># ping 1.1.1.1 so lo0         </span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> </span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">1</span>/<span class="number">1</span>/<span class="number">2</span> ms</span><br><span class="line"><span class="comment">#关闭Primary接口再次测试</span></span><br><span class="line">In-Site2<span class="comment"># ping 1.1.1.1 so lo0 repeat 100   </span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> </span><br><span class="line">!!!!!......!!!!!!!!!!!!!!!!</span><br></pre></td></tr></table></figure>

<h1 id="实验二、设备备份"><a href="#实验二、设备备份" class="headerlink" title="实验二、设备备份"></a>实验二、设备备份</h1><h2 id="需求与前提："><a href="#需求与前提：" class="headerlink" title="需求与前提："></a>需求与前提：</h2><ul>
<li>公司只有一条出公网线路</li>
<li>需要三个公网IP</li>
<li>结合HSRP技术实现设备级别IPSec_VPN的高可用性</li>
<li>Outside、Primary、Secondary默认路由到Internet</li>
<li>内部运行OSPF、宣告30.1.1.0/24和2.2.2.2</li>
</ul>
<img src="../../../images/Cisco%20VPN%EF%BC%9A%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7/vpn-hsrp-674x1024.png" alt="img" style="zoom:75%;" />

<h2 id="实验配置：-1"><a href="#实验配置：-1" class="headerlink" title="实验配置："></a>实验配置：</h2><h3 id="接口配置：-1"><a href="#接口配置：-1" class="headerlink" title="接口配置："></a>接口配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Primary</span></span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Secondary</span></span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.20</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">3</span></span><br><span class="line"> ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.20</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Out-Site1</span></span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>      </span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#In-Site2</span></span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> ip address <span class="number">30.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#Internet</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">202.200</span><span class="number">.200</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">10.1</span><span class="number">.1</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h3 id="路由配置：-1"><a href="#路由配置：-1" class="headerlink" title="路由配置："></a>路由配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Primary</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">30.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"><span class="comment">#In-Site2</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"> network <span class="number">30.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br><span class="line"><span class="comment">#Out-Site1</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.100</span></span><br><span class="line"><span class="comment">#Secondary</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> network <span class="number">30.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> area <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="HSRP配置："><a href="#HSRP配置：" class="headerlink" title="HSRP配置："></a>HSRP配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Primary</span></span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> standby <span class="number">1</span> ip <span class="number">10.1</span><span class="number">.1</span><span class="number">.200</span></span><br><span class="line"> standby <span class="number">1</span> priority <span class="number">105</span></span><br><span class="line"> standby <span class="number">1</span> preempt</span><br><span class="line"> standby <span class="number">1</span> name vpn</span><br><span class="line"><span class="comment">#Secondary</span></span><br><span class="line">interface Ethernet0/<span class="number">3</span></span><br><span class="line"> standby <span class="number">1</span> ip <span class="number">10.1</span><span class="number">.1</span><span class="number">.200</span></span><br><span class="line"> standby <span class="number">1</span> priority <span class="number">100</span></span><br><span class="line"> standby <span class="number">1</span> name vpn</span><br><span class="line"><span class="comment">#查看HSRP状态</span></span><br><span class="line">Primary(config-<span class="keyword">if</span>)<span class="comment">#do show standby</span></span><br><span class="line">Ethernet0/<span class="number">2</span> - Group <span class="number">1</span></span><br><span class="line">  State <span class="keyword">is</span> Active</span><br><span class="line"><span class="comment">#测试HSRP连通性</span></span><br><span class="line">Out-Site1<span class="comment"># ping 10.1.1.200</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">10.1</span><span class="number">.1</span><span class="number">.200</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">1</span>/<span class="number">1</span>/<span class="number">3</span> ms</span><br></pre></td></tr></table></figure>

<h3 id="VPN配置：-1"><a href="#VPN配置：-1" class="headerlink" title="VPN配置："></a>VPN配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Out-Site1配置</span></span><br><span class="line"><span class="comment">##第一阶段配置</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">10.1</span><span class="number">.1</span><span class="number">.200</span>     </span><br><span class="line">crypto isakmp keepalive <span class="number">10</span> periodic</span><br><span class="line"><span class="comment">##第二阶段配置</span></span><br><span class="line"><span class="comment">###抓取感兴趣流</span></span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit ip <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">crypto ipsec transform-set vpn-hsrp esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map vpn-hsrp-map <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set peer <span class="number">10.1</span><span class="number">.1</span><span class="number">.200</span></span><br><span class="line"> set transform-set vpn-hsrp </span><br><span class="line"> match address vpn</span><br><span class="line"> <span class="comment">###应用到接口</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> crypto map vpn-hsrp-map</span><br><span class="line"><span class="comment">#Primary配置</span></span><br><span class="line"><span class="comment">##第一阶段配置</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span>    </span><br><span class="line">crypto isakmp keepalive <span class="number">10</span> periodic</span><br><span class="line"><span class="comment">##第二阶段配置</span></span><br><span class="line"><span class="comment">###抓取感兴趣流</span></span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit ip <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">crypto ipsec transform-set vpn-hsrp esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map vpn-hsrp-map <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set peer <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> set transform-set vpn-hsrp </span><br><span class="line"> match address vpn</span><br><span class="line"> reverse-route static </span><br><span class="line"> set reverse-route tag <span class="number">10</span></span><br><span class="line">route-map VPN</span><br><span class="line"> match tag <span class="number">10</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> redistribute static subnets route-map VPN</span><br><span class="line"><span class="comment">###应用到接口</span></span><br><span class="line">interface Ethernet0/<span class="number">2</span></span><br><span class="line"> crypto map vpn-hsrp-map redundancy vpn      //调用MAP的同时关联所配置的HSRP</span><br><span class="line"><span class="comment">#Seconadry配置</span></span><br><span class="line"><span class="comment">##第一阶段配置</span></span><br><span class="line">crypto isakmp policy <span class="number">10</span></span><br><span class="line"> encr <span class="number">3</span>des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"> group <span class="number">2</span></span><br><span class="line">crypto isakmp key cisco address <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span>    </span><br><span class="line">crypto isakmp keepalive <span class="number">10</span> periodic</span><br><span class="line"><span class="comment">##第二阶段配置</span></span><br><span class="line"><span class="comment">###抓取感兴趣流</span></span><br><span class="line">ip access-list extended vpn</span><br><span class="line"> permit ip <span class="number">2.2</span><span class="number">.2</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">crypto ipsec transform-set vpn-hsrp esp<span class="number">-3</span>des esp-md5-hmac </span><br><span class="line"> mode tunnel</span><br><span class="line">crypto map vpn-hsrp-map <span class="number">10</span> ipsec-isakmp </span><br><span class="line"> set peer <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> set transform-set vpn-hsrp </span><br><span class="line"> match address vpn</span><br><span class="line"> reverse-route static </span><br><span class="line"> set reverse-route tag <span class="number">10</span></span><br><span class="line">route-map VPN</span><br><span class="line"> match tag <span class="number">10</span></span><br><span class="line">router ospf <span class="number">100</span></span><br><span class="line"> redistribute static subnets route-map VPN</span><br><span class="line"><span class="comment">###应用到接口</span></span><br><span class="line">interface Ethernet0/<span class="number">3</span></span><br><span class="line"> crypto map vpn-hsrp-map redundancy vpn     //调用MAP的同时关联所配置的HSRP</span><br></pre></td></tr></table></figure>

<h3 id="测试VPN：-1"><a href="#测试VPN：-1" class="headerlink" title="测试VPN："></a>测试VPN：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In-Site2<span class="comment">#  ping 1.1.1.1 so lo0</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span> </span><br><span class="line">.!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">80</span> percent (<span class="number">4</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">4</span>/<span class="number">5</span>/<span class="number">7</span> ms</span><br><span class="line"><span class="comment">#查看加解密</span></span><br><span class="line">Out-Site1<span class="comment">#show crypto engine connections active</span></span><br><span class="line">Crypto Engine Connections</span><br><span class="line">   ID  Type    Algorithm           Encrypt  Decrypt LastSeqN IP-Address</span><br><span class="line">    <span class="number">1</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">0</span>        <span class="number">4</span>        <span class="number">4</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line">    <span class="number">2</span>  IPsec   <span class="number">3</span>DES+MD5                  <span class="number">4</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"> <span class="number">1001</span>  IKE     MD5+<span class="number">3</span>DES                  <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span> <span class="number">202.200</span><span class="number">.200</span><span class="number">.1</span></span><br><span class="line"><span class="comment">#测试高可用</span></span><br><span class="line"><span class="comment">##执行长Ping测试</span></span><br><span class="line">Out-Site1<span class="comment">#ping 2.2.2.2 source lo0 repeat 999999</span></span><br><span class="line"><span class="comment">##将Switch-e0/2口shutdown，查看切换效果</span></span><br><span class="line">Out-Site1<span class="comment">#ping 2.2.2.2 source lo0 repeat 999999</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">999999</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">Packet sent <span class="keyword">with</span> a source address of <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!.......!!!!!!!!!!!</span><br><span class="line"><span class="comment">##将交换机接口恢复，查看切换抢占后恢复时间</span></span><br><span class="line">!!!!!!!!!.......!!!!!!!!!!!</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>高可用性</tag>
        <tag>VPN</tag>
        <tag>DPD</tag>
        <tag>HSRP</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco VPN ：DMVPN</title>
    <url>/2020/07/14/2020-07-Cisco-VPN-DMVPN.html</url>
    <content><![CDATA[<h1 id="DMVPN：动态多点虚拟VPN"><a href="#DMVPN：动态多点虚拟VPN" class="headerlink" title="DMVPN：动态多点虚拟VPN"></a>DMVPN：动态多点虚拟VPN</h1><ul>
<li><p>由以下协议组成DMVPN整体架构</p>
<ul>
<li><p>动态多点GRE（mGRE）</p>
<ul>
<li>基于协议号47</li>
<li>用于实现DMVPN虚拟网状全互联特性</li>
<li>所有站点mGRE隧道接口均处于同一个网段</li>
<li>可实现任何站点间的直接通信</li>
</ul>
</li>
<li><p>下一跳解析协议（NHRP）</p>
<ul>
<li>二层协议，用于执行客户-服务器的流量解析</li>
<li>在以太网进行数据包传输，发送者必须知道以下信息<ul>
<li>目的逻辑地址IP</li>
<li>目的物理地址Mac</li>
<li>实现以上地址映射协议为ARP协议</li>
</ul>
</li>
<li>在mGRE网络进行数据包传输，发送者必须知道以下信息<ul>
<li>目的逻辑地址（mGRE隧道虚拟地址）</li>
<li>目的物理地址（站点公网地址）</li>
<li>实现以上地址映射协议为NHRP协议</li>
</ul>
</li>
</ul>
</li>
<li><p>动态路由协议</p>
</li>
<li><p>IPSec协议</p>
<p><img src="../../../images/Cisco-VPN-DMVPN/dmvpn.png" alt="img"></p>
</li>
</ul>
</li>
</ul>
<h1 id="DMVPN三大发展历程"><a href="#DMVPN三大发展历程" class="headerlink" title="DMVPN三大发展历程"></a>DMVPN三大发展历程</h1><h2 id="第一阶段：星型拓扑设计"><a href="#第一阶段：星型拓扑设计" class="headerlink" title="第一阶段：星型拓扑设计"></a>第一阶段：星型拓扑设计</h2><ul>
<li>优点：<ul>
<li>新增分支站点无需添加新配置</li>
<li>支持分支站点动态IP地址</li>
</ul>
</li>
<li>缺点：<ul>
<li>分支站点流量依然经过中心站点</li>
</ul>
</li>
<li>只做理论知识，不再使用</li>
</ul>
<img src="../../../images/Cisco-VPN-DMVPN/DMVPN-1.png" alt="img" style="zoom:50%;" />

<h2 id="第二阶段：虚拟网状拓扑设计"><a href="#第二阶段：虚拟网状拓扑设计" class="headerlink" title="第二阶段：虚拟网状拓扑设计"></a>第二阶段：虚拟网状拓扑设计</h2><ul>
<li>IOS_12.3或更高支持</li>
<li>该阶段真正实现了DMVPN的高扩展性</li>
<li>不支持路由汇总</li>
<li>考试考点之一<img src="../../../images/Cisco-VPN-DMVPN/dmvpn-2.png" alt="img" style="zoom:50%;" /></li>
</ul>
<h2 id="第三阶段：树状设计与优化"><a href="#第三阶段：树状设计与优化" class="headerlink" title="第三阶段：树状设计与优化"></a>第三阶段：树状设计与优化</h2><ul>
<li>IOS_12.4或更高支持</li>
<li>分支站点无需通过次总站点即可按需建立隧道</li>
<li>第三阶段在第二阶段基础上实现优化</li>
<li>支持路由汇总</li>
<li>不具备向下兼容特性</li>
<li>考试考点之一，实际生产环境推荐部署方式</li>
</ul>
<img src="../../../images/Cisco-VPN-DMVPN/dmvpn-3.png" alt="img" style="zoom:50%;" />

<h1 id="实验部分"><a href="#实验部分" class="headerlink" title="实验部分"></a>实验部分</h1><h2 id="DMVPN第二阶段实验：单Hub单DMVPN（SHSD）"><a href="#DMVPN第二阶段实验：单Hub单DMVPN（SHSD）" class="headerlink" title="DMVPN第二阶段实验：单Hub单DMVPN（SHSD）"></a>DMVPN第二阶段实验：单Hub单DMVPN（SHSD）</h2><h3 id="拓扑图"><a href="#拓扑图" class="headerlink" title="拓扑图"></a>拓扑图<img src="../../../images/Cisco-VPN-DMVPN/dmvpn-lab1.png" alt="img" style="zoom:75%;" /></h3><h3 id="实验需求"><a href="#实验需求" class="headerlink" title="实验需求"></a>实验需求</h3><ul>
<li>通过部署DMVPN来实现流量安全传输</li>
<li>预配置：<ul>
<li>激活设备接口与配置IP地址</li>
<li>中心站点和分支站点默认路由指向防火墙</li>
<li>防火墙放行ICMP</li>
</ul>
</li>
</ul>
<h3 id="预配置："><a href="#预配置：" class="headerlink" title="预配置："></a>预配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Hub1</span></span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.100</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.1</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line"><span class="comment">#ASAv</span></span><br><span class="line">interface GigabitEthernet0/<span class="number">0</span></span><br><span class="line"> nameif Inside</span><br><span class="line"> security-level <span class="number">100</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line">interface GigabitEthernet0/<span class="number">1</span></span><br><span class="line"> nameif Outside</span><br><span class="line"> security-level <span class="number">0</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.3</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line"><span class="comment">#Spoke1</span></span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.10</span></span><br><span class="line"><span class="comment">#Spoke2</span></span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.3</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.10</span></span><br><span class="line"><span class="comment">#ASAv放行ICMP</span></span><br><span class="line">access-list out-icmp extended permit icmp any any </span><br><span class="line">access-gr</span><br></pre></td></tr></table></figure>

<h3 id="测试底层连通性："><a href="#测试底层连通性：" class="headerlink" title="测试底层连通性："></a>测试底层连通性：</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Hub1#ping <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">1</span>/<span class="number">2</span>/<span class="number">4</span> ms</span><br><span class="line">Hub1#ping <span class="number">7.7</span><span class="number">.3</span><span class="number">.2</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">7.7</span><span class="number">.3</span><span class="number">.2</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">2</span>/<span class="number">2</span>/<span class="number">3</span> ms</span><br></pre></td></tr></table></figure>

<h3 id="配置第二阶段DMVPN："><a href="#配置第二阶段DMVPN：" class="headerlink" title="配置第二阶段DMVPN："></a>配置第二阶段DMVPN：</h3><h4 id="配置mGRE："><a href="#配置mGRE：" class="headerlink" title="配置mGRE："></a>配置mGRE：</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">interface Tunnel10</span><br><span class="line"><span class="built_in"> ip address </span>172.16.1.100 255.255.255.0</span><br><span class="line"> tunnel source Ethernet0/0</span><br><span class="line"><span class="comment">#多点GRE模式</span></span><br><span class="line"> tunnel mode gre multipoint</span><br><span class="line"><span class="comment">#建议配置，老版本不配置Tunnel不会UP，与加密无关，用于标识隧道</span></span><br><span class="line"> tunnel key 12345</span><br></pre></td></tr></table></figure>

<h4 id="配置NHRP："><a href="#配置NHRP：" class="headerlink" title="配置NHRP："></a>配置NHRP：</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#启用nhrp认证</span></span><br><span class="line">ip nhrp authentication cisco    </span><br><span class="line"><span class="comment">#动态接收组播映射</span></span><br><span class="line">ip nhrp map multicast dynamic</span><br><span class="line"><span class="comment">#在单DMVPN拓扑中，所以设备需要配置相同ID</span></span><br><span class="line">ip nhrp network-id 10</span><br></pre></td></tr></table></figure>

<h3 id="ASAv放行mGRE流量："><a href="#ASAv放行mGRE流量：" class="headerlink" title="ASAv放行mGRE流量："></a>ASAv放行mGRE流量：</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">access-list <span class="keyword">out</span>-icmp extended permit gre <span class="number">7.7</span><span class="number">.3</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h3 id="分支站点配置mGRE与NHRP："><a href="#分支站点配置mGRE与NHRP：" class="headerlink" title="分支站点配置mGRE与NHRP："></a>分支站点配置mGRE与NHRP：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Spoke1</span></span><br><span class="line">interface Tunnel10</span><br><span class="line"><span class="built_in"> ip address </span>172.16.1.1 255.255.255.0</span><br><span class="line"> <span class="literal">no</span><span class="built_in"> ip </span>redirects</span><br><span class="line"><span class="built_in"> ip </span>nhrp authentication cisco</span><br><span class="line"><span class="comment">##手动映射组播到Hub公网地址，便于后续Spoke和Hub之间建立动态路由协议邻居</span></span><br><span class="line"><span class="built_in"> ip </span>nhrp map multicast 7.7.1.100</span><br><span class="line"><span class="comment">##静态映射服务器虚拟地址和真实物理地址</span></span><br><span class="line"><span class="built_in"> ip </span>nhrp map 172.16.1.100 7.7.1.100</span><br><span class="line"><span class="built_in"> ip </span>nhrp network-id 12345</span><br><span class="line"><span class="comment">##指定NHRP服务器，注意是隧道地址</span></span><br><span class="line"><span class="built_in"> ip </span>nhrp nhs 172.16.1.100</span><br><span class="line"> tunnel source Ethernet0/0</span><br><span class="line"> tunnel mode gre multipoint</span><br><span class="line"> tunnel key 12345</span><br><span class="line"><span class="comment">#Spoke2</span></span><br><span class="line">interface Tunnel10</span><br><span class="line"><span class="built_in"> ip address </span>172.16.1.2 255.255.255.0</span><br><span class="line"> <span class="literal">no</span><span class="built_in"> ip </span>redirects</span><br><span class="line"><span class="built_in"> ip </span>nhrp authentication cisco</span><br><span class="line"><span class="comment">##手动映射组播到Hub公网地址，便于后续Spoke和Hub之间建立动态路由协议邻居</span></span><br><span class="line"><span class="built_in"> ip </span>nhrp map multicast 7.7.1.100</span><br><span class="line"><span class="comment">##静态映射服务器虚拟地址和真实物理地址</span></span><br><span class="line"><span class="built_in"> ip </span>nhrp map 172.16.1.100 7.7.1.100</span><br><span class="line"><span class="built_in"> ip </span>nhrp network-id 12345</span><br><span class="line"><span class="comment">##指定NHRP服务器，注意是隧道地址</span></span><br><span class="line"><span class="built_in"> ip </span>nhrp nhs 172.16.1.100</span><br><span class="line"> tunnel source Ethernet0/0</span><br><span class="line"> tunnel mode gre multipoint</span><br><span class="line"> tunnel key 12345</span><br></pre></td></tr></table></figure>

<h3 id="中心站点检查注册信息："><a href="#中心站点检查注册信息：" class="headerlink" title="中心站点检查注册信息："></a>中心站点检查注册信息：</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Hub1#sh ip nhrp</span><br><span class="line"><span class="number">172.16</span><span class="number">.1</span><span class="number">.1</span>/<span class="number">32</span> via <span class="number">172.16</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">   Tunnel10 created <span class="number">00</span>:<span class="number">02</span>:<span class="number">50</span>, expire <span class="number">01</span>:<span class="number">57</span>:<span class="number">09</span></span><br><span class="line">   Type: dynamic, Flags: unique registered used nhop </span><br><span class="line">   NBMA address: <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> </span><br><span class="line"><span class="number">172.16</span><span class="number">.1</span><span class="number">.2</span>/<span class="number">32</span> via <span class="number">172.16</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">   Tunnel10 created <span class="number">00</span>:<span class="number">00</span>:<span class="number">56</span>, expire <span class="number">01</span>:<span class="number">59</span>:<span class="number">03</span></span><br><span class="line">   Type: dynamic, Flags: unique registered used nhop </span><br><span class="line">   NBMA address: <span class="number">7.7</span><span class="number">.3</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>

<h3 id="部署动态路由协议："><a href="#部署动态路由协议：" class="headerlink" title="部署动态路由协议："></a>部署动态路由协议：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Hub1</span></span><br><span class="line">router eigrp 100</span><br><span class="line"><span class="built_in"> network </span>172.16.1.0 0.0.0.255</span><br><span class="line"><span class="built_in"> network </span>192.168.100.0</span><br><span class="line"><span class="comment">#Spoke1</span></span><br><span class="line">router eigrp 100</span><br><span class="line"><span class="built_in"> network </span>172.16.1.0 0.0.0.255</span><br><span class="line"><span class="built_in"> network </span>192.168.1.0</span><br><span class="line"><span class="comment">#Spoke2</span></span><br><span class="line">router eigrp 100</span><br><span class="line"><span class="built_in"> network </span>172.16.1.0 0.0.0.255</span><br><span class="line"><span class="built_in"> network </span>192.168.2.0</span><br></pre></td></tr></table></figure>

<h3 id="查看路由邻居关系："><a href="#查看路由邻居关系：" class="headerlink" title="查看路由邻居关系："></a>查看路由邻居关系：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看路由邻居关系</span></span><br><span class="line">Hub1#show<span class="built_in"> ip </span>eigrp neighbors </span><br><span class="line">EIGRP-IPv4 Neighbors <span class="keyword">for</span> AS(100)</span><br><span class="line">H  <span class="built_in"> Address </span>               <span class="built_in"> Interface </span>             Hold Uptime   SRTT   RTO  Q  Seq</span><br><span class="line">                                                   (sec)         (ms)       Cnt Num</span><br><span class="line">1   172.16.1.2              Tu10                     13 00:01:24    5  1428  0  3</span><br><span class="line">0   172.16.1.1              Tu10                     10 00:01:42    6  1428  0  3</span><br><span class="line">Spoke1#show<span class="built_in"> ip </span>eigrp neighbors </span><br><span class="line">EIGRP-IPv4 Neighbors <span class="keyword">for</span> AS(100)</span><br><span class="line">H  <span class="built_in"> Address </span>               <span class="built_in"> Interface </span>             Hold Uptime   SRTT   RTO  Q  Seq</span><br><span class="line">                                                   (sec)         (ms)       Cnt Num</span><br><span class="line">0   172.16.1.100            Tu10                     12 00:01:59   17  1470  0  6</span><br><span class="line"><span class="comment">#查看路由</span></span><br><span class="line">Hub1#show<span class="built_in"> ip route </span>eigrp </span><br><span class="line">Gateway of last resort is 7.7.1.10 <span class="keyword">to</span><span class="built_in"> network </span>0.0.0.0</span><br><span class="line">D     192.168.1.0/24 [90/26905600] via 172.16.1.1, 00:03:19, Tunnel10</span><br><span class="line">D     192.168.2.0/24 [90/26905600] via 172.16.1.2, 00:03:01, Tunnel10</span><br><span class="line">Spoke1#show<span class="built_in"> ip route </span>eigrp </span><br><span class="line">Gateway of last resort is 7.7.3.10 <span class="keyword">to</span><span class="built_in"> network </span>0.0.0.0</span><br><span class="line">D     192.168.100.0/24 [90/26905600] via 172.16.1.100, 00:03:15, Tunnel10</span><br><span class="line"><span class="comment">#解决分支站点没有路由问题</span></span><br><span class="line">Hub1(config)#int tunnel 10</span><br><span class="line">Hub1(config-if)#<span class="literal">no</span><span class="built_in"> ip </span>split-horizon eigrp 100</span><br><span class="line"><span class="comment">#再次查看路由</span></span><br><span class="line">Spoke1#show<span class="built_in"> ip route </span>eigrp </span><br><span class="line">Gateway of last resort is 7.7.3.10 <span class="keyword">to</span><span class="built_in"> network </span>0.0.0.0</span><br><span class="line">D     192.168.2.0/24 [90/28185600] via 172.16.1.100, 00:00:23, Tunnel10</span><br><span class="line">D     192.168.100.0/24 [90/26905600] via 172.16.1.100, 00:05:23, Tunnel10</span><br><span class="line"><span class="comment">#解决下一跳问题</span></span><br><span class="line">Hub1(config)#int tunnel 10</span><br><span class="line">Hub1(config-if)#<span class="literal">no</span><span class="built_in"> ip </span>next-hop-self eigrp 100</span><br><span class="line">Spoke1#show<span class="built_in"> ip route </span>eigrp </span><br><span class="line">Gateway of last resort is 7.7.3.10 <span class="keyword">to</span><span class="built_in"> network </span>0.0.0.0</span><br><span class="line">D     192.168.2.0/24 [90/28185600] via 172.16.1.2, 00:00:23, Tunnel10</span><br><span class="line">D     192.168.100.0/24 [90/26905600] via 172.16.1.100, 00:05:23, Tunnel10</span><br></pre></td></tr></table></figure>

<h3 id="ASAv放行IPSec流量，去掉GRE流量的放行："><a href="#ASAv放行IPSec流量，去掉GRE流量的放行：" class="headerlink" title="ASAv放行IPSec流量，去掉GRE流量的放行："></a>ASAv放行IPSec流量，去掉GRE流量的放行：</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">access-list <span class="keyword">out</span>-icmp extended permit udp <span class="number">7.7</span><span class="number">.3</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> eq isakmp </span><br><span class="line">access-list <span class="keyword">out</span>-icmp extended permit esp <span class="number">7.7</span><span class="number">.3</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line">no access-list <span class="keyword">out</span>-icmp extended permit gre <span class="number">7.7</span><span class="number">.3</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h3 id="中心站点配置IPSec-VPN："><a href="#中心站点配置IPSec-VPN：" class="headerlink" title="中心站点配置IPSec VPN："></a>中心站点配置IPSec VPN：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">crypto isakmp<span class="built_in"> policy </span>10</span><br><span class="line"> encr 3des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"><span class="built_in"> group </span>2</span><br><span class="line"><span class="comment">#使用动态Map，因为支持分支站点为动态地址</span></span><br><span class="line">crypto isakmp key cisco<span class="built_in"> address </span>0.0.0.0        </span><br><span class="line">crypto<span class="built_in"> ipsec </span>transform-<span class="builtin-name">set</span> DMVPN esp-3des esp-md5-hmac </span><br><span class="line"><span class="comment">#使用传输模式</span></span><br><span class="line"> mode transport</span><br><span class="line">crypto<span class="built_in"> ipsec profile </span>vpn</span><br><span class="line"> <span class="builtin-name">set</span> transform-<span class="builtin-name">set</span> DMVPN </span><br><span class="line">interface tunnel 10</span><br><span class="line"><span class="comment">#调整mtu防止分片</span></span><br><span class="line"> <span class="built_in"> ip </span>mtu 1400</span><br><span class="line">  tunnel protection<span class="built_in"> ipsec profile </span>vpn</span><br></pre></td></tr></table></figure>

<h3 id="分支站点配置IPSec-VPN："><a href="#分支站点配置IPSec-VPN：" class="headerlink" title="分支站点配置IPSec VPN："></a>分支站点配置IPSec VPN：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Spoke1&amp;Spoke2</span></span><br><span class="line">crypto isakmp<span class="built_in"> policy </span>10</span><br><span class="line"> encr 3des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"><span class="built_in"> group </span>2</span><br><span class="line">crypto isakmp key cisco<span class="built_in"> address </span>7.7.1.100      </span><br><span class="line">crypto<span class="built_in"> ipsec </span>transform-<span class="builtin-name">set</span> DMVPN esp-3des esp-md5-hmac </span><br><span class="line"><span class="comment">#使用传输模式</span></span><br><span class="line"> mode transport</span><br><span class="line">crypto<span class="built_in"> ipsec profile </span>vpn</span><br><span class="line"> <span class="builtin-name">set</span> transform-<span class="builtin-name">set</span> DMVPN </span><br><span class="line">interface tunnel 10</span><br><span class="line"><span class="comment">#调整mtu防止分片</span></span><br><span class="line"> <span class="built_in"> ip </span>mtu 1400</span><br><span class="line">  tunnel protection<span class="built_in"> ipsec profile </span>vpn</span><br></pre></td></tr></table></figure>

<h3 id="测试连通性："><a href="#测试连通性：" class="headerlink" title="测试连通性："></a>测试连通性：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">PC3&gt;<span class="built_in"> ping </span>192.168.100.101</span><br><span class="line"></span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.100.101 <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=7.406 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.100.101 <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=2.426 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.100.101 <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=1.941 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.100.101 <span class="attribute">icmp_seq</span>=4 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=2.599 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.100.101 <span class="attribute">icmp_seq</span>=5 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=2.156 ms</span><br><span class="line"></span><br><span class="line">PC3&gt;<span class="built_in"> ping </span>192.168.2.3    </span><br><span class="line"></span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=61 <span class="attribute">time</span>=4.664 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=61 <span class="attribute">time</span>=4.768 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=61 <span class="attribute">time</span>=3.269 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=4 <span class="attribute">ttl</span>=61 <span class="attribute">time</span>=6.053 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=5 <span class="attribute">ttl</span>=61 <span class="attribute">time</span>=4.919 ms</span><br></pre></td></tr></table></figure>

<h3 id="查看NHRP与IPSec之间的映射："><a href="#查看NHRP与IPSec之间的映射：" class="headerlink" title="查看NHRP与IPSec之间的映射："></a>查看NHRP与IPSec之间的映射：</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Spoke1#show crypto sockets </span><br><span class="line"></span><br><span class="line">Number of Crypto Socket connections <span class="number">2</span></span><br><span class="line"></span><br><span class="line">  Tu10 Peers (local/remote): <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span>/<span class="number">7.7</span><span class="number">.3</span><span class="number">.2</span> </span><br><span class="line">       Local Ident  (addr/mask/port/prot): (<span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span>/<span class="number">0</span>/<span class="number">47</span>)</span><br><span class="line">       Remote Ident (addr/mask/port/prot): (<span class="number">7.7</span><span class="number">.3</span><span class="number">.2</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span>/<span class="number">0</span>/<span class="number">47</span>)</span><br><span class="line">       IPSec Profile: <span class="string">"vpn"</span></span><br><span class="line">       Socket State: Closed</span><br><span class="line">       Client: <span class="string">"TUNNEL SEC"</span> (Client State: Active)</span><br><span class="line">  Tu10 Peers (local/remote): <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span>/<span class="number">7.7</span><span class="number">.1</span><span class="number">.100</span> </span><br><span class="line">       Local Ident  (addr/mask/port/prot): (<span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span>/<span class="number">0</span>/<span class="number">47</span>)</span><br><span class="line">       Remote Ident (addr/mask/port/prot): (<span class="number">7.7</span><span class="number">.1</span><span class="number">.100</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span>/<span class="number">0</span>/<span class="number">47</span>)</span><br><span class="line">       IPSec Profile: <span class="string">"vpn"</span></span><br><span class="line">       Socket State: Open</span><br><span class="line">       Client: <span class="string">"TUNNEL SEC"</span> (Client State: Active)</span><br><span class="line">Crypto Sockets <span class="keyword">in</span> Listen state:</span><br><span class="line">Client: <span class="string">"TUNNEL SEC"</span> Profile: <span class="string">"vpn"</span> Map-name: <span class="string">"Tunnel10-head-0"</span></span><br></pre></td></tr></table></figure>

<h2 id="DMVPN第二阶段实验：双Hub单DMVPN（DHSD）"><a href="#DMVPN第二阶段实验：双Hub单DMVPN（DHSD）" class="headerlink" title="DMVPN第二阶段实验：双Hub单DMVPN（DHSD）"></a>DMVPN第二阶段实验：双Hub单DMVPN（DHSD）</h2><h3 id="实验需求与预配置："><a href="#实验需求与预配置：" class="headerlink" title="实验需求与预配置："></a>实验需求与预配置：</h3><ul>
<li>需求：通过部署DMVPN来实现流量安全传输</li>
<li><strong>基于上一个实验延续进行</strong><img src="../../../images/Cisco-VPN-DMVPN/dmvpn-lab2.png" alt="img" style="zoom:75%;" /></li>
</ul>
<h3 id="预配置：-1"><a href="#预配置：-1" class="headerlink" title="预配置："></a>预配置：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Hub2</span></span><br><span class="line">interface Ethernet0/0</span><br><span class="line"><span class="built_in"> ip address </span>7.7.1.200 255.255.255.0</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"><span class="built_in"> ip address </span>192.168.200.200 255.255.255.0</span><br><span class="line">ip<span class="built_in"> route </span>0.0.0.0 0.0.0.0 7.7.1.10</span><br></pre></td></tr></table></figure>

<h3 id="ASAv基于对象分组放行DMVPN流量："><a href="#ASAv基于对象分组放行DMVPN流量：" class="headerlink" title="ASAv基于对象分组放行DMVPN流量："></a>ASAv基于对象分组放行DMVPN流量：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">clear<span class="built_in"> config </span>access-list</span><br><span class="line">object-group<span class="built_in"> network </span>Outside-DMVPN-Device</span><br><span class="line"> network-object host 7.7.3.1</span><br><span class="line"> network-object host 7.7.3.2</span><br><span class="line">object-group<span class="built_in"> network </span>Inside-DMVPN-Device</span><br><span class="line"> network-object host 7.7.1.100</span><br><span class="line"> network-object host 7.7.1.200</span><br><span class="line">object-group<span class="built_in"> service </span>mGRE-Over-IPSec</span><br><span class="line"> service-object udp destination eq isakmp </span><br><span class="line"> service-object esp </span><br><span class="line">access-list out extended permit object-group mGRE-Over-IPSec object-group Outside-DMVPN-Device object-group Inside-DMVPN-Device </span><br><span class="line">access-group out <span class="keyword">in</span><span class="built_in"> interface </span>Outside</span><br></pre></td></tr></table></figure>

<h3 id="中心站点二配置mGRE、NHRP、EIGRP、IPSec："><a href="#中心站点二配置mGRE、NHRP、EIGRP、IPSec：" class="headerlink" title="中心站点二配置mGRE、NHRP、EIGRP、IPSec："></a>中心站点二配置mGRE、NHRP、EIGRP、IPSec：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置IPSec</span></span><br><span class="line">crypto isakmp<span class="built_in"> policy </span>10</span><br><span class="line"> encr 3des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"><span class="built_in"> group </span>2</span><br><span class="line">crypto isakmp key cisco<span class="built_in"> address </span>0.0.0.0        </span><br><span class="line">crypto<span class="built_in"> ipsec </span>transform-<span class="builtin-name">set</span> DMVPN esp-3des esp-md5-hmac </span><br><span class="line"> mode transport</span><br><span class="line">crypto<span class="built_in"> ipsec profile </span>vpn</span><br><span class="line"> <span class="builtin-name">set</span> transform-<span class="builtin-name">set</span> DMVPN </span><br><span class="line"><span class="comment">#配置mGRE和NHRP</span></span><br><span class="line">interface Tunnel10</span><br><span class="line"><span class="built_in"> ip address </span>172.16.1.200 255.255.255.0</span><br><span class="line"> <span class="literal">no</span><span class="built_in"> ip </span>redirects</span><br><span class="line"><span class="built_in"> ip </span>mtu 1400</span><br><span class="line"> <span class="literal">no</span><span class="built_in"> ip </span>next-hop-self eigrp 100</span><br><span class="line"> <span class="literal">no</span><span class="built_in"> ip </span>split-horizon eigrp 100</span><br><span class="line"><span class="built_in"> ip </span>nhrp authentication cisco</span><br><span class="line"><span class="built_in"> ip </span>nhrp map multicast dynamic</span><br><span class="line"><span class="built_in"> ip </span>nhrp network-id 10</span><br><span class="line"> tunnel source Ethernet0/0</span><br><span class="line"> tunnel mode gre multipoint</span><br><span class="line"> tunnel key 12345</span><br><span class="line"> tunnel protection<span class="built_in"> ipsec profile </span>vpn</span><br><span class="line"><span class="comment">#配置EIGRP</span></span><br><span class="line">router eigrp 100</span><br><span class="line"><span class="built_in"> network </span>172.16.1.0 0.0.0.255</span><br><span class="line"><span class="built_in"> network </span>192.168.200.0</span><br></pre></td></tr></table></figure>

<h3 id="两个站点间互相映射，同时添加协商对等体："><a href="#两个站点间互相映射，同时添加协商对等体：" class="headerlink" title="两个站点间互相映射，同时添加协商对等体："></a>两个站点间互相映射，同时添加协商对等体：</h3><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">Hub1</span><span class="params">(config)</span></span><span class="selector-id">#int</span> tunnel <span class="number">10</span></span><br><span class="line"><span class="function"><span class="title">Hub1</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> nhrp map <span class="number">172.16</span>.<span class="number">1.200</span> <span class="number">7.7</span>.<span class="number">1.200</span></span><br><span class="line"><span class="function"><span class="title">Hub1</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> nhrp map multicast <span class="number">7.7</span>.<span class="number">1.200</span></span><br><span class="line"><span class="function"><span class="title">Hub1</span><span class="params">(config)</span></span><span class="selector-id">#crypto</span> isakmp key cisco <span class="selector-tag">address</span> <span class="number">7.7</span>.<span class="number">1.200</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">Hub2</span><span class="params">(config)</span></span><span class="selector-id">#int</span> tunnel <span class="number">10</span></span><br><span class="line"><span class="function"><span class="title">Hub2</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> nhrp map <span class="number">172.16</span>.<span class="number">1.100</span>  <span class="number">7.7</span>.<span class="number">1.100</span></span><br><span class="line"><span class="function"><span class="title">Hub2</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> nhrp map multicast <span class="number">7.7</span>.<span class="number">1.100</span>                </span><br><span class="line"><span class="function"><span class="title">Hub2</span><span class="params">(config-if)</span></span><span class="selector-id">#crypto</span> isakmp key cisco <span class="selector-tag">address</span> <span class="number">7.7</span>.<span class="number">1.100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">Spoke1</span><span class="params">(config)</span></span><span class="selector-id">#crypto</span> isakmp key cisco <span class="selector-tag">address</span> <span class="number">7.7</span>.<span class="number">1.200</span></span><br><span class="line"><span class="function"><span class="title">Spoke1</span><span class="params">(config)</span></span><span class="selector-id">#interface</span> tunnel <span class="number">10</span></span><br><span class="line"><span class="function"><span class="title">Spoke1</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> nhrp nhs <span class="number">172.16</span>.<span class="number">1.200</span></span><br><span class="line"><span class="function"><span class="title">Spoke1</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> nhrp map <span class="number">172.16</span>.<span class="number">1.200</span> <span class="number">7.7</span>.<span class="number">1.200</span></span><br><span class="line"><span class="function"><span class="title">Spoke1</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> nhrp map multicast <span class="number">7.7</span>.<span class="number">1.200</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">Spoke2</span><span class="params">(config)</span></span><span class="selector-id">#crypto</span> isakmp key cisco <span class="selector-tag">address</span> <span class="number">7.7</span>.<span class="number">1.200</span></span><br><span class="line"><span class="function"><span class="title">Spoke2</span><span class="params">(config)</span></span><span class="selector-id">#interface</span> tunnel <span class="number">10</span></span><br><span class="line"><span class="function"><span class="title">Spoke2</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> nhrp nhs <span class="number">172.16</span>.<span class="number">1.200</span></span><br><span class="line"><span class="function"><span class="title">Spoke2</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> nhrp map <span class="number">172.16</span>.<span class="number">1.200</span> <span class="number">7.7</span>.<span class="number">1.200</span></span><br><span class="line"><span class="function"><span class="title">Spoke2</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> nhrp map multicast <span class="number">7.7</span>.<span class="number">1.200</span></span><br></pre></td></tr></table></figure>

<h3 id="中心站点二查看路由："><a href="#中心站点二查看路由：" class="headerlink" title="中心站点二查看路由："></a>中心站点二查看路由：</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Hub2#sh ip route eigrp </span><br><span class="line">Gateway of last resort <span class="keyword">is</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> to network <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">  </span><br><span class="line">D     <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> [<span class="number">90</span>/<span class="number">26905600</span>] via <span class="number">172.16</span><span class="number">.1</span><span class="number">.1</span>, <span class="number">00</span>:<span class="number">01</span>:<span class="number">36</span>, Tunnel10</span><br><span class="line">D     <span class="number">192.168</span><span class="number">.2</span><span class="number">.0</span>/<span class="number">24</span> [<span class="number">90</span>/<span class="number">26905600</span>] via <span class="number">172.16</span><span class="number">.1</span><span class="number">.2</span>, <span class="number">00</span>:<span class="number">00</span>:<span class="number">34</span>, Tunnel10</span><br><span class="line">D     <span class="number">192.168</span><span class="number">.100</span><span class="number">.0</span>/<span class="number">24</span> [<span class="number">90</span>/<span class="number">26905600</span>] via <span class="number">172.16</span><span class="number">.1</span><span class="number">.100</span>, <span class="number">00</span>:<span class="number">07</span>:<span class="number">13</span>, Tunnel10</span><br></pre></td></tr></table></figure>

<h3 id="测试连通性：-1"><a href="#测试连通性：-1" class="headerlink" title="测试连通性："></a>测试连通性：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">PC2&gt;<span class="built_in"> ping </span>192.168.2.3</span><br><span class="line"></span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=4.201 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=2.402 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=7.810 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=4 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=6.685 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=5 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=2.973 ms</span><br><span class="line"></span><br><span class="line">PC2&gt;<span class="built_in"> ping </span>192.168.1.2    </span><br><span class="line"></span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.1.2 <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=5.316 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.1.2 <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=3.872 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.1.2 <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=3.590 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.1.2 <span class="attribute">icmp_seq</span>=4 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=2.926 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.1.2 <span class="attribute">icmp_seq</span>=5 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=2.884 ms</span><br></pre></td></tr></table></figure>

<h3 id="分支站点查看注册的NHRP信息："><a href="#分支站点查看注册的NHRP信息：" class="headerlink" title="分支站点查看注册的NHRP信息："></a>分支站点查看注册的NHRP信息：</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Spoke1#sh ip nhrp</span><br><span class="line"><span class="number">172.16</span><span class="number">.1</span><span class="number">.100</span>/<span class="number">32</span> via <span class="number">172.16</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line">   Tunnel10 created <span class="number">00</span>:<span class="number">58</span>:<span class="number">07</span>, never expire </span><br><span class="line">   Type: static, Flags: used </span><br><span class="line">   NBMA address: <span class="number">7.7</span><span class="number">.1</span><span class="number">.100</span> </span><br><span class="line"><span class="number">172.16</span><span class="number">.1</span><span class="number">.200</span>/<span class="number">32</span> via <span class="number">172.16</span><span class="number">.1</span><span class="number">.200</span></span><br><span class="line">   Tunnel10 created <span class="number">00</span>:<span class="number">01</span>:<span class="number">29</span>, never expire </span><br><span class="line">   Type: static, Flags: used </span><br><span class="line">   NBMA address: <span class="number">7.7</span><span class="number">.1</span><span class="number">.200</span></span><br></pre></td></tr></table></figure>

<h2 id="DMVPN第三阶段实验：双Hub单DMVPN（DHSD）"><a href="#DMVPN第三阶段实验：双Hub单DMVPN（DHSD）" class="headerlink" title="DMVPN第三阶段实验：双Hub单DMVPN（DHSD）"></a>DMVPN第三阶段实验：双Hub单DMVPN（DHSD）</h2><h3 id="需求与配置："><a href="#需求与配置：" class="headerlink" title="需求与配置："></a>需求与配置：</h3><ul>
<li>需求：通过部署DMVPN来实现流量安全传输</li>
<li>基于上一个实验延续进行<img src="../../../images/Cisco-VPN-DMVPN/dmvpn-lab2-20200716012855630.png" alt="img" style="zoom:75%;" /></li>
</ul>
<h3 id="中心站点配置执行更改："><a href="#中心站点配置执行更改：" class="headerlink" title="中心站点配置执行更改："></a>中心站点配置执行更改：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#隧道接口部署NHRP重定向</span></span><br><span class="line">ip nhrp redirect</span><br><span class="line"><span class="comment">#隧道接口部署路由汇总</span></span><br><span class="line">ip summary-address eigrp 100 192.168.0.0 255.255.0.0</span><br></pre></td></tr></table></figure>

<h3 id="分支站点配置执行更改："><a href="#分支站点配置执行更改：" class="headerlink" title="分支站点配置执行更改："></a>分支站点配置执行更改：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#隧道接口部署NHRP短路</span></span><br><span class="line">ip nhrp shortcut</span><br><span class="line"><span class="comment">#隧道接口配置NHRP重定向</span></span><br><span class="line">ip nhrp redirect</span><br></pre></td></tr></table></figure>

<h3 id="触发加解密："><a href="#触发加解密：" class="headerlink" title="触发加解密："></a>触发加解密：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">PC3&gt;<span class="built_in"> ping </span>192.168.2.3</span><br><span class="line"></span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=61 <span class="attribute">time</span>=6.812 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=61 <span class="attribute">time</span>=5.150 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=61 <span class="attribute">time</span>=5.592 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=4 <span class="attribute">ttl</span>=61 <span class="attribute">time</span>=2.776 ms</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.2.3 <span class="attribute">icmp_seq</span>=5 <span class="attribute">ttl</span>=61 <span class="attribute">time</span>=4.820 ms</span><br></pre></td></tr></table></figure>

<h3 id="查看IPSec会话："><a href="#查看IPSec会话：" class="headerlink" title="查看IPSec会话："></a>查看IPSec会话：</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">Spoke1#show</span> <span class="string">crypto</span> <span class="string">session</span> </span><br><span class="line"><span class="string">Crypto</span> <span class="string">session</span> <span class="string">current</span> <span class="string">status</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Interface:</span> <span class="string">Tunnel10</span></span><br><span class="line"><span class="attr">Session status:</span> <span class="string">UP-ACTIVE</span>         <span class="string">//虚拟机是DOWN，这是虚拟机的BUG</span></span><br><span class="line"><span class="attr">Peer:</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.2</span> <span class="string">port</span> <span class="number">500</span> </span><br><span class="line">  <span class="attr">IPSEC FLOW:</span> <span class="string">permit</span> <span class="number">47</span> <span class="string">host</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> <span class="string">host</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.2</span> </span><br><span class="line">        <span class="attr">Active SAs:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">origin:</span> <span class="string">crypto</span> <span class="string">map</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Interface:</span> <span class="string">Tunnel10</span></span><br><span class="line"><span class="attr">Session status:</span> <span class="string">UP-ACTIVE</span>     </span><br><span class="line"><span class="attr">Peer:</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.100</span> <span class="string">port</span> <span class="number">500</span> </span><br><span class="line">  <span class="attr">Session ID:</span> <span class="number">0</span>  </span><br><span class="line">  <span class="attr">IKEv1 SA:</span> <span class="string">local</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span><span class="string">/500</span> <span class="string">remote</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.100</span><span class="string">/500</span> <span class="string">Active</span> </span><br><span class="line">  <span class="attr">IPSEC FLOW:</span> <span class="string">permit</span> <span class="number">47</span> <span class="string">host</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> <span class="string">host</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.100</span> </span><br><span class="line">        <span class="attr">Active SAs:</span> <span class="number">2</span><span class="string">,</span> <span class="attr">origin:</span> <span class="string">crypto</span> <span class="string">map</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Interface:</span> <span class="string">Tunnel10</span></span><br><span class="line"><span class="attr">Session status:</span> <span class="string">UP-ACTIVE</span>     </span><br><span class="line"><span class="attr">Peer:</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.200</span> <span class="string">port</span> <span class="number">500</span> </span><br><span class="line">  <span class="attr">Session ID:</span> <span class="number">0</span>  </span><br><span class="line">  <span class="attr">IKEv1 SA:</span> <span class="string">local</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span><span class="string">/500</span> <span class="string">remote</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.200</span><span class="string">/500</span> <span class="string">Active</span> </span><br><span class="line">  <span class="attr">IPSEC FLOW:</span> <span class="string">permit</span> <span class="number">47</span> <span class="string">host</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.1</span> <span class="string">host</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.200</span> </span><br><span class="line">        <span class="attr">Active SAs:</span> <span class="number">2</span><span class="string">,</span> <span class="attr">origin:</span> <span class="string">crypto</span> <span class="string">map</span></span><br></pre></td></tr></table></figure>

<h2 id="DMVPN第三阶段实验：优化与部署双Hub双DMVPN（DHDD）"><a href="#DMVPN第三阶段实验：优化与部署双Hub双DMVPN（DHDD）" class="headerlink" title="DMVPN第三阶段实验：优化与部署双Hub双DMVPN（DHDD）"></a>DMVPN第三阶段实验：优化与部署双Hub双DMVPN（DHDD）</h2><h3 id="需求与预配置"><a href="#需求与预配置" class="headerlink" title="需求与预配置"></a>需求与预配置</h3><ul>
<li>需求：通过部署DMVPN来实现流量安全传输</li>
<li>基于上一个实验延续进行<img src="../../../images/Cisco-VPN-DMVPN/dmvpn-lab3-1024x858.png" alt="img" style="zoom:75%;" /></li>
</ul>
<h3 id="新增预配："><a href="#新增预配：" class="headerlink" title="新增预配："></a>新增预配：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Spoke3</span></span><br><span class="line">interface Ethernet0/0</span><br><span class="line"><span class="built_in"> ip address </span>7.7.1.3 255.255.255.0</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"><span class="built_in"> ip address </span>7.7.2.3 255.255.255.0</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"><span class="built_in"> ip address </span>192.168.3.3 255.255.255.0</span><br><span class="line">ip<span class="built_in"> route </span>0.0.0.0 0.0.0.0 7.7.1.10</span><br><span class="line"><span class="comment">#Spoke4</span></span><br><span class="line">interface Ethernet0/0</span><br><span class="line"><span class="built_in"> ip address </span>7.7.2.4 255.255.255.0</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"><span class="built_in"> ip address </span>192.168.4.4 255.255.255.0</span><br><span class="line">ip<span class="built_in"> route </span>0.0.0.0 0.0.0.0 7.7.2.3</span><br><span class="line"><span class="comment">#Spoke5</span></span><br><span class="line">interface Ethernet0/0</span><br><span class="line"><span class="built_in"> ip address </span>7.7.2.5 255.255.255.0</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"><span class="built_in"> ip address </span>192.168.5.5 255.255.255.0</span><br><span class="line">ip<span class="built_in"> route </span>0.0.0.0 0.0.0.0 7.7.2.3</span><br></pre></td></tr></table></figure>

<h3 id="Spoke3配置DMVPN-1区域："><a href="#Spoke3配置DMVPN-1区域：" class="headerlink" title="Spoke3配置DMVPN-1区域："></a>Spoke3配置DMVPN-1区域：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#IPSec</span></span><br><span class="line">crypto isakmp<span class="built_in"> policy </span>10</span><br><span class="line"> encr 3des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"><span class="built_in"> group </span>2</span><br><span class="line">crypto isakmp key cisco<span class="built_in"> address </span>0.0.0.0        </span><br><span class="line">crypto<span class="built_in"> ipsec </span>transform-<span class="builtin-name">set</span> DMVPN esp-3des esp-md5-hmac </span><br><span class="line"> mode transport</span><br><span class="line">crypto<span class="built_in"> ipsec profile </span>vpn</span><br><span class="line"> <span class="builtin-name">set</span> transform-<span class="builtin-name">set</span> DMVPN </span><br><span class="line"><span class="comment">#EIGRP</span></span><br><span class="line">router eigrp 100</span><br><span class="line"><span class="built_in"> network </span>172.16.1.0 0.0.0.255</span><br><span class="line"><span class="built_in"> network </span>192.168.3.0</span><br><span class="line"><span class="comment">#配置mGRE和NHRP</span></span><br><span class="line">interface Tunnel10</span><br><span class="line"><span class="built_in"> ip address </span>172.16.1.3 255.255.255.0</span><br><span class="line"><span class="built_in"> ip </span>mtu 1400</span><br><span class="line"><span class="built_in"> ip </span>nhrp authentication cisco</span><br><span class="line"><span class="built_in"> ip </span>nhrp map multicast 7.7.1.100</span><br><span class="line"><span class="built_in"> ip </span>nhrp map multicast 7.7.1.200</span><br><span class="line"><span class="built_in"> ip </span>nhrp map 172.16.1.100 7.7.1.100</span><br><span class="line"><span class="built_in"> ip </span>nhrp map 172.16.1.200 7.7.1.200</span><br><span class="line"><span class="built_in"> ip </span>nhrp network-id 10</span><br><span class="line"><span class="built_in"> ip </span>nhrp nhs 172.16.1.100</span><br><span class="line"><span class="built_in"> ip </span>nhrp nhs 172.16.1.200</span><br><span class="line"><span class="built_in"> ip </span>nhrp shortcut</span><br><span class="line"><span class="built_in"> ip </span>nhrp redirect</span><br><span class="line"> tunnel source Ethernet0/0</span><br><span class="line"> tunnel mode gre multipoint</span><br><span class="line"> tunnel key 12345</span><br><span class="line"> tunnel protection<span class="built_in"> ipsec profile </span>vpn</span><br><span class="line"><span class="comment">#ASAv放行流量</span></span><br><span class="line">object-group<span class="built_in"> network </span>Inside-DMVPN-Device</span><br><span class="line"> network-object host 7.7.1.3</span><br></pre></td></tr></table></figure>

<h3 id="中心站点查看注册信息："><a href="#中心站点查看注册信息：" class="headerlink" title="中心站点查看注册信息："></a>中心站点查看注册信息：</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Hub1#sh ip nhrp</span><br><span class="line"><span class="number">172.16</span><span class="number">.1</span><span class="number">.3</span>/<span class="number">32</span> via <span class="number">172.16</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">   Tunnel10 created <span class="number">00</span>:<span class="number">01</span>:<span class="number">34</span>, expire <span class="number">01</span>:<span class="number">58</span>:<span class="number">25</span></span><br><span class="line">   Type: dynamic, Flags: unique registered used nhop </span><br><span class="line">   NBMA address: <span class="number">7.7</span><span class="number">.1</span><span class="number">.3</span></span><br></pre></td></tr></table></figure>

<h3 id="配置DMVPN-2区域："><a href="#配置DMVPN-2区域：" class="headerlink" title="配置DMVPN-2区域："></a>配置DMVPN-2区域：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Spoke3配置作为次一级中心站点</span></span><br><span class="line"><span class="comment">##配置mGRE和NHRP</span></span><br><span class="line">interface Tunnel20</span><br><span class="line"><span class="built_in"> ip address </span>172.16.2.3 255.255.255.0</span><br><span class="line"><span class="built_in"> ip </span>mtu 1400</span><br><span class="line"> <span class="literal">no</span><span class="built_in"> ip </span>next-hop-self eigrp 100</span><br><span class="line"> <span class="literal">no</span><span class="built_in"> ip </span>split-horizon eigrp 100</span><br><span class="line"><span class="built_in"> ip </span>nhrp authentication cisco</span><br><span class="line"><span class="built_in"> ip </span>nhrp map multicast dynamic</span><br><span class="line"><span class="built_in"> ip </span>nhrp network-id 10</span><br><span class="line"><span class="built_in"> ip </span>nhrp redirect</span><br><span class="line"> tunnel source Ethernet0/1</span><br><span class="line"> tunnel mode gre multipoint</span><br><span class="line"> tunnel key 12345</span><br><span class="line"> tunnel protection<span class="built_in"> ipsec profile </span>vpn</span><br><span class="line"><span class="comment">##EIGRP</span></span><br><span class="line">router eigrp 100</span><br><span class="line"> <span class="built_in"> network </span>172.16.2.0 0.0.0.255</span><br><span class="line"><span class="comment">#Spoke4配置</span></span><br><span class="line"><span class="comment">##IPSec</span></span><br><span class="line">crypto isakmp<span class="built_in"> policy </span>10</span><br><span class="line"> encr 3des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"><span class="built_in"> group </span>2</span><br><span class="line">crypto isakmp key cisco<span class="built_in"> address </span>0.0.0.0        </span><br><span class="line">crypto<span class="built_in"> ipsec </span>transform-<span class="builtin-name">set</span> DMVPN esp-3des esp-md5-hmac </span><br><span class="line"> mode transport</span><br><span class="line">crypto<span class="built_in"> ipsec profile </span>vpn</span><br><span class="line"> <span class="builtin-name">set</span> transform-<span class="builtin-name">set</span> DMVPN </span><br><span class="line"><span class="comment">##配置mGRE和NHRP</span></span><br><span class="line">interface Tunnel20</span><br><span class="line"><span class="built_in"> ip address </span>172.16.2.4 255.255.255.0</span><br><span class="line"><span class="built_in"> ip </span>mtu 1400</span><br><span class="line"><span class="built_in"> ip </span>nhrp authentication cisco</span><br><span class="line"><span class="built_in"> ip </span>nhrp map 172.16.2.3 7.7.2.3</span><br><span class="line"><span class="built_in"> ip </span>nhrp map multicast 7.7.2.3</span><br><span class="line"><span class="built_in"> ip </span>nhrp network-id 10</span><br><span class="line"><span class="built_in"> ip </span>nhrp nhs 172.16.2.3</span><br><span class="line"><span class="built_in"> ip </span>nhrp shortcut</span><br><span class="line"><span class="built_in"> ip </span>nhrp redirect</span><br><span class="line"> tunnel source Ethernet0/0</span><br><span class="line"> tunnel mode gre multipoint</span><br><span class="line"> tunnel key 12345</span><br><span class="line"> tunnel protection<span class="built_in"> ipsec profile </span>vpn</span><br><span class="line"><span class="comment">##EIGRP</span></span><br><span class="line">router eigrp 100</span><br><span class="line"> <span class="built_in"> network </span>172.16.2.0 0.0.0.255</span><br><span class="line"> <span class="built_in"> network </span>192.168.4.0</span><br><span class="line"><span class="comment">#Spoke5配置</span></span><br><span class="line"><span class="comment">##IPSec</span></span><br><span class="line">crypto isakmp<span class="built_in"> policy </span>10</span><br><span class="line"> encr 3des</span><br><span class="line"> hash md5</span><br><span class="line"> authentication pre-share</span><br><span class="line"><span class="built_in"> group </span>2</span><br><span class="line">crypto isakmp key cisco<span class="built_in"> address </span>0.0.0.0        </span><br><span class="line">crypto<span class="built_in"> ipsec </span>transform-<span class="builtin-name">set</span> DMVPN esp-3des esp-md5-hmac </span><br><span class="line"> mode transport</span><br><span class="line">crypto<span class="built_in"> ipsec profile </span>vpn</span><br><span class="line"> <span class="builtin-name">set</span> transform-<span class="builtin-name">set</span> DMVPN </span><br><span class="line"><span class="comment">##配置mGRE和NHRP</span></span><br><span class="line">interface Tunnel20</span><br><span class="line"><span class="built_in"> ip address </span>172.16.2.5 255.255.255.0</span><br><span class="line"><span class="built_in"> ip </span>mtu 1400</span><br><span class="line"><span class="built_in"> ip </span>nhrp authentication cisco</span><br><span class="line"><span class="built_in"> ip </span>nhrp map 172.16.2.3 7.7.2.3</span><br><span class="line"><span class="built_in"> ip </span>nhrp map multicast 7.7.2.3</span><br><span class="line"><span class="built_in"> ip </span>nhrp network-id 10</span><br><span class="line"><span class="built_in"> ip </span>nhrp nhs 172.16.2.3</span><br><span class="line"><span class="built_in"> ip </span>nhrp shortcut</span><br><span class="line"><span class="built_in"> ip </span>nhrp redirect</span><br><span class="line"> tunnel source Ethernet0/0</span><br><span class="line"> tunnel mode gre multipoint</span><br><span class="line"> tunnel key 12345</span><br><span class="line"> tunnel protection<span class="built_in"> ipsec profile </span>vpn</span><br><span class="line"><span class="comment">##EIGRP</span></span><br><span class="line">router eigrp 100</span><br><span class="line"> <span class="built_in"> network </span>172.16.2.0 0.0.0.255</span><br><span class="line"> <span class="built_in"> network </span>192.168.5.0</span><br></pre></td></tr></table></figure>

<h3 id="ASAv放行流量："><a href="#ASAv放行流量：" class="headerlink" title="ASAv放行流量："></a>ASAv放行流量：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">object-group<span class="built_in"> network </span>Inside-DMVPN-Device</span><br><span class="line"> network-object host 7.7.2.3</span><br><span class="line"> network-object host 7.7.2.4</span><br></pre></td></tr></table></figure>

<h3 id="解决路由问题："><a href="#解决路由问题：" class="headerlink" title="解决路由问题："></a>解决路由问题：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Hub1(config)#ip<span class="built_in"> route </span>7.7.2.0 255.255.255.0 7.7.1.3</span><br><span class="line">Hub2(config)#ip<span class="built_in"> route </span>7.7.2.0 255.255.255.0 7.7.1.3</span><br><span class="line">ASAv(config)#<span class="built_in"> route </span>Inside 7.7.2.0 255.255.255.0 7.7.1.3</span><br></pre></td></tr></table></figure>

<h3 id="测试流量："><a href="#测试流量：" class="headerlink" title="测试流量："></a>测试流量：</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">PC4&gt;<span class="built_in"> ping </span>192.168.4.1</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.4.1 <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=60 <span class="attribute">time</span>=6.712 ms</span><br><span class="line"></span><br><span class="line">PC4&gt;<span class="built_in"> ping </span>192.168.5.1</span><br><span class="line">84 bytes <span class="keyword">from</span> 192.168.5.1 <span class="attribute">icmp_seq</span>=5 <span class="attribute">ttl</span>=60 <span class="attribute">time</span>=5.570 ms</span><br></pre></td></tr></table></figure>

<h3 id="查看EIGRP路由（中心站点）："><a href="#查看EIGRP路由（中心站点）：" class="headerlink" title="查看EIGRP路由（中心站点）："></a>查看EIGRP路由（中心站点）：</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Hub1#sh ip route eigrp </span><br><span class="line">Gateway of last resort <span class="keyword">is</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> to network <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">      <span class="number">172.16</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">16</span> <span class="keyword">is</span> variably subnetted, <span class="number">3</span> subnets, <span class="number">2</span> masks</span><br><span class="line">D        <span class="number">172.16</span><span class="number">.2</span><span class="number">.0</span>/<span class="number">24</span> [<span class="number">90</span>/<span class="number">28160000</span>] via <span class="number">172.16</span><span class="number">.1</span><span class="number">.3</span>, <span class="number">00</span>:<span class="number">11</span>:<span class="number">45</span>, Tunnel10</span><br><span class="line">D     <span class="number">192.168</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">16</span> <span class="keyword">is</span> a summary, <span class="number">00</span>:<span class="number">28</span>:<span class="number">38</span>, Null0</span><br><span class="line">D     <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> [<span class="number">90</span>/<span class="number">26905600</span>] via <span class="number">172.16</span><span class="number">.1</span><span class="number">.1</span>, <span class="number">00</span>:<span class="number">28</span>:<span class="number">33</span>, Tunnel10</span><br><span class="line">D     <span class="number">192.168</span><span class="number">.2</span><span class="number">.0</span>/<span class="number">24</span> [<span class="number">90</span>/<span class="number">26905600</span>] via <span class="number">172.16</span><span class="number">.1</span><span class="number">.2</span>, <span class="number">00</span>:<span class="number">28</span>:<span class="number">29</span>, Tunnel10</span><br><span class="line">D     <span class="number">192.168</span><span class="number">.3</span><span class="number">.0</span>/<span class="number">24</span> [<span class="number">90</span>/<span class="number">26905600</span>] via <span class="number">172.16</span><span class="number">.1</span><span class="number">.3</span>, <span class="number">00</span>:<span class="number">17</span>:<span class="number">35</span>, Tunnel10</span><br><span class="line">D     <span class="number">192.168</span><span class="number">.4</span><span class="number">.0</span>/<span class="number">24</span> [<span class="number">90</span>/<span class="number">28185600</span>] via <span class="number">172.16</span><span class="number">.1</span><span class="number">.3</span>, <span class="number">00</span>:<span class="number">08</span>:<span class="number">32</span>, Tunnel10</span><br><span class="line">D     <span class="number">192.168</span><span class="number">.5</span><span class="number">.0</span>/<span class="number">24</span> [<span class="number">90</span>/<span class="number">28185600</span>] via <span class="number">172.16</span><span class="number">.1</span><span class="number">.3</span>, <span class="number">00</span>:<span class="number">06</span>:<span class="number">14</span>, Tunnel10</span><br></pre></td></tr></table></figure>









]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>VPN</tag>
        <tag>DMVPN</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco配置3A认证</title>
    <url>/2020/07/13/2020-07-Cisco-os-3A.html</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建本地用户</span></span><br><span class="line">username admin privilege <span class="number">15</span> password cisco</span><br><span class="line"><span class="comment">#开启3A</span></span><br><span class="line">aaa new-model</span><br><span class="line"><span class="comment">#开启线下保护，防止与3A服务器无法通信时无法登陆</span></span><br><span class="line">aaa authentication login protect line none</span><br><span class="line"><span class="comment">#调用线下保护</span></span><br><span class="line">line con <span class="number">0</span></span><br><span class="line">login authentication protect</span><br><span class="line"><span class="comment">#定义3A服务器，配置注册用密钥</span></span><br><span class="line">aaa group server radius cisco</span><br><span class="line">server-private <span class="number">7.7</span><span class="number">.1</span><span class="number">.20</span> key cisco</span><br><span class="line"><span class="comment">#配置3A认证策略，并调用在VTY下</span></span><br><span class="line">aaa authentication login <span class="number">3</span>A-AU group cisco local</span><br><span class="line"><span class="comment">#调用授权</span></span><br><span class="line">aaa authorization <span class="keyword">exec</span> <span class="number">3</span>A-AU group cisco local</span><br><span class="line">line vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">login authentication <span class="number">3</span>A-AU</span><br><span class="line">authorization <span class="keyword">exec</span> <span class="number">3</span>A-AU</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>AAA</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco设置远程登陆Telnet</title>
    <url>/2020/07/15/2020-07-Cisco%E8%AE%BE%E7%BD%AE%E8%BF%9C%E7%A8%8B%E7%99%BB%E9%99%86Telnet.html</url>
    <content><![CDATA[<h2 id="无密码登陆"><a href="#无密码登陆" class="headerlink" title="无密码登陆"></a>无密码登陆</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">line vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">  no login</span><br><span class="line">  transport input telnet</span><br><span class="line"><span class="comment">#登陆后默认等级为1，可配置enable password提升等级为15等级</span></span><br><span class="line">enable password &lt;password&gt;</span><br><span class="line"><span class="comment">#或在vty接口下直接配置登陆后获得的等级</span></span><br><span class="line">line vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">  privilege level <span class="number">15</span></span><br></pre></td></tr></table></figure>

<h2 id="密码登陆"><a href="#密码登陆" class="headerlink" title="密码登陆"></a>密码登陆</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">line vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">  login</span><br><span class="line">  transport input telnet</span><br><span class="line">  password &lt;password&gt;</span><br><span class="line"><span class="comment">#登陆后默认等级为1，可配置enable password提升等级</span></span><br><span class="line">enable password &lt;password&gt;</span><br><span class="line"><span class="comment">#或在vty接口下直接配置登陆后获得的等级</span></span><br><span class="line">line vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">  privilege level <span class="number">15</span></span><br></pre></td></tr></table></figure>

<h2 id="本地用户-密码认证"><a href="#本地用户-密码认证" class="headerlink" title="本地用户+密码认证"></a>本地用户+密码认证</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">line vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">  login local</span><br><span class="line">  transport input telnet</span><br><span class="line"><span class="comment">#配置明文密码</span></span><br><span class="line">username &lt;user-name&gt; privilege &lt;<span class="number">0</span><span class="number">-15</span>&gt; password &lt;password&gt;</span><br><span class="line"><span class="comment">#配置密文密码</span></span><br><span class="line">username &lt;user-name&gt; privilege &lt;<span class="number">0</span><span class="number">-15</span>&gt; secret &lt;password&gt;</span><br></pre></td></tr></table></figure>

<h2 id="aaa认证"><a href="#aaa认证" class="headerlink" title="aaa认证"></a>aaa认证</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#开启3A认证</span></span><br><span class="line">aaa new-model</span><br><span class="line"><span class="comment">#配置线下保护，防止与3A服务器无法通信时无法登陆</span></span><br><span class="line">aaa authentication login &lt;test&gt; line none</span><br><span class="line"><span class="comment">#调用线下保护</span></span><br><span class="line">line con <span class="number">0</span></span><br><span class="line">  login authentication &lt;test&gt;</span><br><span class="line"><span class="comment">#定义3A服务器，配置注册用密钥</span></span><br><span class="line">aaa group server radius &lt;<span class="number">3</span>A-group-name&gt;</span><br><span class="line">server-private &lt;<span class="number">3</span>A-server-ip&gt; key &lt;<span class="number">3</span>A-key&gt;</span><br><span class="line"><span class="comment">#配置3A认证策略，并调用在VTY下</span></span><br><span class="line"><span class="comment">##使用组cisco所定义的3A服务器执行认证，若关联失败，则使用本地认证</span></span><br><span class="line">aaa authentication login &lt;<span class="number">3</span>A-AU&gt; group &lt;<span class="number">3</span>A-group-name&gt; local</span><br><span class="line">aaa authorization <span class="keyword">exec</span> &lt;<span class="number">3</span>A-AU&gt; group &lt;<span class="number">3</span>A-group-name&gt; local</span><br><span class="line"><span class="comment">##调用授权</span></span><br><span class="line">line vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line"> authorization <span class="keyword">exec</span> <span class="number">3</span>A-AU</span><br><span class="line"> login authentication <span class="number">3</span>A-AU</span><br><span class="line"><span class="comment">#创建本地用户</span></span><br><span class="line">username &lt;user-name&gt; privilege &lt;<span class="number">0</span><span class="number">-15</span>&gt; password &lt;password&gt;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>Telnet</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco不定时丢包</title>
    <url>/2020/07/18/2020-07-Cisco%E4%B8%8D%E5%AE%9A%E6%97%B6%E4%B8%A2%E5%8C%85.html</url>
    <content><![CDATA[<h1 id="不定时丢包，随意丢包，检查copp"><a href="#不定时丢包，随意丢包，检查copp" class="headerlink" title="不定时丢包，随意丢包，检查copp"></a>不定时丢包，随意丢包，检查copp</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">N7K<span class="comment"># show policy-map interface control-plane</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>Troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>H3C设置远程登陆Telnet</title>
    <url>/2020/07/17/2020-07-H3C%E8%AE%BE%E7%BD%AE%E8%BF%9C%E7%A8%8B%E7%99%BB%E9%99%86Telnet.html</url>
    <content><![CDATA[<h2 id="V7版本"><a href="#V7版本" class="headerlink" title="V7版本"></a>V7版本</h2><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span>-<span class="keyword">user</span> &lt;username&gt; <span class="keyword">class</span> manage  </span><br><span class="line"><span class="keyword">password</span> simple &lt;<span class="keyword">password</span>&gt;</span><br><span class="line">service-<span class="keyword">type</span> telnet</span><br><span class="line"><span class="keyword">authorization</span>-<span class="keyword">attribute</span> <span class="keyword">user</span>-<span class="keyword">role</span> <span class="keyword">level</span><span class="number">-15</span> </span><br><span class="line"><span class="keyword">authorization</span>-<span class="keyword">attribute</span> <span class="keyword">user</span>-<span class="keyword">role</span> network-<span class="keyword">operator</span></span><br><span class="line"><span class="type">line</span> <span class="keyword">class</span> aux </span><br><span class="line"><span class="keyword">user</span>-<span class="keyword">role</span> network-<span class="keyword">admin</span></span><br><span class="line"><span class="type">line</span> <span class="keyword">class</span> vty </span><br><span class="line"><span class="keyword">user</span>-<span class="keyword">role</span> network-<span class="keyword">operator</span></span><br><span class="line"><span class="type">line</span> aux <span class="number">0</span> </span><br><span class="line"><span class="keyword">user</span>-<span class="keyword">role</span> network-<span class="keyword">admin</span></span><br><span class="line"><span class="type">line</span> vty <span class="number">0</span> <span class="number">63</span> </span><br><span class="line">authentication-mode scheme </span><br><span class="line"><span class="keyword">user</span>-<span class="keyword">role</span> network-<span class="keyword">operator</span></span><br><span class="line"><span class="keyword">user</span>-interface vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">authentication-mode scheme</span><br><span class="line">telnet <span class="keyword">server</span> <span class="keyword">enable</span></span><br></pre></td></tr></table></figure>

<h2 id="V5版本"><a href="#V5版本" class="headerlink" title="V5版本"></a>V5版本</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">user-interface vty <span class="number">5</span> <span class="number">8</span></span><br><span class="line"> authentication-mode scheme</span><br><span class="line"> protocol inbound telnet</span><br><span class="line">local-user &lt;username&gt;</span><br><span class="line"> password simple &lt;password&gt;</span><br><span class="line"> authorization-attribute level <span class="number">3</span></span><br><span class="line"> service-type telnet</span><br><span class="line">telnet server enable</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>H3C</category>
      </categories>
      <tags>
        <tag>Telnet</tag>
        <tag>H3C</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo优化</title>
    <url>/2020/07/15/2020-07-Hexo%E4%BC%98%E5%8C%96.html</url>
    <content><![CDATA[<h2 id="给Hexo添加本地搜索"><a href="#给Hexo添加本地搜索" class="headerlink" title="给Hexo添加本地搜索"></a>给Hexo添加本地搜索</h2><h3 id="安装hexo-generator-searchdb插件"><a href="#安装hexo-generator-searchdb插件" class="headerlink" title="安装hexo-generator-searchdb插件"></a>安装<code>hexo-generator-searchdb</code>插件</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">npm <span class="keyword">install</span> hexo-generator-searchdb <span class="comment">--save</span></span><br></pre></td></tr></table></figure>

<h3 id="在站点-配置文件添加如下配置"><a href="#在站点-配置文件添加如下配置" class="headerlink" title="在站点 配置文件添加如下配置"></a>在<font color="#dd00">站点</font> 配置文件添加如下配置</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">html</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure>

<h3 id="在NexT主题配置文件添加如下配置（NexT主题已支持该插件，有的话无需再添加）"><a href="#在NexT主题配置文件添加如下配置（NexT主题已支持该插件，有的话无需再添加）" class="headerlink" title="在NexT主题配置文件添加如下配置（NexT主题已支持该插件，有的话无需再添加）"></a>在NexT<font color="#dd00">主题</font>配置文件添加如下配置（NexT主题已支持该插件，有的话无需再添加）</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Local search</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/flashlab/hexo-generator-search</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># if auto, trigger search by changing input</span></span><br><span class="line">  <span class="comment"># if manual, trigger search by pressing enter key or search button</span></span><br><span class="line">  <span class="attr">trigger:</span> <span class="string">auto</span></span><br><span class="line">  <span class="comment"># show top n results per article, show all results by setting to -1</span></span><br><span class="line">  <span class="attr">top_n_per_article:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="给Hexo添加字数统计和阅读时长"><a href="#给Hexo添加字数统计和阅读时长" class="headerlink" title="给Hexo添加字数统计和阅读时长"></a>给Hexo添加字数统计和阅读时长</h2><h3 id="安装hexo-symbols-count-time"><a href="#安装hexo-symbols-count-time" class="headerlink" title="安装hexo-symbols-count-time"></a>安装<code>hexo-symbols-count-time</code></h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-symbols-count-time</span> <span class="string">--save</span></span><br></pre></td></tr></table></figure>

<h3 id="安装eslint"><a href="#安装eslint" class="headerlink" title="安装eslint"></a>安装<code>eslint</code></h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">npm</span> <span class="string">install</span> <span class="string">eslint</span> <span class="string">--save</span></span><br></pre></td></tr></table></figure>

<h3 id="在站点-配置文件添加如下配置-1"><a href="#在站点-配置文件添加如下配置-1" class="headerlink" title="在站点 配置文件添加如下配置"></a>在<font color="#dd00">站点</font> 配置文件添加如下配置</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line">  <span class="attr">symbols:</span> <span class="literal">true</span>                <span class="comment"># 文章字数统计</span></span><br><span class="line">  <span class="attr">time:</span> <span class="literal">true</span>                   <span class="comment"># 文章阅读时长</span></span><br><span class="line">  <span class="attr">total_symbols:</span> <span class="literal">true</span>          <span class="comment"># 站点总字数统计</span></span><br><span class="line">  <span class="attr">total_time:</span> <span class="literal">true</span>             <span class="comment"># 站点总阅读时长</span></span><br><span class="line">  <span class="attr">exclude_codeblock:</span> <span class="literal">false</span>     <span class="comment"># 排除代码字数统计</span></span><br></pre></td></tr></table></figure>

<h3 id="在NexT主题配置文件添加如下配置（NexT主题已支持该插件，有的话无需再添加）-1"><a href="#在NexT主题配置文件添加如下配置（NexT主题已支持该插件，有的话无需再添加）-1" class="headerlink" title="在NexT主题配置文件添加如下配置（NexT主题已支持该插件，有的话无需再添加）"></a>在NexT<font color="#dd00">主题</font>配置文件添加如下配置（NexT主题已支持该插件，有的话无需再添加）</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Post wordcount display settings</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/theme-next/hexo-symbols-count-time</span></span><br><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line">  <span class="attr">separated_meta:</span> <span class="literal">true</span>     <span class="comment"># 是否另起一行（true的话不和发表时间等同一行）</span></span><br><span class="line">  <span class="attr">item_text_post:</span> <span class="literal">true</span>     <span class="comment"># 首页文章统计数量前是否显示文字描述（本文字数、阅读时长）</span></span><br><span class="line">  <span class="attr">item_text_total:</span> <span class="literal">false</span>   <span class="comment"># 页面底部统计数量前是否显示文字描述（站点总字数、站点阅读时长）</span></span><br><span class="line">  <span class="attr">awl:</span> <span class="number">4</span>                   <span class="comment"># Average Word Length</span></span><br><span class="line">  <span class="attr">wpm:</span> <span class="number">275</span>                 <span class="comment"># Words Per Minute（每分钟阅读词数）</span></span><br><span class="line">  <span class="attr">suffix:</span> <span class="string">mins.</span></span><br></pre></td></tr></table></figure>

<h2 id="Hexo文章更改上下间隔"><a href="#Hexo文章更改上下间隔" class="headerlink" title="Hexo文章更改上下间隔"></a>Hexo文章更改上下间隔</h2><h3 id="找到文件-post-expand-styl"><a href="#找到文件-post-expand-styl" class="headerlink" title="找到文件.post-expand.styl"></a>找到文件<code>.post-expand.styl</code></h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">路径：themes/next/source/css/_schemes/Mist/.post-expand.styl</span></span><br></pre></td></tr></table></figure>

<h3 id="修改参数"><a href="#修改参数" class="headerlink" title="修改参数"></a>修改参数</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">.post-block:not(:first-child)</span> <span class="string">&#123;</span></span><br><span class="line">  <span class="attr">margin-top:</span> <span class="string">10px;</span>       <span class="string">//文章上下间隔,默认120px</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="主题设置主页显示文章摘要方法"><a href="#主题设置主页显示文章摘要方法" class="headerlink" title="主题设置主页显示文章摘要方法"></a>主题设置主页显示文章摘要方法</h2><p> 最近使用Hexo搭建了自己的博客，使用了简洁而强大的NexT主题。在写博客的过程中发现主页文章显示为全文模式，看起来很不美观。从网络上搜集了几种方法：</p>
<ul>
<li><p>在文章中使用<code>&lt;!--more--&gt;</code>手动进行截断，Hexo 提供的方式 <font color="#dd00">推荐</font> </p>
</li>
<li><p>在文章的 <code>front-matter</code>中添加 <code>description</code>，并提`供文章摘录</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">title: post</span><br><span class="line">categories:</span><br><span class="line">  - <span class="literal">null</span></span><br><span class="line">tags:</span><br><span class="line">  - <span class="literal">null</span></span><br><span class="line">date: <span class="number">2020</span><span class="number">-07</span><span class="number">-14</span> <span class="number">13</span>:<span class="number">58</span>:<span class="number">16</span>	</span><br><span class="line">description: 这种方式只会在首页列表中显示文章的摘要内容，进入文章详情后不会再显示。</span><br></pre></td></tr></table></figure>



<ul>
<li>自动形成摘要，在 <strong>主题配置文件</strong> 中添加： <font color="#dd00">不推荐</font> </li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">auto_excerpt:</span><br><span class="line">  enable: <span class="literal">true</span></span><br><span class="line">  length: <span class="number">150</span></span><br><span class="line">默认截取的长度为 <span class="number">150</span> 字符，可以根据需要自行设定</span><br></pre></td></tr></table></figure>

<blockquote>
<p>建议使用<code>&lt;!--more--&gt;</code>（即第一种方式），除了可以精确控制需要显示的摘录内容以外， 这种方式也可以让 Hexo 中的插件更好的识别。</p>
</blockquote>
<h2 id="修改文章宽度"><a href="#修改文章宽度" class="headerlink" title="修改文章宽度"></a>修改文章宽度</h2><p>在对应的主题下修改,next下有四种选择，我用的是Mist</p>
<p>文件路径为：/Library/WebServer/Hexo/themes/next/source/css/_schemes/Mist/_layout.styl，在最后面加入</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">header&#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">header</span><span class="selector-class">.post-header</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: auto ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content-wrap</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: calc(<span class="number">100%</span> - <span class="number">252px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media (<span class="attribute">min-width</span>: <span class="number">1600px</span>)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.container</span> <span class="selector-class">.main-inner</span>, <span class="selector-class">.header</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">73%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.container</span> <span class="selector-class">.header-inner</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">73%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media (<span class="attribute">min-width</span>: <span class="number">1200px</span>)&#123;</span><br><span class="line">  <span class="selector-class">.container</span> <span class="selector-class">.main-inner</span>, <span class="selector-class">.header</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">90%</span>;       <span class="comment">//顶部宽度</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.container</span> <span class="selector-class">.header-inner</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">90%</span>;        <span class="comment">//文章宽度</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header</span> &#123;</span><br><span class="line">  +tablet() &#123;</span><br><span class="line">    <span class="attribute">width</span>: auto !important;</span><br><span class="line">  &#125;</span><br><span class="line">  +mobile() &#123;</span><br><span class="line">    <span class="attribute">width</span>: auto ;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-class">.main-inner</span> &#123;</span><br><span class="line">  +tablet() &#123;</span><br><span class="line">    <span class="attribute">width</span>: auto !important;</span><br><span class="line">  &#125;</span><br><span class="line">  +mobile() &#123;</span><br><span class="line">    <span class="attribute">width</span>: auto ;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content-wrap</span> &#123;</span><br><span class="line">  +tablet() &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span> !important;</span><br><span class="line">  &#125;</span><br><span class="line">  +mobile() &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="颜色标签"><a href="#颜色标签" class="headerlink" title="颜色标签"></a>颜色标签</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">note:</span><br><span class="line">  <span class="comment"># Note tag style values:</span></span><br><span class="line">  <span class="comment">#  - simple    bs-callout old alert style. Default.</span></span><br><span class="line">  <span class="comment">#  - modern    bs-callout new (v2-v3) alert style.</span></span><br><span class="line">  <span class="comment">#  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span></span><br><span class="line">  <span class="comment">#  - disabled  disable all CSS styles import of note tag.</span></span><br><span class="line">  style: simple</span><br><span class="line">  icons: false</span><br><span class="line">  <span class="comment"># Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line">  <span class="comment"># Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line">  light_bg_offset: <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="用法："><a href="#用法：" class="headerlink" title="用法："></a>用法：</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% note [<span class="class"><span class="keyword">class</span>] [<span class="title">no</span>-<span class="title">icon</span>] %&#125;</span></span><br><span class="line"><span class="class"><span class="title">Any</span> <span class="title">content</span> <span class="params">(support inline tags too.io)</span>.</span></span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">[<span class="class"><span class="keyword">class</span>]   :</span> default | primary | success | info | warning | danger.</span><br><span class="line">[no-icon] : Disable icon <span class="keyword">in</span> note.</span><br><span class="line"></span><br><span class="line">All parameters are optional.</span><br><span class="line"><span class="comment"># 不在代码块中书写，注意空格。[]中为可选参数。</span></span><br></pre></td></tr></table></figure>

<h2 id="修改行间距"><a href="#修改行间距" class="headerlink" title="修改行间距"></a>修改行间距</h2><p>文章内容较多时，next原来的间距太大了，要上下来回滚动。<br>修改<code>themes\next\source\css\_variables\base.styl</code>，修改</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">$<span class="built_in">line</span>-<span class="built_in">height</span>-base           = <span class="number">1.5</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>杂记</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Next</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei开启远程登陆Telnet</title>
    <url>/2020/07/17/2020-07-Huawei%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E7%99%BB%E9%99%86Telnet.html</url>
    <content><![CDATA[<h2 id="开启Telnet服务"><a href="#开启Telnet服务" class="headerlink" title="开启Telnet服务"></a>开启Telnet服务</h2><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">telnet<span class="built_in"> server </span>enable</span><br></pre></td></tr></table></figure>

<h2 id="配置aaa用户-用户-密码登陆"><a href="#配置aaa用户-用户-密码登陆" class="headerlink" title="配置aaa用户(用户+密码登陆)"></a>配置aaa用户(用户+密码登陆)</h2><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">aaa</span><br><span class="line">  local-<span class="keyword">user</span> <span class="title">&lt;huawei</span>&gt; password cipher <span class="tag">&lt;huawei&gt;</span></span><br><span class="line">  local-<span class="keyword">user</span> <span class="title">huawei</span> service-<span class="keyword">type</span> telnet</span><br><span class="line">  local-<span class="keyword">user</span> <span class="title">huawei</span> level <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h2 id="设置vty验证类型"><a href="#设置vty验证类型" class="headerlink" title="设置vty验证类型"></a>设置vty验证类型</h2><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">user-interface vty 0 4</span><br><span class="line">  authentication-mode aaa</span><br><span class="line">  protocol inbound telnet</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Telnet</tag>
        <tag>Huawei</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac中WordPress中固定链接不能修改的问题</title>
    <url>/2020/07/17/2020-07-Mac%E4%B8%ADWordPress%E4%B8%AD%E5%9B%BA%E5%AE%9A%E9%93%BE%E6%8E%A5%E4%B8%8D%E8%83%BD%E4%BF%AE%E6%94%B9%E7%9A%84%E9%97%AE%E9%A2%98.html</url>
    <content><![CDATA[<h2 id="Apache配置的问题"><a href="#Apache配置的问题" class="headerlink" title="Apache配置的问题"></a>Apache配置的问题</h2><p>如果想要修改固定链接的设置结构，如果运行于apache服务，必须确保apache服务支持。</p>
<p>   首先，检查apache的配置，需要确保apache的设置中已经装载URL rewrite模块。一般apache的配置文件位于/etc/apache2/httpd.conf,使用vi或emacs等编辑器打开httpd.conf，搜索rewrite_module，确保文件中包含有下面的代码，且前面没有#，确保正确装载url重写模块。</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">LoadModule</span></span> rewrite_module modules/mod_rewrite.so</span><br></pre></td></tr></table></figure>

<p>其次，激活AllowOverride ，搜索所有的AllowOverride None，全部改为AllowOverride all。</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory /&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">options</span></span> FllowSymLinks</span><br><span class="line">    <span class="attribute">AllowOverride</span> None</span><br><span class="line">    <span class="attribute"><span class="nomarkup">Order</span></span> deny,allow</span><br><span class="line">    <span class="attribute"><span class="nomarkup">Deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>例如：上面的设置，修改为如下设置</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory /&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">options</span></span> FllowSymLinks</span><br><span class="line">    <span class="attribute">AllowOverride</span> <span class="literal">all</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Order</span></span> deny,allow</span><br><span class="line">    <span class="attribute"><span class="nomarkup">Deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后，修改完成后，重新启动apache服务，</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo apachectl restart</span></span><br></pre></td></tr></table></figure>

<h2 id="htaccess文件的问题。"><a href="#htaccess文件的问题。" class="headerlink" title=".htaccess文件的问题。"></a>.htaccess文件的问题。</h2><p>如果你在设置固定链接过程中，点击“保存更改”后，请注意查看在【设置 – 固定链接】中点击“保存更改”链接的时候，页面顶部是否出现了高亮的错误提示，如果有，则说明您的Wordpress根目录中的 .htaccess 文件不可写或者不存在。这时候需要手动添加此文件，或者修改这个文件的权限属性以使得wp可以存取它：</p>
<p>首先检查网站根目录（即WordPress程序的根目录）下是否存在 .htaccess 文件。如果没有，</p>
<p>可以在本地用Notepad++等文本编辑工具新建一个名为 xx. htaccess 的文件，然后通过FTP工具将该文件上传到WordPress的根目录，同时，把 xx. htaccess 改为 .htaccess </p>
<p>并使用chmod命令设置该文件的权限为 644 或更高，使得该文件支持写入操作。</p>
<p>也可以ssh直接在主机中建立此文件。</p>
<p>1</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">touch</span> <span class="selector-class">.htaccess</span></span><br><span class="line"><span class="selector-tag">chmod</span> 644 <span class="selector-class">.htaccess</span></span><br><span class="line"><span class="selector-tag">vi</span> <span class="selector-class">.htaccess</span></span><br></pre></td></tr></table></figure>

<p>其次，编辑.htaccess 文件进行编辑，确保输入以下内容：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">RewriteEngine</span></span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteBase</span> /</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-f</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-d</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteRule</span></span> . /index.php<span class="meta"> [L]</span></span><br></pre></td></tr></table></figure>

<p>完成后保存.htaccess 文件，这样应该就可以随意地wp的固定链接了。</p>
]]></content>
      <categories>
        <category>杂记</category>
      </categories>
      <tags>
        <tag>MacOS</tag>
        <tag>Wordpress</tag>
      </tags>
  </entry>
  <entry>
    <title>IPSec常见错误日志信息鉴别</title>
    <url>/2020/07/18/2020-07-IPSec%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF%E9%89%B4%E5%88%AB.html</url>
    <content><![CDATA[<h1 id="Replay-Check-Failed"><a href="#Replay-Check-Failed" class="headerlink" title="Replay Check  Failed"></a>Replay Check  Failed</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%CRYPTO<span class="number">-4</span>-PKT_ REPLAY_ ERR: decrypt: replay check failed connection id=<span class="comment">#.</span></span><br></pre></td></tr></table></figure>

<p>仅在转换集配置了esp-md5-hmac后才会看到信息，修改转换集HAMC为其它算法即可，例如SHA</p>
<h1 id="QM-FSM"><a href="#QM-FSM" class="headerlink" title="QM  FSM"></a>QM  FSM</h1><p>Ipsec_ L2L_ <em>VPN隧道未出现在PIX防火墙或ASA上，并显示QM</em> _FSM错误消息</p>
<p>请执行以下检查</p>
<ul>
<li>两端感兴趣流列表不匹配</li>
<li>转换集参数不匹配.</li>
</ul>
<h1 id="Invalid-Local-Address"><a href="#Invalid-Local-Address" class="headerlink" title="Invalid Local Address"></a>Invalid Local Address</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">IPSEC(validate_ proposal): invalid local address <span class="number">10.</span> <span class="number">1.1</span>. <span class="number">10</span></span><br><span class="line">ISAKMP (<span class="number">0</span>:<span class="number">3</span>): atts <span class="keyword">not</span> acceptable. Next payload <span class="keyword">is</span> <span class="number">0</span></span><br><span class="line">ISAKMP (<span class="number">0</span>:<span class="number">3</span>): SA <span class="keyword">not</span> acceptable!</span><br></pre></td></tr></table></figure>

<p>请执行以下检查</p>
<ul>
<li>Crypto-Map接口调用是否正确.</li>
<li>以下命令指定所使用的加解密接口是否正确<br>crypto map cisco loca I-address Ether net0/1</li>
</ul>
<h1 id="IKE-Message-from-X-X-X-X-Failed-its-Sanity-Check-or-is-Ma-Iformed"><a href="#IKE-Message-from-X-X-X-X-Failed-its-Sanity-Check-or-is-Ma-Iformed" class="headerlink" title="IKE Message from X.X.X.X Failed its Sanity Check or is Ma Iformed"></a>IKE Message from X.X.X.X Failed its Sanity Check or is Ma Iformed</h1><p>出现以上错误，请检查两端预共享密钥</p>
<h1 id="Processing-of-Main-Mode-Failed-with-Peer"><a href="#Processing-of-Main-Mode-Failed-with-Peer" class="headerlink" title="Processing of Main Mode Failed with Peer"></a>Processing of Main Mode Failed with Peer</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>d00h: ISAKMP (<span class="number">0</span>:<span class="number">1</span>): atts are <span class="keyword">not</span> acceptable. Next payload <span class="keyword">is</span> <span class="number">0</span></span><br><span class="line"><span class="number">1</span>d00h: ISAKMP (<span class="number">0</span>:<span class="number">1</span>); no offers accepted!</span><br><span class="line"><span class="number">1</span>d00h: ISAKMP (<span class="number">0</span>:<span class="number">1</span>): SA <span class="keyword">not</span> acceptable!</span><br><span class="line"><span class="number">1</span>d00h: %CRYPT0<span class="number">-6</span>-IKMP_MODE_FAILURE: Processing of Main Mode failed <span class="keyword">with</span> peer at <span class="number">30.1</span><span class="number">.1</span><span class="number">.10</span></span><br></pre></td></tr></table></figure>

<p>出现以.上报错，意味主模式阶段1两端策略不匹配</p>
<h1 id="Proxy-Ident-ities-Not-Supported"><a href="#Proxy-Ident-ities-Not-Supported" class="headerlink" title="Proxy Ident ities Not Supported"></a>Proxy Ident ities Not Supported</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>d00h: IPSec (val idate_ transform_ proposal): proxy identities <span class="keyword">not</span> supported</span><br><span class="line"><span class="number">1</span>d00h: ISAKMP: IPSec policy inval idated pr oposal</span><br><span class="line"><span class="number">1</span>d00h: ISAKMP (<span class="number">0</span>:<span class="number">2</span>): SA <span class="keyword">not</span> acceptab le!</span><br></pre></td></tr></table></figure>

<p>出现以上报错，意味感兴趣流列表不匹配</p>
<h1 id="Transform-Proposal-Not-Suppor-ted"><a href="#Transform-Proposal-Not-Suppor-ted" class="headerlink" title="Transform Proposal Not Suppor ted"></a>Transform Proposal Not Suppor ted</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>d00h: IPSec (val idate_ pr oposal): transform pr oposa |</span><br><span class="line">(port <span class="number">3</span>，trans <span class="number">2</span>，hmac_ alg <span class="number">2</span>) <span class="keyword">not</span> supported</span><br><span class="line"><span class="number">1</span>d00h: ISAKMP (<span class="number">0</span>:<span class="number">2</span>) : atts <span class="keyword">not</span> acceptable. Next payload <span class="keyword">is</span> <span class="number">0</span></span><br><span class="line"><span class="number">1</span>d00h: ISAKMP (<span class="number">0</span>:<span class="number">2</span>) SA <span class="keyword">not</span> acceptable</span><br></pre></td></tr></table></figure>

<p>出现以上报错，意味两端转换集不匹配</p>
<h1 id="No-Cert-and-No-Keys-with-Remote-Peer"><a href="#No-Cert-and-No-Keys-with-Remote-Peer" class="headerlink" title="No Cert and No Keys with Remote Peer"></a>No Cert and No Keys with Remote Peer</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>d00h: ISAKMP: No cert，<span class="keyword">and</span> no keys (public <span class="keyword">or</span> pre-shared) withremote peer <span class="number">30.</span> <span class="number">1.</span> <span class="number">1.10</span></span><br></pre></td></tr></table></figure>

<p>出现以上报错，请检查以下配置</p>
<ul>
<li>对等体地址配置是否正确</li>
<li>底层路由是否可通</li>
</ul>
<h1 id="IPsec-Packet-has-Invalid-SPI"><a href="#IPsec-Packet-has-Invalid-SPI" class="headerlink" title="IPsec Packet has Invalid SPI"></a>IPsec Packet has Invalid SPI</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%PIX |ASA<span class="number">-4</span><span class="number">-402101</span>: decaps: recd IPSEC packet has</span><br><span class="line">invalid spi <span class="keyword">for</span> destaddr=dest_ _address， prot=protocol, sp i=number</span><br></pre></td></tr></table></figure>

<p>在SADB里查询不到对应的SPI，请确保本地SA依然存在，而没有手动Clear掉</p>
<h1 id="HMAC-Verification-Failed"><a href="#HMAC-Verification-Failed" class="headerlink" title="HMAC Verification Failed"></a>HMAC Verification Failed</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Sep <span class="number">22</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">39</span> <span class="number">131.</span> <span class="number">203.252</span>. <span class="number">166</span> <span class="number">2435</span>:</span><br><span class="line">Sep <span class="number">22</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">39</span>: %MOTCR<span class="number">-1</span>-ERROR:motcr_ _crypto_ cal Iback() motcr <span class="keyword">return</span> failure</span><br><span class="line">Sep <span class="number">22</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">39</span> <span class="number">131.</span> <span class="number">203.252</span><span class="number">.166</span> <span class="number">2436</span>:</span><br><span class="line">Sep <span class="number">22</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">39</span>: %MOTCR- <span class="number">-1</span>-PKTENGRET_ ERROR: MOTCR PktEng Return Value = <span class="number">0x20000</span>,</span><br><span class="line">PktEngReturn_ MACMi scompare</span><br></pre></td></tr></table></figure>

<ul>
<li>如果偶尔收到此错误信息，可以忽略它</li>
<li>如果此错误消息出现频繁，则有可能是由加密加速器出错造成的(硬件错误)</li>
</ul>
]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>VPN</tag>
        <tag>IPSec</tag>
        <tag>Troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown语法</title>
    <url>/2020/07/14/2020-07-Markdown-use.html</url>
    <content><![CDATA[<h1 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h1><figure class="highlight clean"><table><tr><td class="code"><pre><span class="line"># 这是一级标题</span><br><span class="line">## 这是二级标题</span><br><span class="line">### 这是三级标题</span><br><span class="line">#### 这是四级标题</span><br><span class="line">##### 这是五级标题</span><br><span class="line">###### 这是六级标题</span><br></pre></td></tr></table></figure>

<h1 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h1><figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">*<span class="strong">*这是加粗的文字*</span><span class="strong">*</span></span><br><span class="line"><span class="strong">*</span>这是倾斜的文字<span class="strong">*`</span></span><br><span class="line"><span class="strong">*</span>*<span class="strong">*这是斜体加粗的文字*</span>*<span class="strong">*</span></span><br><span class="line"><span class="strong">~~这是加删除线的文字~~</span></span><br></pre></td></tr></table></figure>

<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">&gt;这是引用的内容</span><br><span class="line"><span class="meta">&gt;&gt;</span>这是引用的内容</span><br></pre></td></tr></table></figure>

<h1 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h1><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<h1 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a>插入图片</h1><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">![图片alt](图片地址 <span class="string">''</span>图片titl<span class="string">e''</span>)</span><br><span class="line"></span><br><span class="line">图片alt就是显示在图片下面的文字，相当于对图片内容的解释。</span><br><span class="line">图片title是图片的标题，当鼠标移到图片上时显示的内容。title可加可不加</span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line">![blockchain](https://ss0.bdstatic.com/<span class="number">70</span>cFvHSh_Q1YnxGkpoWK1HF6hhy/it/</span><br><span class="line">u=<span class="number">702257389</span>,<span class="number">1274025419</span>&amp;fm=<span class="number">27</span>&amp;gp=<span class="number">0.</span>jpg "例如")</span><br></pre></td></tr></table></figure>

<h1 id="超链接"><a href="#超链接" class="headerlink" title="超链接"></a>超链接</h1><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">[<span class="string">简书</span>](<span class="link">http://jianshu.com</span>)</span><br><span class="line">[<span class="string">百度</span>](<span class="link">http://baidu.com</span>)</span><br></pre></td></tr></table></figure>

<h1 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h1><h2 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">- </span>列表内容</span><br><span class="line"><span class="bullet">+ </span>列表内容</span><br><span class="line"><span class="bullet">* </span>列表内容</span><br><span class="line"></span><br><span class="line">以上三种都可以，无差别</span><br><span class="line">注意：- + * 跟内容之间都要有一个空格</span><br></pre></td></tr></table></figure>

<h2 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h2><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> 列表内容</span><br><span class="line"><span class="number">2.</span> 列表内容</span><br><span class="line"><span class="number">3.</span> 列表内容</span><br><span class="line"></span><br><span class="line">注意：序号跟内容之间要有空格</span><br></pre></td></tr></table></figure>

<h2 id="列表嵌套-上一级和下一级之间敲三个空格即可"><a href="#列表嵌套-上一级和下一级之间敲三个空格即可" class="headerlink" title="列表嵌套: 上一级和下一级之间敲三个空格即可"></a>列表嵌套: 上一级和下一级之间敲三个空格即可</h2><h1 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h1><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">表头|表头|表头</span><br><span class="line">---|:--:|---:</span><br><span class="line">内容|内容|内容</span><br><span class="line">内容|内容|内容</span><br></pre></td></tr></table></figure>

<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">单行代码：</span><br><span class="line"></span><br><span class="line">`代码内容`</span><br><span class="line"></span><br><span class="line">代码块：</span><br><span class="line"></span><br><span class="line">（```）</span><br><span class="line">代码内容</span><br><span class="line">代码内容</span><br><span class="line">（```）</span><br><span class="line"></span><br><span class="line">注：为了防止转译，前后三个反引号处加了小括号，实际是没有的。这里只是用来演示，实际中去掉两边小括号即可。</span><br></pre></td></tr></table></figure>

<h1 id="更改颜色"><a href="#更改颜色" class="headerlink" title="更改颜色"></a>更改颜色</h1><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"#dd00"</span>&gt;</span></span>站点<span class="xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="在Markdown中画流程图"><a href="#在Markdown中画流程图" class="headerlink" title="在Markdown中画流程图"></a>在Markdown中画流程图</h1><pre><code class="python">TB 从上到下
BT 从下到上
RL 从右到左
LR 从左到右
TD 同TB

（&lt;pre class="mermaid"&gt;graph TD
  a--&gt;b--&gt;c
​```）
<span class="comment">#注：防止代码块解析加入（）&lt;/pre&gt;</span>
</code></pre>
]]></content>
      <categories>
        <category>杂记</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>WordPress表格无边框解决办法</title>
    <url>/2020/07/17/2020-07-WordPress%E8%A1%A8%E6%A0%BC%E6%97%A0%E8%BE%B9%E6%A1%86%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html</url>
    <content><![CDATA[<h2 id="在样式表style-css中对表格样式重新定义。加上以下代码"><a href="#在样式表style-css中对表格样式重新定义。加上以下代码" class="headerlink" title="在样式表style.css中对表格样式重新定义。加上以下代码"></a>在样式表style.css中对表格样式重新定义。加上以下代码</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">table</span>,<span class="selector-tag">th</span>,<span class="selector-tag">td</span>&#123;</span><br><span class="line"><span class="attribute">border-collapse</span>:collapse;</span><br><span class="line"><span class="attribute">border</span>:<span class="number">1px</span> solid black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>杂记</category>
      </categories>
      <tags>
        <tag>Wordpress</tag>
      </tags>
  </entry>
  <entry>
    <title>WordPress免插件显示阅读次数</title>
    <url>/2020/07/17/2020-07-WordPress%E5%85%8D%E6%8F%92%E4%BB%B6%E6%98%BE%E7%A4%BA%E9%98%85%E8%AF%BB%E6%AC%A1%E6%95%B0.html</url>
    <content><![CDATA[<h2 id="将下面代码加到主题functions模版文件中："><a href="#将下面代码加到主题functions模版文件中：" class="headerlink" title="将下面代码加到主题functions模版文件中："></a>将下面代码加到主题functions模版文件中：</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//postviews   </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_post_views</span> <span class="params">($post_id)</span> </span>&#123;   </span><br><span class="line">  </span><br><span class="line">    $count_key = <span class="string">'views'</span>;   </span><br><span class="line">    $count = get_post_meta($post_id, $count_key, <span class="keyword">true</span>);   </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> ($count == <span class="string">''</span>) &#123;   </span><br><span class="line">        delete_post_meta($post_id, $count_key);   </span><br><span class="line">        add_post_meta($post_id, $count_key, <span class="string">'0'</span>);   </span><br><span class="line">        $count = <span class="string">'0'</span>;   </span><br><span class="line">    &#125;   </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">echo</span> number_format_i18n($count);   </span><br><span class="line">  </span><br><span class="line">&#125;   </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set_post_views</span> <span class="params">()</span> </span>&#123;   </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">global</span> $post;   </span><br><span class="line">  </span><br><span class="line">    $post_id = $post -&gt; ID;   </span><br><span class="line">    $count_key = <span class="string">'views'</span>;   </span><br><span class="line">    $count = get_post_meta($post_id, $count_key, <span class="keyword">true</span>);   </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (is_single() || is_page()) &#123;   </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> ($count == <span class="string">''</span>) &#123;   </span><br><span class="line">            delete_post_meta($post_id, $count_key);   </span><br><span class="line">            add_post_meta($post_id, $count_key, <span class="string">'0'</span>);   </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;   </span><br><span class="line">            update_post_meta($post_id, $count_key, $count + <span class="number">1</span>);   </span><br><span class="line">        &#125;   </span><br><span class="line">  </span><br><span class="line">    &#125;   </span><br><span class="line">  </span><br><span class="line">&#125;   </span><br><span class="line">add_action(<span class="string">'get_header'</span>, <span class="string">'set_post_views'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="将调用显示阅读次数代码加到single模版适当的位置："><a href="#将调用显示阅读次数代码加到single模版适当的位置：" class="headerlink" title="将调用显示阅读次数代码加到single模版适当的位置："></a>将调用显示阅读次数代码加到single模版适当的位置：</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> get_post_views($post -&gt; ID); <span class="meta">?&gt;</span> views</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>杂记</category>
      </categories>
      <tags>
        <tag>Wordpress</tag>
      </tags>
  </entry>
  <entry>
    <title>删除WordPress主题版权</title>
    <url>/2020/07/17/2020-07-%E5%88%A0%E9%99%A4WordPress%E4%B8%BB%E9%A2%98%E7%89%88%E6%9D%83.html</url>
    <content><![CDATA[<h3 id="找到当前主题文件footer-php"><a href="#找到当前主题文件footer-php" class="headerlink" title="找到当前主题文件footer.php"></a>找到当前主题文件footer.php</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"f_bq"</span>&gt;</span><span class="php"><span class="meta">&lt;?php</span> <span class="keyword">if</span>($word_t2!=<span class="string">""</span>)&#123;<span class="keyword">echo</span> $word_t2;&#125;<span class="keyword">else</span>&#123;<span class="keyword">echo</span> <span class="string">'Copyright'</span>;&#125;  <span class="meta">?&gt;</span></span> <span class="symbol">&amp;copy;</span><span class="php"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> date(<span class="string">"Y"</span>); <span class="keyword">echo</span> <span class="string">" "</span>; bloginfo(<span class="string">'name'</span>); <span class="keyword">echo</span> <span class="string">' Powered by &lt;a class="banquan" target="_blank" href="https://www.wordpress.org"&gt; wordpress&lt;/a&gt;'</span>; <span class="meta">?&gt;</span></span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>将其中链接与后面名称更改即可</p>
<h4 id="有可能会出现取消WordPress主题版权信息–“请勿删除版权信息！务必保留页脚css类-f-bq-方可显示正常。”"><a href="#有可能会出现取消WordPress主题版权信息–“请勿删除版权信息！务必保留页脚css类-f-bq-方可显示正常。”" class="headerlink" title="有可能会出现取消WordPress主题版权信息–“请勿删除版权信息！务必保留页脚css类.f_bq,方可显示正常。”"></a>有可能会出现取消WordPress主题版权信息–“请勿删除版权信息！务必保留页脚css类.f_bq,方可显示正常。”</h4><h5 id="解决方法：找到这个js文件，slider-js无论无论里面是什么代码，直接替换为："><a href="#解决方法：找到这个js文件，slider-js无论无论里面是什么代码，直接替换为：" class="headerlink" title="解决方法：找到这个js文件，slider.js无论无论里面是什么代码，直接替换为："></a>解决方法：找到这个js文件，slider.js无论无论里面是什么代码，直接替换为：</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;$(<span class="string">"ul.sub-menu"</span>).parent().append(<span class="string">"&lt;span&gt;&lt;/span&gt;"</span>);$(<span class="string">"ul.menu li span"</span>).mouseover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;$(<span class="keyword">this</span>).parent().find(<span class="string">"ul.sub-menu"</span>).slideDown(<span class="string">'fast'</span>).show();$(<span class="keyword">this</span>).parent().hover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;$(<span class="keyword">this</span>).parent().find(<span class="string">"ul.sub-menu"</span>).slideUp(<span class="string">'slow'</span>);&#125;);&#125;).hover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;$(<span class="keyword">this</span>).addClass(<span class="string">"subhover"</span>);&#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;$(<span class="keyword">this</span>).removeClass(<span class="string">"subhover"</span>);&#125;)&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这样就行了。改完记得清除缓存，顺便把浏览器缓存也清除一下。</p>
</blockquote>
]]></content>
      <categories>
        <category>杂记</category>
      </categories>
      <tags>
        <tag>Wordpress</tag>
      </tags>
  </entry>
  <entry>
    <title>密码学基础</title>
    <url>/2020/07/17/2020-07-%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80.html</url>
    <content><![CDATA[<p>密码技术是网络安全的基础，也是核心。现在对隐私保护、敏感信息尤其重视，所以不论是系统开发还是App开发，只要有网络通信，很多信息都需要进行加密，以防止被截取篡改</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">明文M：原始数据，待加密的数据</span><br><span class="line">密文C：对明文进行某种伪装或变换后的输出</span><br><span class="line">密钥K：加密或解密中所使用的专门工具</span><br><span class="line">加密E：用某种方法将明文变成密文的过程</span><br><span class="line">解密D：将密文恢复成明文的过程</span><br></pre></td></tr></table></figure>

<h2 id="密码系统"><a href="#密码系统" class="headerlink" title="密码系统"></a>密码系统</h2><p>一个密码系统由五元组（M、C、K、E、D）组成，如图所示</p>
<p><img src="../../../images/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80/QQ20200701-004215@2x-1024x296.png" alt="img"></p>
<h2 id="密码体制"><a href="#密码体制" class="headerlink" title="密码体制"></a>密码体制</h2><p><strong>对称密码体制</strong>：对信息进行明/密文变换时，加解和解密使用相同密钥的密码体制</p>
<p><img src="../../../images/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80/111-1024x303.png" alt="img"></p>
<blockquote>
<p>安全性依赖于：1、加密算法的安全性 2、密钥的秘密性<br>优点：算法公开、速度快、保密强度高、占用空间小<br>缺点：密钥的分发和管理非常复杂<br>用途：信息量大的加密<br>代表算法：DES算法、3DES算法、IDEA算法、AES算法<br>问题：若接收方伪造一个消息并诬陷是发送方发送的，发送方无法辩解，也就是无法解决消息的确认问题，不能实现数字签名；另一个问题是建立安全的信道之前，如何实现通信双方的加密密钥的交换</p>
</blockquote>
<p><strong>非对称密码体制</strong>：对信息进行明/密文变换时，加密和解密密钥不相同的密码体制<br>在非对称密码体制中，每个用户都具有一对密钥，一个用于加密，一个用于解密，其中加密密钥可以公开，称之为公钥，解密密钥属于秘密，称之为私钥，只有用户一人知道。</p>
<p><img src="../../../images/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80/12-1024x255.png" alt="img"></p>
<blockquote>
<p>优点：通信双方不需要通过建立一个安全信道来进行密钥的交换，密钥空间小，降低了密钥管理的难度<br>缺点：实现速度慢，不适合通信负荷较重的情况<br>用途：加密关键性的、核心的机密数据<br>代表算法：RSA算法、ElGamal算法、椭圆曲线加密算法<br>问题：由于自己的公钥对外公开，因此<br>1、如果一个人用自己的公钥加密数据发送给我，我无法断定是谁发送的；<br>2、我用私钥加密的数据，任何知道我公钥的人都能解密我的数据。</p>
</blockquote>
<p><strong>混合加密体制</strong>：同时使用对称密码和非对称密码的体制<br>对称加密的一个很大问题就是通信双方如何将密钥传输给对方，为了安全，一般采取带外传输，也就是说如果加密通信是在网络，那么密钥的传输需要通过其他途径，如短信，即使如此，也很难保证密钥传输的安全性。非对称加密加解最大的优点是事先不需要传输密钥，但速度慢，因此实际应用中，经常采取混合密码体制。假设A与B要实现保密通信，工作过程如下：</p>
<blockquote>
<p>1、A找到B的公钥<br>2、A选择一个大随机数作为此次会话的加密密钥，即会话密钥<br>3、A以会话密钥加密通信内容，再以B的公钥加密会话密钥后发送给B<br>4、B收到数据以后，先用自己的私钥解密出会话密钥，然后用会话密钥解密出通信内容</p>
</blockquote>
<h4 id="散列函数与消息摘要"><a href="#散列函数与消息摘要" class="headerlink" title="散列函数与消息摘要"></a>散列函数与消息摘要</h4><p>Hash函数也称为<strong>散列函数</strong>，它能够对不同长度的输入信息，产生固定长度的输出。这种固定长度的输出称之为原消息的散列或者<strong>消息摘要</strong>，消息摘要长度固定且比原始信息小得多，一般情况下，消息摘要是不可逆的，即从消息摘要无法还原原文，为什么说一般情况下呢，中国出了个牛人王小云，感兴趣的自行Google<del>~</del></p>
<p>散列算法：散列算法就是产生信息散列值的算法，它有一个特性，就是在输入信息中如果发生细微的改变，比如给变了二进制的一位，都可以改变散列值中每个比特的特性，导致最后的输出结果大相径庭，所以它对于检测消息或者密钥等信息对象中的任何微小的变化非常有用。</p>
<p>一个安全的散列算法H需要满足：</p>
<blockquote>
<p>1、输入长度是任意的，输出是固定的<br>2、对每一个给定的输入,计算输出是很容易的<br>3、给定H,找到两个不同的输入，输出同一个值在计算上不可行<br>4、给定H和一个消息x,找到另一个不同的消息y，使它们散列到同一个值在计算上不可行<br>常见的散列算法：MD2、MD4、MD5、SHA、SHA-1</p>
</blockquote>
<h4 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h4><p>数字签名是指发送方以电子形式签名一个消息或文件，签名后的消息或文件能在网络中传输，并表示签名人对该消息或文件的内容负有责任。数字签名综合使用了消息摘要和非对称加密技术，可以保证接受者能够核实发送者对报文的签名，发送者事后不抵赖报文的签名，接受者不能篡改报文内容和伪造对报文的签名。</p>
<p>数字签名需要做到两点：</p>
<blockquote>
<p>1、确认信息是由签名者发送的；<br>2、确认信息从签发到接受没有被修改过。</p>
</blockquote>
<p>数字签名的过程与示意图：</p>
<blockquote>
<p>1、发送方要发送消息运用散列函数（MD5、SHA-1等）形成消息摘要；<br>2、发送方用<strong>自己的私钥</strong>对消息摘要进行加密，形成数字签名；<br>3、发送方将数字签名附加在消息后发送给接收方；<br>4、接受方用发送方的公钥对签名信息进行解密，得到消息摘要；<br>5、接收方以相同的散列函数对接收到的消息进行散列，也得到一份消息摘要；<br>6、接收方比较两个消息摘要，如果完全一致，说明数据没有被篡改，签名真实有效；否则拒绝该签名。</p>
</blockquote>
<p><img src="../../../images/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80/2222-1024x566.png" alt="img"></p>
<p>如果通信的内容是加密的，就需要采用<strong>数字信封</strong>：发送方用对称密钥加密明文，然后用对方的公钥加密对称密钥发送给对方，对方收到电子信封，用自己的私钥解密，得到对称密钥解密，还原明文。此时数字签名的过程如下：</p>
<blockquote>
<p>1、发送方要发送消息运用散列函数（MD5、SHA-1等）形成消息摘要；<br>2、发送方用<strong>自己的私钥</strong>对消息摘要进行加密，形成数字签名；<br>3、发送方用对称加密算法对消息原文、数字签名进行加密，得到密文信息；<br>4、发送方用<strong>接收方的公钥</strong>加密对称加密算法的密钥进行加密，形成数字信封；<br>5、发送方将3中的密文信息和数字信封一起发给接收方；<br>6、接收方首先用自己的私钥解密数字信封，还原对称加密算法的密钥；<br>7、接受方用6中的密钥解密接收到的密文，得到原文信息和数字签名；<br>8、接受方用发送方的公钥对签名信息进行解密，得到消息摘要；<br>9、接收方以相同的散列函数对接收到的消息进行散列，也得到一份消息摘要；<br>10、接收方比较两个消息摘要，如果完全一致，说明数据没有被篡改，签名真实有效；否则拒绝该签名。</p>
</blockquote>
<h4 id="数字证书"><a href="#数字证书" class="headerlink" title="数字证书"></a>数字证书</h4><p>数字证书是一种权威的电子文档，由权威公正的第三方认证机构（CA）签发，广泛用于涉及需要身份认证和数据安全的领域。</p>
<p>数字证书种类：</p>
<blockquote>
<p>1、服务器证书：证明服务器的身份和进行通信加密，客户端可以与服务器端建立SSL连接，然后通信数据都会被加密。<br>2、电子邮件证书：证明电子邮件发件人的真实性，也可发送加密邮件，只有接收方才能打得开。<br>3、客户端证书：主要用于身份验证和数字签名，安全的客户端证书经常存储的专门的USBKey中，使用的时候需要输入保护密码，以防被导出和复制，如指纹识别、语音播报、带显示器的USBKey等等。</p>
</blockquote>
<ul>
<li>数字证书功能：<ul>
<li>1、信息保密</li>
<li>2、身份确认</li>
<li>3、不可否认性</li>
<li>4、数据完整性</li>
</ul>
</li>
</ul>
<p>数字证书的格式：</p>
<p>最简单的可以是：公钥、名称和证书授权中心的数字签名，目前 <strong>X.509</strong> 是一种通用的证书格式，它的第三个版本目前使用广泛，证书内容包括：版本、序列号、签名算法标识、签发者、有效期、主体、主体公开密钥、CA的数字签名、可选型等等</p>
]]></content>
      <categories>
        <category>原理以及基础</category>
      </categories>
      <tags>
        <tag>HASH</tag>
        <tag>PKI</tag>
        <tag>Password</tag>
      </tags>
  </entry>
  <entry>
    <title>测试</title>
    <url>/2020/07/18/2020-07-%E6%B5%8B%E8%AF%95.html</url>
    <content><![CDATA[<iframe src="https://video.520call.me/player101.php?id=101xxGDTXhHdHg=" frameborder="0" width="640" height="480" scrolling="no" allowfullscreen="allowfullscreen"></iframe>

<p>123</p>
<iframe src="https://video.520call.me/player101.php?id=101xxGDTXhHdHg=" frameborder="0" width="640" height="480" scrolling="no" allowfullscreen="allowfullscreen"></iframe>]]></content>
      <categories>
        <category>测试</category>
      </categories>
      <tags>
        <tag>测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco WSA网页安全设备</title>
    <url>/2020/07/30/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87.html</url>
    <content><![CDATA[<h1 id="功能介绍"><a href="#功能介绍" class="headerlink" title="功能介绍"></a>功能介绍</h1><ul>
<li>控制用户有效访问WWW</li>
<li>提供丰富、灵活、有效的控制策略<ul>
<li>基于类的URL过滤</li>
<li>用户认证</li>
<li>基于时间过滤</li>
<li>动态URL过滤</li>
<li>带宽控制</li>
<li>应用控制</li>
<li>云访问控制</li>
</ul>
</li>
<li>恶意软件和保护<ul>
<li>基于自带的引擎库对软件和数据包进行检查</li>
<li>同时支持第三方引擎库，需要额外购买授权</li>
<li>可以结合AMP进行检查和过滤</li>
</ul>
</li>
<li>结合Anyconnect执行网页访问控制<ul>
<li>基于Anyconnect拨号成功后的流量</li>
<li>依然需要经过WSA的访问控制</li>
</ul>
</li>
</ul>
<h1 id="设备介绍"><a href="#设备介绍" class="headerlink" title="设备介绍"></a>设备介绍</h1><h2 id="接口介绍"><a href="#接口介绍" class="headerlink" title="接口介绍"></a>接口介绍</h2><ul>
<li>T接口：主要用于四层流量监控（很少使用）</li>
<li>P接口：主要用于网页代理（主要功能接口）</li>
<li>M接口：主要用于网管流量（考试主要接口）<ul>
<li>可以转发管理流量</li>
<li>也可以转发代理流量</li>
</ul>
</li>
</ul>
<h1 id="设备初始化"><a href="#设备初始化" class="headerlink" title="设备初始化"></a>设备初始化</h1><ul>
<li>默认用户名：admin</li>
<li>默认密码：ironport</li>
</ul>
<h2 id="管理接口初始化"><a href="#管理接口初始化" class="headerlink" title="管理接口初始化"></a>管理接口初始化</h2><img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809003943800.png" alt="image-20200809003943800" style="zoom:50%;" />

<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809004106519.png" alt="image-20200809004106519" style="zoom:50%;" />

<h2 id="设定网关"><a href="#设定网关" class="headerlink" title="设定网关"></a>设定网关</h2><img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809004219519.png" alt="image-20200809004219519" style="zoom:50%;" />

<h2 id="保存配置"><a href="#保存配置" class="headerlink" title="保存配置"></a>保存配置</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ironport.example.com&gt; commit</span><br><span class="line"></span><br><span class="line">There <span class="keyword">is</span> no data to commit.</span><br><span class="line">Please run System Setup Wizard at http://<span class="number">7.7</span><span class="number">.1</span><span class="number">.30</span>:<span class="number">8080</span></span><br></pre></td></tr></table></figure>

<h2 id="命令行加载授权"><a href="#命令行加载授权" class="headerlink" title="命令行加载授权"></a>命令行加载授权</h2><h3 id="登陆FTP上传授权"><a href="#登陆FTP上传授权" class="headerlink" title="登陆FTP上传授权"></a>登陆FTP上传授权</h3><ul>
<li><a href="ftp://7.7.1.30">ftp://7.7.1.30</a></li>
<li>用户名和密码均为默认</li>
<li>找到configuration文件夹，将授权文件存放其中</li>
</ul>
<h3 id="加载授权"><a href="#加载授权" class="headerlink" title="加载授权"></a>加载授权</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ironport.example.com&gt; loadlicense</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> Paste via CLI</span><br><span class="line"><span class="number">2.</span> Load <span class="keyword">from</span> file</span><br><span class="line">How would you like to load a license file?</span><br><span class="line">[<span class="number">1</span>]&gt; <span class="number">2</span></span><br><span class="line"></span><br><span class="line">Enter the name of the file <span class="keyword">in</span> /configuration to <span class="keyword">import</span>:</span><br><span class="line">[license.xml]&gt; WSA.xml</span><br></pre></td></tr></table></figure>

<h2 id="执行图形界面初始化"><a href="#执行图形界面初始化" class="headerlink" title="执行图形界面初始化"></a>执行图形界面初始化</h2><pre class="mermaid">graph LR
  System_Administration--> System_Setup -->System_Setup_Wizard</pre>

<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809012602719.png" alt="image-20200809012602719" style="zoom:50%;" />

<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809012647821.png" alt="image-20200809012647821" style="zoom:50%;" />

<p>若上游含有其他代理服务器，需要在此处告知WSA</p>
<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809012855470.png" alt="image-20200809012855470" style="zoom:50%;" />

<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809013007255.png" alt="image-20200809013007255" style="zoom:50%;" />

<p>更改默认密码</p>
<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809013219023.png" alt="image-20200809013219023" style="zoom:50%;" />

<p>其余保持默认即可，一直下一步完成初始化。</p>
<h1 id="WCCP部分参照WCCP协议原理与应用"><a href="#WCCP部分参照WCCP协议原理与应用" class="headerlink" title="WCCP部分参照WCCP协议原理与应用"></a>WCCP部分参照<a href="http://localhost:443/2020/08/09/WCCP协议原理与应用.html" target="_blank" rel="noopener">WCCP协议原理与应用</a></h1><h1 id="Proxy应用与部署"><a href="#Proxy应用与部署" class="headerlink" title="Proxy应用与部署"></a>Proxy应用与部署</h1><h2 id="WSA的两种代理方式"><a href="#WSA的两种代理方式" class="headerlink" title="WSA的两种代理方式"></a>WSA的两种代理方式</h2><ul>
<li>透明代理<ul>
<li>对应WCCP</li>
<li>客户端无须执行任何配置</li>
<li>代理服务器对客户端认证执行困难</li>
</ul>
</li>
<li>明确代理<ul>
<li>客户端需要执行配置</li>
<li>代理服务器对客户端认证执行简单</li>
</ul>
</li>
</ul>
<h2 id="明确代理实验（了解即可）"><a href="#明确代理实验（了解即可）" class="headerlink" title="明确代理实验（了解即可）"></a>明确代理实验（了解即可）</h2><ul>
<li>基于客户端直接部署配置</li>
<li>基于客户端PAC文件实现部署</li>
</ul>
<h3 id="去除WCCP配置"><a href="#去除WCCP配置" class="headerlink" title="去除WCCP配置"></a>去除WCCP配置</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">no wccp interface Inside <span class="number">90</span> redirect <span class="keyword">in</span></span><br></pre></td></tr></table></figure>

<h3 id="查看WSA上默认开启的代理"><a href="#查看WSA上默认开启的代理" class="headerlink" title="查看WSA上默认开启的代理"></a>查看WSA上默认开启的代理</h3><p>security_services/web_proxy</p>
<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809024603937.png" alt="image-20200809024603937" style="zoom:50%;" />

<h4 id="直接部署配置"><a href="#直接部署配置" class="headerlink" title="直接部署配置"></a>直接部署配置</h4><img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809024914535.png" alt="image-20200809024914535" style="zoom:50%;" />

<h4 id="基于PAC文件部署"><a href="#基于PAC文件部署" class="headerlink" title="基于PAC文件部署"></a>基于PAC文件部署</h4><p>1）创建TXT，内容如下，定义了代理服务器的IP地址和端口号，然后更改后缀名为.pac</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">function FindProxyForURL(url,host)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"PROXY 7.7.2.30:80, DIRECT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）将文件上传到WSA中，security_services/web_proxy/pac_file_hosting</p>
<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809025523336.png" alt="image-20200809025523336" style="zoom:50%;" />

<p>3）客户端配置代理</p>
<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809025704260.png" alt="image-20200809025704260" style="zoom:50%;" />

<h2 id="透明代理实验（考点）"><a href="#透明代理实验（考点）" class="headerlink" title="透明代理实验（考点）"></a>透明代理实验（考点）</h2><p>1）防火墙恢复WCCP代理</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wccp interface Inside <span class="number">90</span> redirect <span class="keyword">in</span></span><br></pre></td></tr></table></figure>

<p>2）WSA默认HTTPS代理没有开启</p>
<p>security_services/web_proxy/https_proxy，点击右边enable and edit settings</p>
<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809030026406.png" alt="image-20200809030026406" style="zoom:50%;" />

<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809030405855.png" alt="image-20200809030405855" style="zoom:50%;" />

<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809030327941.png" alt="image-20200809030327941" style="zoom:50%;" />

<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809030515335.png" alt="image-20200809030515335" style="zoom:50%;" />

<h1 id="认证配置"><a href="#认证配置" class="headerlink" title="认证配置"></a>认证配置</h1><h2 id="认证支持模式"><a href="#认证支持模式" class="headerlink" title="认证支持模式"></a>认证支持模式</h2><ul>
<li>网页认证</li>
<li>集成AD域认证（一次性认证SSO）</li>
</ul>
<h2 id="认证支持的代理模式"><a href="#认证支持的代理模式" class="headerlink" title="认证支持的代理模式"></a>认证支持的代理模式</h2><ul>
<li>明确代理<ul>
<li>WSA直接给客户端发送407</li>
<li>407代表客户端需要先执行认证后执行访问</li>
</ul>
</li>
<li>透明代理<ul>
<li>客户端流量被重定向到WSA</li>
<li>客户端收到来自于服务器发送’307’，被告知需要前往WSA执行认证</li>
<li>客户端连接到WSA</li>
<li>客户端收到来自于WSA发送’401’，开始认证认证通过后，WSA将客户端流量重定向到服务器</li>
<li>客户端访问服务器</li>
<li><strong>本质上，所有来自于服务器发送给客户端的数据，都是WSA伪装发送的</strong></li>
</ul>
</li>
</ul>
<h2 id="WSA配置认证"><a href="#WSA配置认证" class="headerlink" title="WSA配置认证"></a>WSA配置认证</h2><p>network/identity_services/authentication</p>
<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809032054035.png" alt="image-20200809032054035" style="zoom:50%;" />

<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809032442098.png" alt="image-20200809032442098" style="zoom:50%;" />

<h2 id="WSA将NTP服务器指向AD域"><a href="#WSA将NTP服务器指向AD域" class="headerlink" title="WSA将NTP服务器指向AD域"></a>WSA将NTP服务器指向AD域</h2><p>system_administration/system_time/time_settings</p>
<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809032750928.png" alt="image-20200809032750928" style="zoom:50%;" />

<h2 id="WSA入域"><a href="#WSA入域" class="headerlink" title="WSA入域"></a>WSA入域</h2><p>network/identity_services/authentication</p>
<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809032909090.png" alt="image-20200809032909090" style="zoom:50%;" />

<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809033221908.png" alt="image-20200809033221908" style="zoom:50%;" />

<p>输入域管理员用户和密码加入域<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809033306923.png" alt="image-20200809033306923" style="zoom:50%;" /></p>
<h2 id="配置全局认证"><a href="#配置全局认证" class="headerlink" title="配置全局认证"></a>配置全局认证</h2><p>web_security_manager/authentication/identities</p>
<h3 id="添加新的认证策略"><a href="#添加新的认证策略" class="headerlink" title="添加新的认证策略"></a>添加新的认证策略</h3><img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809033534211.png" alt="image-20200809033534211" style="zoom:50%;" />

<img src="../../../../images/Cisco%20WSA%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87/image-20200809033649070.png" alt="image-20200809033649070" style="zoom:50%;" />

<h1 id="访问控制策略"><a href="#访问控制策略" class="headerlink" title="访问控制策略"></a>访问控制策略</h1>]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>WSA</tag>
        <tag>WCCP</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco配置PPPoe</title>
    <url>/2020/07/22/Cisco%E9%85%8D%E7%BD%AEPPPoe.html</url>
    <content><![CDATA[<h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>PPPoE 是目前家庭宽带的主流接入方式。看完本文之后，您或许就可以把思科的企业级路由器当作家里的主路由器了，</p>
<hr>
<h2 id="二、拓扑图-amp-需求"><a href="#二、拓扑图-amp-需求" class="headerlink" title="二、拓扑图 &amp; 需求"></a>二、拓扑图 &amp; 需求</h2><img src="../../../../images/Cisco%E9%85%8D%E7%BD%AEPPPoe/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7-2018-05-27-15.14.55.jpg" alt="img" style="zoom:50%;" />

<p>家里刚拉了一条宽带，ISP 要求使用 PPPoE 进行接入。</p>
<p>PPPoE 的用户名是 <code>cisco</code>，密码是 <code>123</code>。</p>
<p>现在要用一台思科的路由器作为主路由器让家里的设备都能上网。</p>
<p><code>e0/0</code> 接口连接外网，<code>e0/1</code> 接口连接内网。</p>
<p>内网的网段是 <code>192.168.1.0/24</code>，路由器的内网 IP 是 <code>192.168.1.1/24</code>。</p>
<hr>
<h2 id="三、操作步骤"><a href="#三、操作步骤" class="headerlink" title="三、操作步骤"></a>三、操作步骤</h2><p>（路由器已经恢复出厂设置）</p>
<h3 id="进入配置模式"><a href="#进入配置模式" class="headerlink" title="进入配置模式"></a>进入配置模式</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Router&gt;enable</span><br><span class="line">Router#configure terminal</span><br></pre></td></tr></table></figure>

<h3 id="配置物理接口"><a href="#配置物理接口" class="headerlink" title="配置物理接口"></a>配置物理接口</h3><p><code>e0/0</code> 接口</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Router(config)<span class="comment">#interface ethernet 0/0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#no ip address         //物理接口不要配置 IP 地址</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#pppoe-client dial-pool-number 1   //作为 PPPoE 客户端并加入 1 号拨号池</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#no shutdown </span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#exit</span></span><br></pre></td></tr></table></figure>

<p><code>e0/1</code> 接口</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Router(config)<span class="comment">#interface ethernet 0/1</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#ip address 192.168.1.1 255.255.255.0</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#ip nat inside                         //设为 NAT 内部接口</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#no shutdown </span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#exit</span></span><br></pre></td></tr></table></figure>

<h3 id="配置-PPPoE-接口"><a href="#配置-PPPoE-接口" class="headerlink" title="配置 PPPoE 接口"></a>配置 PPPoE 接口</h3><p>用于拨号的 <code>dialer0</code> 虚拟接口</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Router(config)<span class="comment">#interface dialer 1</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#encapsulation ppp         </span></span><br><span class="line"><span class="comment">#使用 PPP 协议封装</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#ip address negotiated     </span></span><br><span class="line"><span class="comment">#使用 PPP 协议自动获取 IP 地址</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#ppp ipcp route default    </span></span><br><span class="line"><span class="comment">#自动设置默认路由</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#dialer pool 1            </span></span><br><span class="line"><span class="comment">#加入 1 号拨号池</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#ppp chap hostname cisco              </span></span><br><span class="line"><span class="comment">#设置 CHAP 身份验证使用的用户名</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#ppp chap password 123  </span></span><br><span class="line"><span class="comment">#设置 CHAP 身份验证使用的密码</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#ppp ipcp route default</span></span><br><span class="line"><span class="comment">#获取默认路由</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#ip nat outside                       </span></span><br><span class="line"><span class="comment">#设为 NAT 外部接口</span></span><br><span class="line">Router(config-<span class="keyword">if</span>)<span class="comment">#exit</span></span><br></pre></td></tr></table></figure>

<h3 id="配置-DHCP-服务器"><a href="#配置-DHCP-服务器" class="headerlink" title="配置 DHCP 服务器"></a>配置 DHCP 服务器</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Router(config)<span class="comment">#ip dhcp pool lan     // 创建一个名为 lan 的 DHCP 地址池</span></span><br><span class="line">Router(dhcp-config)<span class="comment">#network 192.168.1.0 255.255.255.0   // 设置地址池的网段</span></span><br><span class="line">Router(dhcp-config)<span class="comment">#default-router 192.168.1.1          // 设置默认网关</span></span><br><span class="line">Router(dhcp-config)<span class="comment">#dns-server 8.8.8.8 8.8.4.4          // 设置 DNS 服务器</span></span><br><span class="line">Router(dhcp-config)<span class="comment">#exit</span></span><br></pre></td></tr></table></figure>

<h3 id="配置-NAT"><a href="#配置-NAT" class="headerlink" title="配置 NAT"></a>配置 NAT</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Router(config)<span class="comment">#access-list 1 permit 192.168.1.0 0.0.0.255   //设置一条包含内网网段的 ACL 规则</span></span><br><span class="line">Router(config)<span class="comment">#ip nat inside source list 1 interface dialer 1 overload  // 把来自内网网段访问外网的流量进行 PAT 转换</span></span><br></pre></td></tr></table></figure>

<h3 id="保存设置-amp-退出"><a href="#保存设置-amp-退出" class="headerlink" title="保存设置 &amp; 退出"></a>保存设置 &amp; 退出</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Router(config)<span class="comment">#exit</span></span><br><span class="line">Router<span class="comment">#write </span></span><br><span class="line">Router<span class="comment">#exit</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四、检查结果"><a href="#四、检查结果" class="headerlink" title="四、检查结果"></a>四、检查结果</h2><h3 id="检查-PPPoE-接口"><a href="#检查-PPPoE-接口" class="headerlink" title="检查 PPPoE 接口"></a>检查 PPPoE 接口</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Router<span class="comment">#show ip interface brief | section Dialer1</span></span><br><span class="line"></span><br><span class="line">Dialer1                   <span class="number">192.168</span><span class="number">.18</span><span class="number">.103</span>  YES IPCP   up                    up</span><br></pre></td></tr></table></figure>

<p>如果拨号接口有 IP 地址，且状态为 up，说明工作正常。</p>
<h3 id="检查-DHCP-服务器"><a href="#检查-DHCP-服务器" class="headerlink" title="检查 DHCP 服务器"></a>检查 DHCP 服务器</h3><p>配置内网主机通过 DHCP 自动获取 IP。如果可以获取到 IP，说明 DHCP 服务器配置正确。</p>
<p>内网主机获取 IP 之后可以在路由器上检查下 DHCP 地址池的分配情况。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Router<span class="comment">#show ip dhcp binding</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Bindings <span class="keyword">from</span> all pools <span class="keyword">not</span> associated <span class="keyword">with</span> VRF:</span><br><span class="line">IP address          Client-ID/          Lease expiration        Type</span><br><span class="line">            Hardware address/</span><br><span class="line">            User name</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>         <span class="number">0150.0100</span><span class="number">.0200</span><span class="number">.00</span>       May <span class="number">28</span> <span class="number">2018</span> <span class="number">04</span>:<span class="number">11</span> PM    Automatic</span><br></pre></td></tr></table></figure>

<h3 id="检查能否上网"><a href="#检查能否上网" class="headerlink" title="检查能否上网"></a>检查能否上网</h3><p>在内网主机上随便打开一个网页。如果可以打开，说明 NAT 以及路由配置正确。</p>
<p>打开网页之后可以在路由器检查下 NAT 的工作情况。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Router<span class="comment">#show ip nat translations</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Pro Inside <span class="keyword">global</span>      Inside local       Outside local      Outside <span class="keyword">global</span></span><br><span class="line">tcp <span class="number">192.168</span><span class="number">.18</span><span class="number">.103</span>:<span class="number">49215</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>:<span class="number">49215</span> <span class="number">117.18</span><span class="number">.237</span><span class="number">.29</span>:<span class="number">80</span>  <span class="number">117.18</span><span class="number">.237</span><span class="number">.29</span>:<span class="number">80</span></span><br><span class="line">tcp <span class="number">192.168</span><span class="number">.18</span><span class="number">.103</span>:<span class="number">49232</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>:<span class="number">49232</span> <span class="number">52.37</span><span class="number">.11</span><span class="number">.39</span>:<span class="number">443</span>   <span class="number">52.37</span><span class="number">.11</span><span class="number">.39</span>:<span class="number">443</span></span><br><span class="line">tcp <span class="number">192.168</span><span class="number">.18</span><span class="number">.103</span>:<span class="number">49233</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>:<span class="number">49233</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">80</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">80</span></span><br><span class="line">tcp <span class="number">192.168</span><span class="number">.18</span><span class="number">.103</span>:<span class="number">49234</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>:<span class="number">49234</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">443</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">443</span></span><br><span class="line">tcp <span class="number">192.168</span><span class="number">.18</span><span class="number">.103</span>:<span class="number">49235</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>:<span class="number">49235</span> <span class="number">202.108</span><span class="number">.23</span><span class="number">.152</span>:<span class="number">443</span> <span class="number">202.108</span><span class="number">.23</span><span class="number">.152</span>:<span class="number">443</span></span><br><span class="line">tcp <span class="number">192.168</span><span class="number">.18</span><span class="number">.103</span>:<span class="number">49236</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>:<span class="number">49236</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">80</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">80</span></span><br><span class="line">tcp <span class="number">192.168</span><span class="number">.18</span><span class="number">.103</span>:<span class="number">49237</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>:<span class="number">49237</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">80</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">80</span></span><br><span class="line">tcp <span class="number">192.168</span><span class="number">.18</span><span class="number">.103</span>:<span class="number">49238</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>:<span class="number">49238</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">80</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">80</span></span><br><span class="line">tcp <span class="number">192.168</span><span class="number">.18</span><span class="number">.103</span>:<span class="number">49239</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>:<span class="number">49239</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">80</span> <span class="number">163.177</span><span class="number">.131</span><span class="number">.52</span>:<span class="number">80</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="五、PPPOE-Server配置："><a href="#五、PPPOE-Server配置：" class="headerlink" title="五、PPPOE Server配置："></a>五、PPPOE Server配置：</h2><h3 id="添加拨号用的用户名密码"><a href="#添加拨号用的用户名密码" class="headerlink" title="添加拨号用的用户名密码"></a>添加拨号用的用户名密码</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">username cisco password <span class="number">0</span> <span class="number">123</span></span><br></pre></td></tr></table></figure>

<h3 id="建立bba拨号组"><a href="#建立bba拨号组" class="headerlink" title="建立bba拨号组"></a>建立bba拨号组</h3><p>bba-group 是一个虚拟的拨号组，在以前的ios中，pppoe拨号是嵌入到vpnd中的，后来思科将pppoe从VPND中移植出来，嵌入到BBA组中。Virtual-template是设备所使用的虚拟访问接口，一个pppoe的拨号连接就属于虚拟访问一种，该接口上存放着与虚拟访问有关的三层和二层信息，所以要把virtual-template与BBA-GROUP关联起来。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">bba-group pppoe name</span><br><span class="line"><span class="comment"># 创建拨号组name</span></span><br><span class="line"> virtual-template <span class="number">1</span></span><br><span class="line">  <span class="comment"># 关联虚拟模版1</span></span><br></pre></td></tr></table></figure>

<h3 id="配置虚拟模版"><a href="#配置虚拟模版" class="headerlink" title="配置虚拟模版"></a>配置虚拟模版</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">interface Virtual-Template1 </span><br><span class="line"><span class="comment"># 进入虚拟模版配置</span></span><br><span class="line"> ip unnumbered FastEthernet0/<span class="number">1</span></span><br><span class="line">  <span class="comment"># 配置该接口向f0/1接口借用地址，当然也可以自己配</span></span><br><span class="line"> peer default ip address pool name</span><br><span class="line"><span class="comment"># 为pppoe客户端分配的一个叫name地址池</span></span><br><span class="line"> ppp authentication chap</span><br><span class="line">  <span class="comment"># 使用chap认证</span></span><br></pre></td></tr></table></figure>

<h3 id="配置pppoe客户端的地址池name"><a href="#配置pppoe客户端的地址池name" class="headerlink" title="配置pppoe客户端的地址池name"></a>配置pppoe客户端的地址池name</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ip local pool name <span class="number">192.168</span><span class="number">.18</span><span class="number">.103</span></span><br></pre></td></tr></table></figure>

<h3 id="进入接口关联bba组"><a href="#进入接口关联bba组" class="headerlink" title="进入接口关联bba组"></a>进入接口关联bba组</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">interface FastEthernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.18</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"> pppoe enable group e0/<span class="number">1</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Cisco</tag>
        <tag>PPPoE</tag>
      </tags>
  </entry>
  <entry>
    <title>绿盟WEB应用防护系统WAF操作手册</title>
    <url>/2020/07/21/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C.html</url>
    <content><![CDATA[<h1 id="登陆"><a href="#登陆" class="headerlink" title="登陆"></a>登陆</h1><table>
<thead>
<tr>
<th></th>
<th align="center">用户名</th>
<th>密码</th>
</tr>
</thead>
<tbody><tr>
<td>Web管理员</td>
<td align="center">admin</td>
<td>admin</td>
</tr>
<tr>
<td>Web审计员</td>
<td align="center">auditor</td>
<td>auditor</td>
</tr>
<tr>
<td>串口管理员（6061版本以后）</td>
<td align="center">nsadmin</td>
<td>nsadmin</td>
</tr>
<tr>
<td>串口管理员（6061版本以前）</td>
<td align="center">conadmin</td>
<td>conadmin</td>
</tr>
<tr>
<td>维护账户</td>
<td align="center">maintainer</td>
<td>maintainer</td>
</tr>
</tbody></table>
<h1 id="部署上线流程"><a href="#部署上线流程" class="headerlink" title="部署上线流程"></a>部署上线流程</h1><pre class="mermaid">graph LR
部署模式-->网络接口-->防护站点-->虚拟站点-->防护策略</pre>

<h1 id="部署模式"><a href="#部署模式" class="headerlink" title="部署模式"></a>部署模式</h1><h2 id="串联部署"><a href="#串联部署" class="headerlink" title="串联部署"></a>串联部署</h2><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>不改动原有网络拓扑</li>
<li>不增加网络设备的接口</li>
<li>WAF关机不能影响服务器的访问</li>
<li>需要在server端管理</li>
</ul>
<img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812152903549.png" alt="image-20200812152903549" style="zoom:50%;" />

<h3 id="配置方法"><a href="#配置方法" class="headerlink" title="配置方法"></a>配置方法</h3><ul>
<li><p>部署模式<img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812152944623.png" alt="image-20200812152944623" style="zoom:50%;" /></p>
</li>
<li><p>部署网络接口，创建工作组，选择bypass接口<img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812153011708.png" alt="image-20200812153011708" style="zoom:50%;" /></p>
</li>
<li><p>带内管理/带外管理<img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812153200285.png" alt="image-20200812153200285" style="zoom:50%;" /></p>
</li>
<li><p>防护站点<img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812153258290.png" alt="image-20200812153258290" style="zoom:50%;" /></p>
<ul>
<li>需要与客户确认<ul>
<li>站点<ul>
<li>IP+端口</li>
</ul>
</li>
<li>确认信息：<ul>
<li>HTTP还是HTTPS：HTTP</li>
<li>服务器的IP和端口：192.168.0.6:80</li>
<li>对服务器熟悉程度：很熟悉，操作系统是Linux/Unix，WEB服务器是Nginx，数据库是Mysql，开发语言不限制。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>虚拟站点</p>
<ul>
<li>域名</li>
<li>确认信息：<ul>
<li>防护的域名：</li>
<li>检测的URL：</li>
<li>不检测的URL：</li>
</ul>
</li>
</ul>
</li>
<li><p>防护策略<img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812153816419.png" alt="image-20200812153816419" style="zoom:50%;" /></p>
</li>
<li><p><font color="#dd00">上线前的注意事项</font></p>
<ul>
<li>确认WAF的系统版本为最新，可以参考update.nsfocus.com中WAF的版本号</li>
<li>在无要求的情况下不建议开启ARP防护</li>
<li>配置完规则以后，先将动作设置为接受或开启一键接受、内置解码失败动作改为放过，上线一周查看日志，根据日志开始策略优化流程</li>
</ul>
</li>
</ul>
<blockquote>
<p>快速模式：<br>    当使用快速模式进行站点安全配置的时候，会自动生成一套安全解决方案，该安全方案中会加载系统的默认配置策略，但该解决方案不会对任何服务器生效，如果需对指定的服务器进行安全防护，请在完成该模式后，在站点组管理中，添加对应的服务器信息。</p>
<p>向导模式：<br>    当使用向导模式进行站点安全配置的时候，向导会引导用户配置需要保护站点信息，及Web服务器基本配置信息。根据用户配置的服务器信息，自动生成一套安全解决方案。客户对服务器环境很了解时可以使用向导模式减少误报。</p>
<p>点击问号，向导模式生成的防护模板有说明。</p>
</blockquote>
<h2 id="旁路部署"><a href="#旁路部署" class="headerlink" title="旁路部署"></a>旁路部署</h2><h3 id="配置接口"><a href="#配置接口" class="headerlink" title="配置接口"></a>配置接口</h3><p><img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812154440105.png" alt="image-20200812154440105" style="zoom:50%;" /><img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812154508581.png" alt="image-20200812154508581" style="zoom:50%;" /><img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812154520813.png" alt="image-20200812154520813" style="zoom:50%;" /><img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812154546195.png" alt="image-20200812154546195" style="zoom:50%;" /><img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812154610099.png" alt="image-20200812154610099" style="zoom:50%;" /><img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812154629668.png" alt="image-20200812154629668" style="zoom:50%;" /></p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>静态路由：用来指定HTTP协议流量从WAF的哪一个口回注到交换机上，进而达到客户端或者服务器，是对HTTP协议流量进行的回注牵引。</li>
<li>回注路由：用来指定非HTTP协议流量从WAF的哪个端口回注到交换机，进而达到客户端或者服务器，是对非HTTP协议流量进行的回注牵引。</li>
<li>常见问题：WAF旁路部署时，无法访问被防护服务器的非HTTP服务。</li>
</ul>
<h2 id="反向代理部署"><a href="#反向代理部署" class="headerlink" title="反向代理部署"></a>反向代理部署</h2><h3 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h3><p>不希望把WEB服务器暴露在公网</p>
<img src="../../../../images/%E7%BB%BF%E7%9B%9FWEB%E5%BA%94%E7%94%A8%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FWAF%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/image-20200812154921435.png" alt="image-20200812154921435" style="zoom:50%;" />

<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>客户端与服务器互相均不可见</li>
<li>只转发代理策略匹配的HTTP流量</li>
<li>需要更改DNS指向</li>
<li>客户端IP地址添加到请求的X-Forwarded-For域</li>
</ul>
]]></content>
      <categories>
        <category>绿盟</category>
      </categories>
      <tags>
        <tag>绿盟</tag>
        <tag>WAF</tag>
      </tags>
  </entry>
  <entry>
    <title>绿盟统一威胁探针UTS</title>
    <url>/2020/07/21/%E7%BB%BF%E7%9B%9F%E7%BB%9F%E4%B8%80%E5%A8%81%E8%83%81%E6%8E%A2%E9%92%88UTS%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C.html</url>
    <content><![CDATA[<p>UTS(Unified Threat Sensor)绿盟统一威胁探针，也可以作为绿盟全流量威胁分析系统的探针，用于采集原始数据流量并对流量的传输层、应用层协议解析，同时兼具安全规则检测、文件还原、原始数据存储等能力。此外，探针将解析的流量日志、告警日志及文件数据上传到上层平台进行安全分析，为平台提供数据支撑。</p>
<h1 id="出厂参数"><a href="#出厂参数" class="headerlink" title="出厂参数"></a>出厂参数</h1><table>
<thead>
<tr>
<th>IP地址</th>
<th align="center"><a href="https://192.168.1.1" target="_blank" rel="noopener">https://192.168.1.1</a></th>
</tr>
</thead>
<tbody><tr>
<td>子网掩码</td>
<td align="center">255.255.255.0</td>
</tr>
<tr>
<td>Web界面超级管理员初始账户</td>
<td align="center">admin</td>
</tr>
<tr>
<td>Web界面超级管理员初始密码</td>
<td align="center">admin</td>
</tr>
<tr>
<td>Console初始账户</td>
<td align="center">conadmin</td>
</tr>
<tr>
<td>Console初始密码</td>
<td align="center">conadmin</td>
</tr>
</tbody></table>
<h1 id="配置流程"><a href="#配置流程" class="headerlink" title="配置流程"></a>配置流程</h1><pre class="mermaid">graph LR
    开始 --> 配置管理接口-->配置网关-->导入证书-->配置安全中心-->配置策略-->实时监控-->结束</pre>

<h1 id="串口配置菜单简介"><a href="#串口配置菜单简介" class="headerlink" title="串口配置菜单简介"></a>串口配置菜单简介</h1><table>
<thead>
<tr>
<th>配置项</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td>Init Network</td>
<td align="center">初始化网络–配置管理接口和网关</td>
</tr>
<tr>
<td>Bind Hardware</td>
<td align="center">绑定设备硬件信息</td>
</tr>
<tr>
<td>Reset Apache Password</td>
<td align="center">重置 web 登录密码</td>
</tr>
<tr>
<td>[close]Remote assist</td>
<td align="center">开启/关闭远程协助–SSH 访问开启/关闭</td>
</tr>
<tr>
<td>Show ip address</td>
<td align="center">展示管理网络地址</td>
</tr>
<tr>
<td>Exit</td>
<td align="center">退出串口配置界面</td>
</tr>
</tbody></table>
<h1 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h1><h2 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h2><h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>接口配置用于查看 UTS 的接口，以及配置 UTS 的管理口的网络接口地址。管理口分别为 M 口和 H1 口，M 口一般用作管理，H1 口则用作和 BSA 联动。</p>
<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>UTS 优先通过首选 DNS 服务器解析域名。当首选 DNS 服务器失效时，UTS 通过备用 DNS 服务器解析域名。</p>
<pre class="mermaid">graph LR
    系统-->系统配置-->DNS-->分别设置首选和备选DNS服务器的IP地址-->应用</pre>

<h2 id="账号管理"><a href="#账号管理" class="headerlink" title="账号管理"></a>账号管理</h2><h3 id="启用缺省审计员"><a href="#启用缺省审计员" class="headerlink" title="启用缺省审计员"></a>启用缺省审计员</h3><p>缺省审计员 auditor 的启用只能由缺省操作员 admin 进行（<strong>默认不启用</strong>）。而且，缺省审计员 auditor 一经启用便不能取消启用。（<strong>日志只能审计员查看，admin无法查看并且如果没有配置syslog服务器，重启后将丢失所有日志</strong>）</p>
<pre class="mermaid">graph LR
    系统-->账号管理-->启用auditor账户-->设置初始密码-->确定</pre>

<h2 id="系统控制"><a href="#系统控制" class="headerlink" title="系统控制"></a>系统控制</h2><ul>
<li>【应用配置】：所有策略将被重新加载生效。</li>
<li>【重启引擎】：重新启动 UTS 的引擎系统。重启系统后，所有策略和配置都将被重新加载生效。 </li>
<li>【重启系统】：重新启动 UTS 的整个硬件系统。</li>
<li>【关闭系统】：关闭 UTS 的整个硬件系统。</li>
</ul>
<h1 id="策略"><a href="#策略" class="headerlink" title="策略"></a>策略</h1><h2 id="元数据还原"><a href="#元数据还原" class="headerlink" title="元数据还原"></a>元数据还原</h2><p>UTS 提供第四层流量和应用层协议的数据解析功能，提取协议元数据后，组装成日志并发送给 TAM。可以设置对哪些协议及应用的数据进行解析还原。</p>
<h2 id="入侵防护"><a href="#入侵防护" class="headerlink" title="入侵防护"></a>入侵防护</h2><h3 id="入侵防护策略"><a href="#入侵防护策略" class="headerlink" title="入侵防护策略"></a>入侵防护策略</h3><p>UTS 支持的入侵防护策略包括两种：</p>
<ul>
<li><p><strong>入侵防护检测</strong>：开启入侵检测功能后，UTS 可以针对已知和未知攻击产生告警日志，同时对于各种黑客攻击（如缓冲区溢出、SQL 注入、暴力猜测、拒绝服务、扫描探测、非授权访问、蠕虫病毒、僵尸网络等）也会产生告警日志。 </p>
</li>
<li><p><strong>Web</strong> <strong>攻击检测</strong>：开启 Web 安全检测功能后，UTS 可以实现基于 HTTP 流量的 Web攻击检测功能，支持检测 SQL 注入、XSS、exec、phprce、ptravel、jeli 等主流攻击类型。</p>
</li>
</ul>
<h3 id="Dos防护策略"><a href="#Dos防护策略" class="headerlink" title="Dos防护策略"></a>Dos防护策略</h3><p>DoS 拒绝服务攻击最常见的有计算机网络带宽入侵和连通性入侵。带宽入侵是制造超过网络最大承载力的数据流量冲击网络，占用所有可用网络资源，达到拒绝服务的目的。连通性入侵是指制造大量的连接请求访问计算机，耗尽所有的操作系统资源，达到拒绝服务的目的。</p>
<p>UTS 内置 DoS 防护模块，可以有效检测并抵御常见的攻击，操作员通过配置 DoS 防护策略，可以保护指定的网络对象免于受到以下类型的攻击：<strong>Flood 攻击、PortScan 攻击、PINGSweep 攻击和 ARPSpoof 攻击</strong>。</p>
<h4 id="Flood攻击"><a href="#Flood攻击" class="headerlink" title="Flood攻击"></a>Flood攻击</h4><p>Flood 攻击是指攻击者向攻击目标发送大量的虚假请求，被攻击者不断应答这些无用信息，而合法的用户却无法得到相应的服务，即发生拒绝服务。</p>
<h4 id="PortScan攻击"><a href="#PortScan攻击" class="headerlink" title="PortScan攻击"></a>PortScan攻击</h4><p>PortScan（端口扫描）攻击是指攻击者通过扫描攻击目标的 TCP 端口或者 UDP 端口确定该主机开启的服务，为进一步侵入目标主机做准备。</p>
<h4 id="PINGSweep-攻击"><a href="#PINGSweep-攻击" class="headerlink" title="PINGSweep 攻击"></a>PINGSweep 攻击</h4><p>PINGSweep 攻击是指攻击者通过 PINGSweep（即 Ping 扫描）方式探测网络上存活的主机，以便大致了解攻击目标提供的服务种类和潜在的安全漏洞，为进一步侵入目标主机做准备。</p>
<h4 id="ARPSpoof防护策略"><a href="#ARPSpoof防护策略" class="headerlink" title="ARPSpoof防护策略"></a>ARPSpoof防护策略</h4><p>ARPSpoof 攻击是指攻击者通过伪造 IP 地址和 MAC 地址实现 ARP 欺骗，从而导致网络不稳定甚至断网，并且可以进一步攻击中间人，以此非法获取游戏、网银、文件服务等系统的帐号和密码。</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td>检测阈值(端口数)</td>
<td align="center">当 UTS 在检测周期内检测到从同一个源 IP 地址发出报文的不同目的端口个数达到或超过了指定的检测阈值时，即认为发生了攻击。</td>
</tr>
<tr>
<td>检测周期(秒)</td>
<td align="center">PortScan 攻击的检测周期。</td>
</tr>
<tr>
<td>复位时间(秒)</td>
<td align="center">每隔此处配置的时间，UTS 就会将检测数据清零，重新开始检测。</td>
</tr>
</tbody></table>
<h2 id="文件还原"><a href="#文件还原" class="headerlink" title="文件还原"></a>文件还原</h2><p>UTS 支持文件还原功能，UTS 能够对 HTTP、FTP、POP3、IMAP、SMTP 等应用层协 议传输的文件进行识别，并解码和提取文件内容。之后，UTS 将文件内容发送给 TAM， 由 TAM 派发给 TAC 来进行文件恶意行为分析。</p>
<p>UTS 支持还原的文件类型包括：</p>
<ul>
<li><p>PE 类：exe、dll、bat、com、src、pif； </p>
</li>
<li><p>文档类：doc/docx、xls/xlsx、ppt/pptx、pdf、rtf、wps、wpt、dot、dps、dpt、pot、pps、et、 ett、mpp、xlt； </p>
</li>
<li><p>压缩包：zip、rar、7z、gzip、tar、bz、bz2。 </p>
</li>
</ul>
<blockquote>
<ul>
<li><p>选择菜单 <strong>系统设置</strong> <strong>&gt;</strong> <strong>专业参数</strong>，可以设置 UTS 系统可还原的文件长度的最大值，如果超过最大长度，则 UTS 将不进行文件的还原。默认是 10M，最大可配置为 100M。 </p>
</li>
<li><p>当还原文件大小占用空间为最大容量的 90%时，UTS 将自动删除老的还原文件，其规律为：依次删除文件超过 48h、24h、12h、6h、1h、30mim 的文件。 </p>
</li>
</ul>
</blockquote>
<h2 id="流量存储"><a href="#流量存储" class="headerlink" title="流量存储"></a>流量存储</h2><p>开启流量存储功能后，UTS 可以将原始流量高速存储在本地的硬盘中，并记录索引。同时，UTS 对 TAM 提供检索接口，当 UTS 接收到 TAM 下发的查询任务后，会开始检索，然后将查询结果存储在 PCAP 文件中，并将下载链接反馈给 TAM。 </p>
<h2 id="资产范围"><a href="#资产范围" class="headerlink" title="资产范围"></a>资产范围</h2><p>只有在资产范围中配置的地址对象，UTS 才会在流量日志中记录数据的方向。</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th align="center">表头</th>
</tr>
</thead>
<tbody><tr>
<td>名称</td>
<td align="center">网络对象的名称，用于在 UTS 中唯一标识该网络对象。名称中不能包含如下特殊字符：%、\、`、&lt;、&gt;、’、&amp;、”。</td>
</tr>
<tr>
<td>IP地址</td>
<td align="center">子网对象的 IP 地址，支持 IPv4。IP 地址的输入格式为“IP 地址/掩码”。</td>
</tr>
<tr>
<td>取反</td>
<td align="center">是否对 IP 地址取反。<br />“取反”表示将设定 IP 地址以外的地址作为该子网对象的有效 IP 地址。</td>
</tr>
</tbody></table>
<h2 id="白名单管理"><a href="#白名单管理" class="headerlink" title="白名单管理"></a>白名单管理</h2><p>UTS 可以设置 IP 地址、域名、端口和邮箱地址的白名单，如果命中白名单，则 UTS 将不再对匹配条件的数据包的流量进行存储，也不再进行元数据还原、文件还原和入侵防护检测。</p>
<p>白名单功能默认为启用状态，管理员可以随时启用或禁用该功能，只有启用后，下面配置的白名单才会生效。</p>
]]></content>
      <categories>
        <category>绿盟</category>
      </categories>
      <tags>
        <tag>绿盟</tag>
        <tag>UTS</tag>
      </tags>
  </entry>
  <entry>
    <title>绿盟网络入侵防护系统NIPS操作手册</title>
    <url>/2020/07/21/%E7%BB%BF%E7%9B%9F%E7%BD%91%E7%BB%9C%E5%85%A5%E4%BE%B5%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9FNIPS%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C.html</url>
    <content><![CDATA[<h1 id="初始化参数"><a href="#初始化参数" class="headerlink" title="初始化参数"></a>初始化参数</h1><table>
<thead>
<tr>
<th align="center">IP地址</th>
<th align="center">M:192.168.1.1<br />H1:192.168.2.1（H1 口是否存在视硬件平台而定）255.255.255.0<br />G1/1:0.0.0.0<br />G1/2:0.0.0.0<br />……（除管理口外，其余工作口初始 IP 均为 0.0.0.0）</th>
</tr>
</thead>
<tbody><tr>
<td align="center">子网掩码</td>
<td align="center">255.255.255.0</td>
</tr>
<tr>
<td align="center">Web操作员/密码</td>
<td align="center">admin</td>
</tr>
<tr>
<td align="center">Web审计员</td>
<td align="center">auditor</td>
</tr>
<tr>
<td align="center">Web审计员密码</td>
<td align="center">无（由 admin 启用时设置）</td>
</tr>
<tr>
<td align="center">Web运维账户/密码</td>
<td align="center">supervisor</td>
</tr>
<tr>
<td align="center"><strong>Console</strong>管理员</td>
<td align="center">admin</td>
</tr>
<tr>
<td align="center"><strong>ESPC</strong> 管理员</td>
<td align="center">admin</td>
</tr>
<tr>
<td align="center"><strong>CLI</strong> 管理员初始帐号/密码</td>
<td align="center">shell</td>
</tr>
<tr>
<td align="center"><strong>Console</strong> <strong>口通讯参数</strong></td>
<td align="center">115200</td>
</tr>
</tbody></table>
<h1 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h1><p>NIPS 的证书分为以下两类:</p>
<ul>
<li>试用证书 <ul>
<li>试用证书多用于售前测试。以引擎软件更新日期为准，过期后，无法登录Web 界面，无法继续使用安全检测功能。</li>
</ul>
</li>
<li>正式证书<ul>
<li>正式证书只能付费后使用。主要用于控制在升级服务授权时间范围内各模块的升级 服务:</li>
<li>− 当引擎软件更新过期后，升级界面自动隐藏，不仅引擎软件不能更新，各种库 均无法进行升级;</li>
<li>− 当引擎软件更新未过期，其他库(系统规则库、URL 分类库、病毒库)过期后， 过期的库无法进行升级;</li>
<li>正式证书过期只会导致各模块不能升级，老版本的各种库依然有效，所以安全检测 和日志查看等功能可以一直使用。</li>
</ul>
</li>
</ul>
<h1 id="产品概述"><a href="#产品概述" class="headerlink" title="产品概述"></a>产品概述</h1><h2 id="产品特点"><a href="#产品特点" class="headerlink" title="产品特点"></a>产品特点</h2><p>NIPS 相比其他厂商的入侵防御设备最突出的特点是提供开箱即用的零配置上线功能。零配置上线是指 NIPS 设备预置成熟的默认安全策略模板，并根据导入的证书自动进行接口配置、自动选择适合的安全策略模板，添加一条默认安全策略，并启用防护模式。</p>
<blockquote>
<p>NIPS 设备在导入相应证书后自动将相邻两个网络接口配置为一对直通口。</p>
</blockquote>
<p>零配置上线处理流程完成后，NIPS 会生成一条源地址对象、目的地址对象、用户对象、时间对象均为 <strong>any</strong>，规则模板为 <strong>default</strong>，默认启用防护模式的安全策略</p>
<h2 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h2><p>能够协助客户实现以下功能：</p>
<ul>
<li>网络防护<br>NIPS 具有实时的、主动的网络防护功能。此外，NIPS 还具有流量管理功能，对于可能出现的异常流量，提供抗拒绝服务攻击功能。</li>
<li>应用防护<br>NIPS 提供对应用层的防护功能，针对操作系统、应用软件以及数据库，提供深度的内容检测技术、过滤报文中的恶意流量和攻击行为，保护存在的漏洞，防止操作系统和应用程序损坏或宕机。</li>
<li>内容管理<br>NIPS 对企业内部网络资源提供内容管理，可有效检测并阻断间谍软件，包括木马后门、恶意程序和广告软件等，并可对即时通讯、P2P 下载、网络游戏和在线视频等内容进行监控并阻断。</li>
<li>防病毒<br>NIPS 可对 HTTP、SMTP、POP3、FTP 等多种协议类型的近百万种病毒进行查杀，包括木马、蠕虫、宏病毒、脚本病毒等，同时可对多线程并发、深层次压缩文件等进行有效控制和查杀。</li>
</ul>
<blockquote>
<p>1、登录本系统之前，请检查浏览器是否设置了禁止弹出窗口属性或者禁止javascript；如果是，请撤销此设置<br>2、建议使用 Firefox 最新版本浏览器或 IE8.0 及以上版本浏览器，屏幕分辨设置为 1024*768 或更高<br>3、初次使用本系统时可用默认的缺省操作员登录，用户名和密码均是 admin。初次登录必须修改用户密码并重新登录。<br>4、管理员登录后，如果不活动的时间超过 5 分钟，系统将超时并自动退回到登录页面，请重新登录继续使用<br>5、登录失败的原因有可能是：①用户名输入错误；②密码输入错误；③未区分大小写；④帐户被禁用或删除</p>
</blockquote>
<h1 id="系统维护"><a href="#系统维护" class="headerlink" title="系统维护"></a>系统维护</h1><h2 id="备份恢复"><a href="#备份恢复" class="headerlink" title="备份恢复"></a>备份恢复</h2><h3 id="备份文件"><a href="#备份文件" class="headerlink" title="备份文件"></a>备份文件</h3><p>目前，NIPS 中能够备份的文件包括：</p>
<ul>
<li>全部配置文件</li>
<li>引擎参数文件</li>
<li>接口参数文件</li>
<li>自定义规则</li>
<li>本地认证文件</li>
<li>流媒体服务器列表文件</li>
<li>对象配置文件</li>
<li>规则配置文件</li>
<li>入侵防护策略配置文件</li>
<li>Snmp Agent MIB 文件</li>
<li>Snmp Trap 相关文档</li>
<li>Syslog 相关文档</li>
<li>证书文件以</li>
<li>规则弱口令字典</li>
</ul>
<h3 id="恢复文件"><a href="#恢复文件" class="headerlink" title="恢复文件"></a>恢复文件</h3><p>目前，NIPS 中能够恢复的备份文件包括：</p>
<ul>
<li>引擎参数文件（*.ebk）</li>
<li>接口参数文件（*.ebk） </li>
<li>自定义规则（*.xml） </li>
<li>本地认证文件（*.list） </li>
<li>流媒体服务器列表文件（*.conf） </li>
<li>配置文件（*.ebk） </li>
<li>规则弱口令字典（*.txt）</li>
</ul>
<h3 id="系统配置还原"><a href="#系统配置还原" class="headerlink" title="系统配置还原"></a>系统配置还原</h3><p>系统配置还原是指按照 NIPS 设备上创建的还原点，对 NIPS 系统配置进行还原。NIPS设备支持通过手动和自动两种方式创建还原点。</p>
<ul>
<li>手动创建还原点<br>在任何时候将 NIPS 设备当前的系统配置文件进行备份。</li>
<li>自动创建还原点<br>配置自动备份周期和时间，NIPS 按照设定时间对全部配置文件进行备份。</li>
</ul>
<blockquote>
<p>为了节约 NIPS 设备磁盘空间，只保存最近一次创建的手动还原点和自动还原点。</p>
</blockquote>
<h1 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h1><h2 id="接口类型"><a href="#接口类型" class="headerlink" title="接口类型"></a>接口类型</h2><p>接口的类型由其“所属安全区”的类型来决定：</p>
<ul>
<li><strong>monitor</strong> ：监听类型安全区，在此类安全区之内的接口处于监听工作模式。</li>
<li><strong>direct</strong>：直通类型安全区，在此类安全区之内的接口处于直通工作模式。</li>
<li><strong>interconnect</strong> ：设备互联安全区，在此类安全区之内的接口处于互联模式。</li>
<li><strong>layer2</strong>：透明类型安全区，在此类安全区之内的接口处于二层交换工作模式。</li>
<li><strong>layer3</strong>：路由类型安全区，在此类安全区之内的接口处于路由工作模式，只有三层接口可以工作在此模式下。</li>
<li><strong>vwire</strong>：虚拟线类型安全区，在此类安全区之内的接口处于虚拟线工作模式。</li>
<li><strong>mgt</strong>：管理类型安全区，在此类安全区之内的接口处于原有工作模式，并可以作为带外管理使用。</li>
<li>*<em>global *</em>：系统缺省安全区，不可配置，包含所有的安全区。</li>
</ul>
<blockquote>
<p>以下几种情况不允许编辑所属安全区：</p>
<ul>
<li>不能修改管理口 M 口和 H1 口的所属安全区。</li>
<li>非千兆 intel 网卡的接口不允许修改所属安全区。</li>
<li>接口存在路由策略时不允许修改所属安全区。</li>
<li>证书存在问题时不允许修改所属安全区，例如：未导入证书之前不允许修改任何接口的所属安全区。</li>
<li>接口上配有子接口、或被策略引用时不允许修改所属安全区。</li>
</ul>
<p>global 安全区不能被编辑或删除，Management 安全区不能被删除</p>
</blockquote>
<h2 id="网管配置SNMP"><a href="#网管配置SNMP" class="headerlink" title="网管配置SNMP"></a>网管配置SNMP</h2><p>NIPS 设备支持主流的 SNMP 管理软件，如 MIB BROWSER、solarwind。<br>NIPS 设备需要进行基本的配置后才能支持 SNMP 管理</p>
<pre class="mermaid">graph LR
网络-->网管配置-->系统配置信息-->开启SnmpTrap/SnmpAgent-->应用</pre>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SnmpTrap：是否开启 NIPS 设备主动向 Snmp 主机发送报警消息的功能。开启后Trap中配置生效。</span><br><span class="line">SnmpAgent:是否开启 NIPS 设备接受 SNMP 管理主机管理的功能。开启后Agent访问控制中的配置生效。</span><br></pre></td></tr></table></figure>

<h3 id="Agent-访问控制"><a href="#Agent-访问控制" class="headerlink" title="Agent 访问控制"></a><strong>Agent</strong> <strong>访问控制</strong></h3><pre class="mermaid">graph LR
网络-->网管配置-->Agent访问控制-->新建-->确定-->应用</pre>

<table>
<thead>
<tr>
<th align="center"><strong>配置项</strong></th>
<th align="center"><strong>描述</strong>(v1,v2版本)</th>
</tr>
</thead>
<tbody><tr>
<td align="center">团体名</td>
<td align="center">NIPS 设备开启 SnmpAgent 代理功能后，SNMP 管理主机访问 NIPS 设备时使用的团体名。</td>
</tr>
<tr>
<td align="center">请求来源</td>
<td align="center">SNMP 管理主机的来源 IP 地址。</td>
</tr>
<tr>
<td align="center">MIB 子树</td>
<td align="center">管理主机对 NIPS 设备中管理信息库子树的访问权限，访问权限是通过 OID<br />（Object identifier，对象标识）实现的控制。<br />1 表示具有所有节点的访问权限，例：1.3.6.1.4.1.19849.2。</td>
</tr>
<tr>
<td align="center">读写权限</td>
<td align="center">管理主机对 NIPS 设备中管理信息库子树的读写权限，可选项：<strong>rw</strong>（读写）、 <strong>r</strong>（读）。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center"><strong>配置项</strong></th>
<th align="center"><strong>描述</strong>(v3版本)</th>
</tr>
</thead>
<tbody><tr>
<td align="center">用户名</td>
<td align="center">SNMP v3 用户的名称。</td>
</tr>
<tr>
<td align="center">认证协议</td>
<td align="center">进行认证时使用的认证协议，可选项：<strong>MD5</strong> 和 <strong>SHA</strong>。</td>
</tr>
<tr>
<td align="center">认证用 key</td>
<td align="center">进行认证时使用的密钥。</td>
</tr>
<tr>
<td align="center">加密协议</td>
<td align="center">加密传送信息时使用的加密算法，可选项：<strong>DES</strong> 和 <strong>AES</strong>。</td>
</tr>
<tr>
<td align="center">加密用 key</td>
<td align="center">进行信息加密时使用的密钥。</td>
</tr>
<tr>
<td align="center">MIB 子树</td>
<td align="center">管理主机对 NIPS 设备中管理信息库子树的访问权限，访问权限是通过 OID<br />（Object identifier，对象标识）实现的控制。<br />1 表示具有所有节点的访问权限，例：1.3.6.1.4.1.19849.2。</td>
</tr>
<tr>
<td align="center">读写权限</td>
<td align="center">管理主机对 NIPS 设备中管理信息库子树的读写权限，可选项：<strong>rw</strong>（读写）、 <strong>r</strong>（读）。</td>
</tr>
<tr>
<td align="center">安全等级</td>
<td align="center">用户必须满足什么安全等级才能访问，可选项：<strong>不认证</strong>、<strong>需认证</strong>、<strong>认证且加密</strong></td>
</tr>
</tbody></table>
<h3 id="Trap"><a href="#Trap" class="headerlink" title="Trap"></a><strong>Trap</strong></h3><p>Trap 是一种自陷信息，是指 NIPS 作为 SNMP Agent 设备可以在任何时候向 SNMP 管理主机报告自身情况，而并不需要等到 SNMP 管理主机为获得这些情况而轮询他的时候才发送。</p>
<pre class="mermaid">graph LR
网络-->网管配置-->Trap-->新建-->确定-->应用</pre>

<table>
<thead>
<tr>
<th align="center"><strong>配置项</strong></th>
<th align="center"><strong>描述</strong>(v1,v2版本)</th>
</tr>
</thead>
<tbody><tr>
<td align="center">团体名</td>
<td align="center">接收 SNMP Trap 报警消息的主机的团体名。</td>
</tr>
<tr>
<td align="center">目的主机</td>
<td align="center">接收 NIPS 设备发出 SNMP Trap 报警消息的主机。<br />支持 IPv4 或 IPv6 地址，例：192.168.1.0 或 2001:abcd:123:1::</td>
</tr>
<tr>
<td align="center">接收端口</td>
<td align="center">用于接收 SNMP Trap 报警消息的端口号。</td>
</tr>
<tr>
<td align="center">协议版本</td>
<td align="center">使用的 SNMP 协议的版本。可选项：<strong>v1</strong> 和 <strong>v2</strong></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center"><strong>配置项</strong></th>
<th align="center"><strong>描述</strong>(v3版本)</th>
</tr>
</thead>
<tbody><tr>
<td align="center">目的主机</td>
<td align="center">接收 NIPS 设备发出 SNMP Trap 报警消息的主机。<br />支持 IPv4 或 IPv6 地址，例：192.168.1.0 或 2001:abcd:123:1::</td>
</tr>
<tr>
<td align="center">接收端口</td>
<td align="center">用于接收 SNMP Trap 报警消息的端口号。</td>
</tr>
<tr>
<td align="center">用户名</td>
<td align="center">SNMP v3 用户的名称。</td>
</tr>
<tr>
<td align="center">认证协议</td>
<td align="center">进行认证时使用的认证协议，可选项：<strong>MD5</strong> 和 <strong>SHA</strong>。</td>
</tr>
<tr>
<td align="center">认证用 key</td>
<td align="center">进行认证时使用的密钥。</td>
</tr>
<tr>
<td align="center">加密协议</td>
<td align="center">加密传送信息时使用的加密算法，可选项：<strong>DES</strong> 和 <strong>AES</strong>。</td>
</tr>
<tr>
<td align="center">加密用 key</td>
<td align="center">进行信息加密时使用的密钥。</td>
</tr>
<tr>
<td align="center">安全等级</td>
<td align="center">用户必须满足什么安全等级才能访问，可选项：<strong>不加密不认证</strong>、<strong>需认证</strong>、<strong>认证且加密</strong>。</td>
</tr>
<tr>
<td align="center">engineID</td>
<td align="center">SNMP 引擎的 ID 号。ID 号为 16 位的 16 进制数，例：0x8000000001020304。</td>
</tr>
</tbody></table>
<h2 id="高可用性设置"><a href="#高可用性设置" class="headerlink" title="高可用性设置"></a>高可用性设置</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>NIPS 的高可用性（High Availability，HA）功能应用于两台设备之间，有四种实现方式：</p>
<ul>
<li>虚拟线 HA<br>虚拟线 HA 即虚拟线配置，当设备使用 vwire 类型安全区时使用该 HA 方式。NIPS的虚拟线 HA 仅支持主从模式。</li>
<li>虚拟路由冗余协议<br>虚拟路由冗余协议（Virtual Router Redundancy Protocol，VRRP）是一种容错协议，通过交互 VRRP 组播报文的方法将多台物理路由器模拟成一台虚拟路由器，与网络上的主机进行通信。当 VRRP 组中的主路由器失效时，从路由器将自动接替其工作，从而保证通信的连续性和可靠性。</li>
<li>二层 HA<br>透明模式下的高可用性配置。</li>
<li>非对称路由支持<br>配置非对称路由支持后，非对称路由支持组中的 NIPS 设备相互转发数据报文传输信息，以便在传输出去的数据选择其他路由回来时进行数据信息整合，形成完整的数据传输会话，从而在不改变数据传输路径的同时完成数据包的深度检测。</li>
</ul>
<p>HA 的工作模式有如下几类：</p>
<ul>
<li>主从模式<br>主从模式下的两台设备，其中一台作为主机，另一台作为从机。主机处理所有业务，并将产生的会话信息和配置信息发送到从机进行备份；从机不处理业务，只用做备份。当主机故障，从机接替主机处理业务，从而保证新发起的会话能正常建立，当前正在进行的会话也不会中断。</li>
<li>主主模式<br>主主模式下，两台设备均为主设备，都处理业务流量，同时又作为另一台设备的备份设备，备份对端的会话信息和配置文件。当其中一台故障后，另一台设备负责处理全部业务，从而保证新发起的会话能正常建立，当前正在进行的会话也不会中断。</li>
<li>抢占模式<br>抢占模式下，主机宕掉后，链路会切换到从机，主机恢复正常后，将抢占从机流量，此时主机切换到激活状态，而从机切换到非激活状态。</li>
<li>非抢占模式<br>非抢占模式下，主机宕掉后，链路会切换到从机，主机恢复正常后，不会抢占从机流量，从机仍然处于激活状态，主机则处于非激活状态，直到从机宕掉后，主机才会接管流量。</li>
</ul>
<h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><p>两台设备之间各通过一个管理口（心跳口）相连，用于设备之间收发心跳信息、同步配置文件和会话信息。</p>
<p>高可用性的基本配置如下：</p>
<table>
<thead>
<tr>
<th align="center"><strong>配置项</strong></th>
<th align="left"><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">心跳接口</td>
<td align="left">本设备的心跳口。NIPS 可以用作心跳接口的接口：M、H1 以及三层工作接口。<br />心跳接口不能用于处理业务。<br />心跳接口与对端 IP 地址在如下情况置灰，不可编辑：<br />HA 启动，会话同步启动，置灰。<br />HA 启动，会话同步未启动，置灰。<br />HA 未启动，会话同步启动，置灰。</td>
</tr>
<tr>
<td align="center">对端 IP 地址</td>
<td align="left">对端设备心跳口的 IP 地址。</td>
</tr>
<tr>
<td align="center">心跳时间间隔(毫 秒)</td>
<td align="left">向对端设备发送心跳信息的时间间隔。取值范围：大于等于 1000毫秒。<br />主、从机的该参数值要保持一致。</td>
</tr>
<tr>
<td align="center">失去心跳次数</td>
<td align="left">当本地设备未接到对端设备心跳信息的次数超过该参数值时，本地设备认为对端设备 down 掉。若本地设备处于主机状态，则保持主机状态不变，将对端设备状态显示为未知。若本地设备处于从机状态，则切换到主机状态进行报文转发，将本机系统状态显示为激活，将对端系统状态显示为未知。</td>
</tr>
<tr>
<td align="center">会话同步</td>
<td align="left">开启该项后，会话通过心跳口或其他接口进行会话同步。</td>
</tr>
<tr>
<td align="center">复用 HA 配置</td>
<td align="left">* 选择是，表示会话同步通过心跳口进行。<br />* 选择否，还需配置会话同步的同步接口和对端 IP 地址。<br />          ** 同步接口：会话同步使用的接口，只有开启会话同步，复用 HA 配置选择否时，该项才可见。<br />        **  对端 IP 地址：与会话同步的对端接口的 IP 地址。只有开启会话同步，“复用 HA 配置”选择“否“时，该项才可见。</td>
</tr>
<tr>
<td align="center">同步配置</td>
<td align="left">NIPS 支持手动和自动同步所有配置。仅当正确配置心跳接口和对端 IP 地址参数后，才能够进行配置同步。同步配置默认关闭，单击“是”单选框，才能开启同步配置。开启后可以选择自动同步</td>
</tr>
</tbody></table>
<h3 id="虚拟线配置"><a href="#虚拟线配置" class="headerlink" title="虚拟线配置"></a>虚拟线配置</h3><p>虚拟线配置即虚拟线 HA，当设备使用 <strong>vwire 类型安全区</strong>时使用该 HA 方式。NIPS 的虚拟线 HA <strong>仅支持主从模式</strong>。<br>启用虚拟线 HA 后，主设备处于工作状态，承担报文转发任务，从设备处于备份状态并准备随时接替主设备工作。主、从设备之间周期性发送心跳信息，通告本地可用的虚拟线条数。</p>
<h3 id="虚拟路由冗余配置"><a href="#虚拟路由冗余配置" class="headerlink" title="虚拟路由冗余配置"></a>虚拟路由冗余配置</h3><p>虚拟路由冗余配置即<strong>三层 HA 配置</strong>，当设备使用 <strong>layer3 类型安全区</strong>时使用该 HA 方式。NIPS 的三层 HA 支持<strong>主从模式和主主模式</strong>。<br>三层 HA 模式下，每台设备中可以设置多个 VRRP 备份组，并且两台设备中虚拟路由 ID（Virtual Router ID，VRID）相同的接口相互备份。在每个 VRRP 组中，优先级高的设备作为主设备，优先级低的设备作为从设备</p>
<table>
<thead>
<tr>
<th align="center"><strong>VRRP配置项</strong></th>
<th align="left"><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">心跳口传送 VRRP报文</td>
<td align="left">本配置是否通过心跳口来传送 VRRP 报文。<br />默认配置为<strong>否</strong>，NIPS 通过 VRRP 的成员接口发送 VRRP 报文，当 NIPS 设备与路由器连接且配置 HA 了时，必须选择否，否则无法进行 VRRP 报文传送。</td>
</tr>
<tr>
<td align="center">使用虚拟 MAC</td>
<td align="left">配置是否使用虚拟 MAC 进行 VRRP 报文传送。<br />默认选择为<strong>是</strong>，表示 VRRP 组的虚拟路由器的 IP 地址将对应唯一的 MAC 地址。建议用户保持默认配置。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center"><strong>监控线路配置项</strong></th>
<th align="left"><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">线路 ID</td>
<td align="left">标识一条线路的 ID 号，仅支持数字，取值范围为 1～255。<br />本地设备配置的线路 ID 必须与对端设备的线路 ID 保持一致。</td>
</tr>
<tr>
<td align="center">线路名称</td>
<td align="left">标识一条线路的名称，仅支持英文字母和数字，区分大小写。</td>
</tr>
<tr>
<td align="center">工作模式</td>
<td align="left">三层 HA 支持主主模式和主从模式。<br />- 主：指该线路在启动三层 HA 后承担报文转发任务，直到发生故障切换。<br />- 从：指该线路在启动三层 HA 后处于备份状态，不转发数据，直到发生故障切换。</td>
</tr>
<tr>
<td align="center">抢占模式</td>
<td align="left">选择<strong>是</strong>，当主线路因故障 down 掉发生数据切换后，再次恢复正常工作时，是否重新抢占为主线路的工作模式，重新转发数据。<br />选择<strong>否</strong>，当主线路因故障 down 掉发生数据切换后，即使主线路再次恢复正常，业务也不会发生切换，仍以原来的从线路为主线路来转发数据。</td>
</tr>
<tr>
<td align="center">状态</td>
<td align="left">该条监控线路的工作状态，可以选择开启或关闭。只有开启，配置才能生效。</td>
</tr>
<tr>
<td align="center">心跳时间</td>
<td align="left">指设备每隔多长时间以组播方式发送一次心跳信息，以通告自己的状态。建议保持默认值。<br />当从线路接口经过【3*心跳时间+(255-从线路接口优先级)/256】时间后，没有收到主线路接口发送的组播报文，则认为主线路 down 掉，将从线路切换至主线路状态，开始转发数据。<br />本地设备配置的心跳时间必须与对端设备配置的心跳时间保持一致。</td>
</tr>
</tbody></table>
<h3 id="二层HA配置"><a href="#二层HA配置" class="headerlink" title="二层HA配置"></a>二层HA配置</h3><p>NIPS 支持透明模式下的高可用性，通过二层 HA 配置，当设备使用 <strong>layer2 类型安全区</strong>时，可以通过二层 HA 提供链路的冗余备份。<br>二层 HA 模式下，每台设备中可以设置多个监控线路，并且两台设备中相同线路 ID 的成员接口相互备份。二层HA <strong>仅支持主从模式</strong>，设备的工作模式在添加监控线路时指定。</p>
<ol>
<li>配置监控线路。</li>
<li>选择菜单 <strong>网络</strong> <strong>&gt;</strong> <strong>高可用性设置</strong> &gt; <strong>二层配置</strong>，进入二层 HA 配置页面</li>
<li>配置监控线路。<strong>只有二层</strong> <strong>HA</strong> <strong>为停止状态时才能添加、修改和删除监控线路。</strong><ol>
<li>线路ID：标识一条线路的 ID 号，仅支持数字，取值范围为 1～255。本地设备配置的线路 ID 必须与对端设备的线路 ID 保持一致。</li>
<li>接口：配置该线路包含的成员接口，需要选择二层以太网接口或二层聚合接口。<br><strong>说明：</strong>作为二层 HA 的成员接口，接口上不能启用 STP 协议。</li>
<li>工作模式：二层 HA 仅支持主从模式。</li>
</ol>
</li>
<li>启用二层 HA 功能。</li>
</ol>
<h3 id="非对称路由支持"><a href="#非对称路由支持" class="headerlink" title="非对称路由支持"></a>非对称路由支持</h3><p>所有型号的 NIPS 设备均支持非对称路由功能，但是配置略有不同：</p>
<ul>
<li>非 NX5-T9010A、NX5-T9020A 型号：<br>只有点到点虚拟线部署的两台 NIPS 才能配置非对称路由支持功能。</li>
<li>NX5-T9010A、NX5-T9020A 型号：<br>直通模式部署的两台 NIPS 设备才能配置非对称路由功能。</li>
</ul>
]]></content>
      <categories>
        <category>绿盟</category>
      </categories>
      <tags>
        <tag>绿盟</tag>
        <tag>NIPS</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco下一代防火墙Firepower</title>
    <url>/2020/07/27/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower.html</url>
    <content><![CDATA[<p> Cisco Firepower 下一代防火墙 (NGFW)具有统一管理功能完全集成、专注于威胁防御的一下代防火墙 。它包括应用可视性与可控制(AVC)、可选的Firepower下一代IPS(NGIPS)、思科高级恶意软件保护(AMP)和URL过滤。</p>
<p><strong>Cisco FireSIGHT NGIPS 解决方案的功能：</strong></p>
<ul>
<li>实时情景感知：查看和关联以下与 IT 环境相关的大量事件数据 - 应用、用户、设备、操作系统、漏洞、服务、进程、网络行为、文件和威胁。</li>
<li>高级威胁防御：利用经过独立第三方测试验证并让全球数千客户感到满意的现有最佳威胁防御系统，抵御最新威胁。</li>
<li>智能安全自动化：大幅降低总拥有成本，帮助您增强适应不断变化的环境的能力， 使您能够充分利用自动事件影响评估、IPS 策略调整、策略管理、网络行为分析和用户身份识别等功能。</li>
<li>高性能和可扩展性：借助采用低延迟单通设计的专用设备获得出色的性能和可扩展性。可选应用控制、URL 过滤和高级恶意软件防护 (AMP)：通过精确控制超过 1800 个应用和 80 多个类别的数亿 URL，减小攻击面。发现、跟踪和阻止可疑文件和恶意软件的活动，防止感染蔓延以及再次感染。</li>
</ul>
<h2 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h2><table>
<thead>
<tr>
<th align="left">许可证</th>
<th align="left">功能</th>
<th>过期</th>
<th>购买组合</th>
</tr>
</thead>
<tbody><tr>
<td align="left">基本授权（Base）</td>
<td align="left">1、更新Firepower系统<br />2、应用控制<br />3、用户控制<br />4、路由交换<br />5、地址转换</td>
<td>永久</td>
<td>无需单独购买，自动包含在设备订单中。</td>
</tr>
<tr>
<td align="left">威胁授权（Threat）【智能授权】</td>
<td align="left">1、入侵防御检测<br />2、安全只能过滤<br />3、文件控制与过滤</td>
<td>基于条款</td>
<td>T：只包含威胁授权</td>
</tr>
<tr>
<td align="left">控制授权（Control）【经典授权】</td>
<td align="left">1、路由交换功能<br />2、用户和应用过滤<br />3、7K和8K设备高可用<br />4、7K和8K地址转换</td>
<td>永久</td>
<td>无需单独购买，自动包含在设备订单中。</td>
</tr>
<tr>
<td align="left">恶意软件（Malware）</td>
<td align="left">1、保护网络免受恶意软件侵害<br />2、启用AMP<br />3、启用AMP高级特性</td>
<td>基于条款</td>
<td>TM：包含威胁和恶意软件授权<br />AMP：只包含恶意软件授权，仅当已拥有威胁授权时购买</td>
</tr>
<tr>
<td align="left">URL过滤（URL Filtering）</td>
<td align="left">1、激活基于信誉和类别过滤URL</td>
<td>基于条款</td>
<td>TMC：包含威胁、恶意软件、URL过滤授权<br />URL：只包含URL过滤授权，仅当已拥有威胁授权时购买</td>
</tr>
</tbody></table>
<h2 id="产品介绍"><a href="#产品介绍" class="headerlink" title="产品介绍"></a>产品介绍</h2><h3 id="Firepower机框管理器和设备管理器"><a href="#Firepower机框管理器和设备管理器" class="headerlink" title="Firepower机框管理器和设备管理器"></a>Firepower机框管理器和设备管理器</h3><ul>
<li>Firepower系列产品除了通过FMC注册管理之外，也拥有自己的管理界面</li>
<li>4100和9000系列防火墙内置管理功能成为机框管理器</li>
<li>2100系列防火墙内置管理功能称为设备管理器（FDM）</li>
<li>FDM同时支持集成的ASA和虚拟化的FTD设备</li>
</ul>
<h3 id="Firepower管理中心"><a href="#Firepower管理中心" class="headerlink" title="Firepower管理中心"></a>Firepower管理中心</h3><ul>
<li>Firepower Management Center</li>
<li>相对于免费的FDM，FMC需要购买额外的授权（90天试用授权）</li>
</ul>
<h2 id="策略结构"><a href="#策略结构" class="headerlink" title="策略结构"></a>策略结构</h2><h3 id="安全情报，也叫智能过滤-黑白名单"><a href="#安全情报，也叫智能过滤-黑白名单" class="headerlink" title="安全情报，也叫智能过滤/黑白名单"></a>安全情报，也叫智能过滤/黑白名单</h3><p>基于安全情报的两种部署方式，针对IP地址、域名、URL对象执行快速的流量过滤：</p>
<ul>
<li>静态配置<ul>
<li>集合实际情况，手动配置部署用于过滤的黑白名单</li>
<li>被加入黑名单的IP地址/域名/URL流量将被拒绝接入或访问网络</li>
</ul>
</li>
<li>动态更新<ul>
<li>基于HTTP/HTTPS，自动更新来自于思科安全团队Talos的数据</li>
<li>同时，更新之后的数据库无需重新部署</li>
</ul>
</li>
</ul>
<h3 id="SSL策略"><a href="#SSL策略" class="headerlink" title="SSL策略"></a>SSL策略</h3><ul>
<li>通过配置SSL策略，来决定FTD该如何处理被SSL所加密的流量，比如HTTPS</li>
<li>在将解密之后的流量，递交给匹配的访问控制策略来执行处理</li>
</ul>
<p><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200728221014199.png" alt="image-20200728221014199"></p>
<h3 id="网络分析策略"><a href="#网络分析策略" class="headerlink" title="网络分析策略"></a>网络分析策略</h3><ul>
<li>针对协议进行规范化预处理</li>
<li>类似于MPF技术的规范化</li>
</ul>
<h3 id="预过滤策略"><a href="#预过滤策略" class="headerlink" title="预过滤策略"></a>预过滤策略</h3><ul>
<li>该步骤为隐藏步骤</li>
<li>针对不需要执行深度处理的流量，直接经过防火墙（快速路径/Bypass）</li>
</ul>
<h3 id="访问控制策略"><a href="#访问控制策略" class="headerlink" title="访问控制策略"></a>访问控制策略</h3><ul>
<li>针对工程师所配置的策略进行匹配，同时执行对应操作</li>
<li>相对于传统防火墙的两种动作（允许/拒绝）FTD支持的执行动作更加灵活和丰富</li>
</ul>
<p><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200728221526177.png" alt="image-20200728221526177"></p>
<table>
<thead>
<tr>
<th>执行动作</th>
<th align="left">效果</th>
</tr>
</thead>
<tbody><tr>
<td>Monitor</td>
<td align="left">该动作跟踪和记录网络流量，但不影响流量，系统继续根据其他规则匹配流量</td>
</tr>
<tr>
<td>Trust</td>
<td align="left">匹配该动作的流量直接放行</td>
</tr>
<tr>
<td>Block</td>
<td align="left">匹配该动作的流量直接丢弃</td>
</tr>
<tr>
<td>Allow</td>
<td align="left">匹配该动作的流量，还需完成网络发现策略、文件控制策略、入侵策略才可通过</td>
</tr>
<tr>
<td>Default Action</td>
<td align="left">用于处理没有匹配任何策略的流量，默认拒绝所有</td>
</tr>
</tbody></table>
<h3 id="网络发现策略"><a href="#网络发现策略" class="headerlink" title="网络发现策略"></a>网络发现策略</h3><ul>
<li>FTD使用网络发现和身份策略收集网络上流量的主机、应用和用户数据</li>
<li>同时可以调用扫描工具NMAP来实现更为精准的数据收集</li>
</ul>
<h3 id="AMP与文件控制策略"><a href="#AMP与文件控制策略" class="headerlink" title="AMP与文件控制策略"></a>AMP与文件控制策略</h3><ul>
<li>在流量由发现检查之后，系统可以通过AMP检查其中是否存在受禁文件和恶意软件</li>
<li>包括PDF、Office文档等</li>
<li>如果还需要阻止特定类型文件的传输，可以部署文件控制策略进行控制</li>
</ul>
<h3 id="入侵威胁检测策略"><a href="#入侵威胁检测策略" class="headerlink" title="入侵威胁检测策略"></a>入侵威胁检测策略</h3><ul>
<li>在文件检查之后，系统可以检查流量中是否存在入侵和漏洞</li>
<li>入侵策略根据模式检查已解码数据包中是否存在攻击，并且可以阻止或修改恶意流量</li>
</ul>
<h2 id="实验部分"><a href="#实验部分" class="headerlink" title="实验部分"></a>实验部分</h2><h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912052703437.png" alt="image-20200912052703437" style="zoom:50%;" />

<h4 id="设备对应IOS"><a href="#设备对应IOS" class="headerlink" title="设备对应IOS"></a>设备对应IOS</h4><table>
<thead>
<tr>
<th align="left">设备</th>
<th>IOS</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Winserver</td>
<td>2012 Server</td>
</tr>
<tr>
<td align="left">Inside_1/Inside_2/DMZ/Outside</td>
<td>IOL-L3</td>
</tr>
<tr>
<td align="left">FTDv</td>
<td>Firepower6-FTD-6.3.0-83</td>
</tr>
<tr>
<td align="left">FMC</td>
<td>Firepower6-FMC-6.3.0-83</td>
</tr>
<tr>
<td align="left">SW7/SW8</td>
<td>IOL-L2</td>
</tr>
</tbody></table>
<h4 id="设备对应IP"><a href="#设备对应IP" class="headerlink" title="设备对应IP"></a>设备对应IP</h4><table>
<thead>
<tr>
<th align="left">设备</th>
<th>接口</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Winserver</td>
<td>e0</td>
<td>150.1.7.20/24</td>
</tr>
<tr>
<td align="left">Inside_1</td>
<td>e0/0</td>
<td>7.7.1.10/24</td>
</tr>
<tr>
<td align="left">FTDv</td>
<td>eth0</td>
<td>150.1.7.31/24</td>
</tr>
<tr>
<td align="left">FMC</td>
<td>eth0</td>
<td>150.1.7.30/24</td>
</tr>
<tr>
<td align="left">Inside_2</td>
<td>e0/0</td>
<td>7.7.2.10/24</td>
</tr>
<tr>
<td align="left">Internet</td>
<td></td>
<td>192.168.72.1/24</td>
</tr>
<tr>
<td align="left">test-PC</td>
<td></td>
<td>150.1.7.1/24</td>
</tr>
<tr>
<td align="left">DMZ</td>
<td>e0/0</td>
<td>150.1.7.10/24</td>
</tr>
<tr>
<td align="left">Outside</td>
<td>e0/0</td>
<td>dhcp</td>
</tr>
<tr>
<td align="left">Outside</td>
<td>e0/1</td>
<td>7.7.3.10/24</td>
</tr>
<tr>
<td align="left">SW7</td>
<td></td>
<td>vlan 10 : e0/0 , e1/0<br/>vlan 20 : e0/1 , e1/1<br/>vlan 30 : e0/2 , e1/2<br/>vlan 40 : e0/3 , e1/3 , e2/0</td>
</tr>
</tbody></table>
<h3 id="设备初始化配置"><a href="#设备初始化配置" class="headerlink" title="设备初始化配置"></a>设备初始化配置</h3><h4 id="Outside"><a href="#Outside" class="headerlink" title="Outside"></a>Outside</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hostname Outside</span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address dhcp</span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.3</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.254</span></span><br><span class="line">ip route <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.254</span></span><br><span class="line">ip route <span class="number">150.1</span><span class="number">.7</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.3</span><span class="number">.254</span></span><br></pre></td></tr></table></figure>

<h4 id="Inside-1"><a href="#Inside-1" class="headerlink" title="Inside_1"></a>Inside_1</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hostname Inside_1</span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.254</span></span><br></pre></td></tr></table></figure>

<h4 id="Inside-2"><a href="#Inside-2" class="headerlink" title="Inside_2"></a>Inside_2</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hostname Inside_2</span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">7.7</span><span class="number">.2</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.2</span><span class="number">.254</span></span><br></pre></td></tr></table></figure>

<h4 id="DMZ"><a href="#DMZ" class="headerlink" title="DMZ"></a>DMZ</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hostname DMZ</span><br><span class="line">interface Ethernet0/<span class="number">0</span></span><br><span class="line"> ip address <span class="number">150.1</span><span class="number">.7</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">150.1</span><span class="number">.7</span><span class="number">.254</span></span><br></pre></td></tr></table></figure>

<h4 id="FMC"><a href="#FMC" class="headerlink" title="FMC"></a>FMC</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">RAM：<span class="number">10240</span></span><br><span class="line">Default-user：admin</span><br><span class="line">Default-password：Admin123</span><br><span class="line">New-password: Cisc0123</span><br><span class="line"><span class="comment">#更改IP地址：</span></span><br><span class="line">sudo /usr/local/sf/bin/configure-network</span><br><span class="line">password: Admin123</span><br><span class="line">Do you wish to configure IPV4? (y or n)y</span><br><span class="line">Management IP Address? 150.1.7.30</span><br><span class="line">Management Network? 255.255.255.0</span><br><span class="line">Management default Gateway? 150.1.7.254</span><br><span class="line">Are these setting correct? (y or n)y</span><br><span class="line">Do you wish to configure IPV6? (y or n)n</span><br></pre></td></tr></table></figure>

<h4 id="FTDv"><a href="#FTDv" class="headerlink" title="FTDv"></a>FTDv</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">RAM：<span class="number">10240</span></span><br><span class="line">Default-user：admin</span><br><span class="line">Default-password：Admin123</span><br><span class="line">New-password: Cisc0123</span><br><span class="line"><span class="comment">#更改IP地址：首次登陆默认需要更改密码以及设置IP地址，根据向导进行即可。</span></span><br><span class="line"><span class="comment">#允许https网管流量</span></span><br><span class="line">configure https-access-list <span class="number">150.1</span><span class="number">.7</span><span class="number">.0</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<h3 id="关联FMC和FTDv"><a href="#关联FMC和FTDv" class="headerlink" title="关联FMC和FTDv"></a>关联FMC和FTDv</h3><blockquote>
<p>FTDv只能被一种方式网管，当关联FMC后，无法使用https网管设备</p>
</blockquote>
<h4 id="FTDv配置"><a href="#FTDv配置" class="headerlink" title="FTDv配置"></a>FTDv配置</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">configure managers add <span class="number">150.1</span><span class="number">.7</span><span class="number">.30</span> Cisc0123   //Cisc0123为注册密码，与登录密码无关，不能为特殊字符</span><br></pre></td></tr></table></figure>

<h4 id="FMC配置"><a href="#FMC配置" class="headerlink" title="FMC配置"></a>FMC配置</h4><h5 id="创建Policy"><a href="#创建Policy" class="headerlink" title="创建Policy"></a>创建Policy</h5><p><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912163821154.png" alt="image-20200912163821154" style="zoom:50%;" /><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912164001127.png" alt="image-20200912164001127" style="zoom:50%;" /></p>
<h5 id="激活License（评估授权，试用90天）"><a href="#激活License（评估授权，试用90天）" class="headerlink" title="激活License（评估授权，试用90天）"></a>激活License（评估授权，试用90天）</h5><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912164039498.png" alt="image-20200912164039498" style="zoom:50%;" />

<h5 id="添加设备"><a href="#添加设备" class="headerlink" title="添加设备"></a>添加设备</h5><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912164243815.png" alt="image-20200912164243815" style="zoom:50%;" />

<h4 id="查看注册状态"><a href="#查看注册状态" class="headerlink" title="查看注册状态"></a>查看注册状态</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看注册状态：</span></span><br><span class="line">show managers</span><br><span class="line">Registration          : pending</span><br><span class="line"><span class="comment">#注册成功状态：</span></span><br><span class="line">show managers</span><br><span class="line">Registration          : Completed</span><br></pre></td></tr></table></figure>

<h3 id="防火墙升级"><a href="#防火墙升级" class="headerlink" title="防火墙升级"></a>防火墙升级</h3><ul>
<li>不同版本FTD与FMC是不兼容的</li>
<li>联网时可自动更新</li>
<li>不联网时也可手动更新</li>
</ul>
<h3 id="备份配置"><a href="#备份配置" class="headerlink" title="备份配置"></a>备份配置</h3><p><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912170109722.png" alt="image-20200912170109722" style="zoom:50%;" /><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912170242676.png" alt="image-20200912170242676" style="zoom:50%;" /></p>
<h2 id="防火墙部署模式"><a href="#防火墙部署模式" class="headerlink" title="防火墙部署模式"></a>防火墙部署模式</h2><ul>
<li>FTDv默认为路由模式</li>
<li>更改防火墙模式会清除配置，需要提前备份</li>
<li>若使用FMC管理，则无需备份策略</li>
<li>不要将BVI地址设为网关</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看当前模式</span></span><br><span class="line">show firewall</span><br><span class="line">Firewall mode : Router</span><br></pre></td></tr></table></figure>

<h3 id="透明模式部署"><a href="#透明模式部署" class="headerlink" title="透明模式部署"></a>透明模式部署</h3><ul>
<li>若FTD已经注册到FMC上，是无法切换模式的</li>
<li>首先需要删除FTD注册</li>
<li>FTD命令行确认已被清空</li>
</ul>
<img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912171858532.png" alt="image-20200912171858532" style="zoom:50%;" />

<h4 id="FTD更改防火墙模式"><a href="#FTD更改防火墙模式" class="headerlink" title="FTD更改防火墙模式"></a>FTD更改防火墙模式</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">configure firewall transparent</span><br></pre></td></tr></table></figure>

<img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912172223250.png" alt="image-20200912172223250" style="zoom:50%;" />

<h4 id="重新注册FTD到FMC上"><a href="#重新注册FTD到FMC上" class="headerlink" title="重新注册FTD到FMC上"></a>重新注册FTD到FMC上</h4><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912172523007.png" alt="image-20200912172523007" style="zoom:50%;" />

<img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912172508612.png" alt="image-20200912172508612" style="zoom:50%;" />

<img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912172756807.png" alt="image-20200912172756807" style="zoom:50%;" />

<h4 id="配置接口为透明（桥接bridge）"><a href="#配置接口为透明（桥接bridge）" class="headerlink" title="配置接口为透明（桥接bridge）"></a>配置接口为透明（桥接bridge）</h4><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912175227209.png" alt="image-20200912175227209" style="zoom:50%;" />

<img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912175411415.png" alt="image-20200912175411415" style="zoom:50%;" />

<h4 id="部署下发配置"><a href="#部署下发配置" class="headerlink" title="部署下发配置"></a>部署下发配置</h4><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912175632001.png" alt="image-20200912175632001" style="zoom:50%;" />

<h4 id="测试网络"><a href="#测试网络" class="headerlink" title="测试网络"></a>测试网络</h4><blockquote>
<p>将Inside_1和Inside_2的地址改为同一网段进行测试</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside_2<span class="comment">#sh ip int bri</span></span><br><span class="line">Interface                  IP-Address      OK? Method Status                Protocol</span><br><span class="line">Ethernet0/<span class="number">0</span>                <span class="number">7.7</span><span class="number">.1</span><span class="number">.30</span>        YES manual up                    up      </span><br><span class="line">Inside_1<span class="comment">#sh ip int bri</span></span><br><span class="line">Interface                  IP-Address      OK? Method Status                Protocol</span><br><span class="line">Ethernet0/<span class="number">0</span>                <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span>        YES manual up                    up </span><br><span class="line"></span><br><span class="line">Inside_1<span class="comment">#ping 7.7.1.30</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">7.7</span><span class="number">.1</span><span class="number">.30</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">13</span>/<span class="number">23</span>/<span class="number">43</span> ms</span><br></pre></td></tr></table></figure>

<h4 id="将策略Policy改为默认后，再次测试（记得下发配置）"><a href="#将策略Policy改为默认后，再次测试（记得下发配置）" class="headerlink" title="将策略Policy改为默认后，再次测试（记得下发配置）"></a>将策略Policy改为默认后，再次测试（记得下发配置）</h4><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912175916768.png" alt="image-20200912175916768" style="zoom:50%;" />

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside_1<span class="comment">#ping 7.7.1.30</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">7.7</span><span class="number">.1</span><span class="number">.30</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">.....</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">0</span> percent (<span class="number">0</span>/<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<h4 id="添加rule再次测试（记得下发配置）"><a href="#添加rule再次测试（记得下发配置）" class="headerlink" title="添加rule再次测试（记得下发配置）"></a>添加rule再次测试（记得下发配置）</h4><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912180101330.png" alt="image-20200912180101330" style="zoom:50%;" />

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Inside_1<span class="comment">#ping 7.7.1.30</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending <span class="number">5</span>, <span class="number">100</span>-byte ICMP Echos to <span class="number">7.7</span><span class="number">.1</span><span class="number">.30</span>, timeout <span class="keyword">is</span> <span class="number">2</span> seconds:</span><br><span class="line">!!!!!</span><br><span class="line">Success rate <span class="keyword">is</span> <span class="number">100</span> percent (<span class="number">5</span>/<span class="number">5</span>), round-trip min/avg/max = <span class="number">13</span>/<span class="number">23</span>/<span class="number">43</span> ms</span><br></pre></td></tr></table></figure>

<h3 id="路由模式部署"><a href="#路由模式部署" class="headerlink" title="路由模式部署"></a>路由模式部署</h3><ul>
<li>先删除注册，再修改模式</li>
<li>删除上个实验配置</li>
</ul>
<h4 id="删除Zone"><a href="#删除Zone" class="headerlink" title="删除Zone"></a>删除Zone</h4><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912181134886.png" alt="image-20200912181134886" style="zoom:50%;" />

<h4 id="配置接口（部署生效）"><a href="#配置接口（部署生效）" class="headerlink" title="配置接口（部署生效）"></a>配置接口（部署生效）</h4><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912181356606.png" alt="image-20200912181356606" style="zoom:50%;" />

<h4 id="配置路由（部署生效）"><a href="#配置路由（部署生效）" class="headerlink" title="配置路由（部署生效）"></a>配置路由（部署生效）</h4><img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912181701325.png" alt="image-20200912181701325" style="zoom:50%;" />

<img src="../../../../images/Cisco%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99Firepower/image-20200912181723291.png" alt="image-20200912181723291" style="zoom:50%;" />

<h4 id="配置策略（部署生效）"><a href="#配置策略（部署生效）" class="headerlink" title="配置策略（部署生效）"></a>配置策略（部署生效）</h4><ul>
<li>默认deny any any</li>
</ul>
]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>Firepower</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei配置PPPoE</title>
    <url>/2020/07/27/Huawei%E9%85%8D%E7%BD%AEPPPoE.html</url>
    <content><![CDATA[<h1 id="Server"><a href="#Server" class="headerlink" title="Server:"></a>Server:</h1><h2 id="创建使能PPPOE认证的用户"><a href="#创建使能PPPOE认证的用户" class="headerlink" title="创建使能PPPOE认证的用户"></a>创建使能PPPOE认证的用户</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">aaa</span><br><span class="line"> local-user chen password cipher %$%$e<span class="string">'5!=dzDT-ZFQ4FOVrrBFK9S%$%$ </span></span><br><span class="line"><span class="string">  #创建用户</span></span><br><span class="line"><span class="string"> local-user chen service-type ppp  </span></span><br><span class="line"><span class="string">#用户服务类型</span></span><br></pre></td></tr></table></figure>

<h2 id="创建IP地址池，使能PPPOE客户IP地址分配"><a href="#创建IP地址池，使能PPPOE客户IP地址分配" class="headerlink" title="创建IP地址池，使能PPPOE客户IP地址分配"></a>创建IP地址池，使能PPPOE客户IP地址分配</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ip pool PPPoE3  </span><br><span class="line"><span class="comment">#地址池命名（PPPo）</span></span><br><span class="line"> network <span class="number">192.168</span><span class="number">.10</span><span class="number">.0</span> mask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>  </span><br><span class="line">  <span class="comment">#网络段及掩码</span></span><br><span class="line"> dns-list <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>  </span><br><span class="line"><span class="comment"># DNS</span></span><br></pre></td></tr></table></figure>

<h2 id="逻辑接口"><a href="#逻辑接口" class="headerlink" title="逻辑接口"></a>逻辑接口</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">interface Virtual-Template1  </span><br><span class="line"><span class="comment">#创建逻辑接口             </span></span><br><span class="line"> ppp authentication-mode chap  </span><br><span class="line">  <span class="comment">#认证为chap挑战握手协议          </span></span><br><span class="line"> remote address pool pppoe3 </span><br><span class="line"><span class="comment">#客户端获取IP指定到PPPOE3地址池             </span></span><br><span class="line"> ip address <span class="number">192.168</span><span class="number">.10</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line">  <span class="comment">#配置IP</span></span><br></pre></td></tr></table></figure>


<h2 id="物理接口绑定逻辑接口"><a href="#物理接口绑定逻辑接口" class="headerlink" title="物理接口绑定逻辑接口"></a>物理接口绑定逻辑接口</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>            </span><br><span class="line"> pppoe-server bind Virtual-Template <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="拨号成功后服务端状态"><a href="#拨号成功后服务端状态" class="headerlink" title="拨号成功后服务端状态"></a>拨号成功后服务端状态</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Interface                         IP Address/Mask      Physical   Protocol  </span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>              unassigned           up         down               </span><br><span class="line">Virtual-Template1                 <span class="number">10.10</span><span class="number">.10</span><span class="number">.1</span>/<span class="number">30</span>        up         up</span><br></pre></td></tr></table></figure>

<h1 id="Clinet-："><a href="#Clinet-：" class="headerlink" title="Clinet ："></a>Clinet ：</h1><h2 id="拨号权限"><a href="#拨号权限" class="headerlink" title="拨号权限"></a>拨号权限</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dialer-rule </span><br><span class="line"><span class="comment">#使能拨号权限</span></span><br><span class="line">dialer-rule <span class="number">1</span> ip permit </span><br><span class="line"><span class="comment">#创建拨号权限命名1 并使能 iP协议栈</span></span><br></pre></td></tr></table></figure>

<h2 id="拨号配置"><a href="#拨号配置" class="headerlink" title="拨号配置"></a>拨号配置</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">interface Dialer <span class="number">1</span></span><br><span class="line">ppp chap user chen </span><br><span class="line"><span class="comment">#拨号账号密码                     </span></span><br><span class="line"> ppp chap password cipher %$%$<span class="number">5</span>Zt-RJ~m0@V[\HIzL\N$,<span class="string">"`4%$%$</span></span><br><span class="line"><span class="string"> ip address ppp-negotiate   </span></span><br><span class="line"><span class="string"> #允许接口进行IP地址协商               </span></span><br><span class="line"><span class="string"> dialer user chen</span></span><br><span class="line"><span class="string">#启动共享                        </span></span><br><span class="line"><span class="string"> dialer bundle 1  </span></span><br><span class="line"><span class="string"># 关联拨号接口“1”                        </span></span><br><span class="line"><span class="string"> dialer-group 1 </span></span><br><span class="line"><span class="string"># 关联拨号组“1”</span></span><br></pre></td></tr></table></figure>

<h2 id="绑定接口"><a href="#绑定接口" class="headerlink" title="绑定接口"></a>绑定接口</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">interface GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>  </span><br><span class="line"><span class="comment">#物理端口与拨号接口关联“1”</span></span><br><span class="line">pppoe-client dial-bundle-number <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="进行拨号"><a href="#进行拨号" class="headerlink" title="进行拨号"></a>进行拨号</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">interface Dialer <span class="number">1</span></span><br><span class="line">ppp chap user chen</span><br><span class="line">ppp chap password cipher chen</span><br></pre></td></tr></table></figure>

<h2 id="拨号后Clinet正常状态"><a href="#拨号后Clinet正常状态" class="headerlink" title="拨号后Clinet正常状态"></a>拨号后Clinet正常状态</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">display ip interface  brief</span><br><span class="line">Interface                         IP Address/Mask      Physical   Protocol  </span><br><span class="line">Dialer1                           <span class="number">10.10</span><span class="number">.10</span><span class="number">.2</span>/<span class="number">32</span>        up         up(s)     </span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>              unassigned           up         down      </span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>              unassigned           down       down      </span><br><span class="line">NULL0                             unassigned           up         up(s)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Huawei</tag>
        <tag>PPPoE</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco VPN:SSL VPN</title>
    <url>/2020/07/28/Cisco_VPN_Anyconnect.html</url>
    <content><![CDATA[<h1 id="SSLVPN特点："><a href="#SSLVPN特点：" class="headerlink" title="SSLVPN特点："></a>SSLVPN特点：</h1><ul>
<li>不需要预先安装客户端软件</li>
<li>通过标准的网页浏览器建立VPN连接</li>
<li>使用浏览器本身支持的SSL安全技术提供数据私密性，完整性校验和源认证</li>
<li>提供细致的访问控制<ul>
<li>通过模式与权限的控制</li>
</ul>
</li>
<li>客户端运用程序可以通过多种方式动态的下载<ul>
<li>在线下载客户端</li>
<li>通过Activex分发下载</li>
<li>离线安装客户端</li>
</ul>
</li>
<li>在任何地点都能轻松的穿越防火墙和网络</li>
<li>8.X之后SSLVPN统称Anyconnect</li>
</ul>
<h1 id="Cisco-SSLVPN的四个工作模式"><a href="#Cisco-SSLVPN的四个工作模式" class="headerlink" title="Cisco SSLVPN的四个工作模式"></a>Cisco SSLVPN的四个工作模式</h1><h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><ul>
<li>Clientless Mode，基于网页的七层工作模型</li>
<li>无需安装任意客户端，无需执行任何配置，基于网络访问</li>
<li>代理服务器模式，数据包将使用代理服务器的IP地址访问资源</li>
<li>仅限于四个功能的访问<ul>
<li>HTTP</li>
<li>HTTPS</li>
<li>CIFS共享文件夹</li>
<li>FTP</li>
</ul>
</li>
</ul>
<h2 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h2><ul>
<li>Thin CLient Mode,瘦客户端模式接入，基于网页的七层工作模型</li>
<li>基于反向代理模式的一个扩展功能，依然使用代理服务器模型，基于网页访问</li>
<li>用于实现以命令行访问某个端口服务，例如<ul>
<li>Telnet     Port 23</li>
<li>SSH      Port 22</li>
<li>RDP      Port 3389</li>
</ul>
</li>
<li>无需支持动态端口协议，例如<code>FTP</code></li>
<li>客户端需要提前安装好<code>Java</code></li>
</ul>
<h2 id="终端服务"><a href="#终端服务" class="headerlink" title="终端服务"></a>终端服务</h2><ul>
<li>基于端口转发技术</li>
<li>客户端需要提前安装好<code>Java</code></li>
<li>使用代理器模型，接入设备将使用代理服务器IP去访问资源</li>
<li>基于反向代理模式的一个扩展功能，依然使用代理服务器模型，基于网页访问</li>
</ul>
<h2 id="Anyconnect"><a href="#Anyconnect" class="headerlink" title="Anyconnect"></a>Anyconnect</h2><ul>
<li>Thick Client Mode，厚客户端接入，基于客户端的三层工作模型</li>
<li>通过在线的方式，下载并安装用于拨号的软件<code>Anyconnect</code></li>
<li>实现了三层完整性访问任何应用，支持所有IP协议</li>
<li>路由器无法支持此模式</li>
</ul>
<h1 id="实验部分"><a href="#实验部分" class="headerlink" title="实验部分"></a>实验部分</h1><h2 id="反向代理模式基础配置"><a href="#反向代理模式基础配置" class="headerlink" title="反向代理模式基础配置"></a>反向代理模式基础配置</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><ul>
<li>IP地址如下</li>
<li>所有设备网关指向防火墙</li>
<li>Server和Win7需要提前安装Java</li>
</ul>
<h3 id="拓扑图如下"><a href="#拓扑图如下" class="headerlink" title="拓扑图如下"></a>拓扑图如下</h3><img src="../../../../images/Cisco_VPN_Anyconnect/image-20200808224227296.png" alt="image-20200808224227296" style="zoom:50%;" />

<h3 id="预配如下："><a href="#预配如下：" class="headerlink" title="预配如下："></a>预配如下：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ASAv</span></span><br><span class="line">interface e0</span><br><span class="line">  ip address <span class="number">7.7</span><span class="number">.1</span><span class="number">.254</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  nameif Inside</span><br><span class="line">  security-level <span class="number">100</span></span><br><span class="line">  no shutdown</span><br><span class="line">interface e1</span><br><span class="line">  ip address <span class="number">7.7</span><span class="number">.3</span><span class="number">.254</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  nameif Outside</span><br><span class="line">  security-level <span class="number">0</span></span><br><span class="line">  no shutdown</span><br><span class="line"><span class="comment">#IOS-Server</span></span><br><span class="line">interface e0/<span class="number">0</span></span><br><span class="line">  ip address <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  no shutdown</span><br><span class="line">  ip route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.254</span></span><br></pre></td></tr></table></figure>

<h3 id="IOS-Server配置以下服务"><a href="#IOS-Server配置以下服务" class="headerlink" title="IOS-Server配置以下服务"></a>IOS-Server配置以下服务</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置HTTP服务</span></span><br><span class="line">ip http server</span><br><span class="line">ip http authentication local</span><br><span class="line">username cisco privilege <span class="number">15</span> password cisco</span><br><span class="line"><span class="comment">#配置SSH和Telnet</span></span><br><span class="line">ip domain name Cisco.com</span><br><span class="line">crypto key generate rsa</span><br><span class="line">line vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">	password cisco</span><br><span class="line">	login</span><br><span class="line">	transport input all</span><br></pre></td></tr></table></figure>

<h3 id="配置防火墙ASDM"><a href="#配置防火墙ASDM" class="headerlink" title="配置防火墙ASDM"></a>配置防火墙ASDM</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http server enable <span class="number">500</span>   //不能使用默认<span class="number">443</span>端口，否则会和拨号VPN端口冲突</span><br><span class="line">http <span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> Inside  //允许源Inside区域<span class="number">7.7</span><span class="number">.1</span><span class="number">.0</span>的流量网关ASA</span><br></pre></td></tr></table></figure>

<h3 id="配置无客户端模式VPN"><a href="#配置无客户端模式VPN" class="headerlink" title="配置无客户端模式VPN"></a>配置无客户端模式VPN</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">webvpn</span><br><span class="line">	enable Outside</span><br><span class="line">  username cisco password cisco</span><br></pre></td></tr></table></figure>

<h3 id="测试远程拨号VPN"><a href="#测试远程拨号VPN" class="headerlink" title="测试远程拨号VPN"></a>测试远程拨号VPN</h3><img src="../../../../images/Cisco_VPN_Anyconnect/image-20200808232916425.png" alt="image-20200808232916425" style="zoom:50%;" />

<img src="../../../../images/Cisco_VPN_Anyconnect/image-20200808233652931.png" alt="image-20200808233652931" style="zoom:50%;" />

<h2 id="端口转发模式基础配置"><a href="#端口转发模式基础配置" class="headerlink" title="端口转发模式基础配置"></a>端口转发模式基础配置</h2><ul>
<li>基于反向代理实验继续进行</li>
</ul>
<h3 id="配置端口转发技术"><a href="#配置端口转发技术" class="headerlink" title="配置端口转发技术"></a>配置端口转发技术</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">webvpn</span><br><span class="line"><span class="comment">#当拨号设备Telnet本地1314端口时，会自动跳转到7.7.1.10的Telnet端口</span></span><br><span class="line">	port-forward port-forward IOS-Server-Telnet <span class="number">1314</span> <span class="number">7.7</span><span class="number">.1</span><span class="number">.10</span> telnet</span><br></pre></td></tr></table></figure>

<h3 id="关联端口转发到用户组策略中，然后将组策略关联给对应的用户"><a href="#关联端口转发到用户组策略中，然后将组策略关联给对应的用户" class="headerlink" title="关联端口转发到用户组策略中，然后将组策略关联给对应的用户"></a>关联端口转发到用户组策略中，然后将组策略关联给对应的用户</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">group-policy User-Group-Policy internal </span><br><span class="line">group-policy User-Group-Policy attributes </span><br><span class="line">	vpn-idle-timeout <span class="number">15</span>  //设置超时时间为<span class="number">15</span>分钟，默认为<span class="number">30</span>分钟</span><br><span class="line">webvpn</span><br><span class="line">	port-forward enable  IOS-Server-Telnet</span><br><span class="line">  </span><br><span class="line">username cisco password cisco  </span><br><span class="line">username cisco attributes</span><br><span class="line">	vpn-group-policy User-Group-Policy</span><br></pre></td></tr></table></figure>

<h2 id="Anyconnect模式基础配置"><a href="#Anyconnect模式基础配置" class="headerlink" title="Anyconnect模式基础配置"></a>Anyconnect模式基础配置</h2><h3 id="上传Anyconnect到ASA"><a href="#上传Anyconnect到ASA" class="headerlink" title="上传Anyconnect到ASA"></a>上传Anyconnect到ASA</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ciscoasa(config)<span class="comment">#copy tftp://7.7.1.134/Anyconnect.pkg disk0:Anyconnect.pkg</span></span><br><span class="line">ciscoasa(config)<span class="comment"># show flash:</span></span><br><span class="line">   <span class="number">82</span>  <span class="number">25356342</span>    Mar <span class="number">28</span> <span class="number">2020</span> <span class="number">14</span>:<span class="number">38</span>:<span class="number">02</span>  Anyconnect.pkg</span><br></pre></td></tr></table></figure>

<h3 id="配置远程拨号VPN以及使用镜像"><a href="#配置远程拨号VPN以及使用镜像" class="headerlink" title="配置远程拨号VPN以及使用镜像"></a>配置远程拨号VPN以及使用镜像</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http server enable <span class="number">500</span> 将http端口改为<span class="number">500</span></span><br><span class="line">http <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> Outside</span><br><span class="line">webvpn</span><br><span class="line"> enable Outside</span><br><span class="line"> anyconnect image disk0:/Anyconnect.pkg <span class="number">1</span></span><br><span class="line"> anyconnect enable</span><br></pre></td></tr></table></figure>

<h3 id="配置地址池"><a href="#配置地址池" class="headerlink" title="配置地址池"></a>配置地址池</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ip local pool SSLVPNPOOL <span class="number">172.16</span><span class="number">.1</span><span class="number">.100</span><span class="number">-172.16</span><span class="number">.1</span><span class="number">.200</span></span><br></pre></td></tr></table></figure>

<h3 id="配置组策略"><a href="#配置组策略" class="headerlink" title="配置组策略"></a>配置组策略</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">group-policy SSL-Policy internal</span><br><span class="line">group-policy SSL-Policy attributes</span><br><span class="line"> dns-server value <span class="number">7.7</span><span class="number">.1</span><span class="number">.29</span></span><br><span class="line"> vpn-tunnel-protocol ssl-client ssl-clientless</span><br><span class="line"> address-pools value SSLVPNPOOL</span><br></pre></td></tr></table></figure>

<h3 id="配置用户并关联组策略"><a href="#配置用户并关联组策略" class="headerlink" title="配置用户并关联组策略"></a>配置用户并关联组策略</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">username admin password Cisco123</span><br><span class="line">username admin attributes</span><br><span class="line"> vpn-group-policy SSL-Policy</span><br></pre></td></tr></table></figure>

<h3 id="配置NAT转换"><a href="#配置NAT转换" class="headerlink" title="配置NAT转换"></a>配置NAT转换</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">object network SSLVPNPOOL</span><br><span class="line"> subnet <span class="number">172.16</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">  nat (any,Outside) dynamic interface</span><br></pre></td></tr></table></figure>

<h3 id="放行同一接口进出流量"><a href="#放行同一接口进出流量" class="headerlink" title="放行同一接口进出流量"></a>放行同一接口进出流量</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">same-security-traffic permit intra-interface</span><br></pre></td></tr></table></figure>

<h3 id="打开浏览器下载客户端并安装"><a href="#打开浏览器下载客户端并安装" class="headerlink" title="打开浏览器下载客户端并安装"></a>打开浏览器下载客户端并安装</h3><img src="../../../../images/Cisco_VPN_Anyconnect/image-20200718023810269.png" alt="image-20200808233652931" style="zoom:50%;" />

<h3 id="输入IP进行连接"><a href="#输入IP进行连接" class="headerlink" title="输入IP进行连接"></a>输入IP进行连接</h3><blockquote>
<p>外网证书需要购买，如果只用内网，可以自己颁发证书</p>
</blockquote>
<h1 id="认证部分"><a href="#认证部分" class="headerlink" title="认证部分"></a>认证部分</h1><p>默认的WEBVPN策略，决定了所使用的认证数据库，默认使用<code>本地认证</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看思科默认存在的DefaultWEBVPNGroup</span></span><br><span class="line">ASA(config)<span class="comment"># show run all tunnel-group | b DefaultWEBVPNGroup</span></span><br><span class="line">tunnel-group DefaultWEBVPNGroup type remote-access</span><br><span class="line">tunnel-group DefaultWEBVPNGroup general-attributes</span><br><span class="line"> authentication-server-group LOCAL</span><br></pre></td></tr></table></figure>

<p>默认的GroupPolicy策略，决定了能够使用哪种模式接入SSLVPN服务器，默认使用<code>Clientless Mode</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看思科默认存在的DefaultWEBVPNGroup</span></span><br><span class="line">ASA(config)<span class="comment"># show run all tunnel-group | b DefaultWEBVPNGroup</span></span><br><span class="line"> default-group-policy DfltGrpPolicy</span><br><span class="line"><span class="comment">#查看思科默认存在的DfltGrpPolicy</span></span><br><span class="line">ASA(config)<span class="comment"># show run all group-policy | b DfltGrpPolicy </span></span><br><span class="line">group-policy DfltGrpPolicy internal</span><br><span class="line">group-policy DfltGrpPolicy attributes</span><br><span class="line"> vpn-tunnel-protocol ikev1 ikev2 l2tp-ipsec ssl-clientless</span><br></pre></td></tr></table></figure>

<h1 id="SSLVPN常见问题的处理方法"><a href="#SSLVPN常见问题的处理方法" class="headerlink" title="SSLVPN常见问题的处理方法"></a>SSLVPN常见问题的处理方法</h1><ul>
<li><p>端口号冲突<br>默认HTTPS网管和SSLVPN使用的都是端口号443，如果不更改，会导致端口号冲突</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http server enable <span class="number">500</span>  //更改HTTPS网管的端口号</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭浏览器等于注销SSLVPN吗？<br>直接关闭浏览器SSLVPN会话依然存在</p>
</li>
<li><p>SSLVPN使用AnyConnect Premium Peers授权，该授权决定SSLVPN并发会话数</p>
<ul>
<li>查看授权数量</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">show version | include Premium</span><br></pre></td></tr></table></figure>

<ul>
<li>查看VPN会话数</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">show vpn-sessiondb webvpn</span><br></pre></td></tr></table></figure>
<ul>
<li>强制注销VPN回话</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vpn-sessiondb logoff webvpn</span><br></pre></td></tr></table></figure>
</li>
<li><p>超过授权的并发会话数，会导致SSLVPN登录失败，清空VPN会话数即可</p>
</li>
<li><p>清除并发连接数依旧SSLVPN登录失败,重新敲一遍用户名密码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">username cisco password cisco</span><br></pre></td></tr></table></figure>
</li>
<li><p>如何设置SSLVPN的超时时间</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">group-policy User-Group-Policy internal </span><br><span class="line">group-policy User-Group-Policy attributes </span><br><span class="line">	vpn-idle-timeout <span class="number">15</span>  //设置超时时间为<span class="number">15</span>分钟，默认为<span class="number">30</span>分钟</span><br></pre></td></tr></table></figure>
</li>
<li><p>无客户端(浏览器) SSL VPN访问不允许clientless (browser) ssl vpn access is not allowed</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">webvpn</span><br><span class="line">	no anyconnect-essentials</span><br></pre></td></tr></table></figure>
</li>
<li><p>消息“AnyConnect在VPN服务器没有被启用”出现于浏览器在一个不成功的登录尝试以后。无客户端VPN协议在组策略没有被启用。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#寻找在日志的此消息：</span></span><br><span class="line"></span><br><span class="line">%ASA<span class="number">-6</span><span class="number">-716002</span>: Group &lt;DfltGrpPolicy&gt; User &lt;cisco&gt; IP &lt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>&gt;</span><br><span class="line"> WebVPN session terminated: Client type <span class="keyword">not</span> supported.</span><br><span class="line"></span><br><span class="line"><span class="comment">#切记无客户端VPN协议为期望组策略是启用的：</span></span><br><span class="line"></span><br><span class="line">ASA(config)<span class="comment"># show run all group-policy | include vpn-tunnel-protocol</span></span><br><span class="line">	vpn-tunnel-protocol ikev1 ikev2 l2tp-ipsec ssl-clientless</span><br></pre></td></tr></table></figure>
</li>
<li><p>仅三个WebVPN客户端能连接到ASA。连接第四个客户端时将失败。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#默认为3，可更改</span></span><br><span class="line">group-policy DfltGrpPolicy attributes</span><br><span class="line">	vpn-simultaneous-logins <span class="number">3</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>VPN</tag>
        <tag>Anyconnect</tag>
        <tag>SSL</tag>
      </tags>
  </entry>
  <entry>
    <title>Python学习笔记1-环境配置</title>
    <url>/2020/07/28/Python%E5%AE%89%E8%A3%85%E4%B8%8E%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE.html</url>
    <content><![CDATA[<h1 id="Python介绍"><a href="#Python介绍" class="headerlink" title="Python介绍"></a>Python介绍</h1><p>Python是一种计算机程序设计语言。</p>
<p>Python应用方向</p>
<ul>
<li>常规软件开发</li>
<li>科学计算</li>
<li>自动化运维</li>
<li>云计算</li>
<li>WEB开发</li>
<li>网络爬虫</li>
<li>数据分析</li>
<li>人工智能</li>
</ul>
<p>Python的缺点：</p>
<ul>
<li><p>运行速度慢，和C程序相比非常慢，因为Python是解释型语言，你的代码在执行时会一行一行地翻译成CPU能理解的机器码，这个翻译过程非常耗时，所以很慢。而C程序是运行前直接编译成CPU能执行的机器码，所以非常快。</p>
</li>
<li><p>就是代码不能加密。如果要发布你的Python程序，实际上就是发布源代码，这一点跟C语言不同，C语言不用发布源代码，只需要把编译后的机器码（也就是你在Windows上常见的xxx.exe文件）发布出去。要从机器码反推出C代码是不可能的，所以，凡是编译型的语言，都没有这个问题，而解释型的语言，则必须把源码发布出去。</p>
</li>
</ul>
<h1 id="Python安装"><a href="#Python安装" class="headerlink" title="Python安装"></a>Python安装</h1><p>目前，Python有两个版本，一个是2.x版，一个是3.x版，这两个版本是不兼容的。由于3.x版越来越普及，此笔记为3.x笔记</p>
<h2 id="在Mac上安装Python"><a href="#在Mac上安装Python" class="headerlink" title="在Mac上安装Python"></a>在Mac上安装Python</h2><p>如果你正在使用Mac，系统是OS X&gt;=10.9，那么系统自带的Python版本是2.7。要安装最新的Python 3，有两个方法：</p>
<p>方法一：从Python官网下载Python 3的<a href="https://www.python.org/downloads/" target="_blank" rel="noopener">安装程序</a>，下载后双击运行并安装；</p>
<p>方法二：如果安装了<a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a>，直接通过命令<code>brew install python3</code>安装即可。</p>
<h2 id="在Windows上安装Python"><a href="#在Windows上安装Python" class="headerlink" title="在Windows上安装Python"></a>在Windows上安装Python</h2><p>首先，根据你的Windows版本（64位还是32位）从Python的官方网站下载Python 3对应的<a href="https://www.python.org/ftp/python/3.8.0/python-3.8.0-amd64.exe" target="_blank" rel="noopener">64位安装程序</a>或<a href="https://www.python.org/ftp/python/3.8.0/python-3.8.0.exe" target="_blank" rel="noopener">32位安装程序</a>，然后，运行下载的exe安装包</p>
<img src="../../../../images/Python%E5%AE%89%E8%A3%85%E4%B8%8E%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20200730050525185.png" alt="image-20200730050525185" style="zoom:50%;" />

<p>Windows会根据一个<code>Path</code>的环境变量设定的路径去查找<code>python.exe</code>，如果没找到，就会报错。如果在安装时漏掉了勾选<code>Add Python 3.7 to PATH</code>，那就要手动把<code>python.exe</code>所在的路径添加到Path中：</p>
<ul>
<li>右键点击”计算机”，然后点击”属性”</li>
<li>然后点击”高级系统设置”</li>
<li>选择”系统变量”窗口下面的”Path”,双击即可！</li>
<li>然后在”Path”行，添加python安装路径即可(我的D:\Python)。 <strong>ps：记住，路径直接用分号”；”隔开！</strong></li>
</ul>
<h1 id="Pycharm安装和基本配置"><a href="#Pycharm安装和基本配置" class="headerlink" title="Pycharm安装和基本配置"></a>Pycharm安装和基本配置</h1><p>PyCharm 是一款功能强大的 Python 编辑器。</p>
<p><a href="https://www.jetbrains.com/pycharm/download/" target="_blank" rel="noopener">Pycharm下载地址</a></p>
<img src="../../../../images/Python%E5%AE%89%E8%A3%85%E4%B8%8E%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/image-20200730052307514.png" alt="image-20200730052307514" style="zoom:50%;" />

<p>1、选择新建一个Python项目，新建项目路径可以在Location处选择。</p>
<p>2、Project Interpreter部分是选择新建项目所依赖的python库，第一个选项会在项目中简历一个venv（virtualenv）目录，这里存放一个虚拟的python环境。这里所有的类库依赖都可以直接脱离系统安装的python独立运行。</p>
<p>3、Existing Interpreter关联已经存在的python解释器，如果不想在项目中出现venv这个虚拟解释器就可以选择本地安装的python环境。（新手推荐）</p>
<h2 id="汉化"><a href="#汉化" class="headerlink" title="汉化"></a>汉化</h2><p><a href="https://github.com/pingfangx/jetbrains-in-chinese/tree/master/PyCharm" target="_blank" rel="noopener">下载版本相对应的汉化包</a></p>
<ul>
<li>拷贝到：安装目录/lib/</li>
<li>将原始语言文件更改名称备份</li>
<li>重启Pycharm即可</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>WCCP协议原理与应用</title>
    <url>/2020/08/09/WCCP%E5%8D%8F%E8%AE%AE%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8.html</url>
    <content><![CDATA[<h1 id="WCCP协议原理与应用"><a href="#WCCP协议原理与应用" class="headerlink" title="WCCP协议原理与应用"></a>WCCP协议原理与应用</h1><h2 id="WCCP协议简介"><a href="#WCCP协议简介" class="headerlink" title="WCCP协议简介"></a>WCCP协议简介</h2><ul>
<li>Web Cache Communication Protocol </li>
<li>思科1997年引入WCCP技术</li>
<li>I0S12.0（3）T后支持</li>
<li>透明重定向UDP/TCP数据包<ul>
<li>主要针对HTTP/HTTPS/FTP </li>
</ul>
</li>
<li>支持最多32个WCCP设备</li>
<li>可以使用MD5认证实现安全引擎注册</li>
<li>实现出和入接口流量的劫持</li>
</ul>
<h2 id="WCCP工作流程"><a href="#WCCP工作流程" class="headerlink" title="WCCP工作流程"></a>WCCP工作流程</h2><ul>
<li>客户PC通过浏览器发起请求</li>
<li>WCCP设备依据感兴趣流，将流量重定向到WSA<br>两种重定向方法:<ul>
<li>WSA与WCCP设备处于同一网段（考点）<br>WCP设备将感兴趣流数据包目的MAC重写WSA的MAC </li>
<li>WSA与WCCP设备处于不同网段<br>WCCP设备将感兴趣流数据包通过GRE隧道重定向到WSA</li>
</ul>
</li>
<li>流量抵达WSA，WSA将扮演服务器角色，提供两种服务<ul>
<li>若存在请求缓存，则直接回复请求</li>
<li>若不存在请求缓存，则发送请求给真实服务器，然后再将结果回复给客户PC</li>
</ul>
</li>
</ul>
<h2 id="WCCP流量劫持与分配"><a href="#WCCP流量劫持与分配" class="headerlink" title="WCCP流量劫持与分配"></a>WCCP流量劫持与分配</h2><ul>
<li>WSA如何确认感兴趣流?<ul>
<li>匹配流量方向</li>
<li>匹配访问控制列表</li>
</ul>
</li>
<li>WSA与WCCP设备之间的心跳维持<ul>
<li>每30秒互发信息维持</li>
<li>若超过30秒没有收到信息，则执行下一步的流量分配</li>
</ul>
</li>
<li>若存在其余在线的WSA，则流量由该WSA处理</li>
<li>若不存在任何在线WSA，则流量恢复正常转发，不再执行重定向（Fail_Open）</li>
</ul>
<h1 id="配置WCCP设备"><a href="#配置WCCP设备" class="headerlink" title="配置WCCP设备"></a>配置WCCP设备</h1><h2 id="防火墙上配置WCCP"><a href="#防火墙上配置WCCP" class="headerlink" title="防火墙上配置WCCP"></a>防火墙上配置WCCP</h2><ul>
<li>针对源为7.7.1.0/24网段的流量</li>
<li>重定向到WSA上执行处理</li>
<li>重定向端口号为80，443，21</li>
<li>服务ID为90</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#定义感兴趣流</span></span><br><span class="line">access-list WSA-Redirect permit ip <span class="number">7.7</span><span class="number">.2</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> any</span><br><span class="line"><span class="comment">#定义服务器地址</span></span><br><span class="line">access-list WSA-Server permit ip host <span class="number">7.7</span><span class="number">.2</span><span class="number">.30</span> any</span><br><span class="line"><span class="comment">#将感兴趣流重定向到服务器上，服务ID为90</span></span><br><span class="line">wccp <span class="number">90</span> redirect-list WSA-Redirect group-list WSA-Server</span><br><span class="line"><span class="comment">#入方向且匹配感兴趣的流量</span></span><br><span class="line">wccp interface Inside <span class="number">90</span> redirect <span class="keyword">in</span></span><br></pre></td></tr></table></figure>

<h2 id="WSA上配置WCCP"><a href="#WSA上配置WCCP" class="headerlink" title="WSA上配置WCCP"></a>WSA上配置WCCP</h2><pre class="mermaid">graph LR
  Network--> Transparent_Redirection-->Edit_Device-->Type改为WCCP_V2_Router-->Add_Device</pre>

<img src="../../../../images/WCCP%E5%8D%8F%E8%AE%AE%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/image-20200809022713960.png" alt="image-20200809022713960" style="zoom:50%;" />

<h2 id="防火墙查看WSA引擎注册情况"><a href="#防火墙查看WSA引擎注册情况" class="headerlink" title="防火墙查看WSA引擎注册情况"></a>防火墙查看WSA引擎注册情况</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASA<span class="comment"># show wccp</span></span><br><span class="line">Global WCCP information:</span><br><span class="line">    Router information:</span><br><span class="line">        Router Identifier:                   <span class="number">7.7</span><span class="number">.2</span><span class="number">.30</span></span><br><span class="line">        Protocol Version:                    <span class="number">2.0</span></span><br><span class="line"></span><br><span class="line">    Service Identifier: <span class="number">90</span></span><br><span class="line">        <span class="comment">#Number of Cache Engines:             1</span></span><br><span class="line">        Number of routers:                   <span class="number">0</span></span><br><span class="line">        Total Packets Redirected:            <span class="number">0</span></span><br><span class="line">        Redirect access-list:                WSA-Redirect</span><br><span class="line">        Total Connections Denied Redirect:   <span class="number">0</span></span><br><span class="line">        Total Packets Unassigned:            <span class="number">0</span></span><br><span class="line">        Group access-list:                   WSA-Server</span><br><span class="line">        Total Messages Denied to Group:      <span class="number">0</span></span><br><span class="line">        Total Authentication failures:       <span class="number">0</span></span><br><span class="line">        Total Bypassed Packets Received:     <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="防火墙查看重定向的流量端口号"><a href="#防火墙查看重定向的流量端口号" class="headerlink" title="防火墙查看重定向的流量端口号"></a>防火墙查看重定向的流量端口号</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ASA<span class="comment"># sh wccp 90 service </span></span><br><span class="line"></span><br><span class="line">WCCP service information definition:</span><br><span class="line">        Type:          Dynamic</span><br><span class="line">        Id:            <span class="number">90</span></span><br><span class="line">        Priority:      <span class="number">240</span></span><br><span class="line">        Protocol:      <span class="number">6</span></span><br><span class="line">        Options:       <span class="number">0x00000012</span></span><br><span class="line">        --------</span><br><span class="line">            Hash:      DstIP </span><br><span class="line">            Alt Hash:  -none-</span><br><span class="line">            Ports:     Destination:: <span class="number">21</span> <span class="number">80</span> <span class="number">443</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>ASA</tag>
        <tag>WSA</tag>
        <tag>WCCP</tag>
      </tags>
  </entry>
  <entry>
    <title>Hillstone高可用配置</title>
    <url>/2020/08/14/Hillstone%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7HA%E9%85%8D%E7%BD%AE.html</url>
    <content><![CDATA[<h1 id="高可用性介绍"><a href="#高可用性介绍" class="headerlink" title="高可用性介绍"></a>高可用性介绍</h1><h2 id="HA簇"><a href="#HA簇" class="headerlink" title="HA簇"></a>HA簇</h2><p>HA 簇是实现 HA 功能的设备的组合。对于外部网络设备而言，一个 HA 簇是一个单一的设备，处理网络流量和提供安全服务。HA 簇通过簇 ID 进行标识。为设备指定 HA 簇 ID 后，设备进入HA 状态，执行 HA 功能。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ha cluster cluster-id</span><br><span class="line"><span class="comment">#cluster-id – 指定 HA 簇 ID。范围是 1 到 7。</span></span><br><span class="line"><span class="comment">#在全局配置模式下使用该命令 no 的形式关闭设备的 HA 功能：</span></span><br><span class="line">no ha cluster</span><br></pre></td></tr></table></figure>

<h2 id="HA组"><a href="#HA组" class="headerlink" title="HA组"></a>HA组</h2><p>系统会对 HA 簇中相同 HA 组 ID 的设备，按照 HCMP 协议，根据设备的 HA 配置，进行主备选举。主设备处于活动状态处理网络流量，而当主设备出现故障时，其它设备代替主设备继续工作。当为安全设备设置簇 ID 时，组 ID 为 0 的 HA 组会自动创建。在 Active-Passive（A/P）模式中，设备仅具有 HA 组 0。在 Active-Active（A/A）模式中，目前的版本支持用户创建 2 个 HA 组，组 0 和组 1。</p>
<h2 id="HA同步"><a href="#HA同步" class="headerlink" title="HA同步"></a>HA同步</h2><p>同步的信息类型有三种：配置信息、文件以及 RDO（Runtime Dynamic Object）。RDO 的具体内容主要包括：</p>
<ul>
<li>会话信息（以下类型会话信息不会同步：到设备本身的会话、隧道会话、Deny Session、ICMP 会话以及 tentative 会话） </li>
<li>IPSec VPN 信息</li>
<li>SCVPN 信息</li>
<li>L2TP 信息</li>
<li>DNS 缓存映射条目</li>
<li>ARP 表 </li>
<li>PKI 信息</li>
<li>DHCP 信息</li>
<li>MAC 表 </li>
<li>Web 认证信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启用/禁用 HA 会话自动同步</span></span><br><span class="line">启用：ha sync rdo session</span><br><span class="line">禁用：no ha sync rdo sessio</span><br></pre></td></tr></table></figure>

<h1 id="模式配置"><a href="#模式配置" class="headerlink" title="模式配置"></a>模式配置</h1><h2 id="AP模式"><a href="#AP模式" class="headerlink" title="AP模式"></a>AP模式</h2><p>Active-Passive（A/P）模式：在 HA 簇中配置两台设备组成一个 HA 组，组内只有一台主设备。主设备处于活动状态，转发报文，同时将其所有网络和配置信息以及当前会话信息传递给备份设备。当主设备出现故障时，备份设备接替主设备工作，转发报文。这种 A/P模式具有较强冗余性，而且其网络结构简单，便于维护管理。</p>
<img src="../../../../images/Hillstone%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7HA%E9%85%8D%E7%BD%AE/image-20201021211507229.png" alt="image-20201021211507229" style="zoom:50%;" />

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#主配置</span></span><br><span class="line">configure    //进入全局模式</span><br><span class="line">ha link interface ethernet0/<span class="number">3</span>     //配置 HA 连接接口</span><br><span class="line">ha link ip <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.252</span>     //配置HA连接IP</span><br><span class="line">ha group <span class="number">0</span>      //配置HA组</span><br><span class="line">ha priority <span class="number">50</span>   //越小越优先</span><br><span class="line">ha preempt          //配置抢占</span><br><span class="line">arp <span class="number">15</span>    //配置arp个数</span><br><span class="line"></span><br><span class="line"><span class="comment">#备配置</span></span><br><span class="line">configure    //进入全局模式</span><br><span class="line">ha link interface ethernet0/<span class="number">3</span>     //配置 HA 连接接口</span><br><span class="line">ha link ip <span class="number">1.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.252</span>     //配置HA连接IP</span><br><span class="line">ha group <span class="number">0</span>      //配置HA组</span><br><span class="line">ha priority <span class="number">100</span>   //越小越优先</span><br><span class="line">arp <span class="number">15</span>    //配置arp个数</span><br></pre></td></tr></table></figure>

<h2 id="AA模式"><a href="#AA模式" class="headerlink" title="AA模式"></a>AA模式</h2><p>Active-Active（A/A）模式：当安全设备处于 NAT 模式、路由模式或两者的组合时，可以将 HA 簇中的两台设备都配置成主动，使两台设备同时运行各自的工作，且相互监测对方的情况。当其中一台设备发生故障时，另外一台设备运行其自身的工作并且接管故障设备的工作，以保证工作不间断，该模式称为 Active-Active 模式。这种 A/A 模式具有高性能以及负载均衡的优点。</p>
<img src="../../../../images/Hillstone%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7HA%E9%85%8D%E7%BD%AE/image-20201021211526279.png" alt="image-20201021211526279" style="zoom:50%;" />

<h3 id="设备A"><a href="#设备A" class="headerlink" title="设备A"></a>设备A</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ha group <span class="number">0</span></span><br><span class="line">arp <span class="number">15</span></span><br><span class="line">priority <span class="number">200</span>   <span class="comment">##作为group 0 的Master</span></span><br><span class="line">exit</span><br><span class="line">ha group <span class="number">1</span></span><br><span class="line">arp <span class="number">15</span></span><br><span class="line">priority <span class="number">50</span>   <span class="comment">##作为group 1 的Backup</span></span><br><span class="line">exit</span><br><span class="line">ha link interface HA0       <span class="comment">##配置数据同步链路接口</span></span><br><span class="line">ha link data interface Ethernet <span class="number">0</span>/<span class="number">0</span>     <span class="comment">##配置会话同步链路接口</span></span><br><span class="line">ha link ip <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>/<span class="number">24</span></span><br><span class="line">ha cluster <span class="number">1</span> peer-mode node <span class="number">0</span>     <span class="comment">#蔟ID只有0和1，配置0时，在group 0为Master</span></span><br><span class="line">ha traffic enable</span><br><span class="line">ha traffic first-packet        <span class="comment">##首包转发</span></span><br></pre></td></tr></table></figure>

<h3 id="设备B"><a href="#设备B" class="headerlink" title="设备B"></a>设备B</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ha group <span class="number">0</span></span><br><span class="line">arp <span class="number">15</span></span><br><span class="line">priority <span class="number">50</span> <span class="comment">##作为group 0 的Master</span></span><br><span class="line">exit</span><br><span class="line">ha group <span class="number">1</span></span><br><span class="line">arp <span class="number">15</span></span><br><span class="line">priority <span class="number">200</span>   <span class="comment">##作为group 1 的Backup</span></span><br><span class="line">exit</span><br><span class="line">ha link interface HA0       <span class="comment">##配置数据同步链路接口</span></span><br><span class="line">ha link data interface Ethernet <span class="number">0</span>/<span class="number">0</span>     <span class="comment">##配置会话同步链路接口</span></span><br><span class="line">ha link ip <span class="number">1.1</span><span class="number">.1</span><span class="number">.2</span>/<span class="number">24</span></span><br><span class="line">ha cluster <span class="number">1</span> peer-mode node <span class="number">1</span>    <span class="comment">#蔟ID只有0和1，配置1时，在group 1为Master</span></span><br><span class="line">ha traffic enable</span><br><span class="line">ha traffic first-packet      <span class="comment">##首包转发</span></span><br></pre></td></tr></table></figure>

<h3 id="配置接口"><a href="#配置接口" class="headerlink" title="配置接口"></a>配置接口</h3><blockquote>
<p>只能在Master设备配置</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置Master设备接口</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">1</span></span><br><span class="line">zone trust</span><br><span class="line">ip address <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">2</span></span><br><span class="line">zone untrust</span><br><span class="line">ip address <span class="number">10.10</span><span class="number">.2</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">3</span></span><br><span class="line">zone dmz</span><br><span class="line">ip address <span class="number">10.10</span><span class="number">.3</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment">#配置Backup设备接口</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">1</span>:<span class="number">1</span></span><br><span class="line">zone trust</span><br><span class="line">ip address <span class="number">10.10</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">2</span>:<span class="number">1</span></span><br><span class="line">zone untrust</span><br><span class="line">ip address <span class="number">10.10</span><span class="number">.2</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">3</span>:<span class="number">1</span></span><br><span class="line">zone dmz</span><br><span class="line">ip address <span class="number">10.10</span><span class="number">.3</span><span class="number">.3</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Hillstone</category>
      </categories>
      <tags>
        <tag>高可用性</tag>
        <tag>Hillstone</tag>
        <tag>HA</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP/IP协议基础</title>
    <url>/2020/08/19/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80.html</url>
    <content><![CDATA[<h1 id="OSI-和TCP-IP-的对应关系和协议"><a href="#OSI-和TCP-IP-的对应关系和协议" class="headerlink" title="OSI 和TCP/IP 的对应关系和协议"></a>OSI 和TCP/IP 的对应关系和协议</h1><p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-2d62ba265be486cb94ab531912aa3b9c_1440w.jpg" alt="img"></p>
<h1 id="OSI模型各层的基本作用"><a href="#OSI模型各层的基本作用" class="headerlink" title="OSI模型各层的基本作用"></a>OSI模型各层的基本作用</h1><p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-436927a69a3574532059a78623d3095d_1440w.jpg" alt="img"></p>
<h1 id="OSI模型的详解（但是对会话层、表示层、应用层合并为TCP-IP的应用层）"><a href="#OSI模型的详解（但是对会话层、表示层、应用层合并为TCP-IP的应用层）" class="headerlink" title="OSI模型的详解（但是对会话层、表示层、应用层合并为TCP/IP的应用层）"></a>OSI模型的详解（但是对会话层、表示层、应用层合并为TCP/IP的应用层）</h1><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-5ce0438c1e2c59840286b124fc70dd67_1440w.jpg" alt="img"></p>
<h2 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h2><p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-343093645638ea0839b71db5eba1f7c0_1440w.jpg" alt="img"></p>
<h2 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h2><p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-fb8534d86e40986e43449de6c35ebd14_1440w.jpg" alt="img"></p>
<h2 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h2><p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-991572825990575d273f653a78bcc5e7_1440w.jpg" alt="img"></p>
<h2 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h2><p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-31bff54e0720487afe37e5f3f282d231_1440w.jpg" alt="img"></p>
<h2 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h2><p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-741e4cd7f95897d6a61bd219e208f1c1_1440w.jpg" alt="img"></p>
<h1 id="以下为补充内容，可以帮助理解"><a href="#以下为补充内容，可以帮助理解" class="headerlink" title="以下为补充内容，可以帮助理解"></a>以下为补充内容，可以帮助理解</h1><h2 id="pc连网的设置详解"><a href="#pc连网的设置详解" class="headerlink" title="pc连网的设置详解"></a>pc连网的设置详解</h2><p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-b09a3718e0501f053b6ed418b087211b_1440w.jpg" alt="img"></p>
<h2 id="数据链路层数据包（以太网数据包）格式，除了应用层没有头部，其他都有"><a href="#数据链路层数据包（以太网数据包）格式，除了应用层没有头部，其他都有" class="headerlink" title="数据链路层数据包（以太网数据包）格式，除了应用层没有头部，其他都有"></a>数据链路层数据包（以太网数据包）格式，除了应用层没有头部，其他都有</h2><p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-3c8ab7e3f330238821adedea31b9c321_1440w.jpg" alt="img"></p>
<blockquote>
<p>由于以太网数据包的数据部分，最大长度为1500字节，当IP包过大时，会分割下来，但是每个分割包的头部都一样</p>
</blockquote>
<p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-5ce2810c5f0ed99ad92d7d3a43cc652c_1440w.jpg" alt="img"></p>
<h2 id="数据包在传送时的封装和解封装如下所示"><a href="#数据包在传送时的封装和解封装如下所示" class="headerlink" title="数据包在传送时的封装和解封装如下所示"></a>数据包在传送时的封装和解封装如下所示</h2><p><img src="../../../../images/TCP.IP%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80/v2-80430dbb37a1e42315a77e30448b34b2_1440w.jpg" alt="img"></p>
]]></content>
      <categories>
        <category>原理以及基础</category>
      </categories>
      <tags>
        <tag>OSI</tag>
        <tag>TCP/IP</tag>
      </tags>
  </entry>
  <entry>
    <title>删除launchpad中无法正常移除的图标</title>
    <url>/2020/08/14/%E5%88%A0%E9%99%A4launchpad%E4%B8%AD%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E7%A7%BB%E9%99%A4%E7%9A%84%E5%9B%BE%E6%A0%87.html</url>
    <content><![CDATA[<blockquote>
<p>思路：找到存放launchpad中图标的数据库，对数据库进行操作直接删除对于的图标。</p>
</blockquote>
<h3 id="第一步：找到com-apple-dock-launchpad文件夹："><a href="#第一步：找到com-apple-dock-launchpad文件夹：" class="headerlink" title="第一步：找到com.apple.dock.launchpad文件夹："></a>第一步：找到com.apple.dock.launchpad文件夹：</h3><p>打开一个folder，按<code>command+shift+G</code>，在前往当中输入地址<code>/private/var/folders</code>，然后在里边自己尝试找到<code>com.apple.dock.launchpad</code>这个文件夹，我的路径是<code>/private/var/folders/8v/.../0/com.apple.dock.launchpad</code>，省略号处应该大家都不一样，所以慢慢找，总之最后找到名为<code>com.apple.dock.launchpad</code>的文件夹。</p>
<h3 id="第二步：找到数据库，获取其路径："><a href="#第二步：找到数据库，获取其路径：" class="headerlink" title="第二步：找到数据库，获取其路径："></a>第二步：找到数据库，获取其路径：</h3><p>打开<code>com.apple.dock.launchpad</code> 文件夹<br>之后有一个<code>db</code>文件夹，再点进去有一个文件叫<code>db</code>,它就是我们要找的数据库（如图）</p>
<img src="../../../../images/%E5%88%A0%E9%99%A4launchpad%E4%B8%AD%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E7%A7%BB%E9%99%A4%E7%9A%84%E5%9B%BE%E6%A0%87/image-20200814122001724.png" alt="image-20200814122001724" style="zoom:50%;" />

<h3 id="第三步：开始对数据库进行操作"><a href="#第三步：开始对数据库进行操作" class="headerlink" title="第三步：开始对数据库进行操作"></a>第三步：开始对数据库进行操作</h3><p>打开终端：cd到刚才拷贝的路径<br>然后输入：<br><code>sqlite3 db &quot;delete from apps where title=&#39;应用名称&#39;;&quot;&amp;&amp;killall Dock</code><br>注意要将<code>应用名称</code>处替换成你要删除的图标的名称，然后回车即可。</p>
<p><strong>再回到launchpad看看，没有啦！</strong></p>
]]></content>
      <categories>
        <category>MacOS</category>
      </categories>
      <tags>
        <tag>MacOS</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP的三次握手与四次挥手</title>
    <url>/2020/08/19/TCP%E7%9A%84%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E4%B8%8E%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.html</url>
    <content><![CDATA[<h3 id="常用的熟知端口号"><a href="#常用的熟知端口号" class="headerlink" title="常用的熟知端口号"></a>常用的熟知端口号</h3><table>
<thead>
<tr>
<th>应用程序</th>
<th>FTP</th>
<th>TFTP</th>
<th>TELNET</th>
<th>SMTP</th>
<th>DNS</th>
<th>HTTP</th>
<th>SSH</th>
<th>MYSQL</th>
</tr>
</thead>
<tbody><tr>
<td>熟知端口</td>
<td>21,20</td>
<td>69</td>
<td>23</td>
<td>25</td>
<td>53</td>
<td>80</td>
<td>22</td>
<td>3306</td>
</tr>
<tr>
<td>传输层协议</td>
<td>TCP</td>
<td>UDP</td>
<td>TCP</td>
<td>TCP</td>
<td>UDP</td>
<td>TCP</td>
<td>TCP</td>
<td>TCP</td>
</tr>
</tbody></table>
<h3 id="TCP的概述"><a href="#TCP的概述" class="headerlink" title="TCP的概述"></a>TCP的概述</h3><blockquote>
<p>TCP把连接作为最基本的对象，每一条TCP连接都有两个端点，这种断点我们叫作套接字（socket），它的定义为端口号拼接到IP地址即构成了套接字，例如，若IP地址为192.3.4.16 而端口号为80，那么得到的套接字为192.3.4.16:80。</p>
</blockquote>
<h3 id="TCP报文首部"><a href="#TCP报文首部" class="headerlink" title="TCP报文首部"></a>TCP报文首部</h3><ol>
<li>源端口和目的端口，各占2个字节，分别写入源端口和目的端口；</li>
<li>序号，占4个字节，TCP连接中传送的字节流中的每个字节都按顺序编号。例如，一段报文的序号字段值是 301 ，而携带的数据共有100字段，显然下一个报文段（如果还有的话）的数据序号应该从401开始；</li>
<li>确认号，占4个字节，是期望收到对方下一个报文的第一个数据字节的序号。例如，B收到了A发送过来的报文，其序列号字段是501，而数据长度是200字节，这表明B正确的收到了A发送的到序号700为止的数据。因此，B期望收到A的下一个数据序号是701，于是B在发送给A的确认报文段中把确认号置为701；</li>
<li>数据偏移，占4位，它指出TCP报文的数据距离TCP报文段的起始处有多远；</li>
<li>保留，占6位，保留今后使用，但目前应都位0；</li>
<li>紧急URG，当URG=1，表明紧急指针字段有效。告诉系统此报文段中有紧急数据；</li>
<li>确认ACK，仅当ACK=1时，确认号字段才有效。TCP规定，在连接建立后所有报文的传输都必须把ACK置1；</li>
<li>推送PSH，当两个应用进程进行交互式通信时，有时在一端的应用进程希望在键入一个命令后立即就能收到对方的响应，这时候就将PSH=1；</li>
<li>复位RST，当RST=1，表明TCP连接中出现严重差错，必须释放连接，然后再重新建立连接；</li>
<li>同步SYN，在连接建立时用来同步序号。当SYN=1，ACK=0，表明是连接请求报文，若同意连接，则响应报文中应该使SYN=1，ACK=1；</li>
<li>终止FIN，用来释放连接。当FIN=1，表明此报文的发送方的数据已经发送完毕，并且要求释放；</li>
<li>窗口，占2字节，指的是通知接收方，发送本报文你需要有多大的空间来接受；</li>
<li>检验和，占2字节，校验首部和数据这两部分；</li>
<li>紧急指针，占2字节，指出本报文段中的紧急数据的字节数；</li>
<li>选项，长度可变，定义一些其他的可选的参数。</li>
</ol>
<h3 id="TCP连接的建立（三次握手）"><a href="#TCP连接的建立（三次握手）" class="headerlink" title="TCP连接的建立（三次握手）"></a>TCP连接的建立（三次握手）</h3><p><img src="../../../../images/TCP%E7%9A%84%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E4%B8%8E%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/format,png.gif" alt="这里写图片描述"></p>
<blockquote>
<p><strong>最开始的时候客户端和服务器都是处于CLOSED状态。主动打开连接的为客户端，被动打开连接的是服务器。</strong></p>
</blockquote>
<ol>
<li>TCP服务器进程先创建传输控制块TCB，时刻准备接受客户进程的连接请求，此时服务器就进入了LISTEN（监听）状态；</li>
<li>TCP客户进程也是先创建传输控制块TCB，然后向服务器发出连接请求报文，这是报文首部中的同部位SYN=1，同时选择一个初始序列号 seq=x ，此时，TCP客户端进程进入了 SYN-SENT（同步已发送状态）状态。TCP规定，SYN报文段（SYN=1的报文段）不能携带数据，但需要消耗掉一个序号。</li>
<li>TCP服务器收到请求报文后，如果同意连接，则发出确认报文。确认报文中应该 ACK=1，SYN=1，确认号是ack=x+1，同时也要为自己初始化一个序列号 seq=y，此时，TCP服务器进程进入了SYN-RCVD（同步收到）状态。这个报文也不能携带数据，但是同样要消耗一个序号。</li>
<li>TCP客户进程收到确认后，还要向服务器给出确认。确认报文的ACK=1，ack=y+1，自己的序列号seq=x+1，此时，TCP连接建立，客户端进入ESTABLISHED（已建立连接）状态。TCP规定，ACK报文段可以携带数据，但是如果不携带数据则不消耗序号。</li>
<li>当服务器收到客户端的确认后也进入ESTABLISHED状态，此后双方就可以开始通信了。<br><img src="../../../../images/TCP%E7%9A%84%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E4%B8%8E%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/format,png.png" alt="三次握手"></li>
</ol>
<h4 id="为什么TCP客户端最后还要发送一次确认呢？"><a href="#为什么TCP客户端最后还要发送一次确认呢？" class="headerlink" title="为什么TCP客户端最后还要发送一次确认呢？"></a>为什么TCP客户端最后还要发送一次确认呢？</h4><blockquote>
<p>一句话，主要防止已经失效的连接请求报文突然又传送到了服务器，从而产生错误。</p>
<p>如果使用的是两次握手建立连接，假设有这样一种场景，客户端发送了第一个请求连接并且没有丢失，只是因为在网络结点中滞留的时间太长了，由于TCP的客户端迟迟没有收到确认报文，以为服务器没有收到，此时重新向服务器发送这条报文，此后客户端和服务器经过两次握手完成连接，传输数据，然后关闭连接。此时此前滞留的那一次请求连接，网络通畅了到达了服务器，这个报文本该是失效的，但是，两次握手的机制将会让客户端和服务器再次建立连接，这将导致不必要的错误和资源的浪费。</p>
<p>如果采用的是三次握手，就算是那一次失效的报文传送过来了，服务端接受到了那条失效报文并且回复了确认报文，但是客户端不会再次发出确认。由于服务器收不到确认，就知道客户端并没有请求连接。</p>
</blockquote>
<h3 id="TCP连接的释放（四次挥手）"><a href="#TCP连接的释放（四次挥手）" class="headerlink" title="TCP连接的释放（四次挥手）"></a>TCP连接的释放（四次挥手）</h3><p><img src="../../../../images/TCP%E7%9A%84%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E4%B8%8E%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/format,png-20200819023406222.gif" alt="这里写图片描述"></p>
<blockquote>
<p>数据传输完毕后，双方都可释放连接。最开始的时候，客户端和服务器都是处于ESTABLISHED状态，然后客户端主动关闭，服务器被动关闭。</p>
</blockquote>
<ol>
<li>客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN=1，其序列号为seq=u（等于前面已经传送过来的数据的最后一个字节的序号加1），此时，客户端进入FIN-WAIT-1（终止等待1）状态。 TCP规定，FIN报文段即使不携带数据，也要消耗一个序号。</li>
<li>服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号seq=v，此时，服务端就进入了CLOSE-WAIT（关闭等待）状态。TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个CLOSE-WAIT状态持续的时间。</li>
<li>客户端收到服务器的确认请求后，此时，客户端就进入FIN-WAIT-2（终止等待2）状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。</li>
<li>服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN=1，ack=u+1，由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为seq=w，此时，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。</li>
<li>客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=w+1，而自己的序列号是seq=u+1，此时，客户端就进入了TIME-WAIT（时间等待）状态。注意此时TCP连接还没有释放，必须经过2∗*∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态。</li>
<li>服务器只要收到了客户端发出的确认，立即进入CLOSED状态。同样，撤销TCB后，就结束了这次的TCP连接。可以看到，服务器结束TCP连接的时间要比客户端早一些。</li>
</ol>
<p><img src="../../../../images/TCP%E7%9A%84%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E4%B8%8E%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/format,png-20200819023406208.png" alt="四次挥手"></p>
<h4 id="为什么客户端最后还要等待2MSL？"><a href="#为什么客户端最后还要等待2MSL？" class="headerlink" title="为什么客户端最后还要等待2MSL？"></a>为什么客户端最后还要等待2MSL？</h4><blockquote>
<p>MSL（Maximum Segment Lifetime），TCP允许不同的实现可以设置不同的MSL值。</p>
<p>第一，保证客户端发送的最后一个ACK报文能够到达服务器，因为这个ACK报文可能丢失，站在服务器的角度看来，我已经发送了FIN+ACK报文请求断开了，客户端还没有给我回应，应该是我发送的请求断开报文它没有收到，于是服务器又会重新发送一次，而客户端就能在这个2MSL时间段内收到这个重传的报文，接着给出回应报文，并且会重启2MSL计时器。</p>
<p>第二，防止类似与“三次握手”中提到了的“已经失效的连接请求报文段”出现在本连接中。客户端发送完最后一个确认报文后，在这个2MSL时间中，就可以使本连接持续的时间内所产生的所有报文段都从网络中消失。这样新的连接中不会出现旧连接的请求报文。</p>
</blockquote>
<h4 id="为什么建立连接是三次握手，关闭连接确是四次挥手呢？"><a href="#为什么建立连接是三次握手，关闭连接确是四次挥手呢？" class="headerlink" title="为什么建立连接是三次握手，关闭连接确是四次挥手呢？"></a>为什么建立连接是三次握手，关闭连接确是四次挥手呢？</h4><blockquote>
<p>建立连接的时候， 服务器在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。<br>而关闭连接时，服务器收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，而自己也未必全部数据都发送给对方了，所以己方可以立即关闭，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送，从而导致多了一次。</p>
</blockquote>
<h4 id="如果已经建立了连接，但是客户端突然出现故障了怎么办？"><a href="#如果已经建立了连接，但是客户端突然出现故障了怎么办？" class="headerlink" title="如果已经建立了连接，但是客户端突然出现故障了怎么办？"></a>如果已经建立了连接，但是客户端突然出现故障了怎么办？</h4><blockquote>
<p>TCP还设有一个保活计时器，显然，客户端如果出现故障，服务器不能一直等下去，白白浪费资源。服务器每收到一次客户端的请求后都会重新复位这个计时器，时间通常是设置为2小时，若两小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔75秒发送一次。若一连发送10个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。</p>
</blockquote>
]]></content>
      <categories>
        <category>原理以及基础</category>
      </categories>
      <tags>
        <tag>TCP/IP</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco配置VRRP</title>
    <url>/2020/10/16/Cisco%E9%85%8D%E7%BD%AEVRRP.html</url>
    <content><![CDATA[<h2 id="拓扑"><a href="#拓扑" class="headerlink" title="拓扑"></a>拓扑</h2><img src="../../../../images/Cisco%E9%85%8D%E7%BD%AEVRRP/image-20201016023524270.png" alt="image-20201016023524270" style="zoom:50%;" />

<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><ol>
<li><p>按拓扑配置基础互联地址，在ISP设备上配置loopback0接口，地址为1.1.1.1/24. </p>
</li>
<li><p>在Outside1和Outside2上配置NAT转换，访问外部网络。 </p>
</li>
<li><p>在Outside1和Outside2互联接口上配置VRRP，需要配置两个VRRP组，实现PC5和PC6访问外部网络流量负载。</p>
</li>
<li><p>PC5和PC6分别配置网关为254和253实现流量负载，各走各的</p>
</li>
</ol>
<h3 id="VRRP组1配置需求"><a href="#VRRP组1配置需求" class="headerlink" title="VRRP组1配置需求"></a>VRRP组1配置需求</h3><ol>
<li><p>VRRP:IP=192.168.1.254 </p>
</li>
<li><p>明文认证，密码为CCIE </p>
</li>
<li><p>开启抢占，并配置抢占延时为10s </p>
</li>
<li><p>配置Outside1为组1的Master </p>
</li>
<li><p>在在Outside1上配置track SLA,目的地址为1.1.1.1。如果SLA失效，要求主备切换，Outside2升级为Master，SLA正常后可以回切到Outside1。 </p>
</li>
</ol>
<h3 id="VRRP组2配置需求"><a href="#VRRP组2配置需求" class="headerlink" title="VRRP组2配置需求"></a>VRRP组2配置需求</h3><ol>
<li>VRRP:IP=192.168.1.253 </li>
<li>MD5认证，密码为CCNP </li>
<li>开启抢占，并配置抢占延时为5s</li>
<li>配置Outside2为组2的Master </li>
<li>在Outside2上配置track SLA，目的地址为1.1.1.1。如果SLA失效，要求主备切换，Outside1升级为Master，SLA正常后可以回切到Outside2。 </li>
</ol>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="配置IP及路由"><a href="#配置IP及路由" class="headerlink" title="配置IP及路由"></a>配置IP及路由</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ISP<span class="comment">#show ip int bri</span></span><br><span class="line">Interface                  IP-Address      OK? Method Status                Protocol</span><br><span class="line">Ethernet0/<span class="number">0</span>                <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span>        YES manual up                    up</span><br><span class="line">Ethernet0/<span class="number">1</span>                <span class="number">20.2</span><span class="number">.2</span><span class="number">.1</span>        YES manual up                    up</span><br><span class="line">Loopback0                  <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>         YES manual up                    up</span><br><span class="line">Outside1<span class="comment">#show ip int bri</span></span><br><span class="line">Interface                  IP-Address      OK? Method Status                Protocol</span><br><span class="line">Ethernet0/<span class="number">0</span>                <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span>        YES manual up                    up</span><br><span class="line">Ethernet0/<span class="number">1</span>                <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>     YES manual up                    up</span><br><span class="line">Outside2<span class="comment">#show ip int bri</span></span><br><span class="line">Interface                  IP-Address      OK? Method Status                Protocol</span><br><span class="line">Ethernet0/<span class="number">0</span>                <span class="number">20.2</span><span class="number">.2</span><span class="number">.3</span>        YES manual up                    up</span><br><span class="line">Ethernet0/<span class="number">1</span>                <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>     YES manual up                    up</span><br><span class="line">PC5&gt; show ip</span><br><span class="line"></span><br><span class="line">NAME        : PC5[<span class="number">1</span>]</span><br><span class="line">IP/MASK     : <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span>/<span class="number">24</span>   <span class="comment">#PC5的IP：192.168.1.101</span></span><br><span class="line">GATEWAY     : <span class="number">192.168</span><span class="number">.1</span><span class="number">.253</span>      <span class="comment">#PC5网关253</span></span><br><span class="line">DNS         :</span><br><span class="line">MAC         : <span class="number">00</span>:<span class="number">50</span>:<span class="number">79</span>:<span class="number">66</span>:<span class="number">68</span>:<span class="number">05</span></span><br><span class="line">LPORT       : <span class="number">20000</span></span><br><span class="line">RHOST:PORT  : <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">30000</span></span><br><span class="line">MTU         : <span class="number">1500</span></span><br><span class="line">PC6&gt; show ip</span><br><span class="line"></span><br><span class="line">NAME        : PC6[<span class="number">1</span>]</span><br><span class="line">IP/MASK     : <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>/<span class="number">24</span>    <span class="comment">#PC6的IP：192.168.1.102</span></span><br><span class="line">GATEWAY     : <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span>       <span class="comment">#PC6网关254</span></span><br><span class="line">DNS         :</span><br><span class="line">MAC         : <span class="number">00</span>:<span class="number">50</span>:<span class="number">79</span>:<span class="number">66</span>:<span class="number">68</span>:<span class="number">06</span></span><br><span class="line">LPORT       : <span class="number">20000</span></span><br><span class="line">RHOST:PORT  : <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">30000</span></span><br><span class="line">MTU         : <span class="number">1500</span></span><br><span class="line"></span><br><span class="line">Outside1(config-<span class="keyword">if</span>)<span class="comment">#ip route 0.0.0.0 0.0.0.0 10.1.1.1</span></span><br><span class="line">Outside2(config-<span class="keyword">if</span>)<span class="comment">#ip route 0.0.0.0 0.0.0.0 20.2.2.1</span></span><br></pre></td></tr></table></figure>

<h3 id="配置NAT"><a href="#配置NAT" class="headerlink" title="配置NAT"></a>配置NAT</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Outside1(config)<span class="comment">#int e0/0</span></span><br><span class="line">Outside1(config-<span class="keyword">if</span>)<span class="comment">#ip nat outside</span></span><br><span class="line">Outside1(config)<span class="comment">#int e0/1</span></span><br><span class="line">Outside1(config-<span class="keyword">if</span>)<span class="comment">#ip nat inside</span></span><br><span class="line">Outside1(config)<span class="comment">#access-list 1 permit 192.168.1.0 /24</span></span><br><span class="line">Outside1(config)<span class="comment">#ip nat inside source list 1 interface e0/0 overload</span></span><br><span class="line">Outside2(config)<span class="comment">#int e0/0</span></span><br><span class="line">Outside2(config-<span class="keyword">if</span>)<span class="comment">#ip nat outside</span></span><br><span class="line">Outside2(config)<span class="comment">#int e0/1</span></span><br><span class="line">Outside2(config-<span class="keyword">if</span>)<span class="comment">#ip nat inside</span></span><br><span class="line">Outside2(config)<span class="comment">#access-list 1 permit 192.168.1.0 /24</span></span><br><span class="line">Outside2(config)<span class="comment">#ip nat inside source list 1 interface e0/0 overload</span></span><br></pre></td></tr></table></figure>

<h3 id="配置VRRP"><a href="#配置VRRP" class="headerlink" title="配置VRRP"></a>配置VRRP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Outside1</span></span><br><span class="line">track <span class="number">1</span> interface Ethernet0/<span class="number">0</span> line-protocol   <span class="comment">#配置track SLA,监控外网接口，</span></span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> vrrp <span class="number">1</span> ip <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span>          <span class="comment">#配置VRRP组1的IP</span></span><br><span class="line"> vrrp <span class="number">1</span> timers advertise <span class="number">2</span>        <span class="comment">#配置通告时间2s</span></span><br><span class="line"> vrrp <span class="number">1</span> preempt delay minimum <span class="number">10</span>   <span class="comment">#配置抢占时间10s，默认0</span></span><br><span class="line"> vrrp <span class="number">1</span> priority <span class="number">101</span>              <span class="comment">#配置优先级101，默认100，越大越优先</span></span><br><span class="line"> vrrp <span class="number">1</span> authentication CCIE      <span class="comment">#配置明文认证，密码CCIE</span></span><br><span class="line"> vrrp <span class="number">1</span> track <span class="number">1</span> decrement <span class="number">2</span>       <span class="comment">#组1关联track SLA，当监控接口Down时，则VRRP组的优先级降低2。</span></span><br><span class="line"> vrrp <span class="number">2</span> ip <span class="number">192.168</span><span class="number">.1</span><span class="number">.253</span></span><br><span class="line"> vrrp <span class="number">2</span> timers advertise <span class="number">2</span></span><br><span class="line"> vrrp <span class="number">2</span> preempt delay minimum <span class="number">5</span></span><br><span class="line"> vrrp <span class="number">2</span> authentication md5 key-string CCNP    <span class="comment">#md5认证，密码CCNP</span></span><br><span class="line"><span class="comment">#Outside2</span></span><br><span class="line">track <span class="number">1</span> interface Ethernet0/<span class="number">0</span> line-protocol</span><br><span class="line">interface Ethernet0/<span class="number">1</span></span><br><span class="line"> vrrp <span class="number">1</span> ip <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line"> vrrp <span class="number">1</span> timers advertise <span class="number">2</span></span><br><span class="line"> vrrp <span class="number">1</span> preempt delay minimum <span class="number">10</span></span><br><span class="line"> vrrp <span class="number">1</span> authentication CCIE</span><br><span class="line"> vrrp <span class="number">2</span> ip <span class="number">192.168</span><span class="number">.1</span><span class="number">.253</span></span><br><span class="line"> vrrp <span class="number">2</span> timers advertise <span class="number">2</span></span><br><span class="line"> vrrp <span class="number">2</span> preempt delay minimum <span class="number">5</span></span><br><span class="line"> vrrp <span class="number">2</span> priority <span class="number">101</span></span><br><span class="line"> vrrp <span class="number">2</span> authentication md5 key-string CCNP</span><br><span class="line"> vrrp <span class="number">2</span> track <span class="number">1</span> decrement <span class="number">2</span>        <span class="comment">#组2关联track SLA，当监控接口Down时，则VRRP组的优先级降低2。</span></span><br></pre></td></tr></table></figure>

<h3 id="查看VRRP状态"><a href="#查看VRRP状态" class="headerlink" title="查看VRRP状态"></a>查看VRRP状态</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Outside1<span class="comment">#show vrrp</span></span><br><span class="line">Ethernet0/<span class="number">1</span> - Group <span class="number">1</span></span><br><span class="line">  State <span class="keyword">is</span> Master</span><br><span class="line">  Virtual IP address <span class="keyword">is</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line">  Virtual MAC address <span class="keyword">is</span> <span class="number">0000.5e00</span><span class="number">.0101</span></span><br><span class="line">  Advertisement interval <span class="keyword">is</span> <span class="number">2.000</span> sec</span><br><span class="line">  Preemption enabled, delay min <span class="number">3</span> secs</span><br><span class="line">  Priority <span class="keyword">is</span> <span class="number">101</span></span><br><span class="line">    Track object <span class="number">1</span> state Up decrement <span class="number">2</span></span><br><span class="line">  Authentication text, string <span class="string">"CCIE"</span></span><br><span class="line">  Master Router <span class="keyword">is</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> (local), priority <span class="keyword">is</span> <span class="number">101</span></span><br><span class="line">  Master Advertisement interval <span class="keyword">is</span> <span class="number">2.000</span> sec</span><br><span class="line">  Master Down interval <span class="keyword">is</span> <span class="number">6.605</span> sec</span><br><span class="line"></span><br><span class="line">Ethernet0/<span class="number">1</span> - Group <span class="number">2</span></span><br><span class="line">  State <span class="keyword">is</span> Backup</span><br><span class="line">  Virtual IP address <span class="keyword">is</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.253</span></span><br><span class="line">  Virtual MAC address <span class="keyword">is</span> <span class="number">0000.5e00</span><span class="number">.0102</span></span><br><span class="line">  Advertisement interval <span class="keyword">is</span> <span class="number">2.000</span> sec</span><br><span class="line">  Preemption enabled, delay min <span class="number">3</span> secs</span><br><span class="line">  Priority <span class="keyword">is</span> <span class="number">100</span></span><br><span class="line">  Authentication MD5, key-string</span><br><span class="line">  Master Router <span class="keyword">is</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>, priority <span class="keyword">is</span> <span class="number">101</span></span><br><span class="line">  Master Advertisement interval <span class="keyword">is</span> <span class="number">2.000</span> sec</span><br><span class="line">  Master Down interval <span class="keyword">is</span> <span class="number">6.609</span> sec (expires <span class="keyword">in</span> <span class="number">6.074</span> sec)</span><br><span class="line">  </span><br><span class="line">Outside1<span class="comment">#show vrrp brief</span></span><br><span class="line">Interface          Grp Pri Time  Own Pre State   Master addr     Group addr</span><br><span class="line">Et0/<span class="number">1</span>              <span class="number">1</span>   <span class="number">101</span> <span class="number">6605</span>       Y  Master  <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>     <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line">Et0/<span class="number">1</span>              <span class="number">2</span>   <span class="number">100</span> <span class="number">6609</span>       Y  Backup  <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>     <span class="number">192.168</span><span class="number">.1</span><span class="number">.253</span></span><br></pre></td></tr></table></figure>

<h3 id="测试连通性"><a href="#测试连通性" class="headerlink" title="测试连通性"></a>测试连通性</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PC5&gt; ping <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="number">84</span> bytes <span class="keyword">from</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> icmp_seq=<span class="number">1</span> ttl=<span class="number">254</span> time=<span class="number">0.612</span> ms</span><br><span class="line"></span><br><span class="line">Outside2<span class="comment">#show ip nat translations</span></span><br><span class="line">Pro Inside <span class="keyword">global</span>      Inside local       Outside local      Outside <span class="keyword">global</span></span><br><span class="line">icmp <span class="number">20.2</span><span class="number">.2</span><span class="number">.3</span>:<span class="number">12959</span>    <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span>:<span class="number">12959</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>:<span class="number">12959</span>     <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>:<span class="number">12959</span></span><br><span class="line"></span><br><span class="line">PC6&gt; ping <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="number">84</span> bytes <span class="keyword">from</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> icmp_seq=<span class="number">1</span> ttl=<span class="number">254</span> time=<span class="number">0.612</span> ms</span><br><span class="line"></span><br><span class="line">Outside1<span class="comment">#show ip nat translations</span></span><br><span class="line">Pro Inside <span class="keyword">global</span>      Inside local       Outside local      Outside <span class="keyword">global</span></span><br><span class="line">icmp <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span>:<span class="number">13983</span>    <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>:<span class="number">13983</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>:<span class="number">13983</span>     <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>:<span class="number">13983</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>VRRP</tag>
      </tags>
  </entry>
  <entry>
    <title>绿盟下一代防火墙NF</title>
    <url>/2020/08/12/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF.html</url>
    <content><![CDATA[<h1 id="绿盟下一代防火墙NF"><a href="#绿盟下一代防火墙NF" class="headerlink" title="绿盟下一代防火墙NF"></a>绿盟下一代防火墙NF</h1><p>默认登陆名：weboper       ；</p>
<h1 id="透明模式部署"><a href="#透明模式部署" class="headerlink" title="透明模式部署"></a>透明模式部署</h1><h2 id="点到点虚拟线部署"><a href="#点到点虚拟线部署" class="headerlink" title="点到点虚拟线部署"></a>点到点虚拟线部署</h2><p>虚拟线模式，即将NF看作一根网线使用。一条虚拟线包括两个工作接口（一组in、out接口），可以保护内网用户不受来自Internet的攻击。</p>
<h3 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h3><ul>
<li>只允许IP范围10.10.10.2/24-10.10.10.50/24的内网用户访问外网的web服务</li>
<li>开启URL过滤，不允许内网用户访问URL分类为搜索引擎和门户网站和社交网</li>
</ul>
<h3 id="拓扑图如下："><a href="#拓扑图如下：" class="headerlink" title="拓扑图如下："></a>拓扑图如下：</h3><img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812113804714.png" alt="image-20200812113804714" style="zoom:50%;" />

<h3 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h3><ul>
<li>配置接口和虚拟线</li>
<li>配置网络对象、安全模版和安全策略<br>允许内网访问外网，开启URL过滤，同时开启安全防护日志记录</li>
<li>应用配置</li>
</ul>
<h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><ul>
<li>配置接口和虚拟线<ul>
<li>网络 –&gt; 接口 – &gt; 接口</li>
<li>编辑g1/1和g1/2接口，类型选择虚拟线</li>
<li>网络 –&gt; 虚拟线  –&gt; 虚拟线</li>
<li>新建虚拟线，名称test，将g1/1和g1/2接口加入虚拟线test中，接口链路状态同步选择<strong>是</strong>（虚拟线中一个接口down时，另一个也会down）</li>
</ul>
</li>
<li>配置网络对象、安全模版和安全策略<ul>
<li>对象 –&gt; 网络 –&gt; IP池</li>
<li>新建名称为内网用户的IP池，<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812115121596.png" alt="image-20200812115121596" style="zoom:50%;" /></li>
<li>对象 –&gt; 安全模版 –&gt; 新建URL过滤安全模版<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812115751451.png" alt="image-20200812115751451"></li>
<li>策略 –&gt; 安全策略 –&gt; 安全策略 –&gt; 新建内网用户访问外网的安全策略<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812120333673.png" alt="image-20200812120333673" style="zoom:50%;" /></li>
</ul>
</li>
<li>应用配置生效（不应用不生效）</li>
</ul>
<h1 id="路由模式部署"><a href="#路由模式部署" class="headerlink" title="路由模式部署"></a>路由模式部署</h1><h2 id="边界网关部署"><a href="#边界网关部署" class="headerlink" title="边界网关部署"></a>边界网关部署</h2><p>NF部署在网络边界，处于外网、内网和DMZ区域交界处，以三层路由模式接入网络。</p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><ul>
<li>允许用户认证的内网用户zhangsan和lisi访问外网Web应用，所有内网用户都通过NAT策略进行外网的Web访问。</li>
<li>DMZ区域的10.10.10.253和10.10.10.254对外提供Web服务，并进行服务器负载均衡（随机）</li>
<li>内网和外网用户均可通过公网地址访问DMZ区的Web服务</li>
<li>对所有访问进行安全防护和用户访问日志记录</li>
</ul>
<h3 id="拓扑图如下"><a href="#拓扑图如下" class="headerlink" title="拓扑图如下"></a>拓扑图如下</h3><img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812130347652.png" alt="image-20200812130347652" style="zoom:50%;" />

<h3 id="配置思路-1"><a href="#配置思路-1" class="headerlink" title="配置思路"></a>配置思路</h3><ul>
<li>配置接口以及默认路由</li>
<li>配置网络对象以及NAT策略<ul>
<li>配置源NAT策略，在内网用户访问外网时，将192.168.100.0/24转换为202.100.100.3</li>
<li>配置目的NAT策略，将DMZ区域10.10.10.253和254的Web做外网映射，并做服务器负载均衡，映射的地址为202.100.100.15</li>
<li>配置目的NAT策略，允许内网用户通过公网地址访问DMZ区Web应用</li>
</ul>
</li>
<li>配置安全模版以及安全策略<ul>
<li>配置安全策略，允许内网用户zhangsan和lisi访问外网Web应用，记录会话开始和结束的日志，同时开启，IPS、URL过滤、内容过滤以及病毒防护。</li>
<li>配置安全策略，允许内网和外网的任意用户访问DMZ区域的Web应用，记录会话开始和结束的日志，同时开启，IPS、URL过滤、内容过滤以及病毒防护。</li>
</ul>
</li>
<li>配置用户对象以及用户认证策略，对来自192.168.100.0/24的访问进行用户身份认证</li>
<li>应用配置，使配置生效</li>
</ul>
<h3 id="配置步骤-1"><a href="#配置步骤-1" class="headerlink" title="配置步骤"></a>配置步骤</h3><ul>
<li><p>配置接口以及默认路由</p>
<ul>
<li><p>网络 –&gt; 接口 –&gt; 接口，分别配置接口g1/1：192.168.100.1/24，g1/2：10.10.10.1/24，g1/3：202.100.100.3/24三个接口类型均为三层，所属安全区域依次为Intranet、DMZ以及Extranet。<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812132904066.png" alt="image-20200812132904066"></p>
</li>
<li><p>网络 –&gt; 路由 –&gt; 静态路由，添加一条默认路由（假设下一跳地址为202.100.100.100）<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812131825917.png" alt="image-20200812131825917" style="zoom:100%;" /></p>
</li>
<li><blockquote>
<p>静态路由缺省管理距离为1，为了保证其他静态路由的优先级，默认路由的管理距离建议设置为大于1。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>配置网络对象以及NAT策略</p>
<ul>
<li>对象 –&gt; 网络 –&gt; 子网</li>
<li>新建名称为内网（子网）、外网出口（节点）、DNAT外网（节点）、以及253-254（IP池）四个网络对象</li>
<li>策略 –&gt; NAT –&gt; 源NAT</li>
<li>新建源NAT策略<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812133026634.png" alt="image-20200812133026634"></li>
<li>新建目的策略<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812133154284.png" alt="image-20200812133154284">)<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812133313192.png" alt="image-20200812133313192"></li>
</ul>
</li>
<li><p>配置安全模版以及安全策略</p>
<ul>
<li>对象 –&gt; 安全模版</li>
<li>新建入侵检测</li>
<li>新建URL过滤</li>
<li>新建防病毒</li>
<li>新建内容过滤策略</li>
<li>策略 –&gt; 安全策略 –&gt; 安全策略，访问外网策略<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812134125193.png" alt="image-20200812134125193"></li>
<li>策略 –&gt; 安全策略 –&gt; 安全策略，访问DMZ策略<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812134324930.png" alt="image-20200812134324930"></li>
</ul>
</li>
<li><p>配置对象以及用户认证策略</p>
<ul>
<li>对象 –&gt; 用户 –&gt; 用户</li>
<li>新建用户zhangsan和lisi</li>
<li>策略 –&gt; 用户认证  –&gt; 认证策略</li>
<li>新建用户认证策略<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812134715165.png" alt="image-20200812134715165"></li>
</ul>
</li>
</ul>
<h2 id="非对称路由模式部署"><a href="#非对称路由模式部署" class="headerlink" title="非对称路由模式部署"></a>非对称路由模式部署</h2><p>只有点到点虚拟线部署的两台NF才能配置非对称路由支持功能。</p>
<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812141144521.png" alt="image-20200812141144521" style="zoom:50%;" />

<ul>
<li>配置NF1接口<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812141412388.png" alt="image-20200812141412388"></li>
<li>配置NF1虚拟线<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812141449106.png" alt="image-20200812141449106" style="zoom:100%;" /></li>
<li>配置NF1网络对象<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812141531123.png" alt="image-20200812141531123"></li>
<li>配置NF1安全策略<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812141546572.png" alt="image-20200812141546572"></li>
<li>配置NF1非对称路由支持，网络 –&gt; 高可用性 –&gt; 非对称路由支持<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812141629487.png" alt="image-20200812141629487"></li>
<li>配置NF2接口<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812141728925.png" alt="image-20200812141728925"></li>
<li>配置NF2虚拟线<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812141743561.png" alt="image-20200812141743561"></li>
<li>配置NF2网络对象<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812141812093.png" alt="image-20200812141812093"></li>
<li>配置NF2安全策略<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812141826383.png" alt="image-20200812141826383"></li>
<li>配置NF2非对称路由支持<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812141843745.png" alt="image-20200812141843745"></li>
<li>应用配置</li>
</ul>
<h1 id="混合部署"><a href="#混合部署" class="headerlink" title="混合部署"></a>混合部署</h1><h3 id="需求-1"><a href="#需求-1" class="headerlink" title="需求"></a>需求</h3><ul>
<li>运维部（Vlan10:192.168.10.0/24）通过单臂路由访问ERP服务器（Vlan20:192.168.20.0/24）但只允许telnet应用，并配置用户认证策略，要求运维人员对ERP进行维护时需要进行登陆认证</li>
<li>员工1区和2区通过2层接入，彼此间可用互相访问，并且可以对ERP服务器进行ERP应用。</li>
<li>员工1区和2区的用户可以访问Web应用，但需要进行用户认证</li>
<li>DMZ区将IP地址10.10.10.2映射于外网，对外网提供Web服务</li>
<li>所有访问都必须进行一定程度的安全防护和用户访问日志记录。</li>
</ul>
<h3 id="拓扑图如下-1"><a href="#拓扑图如下-1" class="headerlink" title="拓扑图如下"></a>拓扑图如下</h3><img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812142610784.png" alt="image-20200812142610784" style="zoom:50%;" />

<h3 id="配置步骤-2"><a href="#配置步骤-2" class="headerlink" title="配置步骤"></a>配置步骤</h3><ul>
<li>配置安全区和接口<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812143526299.png" alt="image-20200812143526299" style="zoom:50%;" /><ul>
<li>layer2安全区：员工1区和员工2区</li>
<li>layer3安全区：<ul>
<li>员工安全区（包括员工1区和员工2区）</li>
<li>ERP管理安全区（包括运维部和ERP服务区）</li>
<li>DMZ区（使用系统DMZ）</li>
<li>外网区（使用系统Extranet）</li>
</ul>
</li>
<li>配置接口：<img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812144041136.png" alt="image-20200812144041136" style="zoom:50%;" /><ul>
<li>三层接口：g1/1、g1/2、g1/3</li>
<li>三层子接口：运维部和ERP服务器采用单臂路由模式与NF设备连接，故g1/1下还需要配置两个子接口g1/1.10和g1/1.20</li>
<li>二层接口：g1/4、g2/1</li>
<li>vlan接口：员工1区和员工2区通过该vlan接口与外网、ERP区进行数据路由</li>
</ul>
</li>
</ul>
</li>
<li>配置网络对象以及NAT策略<ul>
<li><img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812144536008.png" alt="image-20200812144536008" style="zoom:50%;" /><img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812144639388.png" alt="image-20200812144639388" style="zoom:50%;" /></li>
<li><img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812144813111.png" alt="image-20200812144813111" style="zoom:50%;" /><img src="../../../../images/%E7%BB%BF%E7%9B%9F%E4%B8%8B%E4%B8%80%E4%BB%A3%E9%98%B2%E7%81%AB%E5%A2%99NF/image-20200812144910442.png" alt="image-20200812144910442" style="zoom:50%;" /></li>
</ul>
</li>
<li>配置安全模版</li>
<li>配置安全策略</li>
<li>配置用户对象</li>
<li>配置认证策略</li>
</ul>
]]></content>
      <categories>
        <category>绿盟</category>
      </categories>
      <tags>
        <tag>绿盟</tag>
        <tag>NF</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP/IP协议安全</title>
    <url>/2020/08/19/TCP.IP%E5%8D%8F%E8%AE%AE%E5%AE%89%E5%85%A8.html</url>
    <content><![CDATA[<h1 id="TCP-IP协议常见安全风险"><a href="#TCP-IP协议常见安全风险" class="headerlink" title="TCP/IP协议常见安全风险"></a>TCP/IP协议常见安全风险</h1><ul>
<li>应用层：漏洞、缓冲区溢出攻击、WEB攻击、病毒、木马等</li>
<li>传输层：TCP欺骗、TCP拒绝服务攻击、UDP拒绝服务攻击、端口扫描等</li>
<li>网络层：IP欺骗、Smurf攻击、ICMP攻击、地址扫描等</li>
<li>链路层：MAC欺骗、MAC泛洪、ARP欺骗等</li>
<li>物理层：物理破坏、线路侦听等</li>
</ul>
<h1 id="ARP欺骗"><a href="#ARP欺骗" class="headerlink" title="ARP欺骗"></a>ARP欺骗</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><strong>ARP欺骗</strong>（英语：<strong>ARP spoofing</strong>），又称<strong>ARP毒化</strong>（<strong>ARP poisoning</strong>，网络上多译为<strong>ARP病毒</strong>）或<strong>ARP攻击</strong>，是针对以太网地址解析协议地址解析协议ARP的一种攻击技术。此种攻击可让攻击者获取局域网上的数据包甚至可篡改数据包，且可让网络上特定计算机或所有计算机无法正常连线。</p>
<h2 id="运作机制"><a href="#运作机制" class="headerlink" title="运作机制"></a>运作机制</h2><p>ARP欺骗的运作原理是由攻击者发送假的ARP数据包到网上，尤其是送到网关上。其目的是要让送至特定的IP地址的流量被错误送到攻击者所取代的地方。因此攻击者可将这些流量另行转送到真正的网关（被动式数据包嗅探，passive sniffing）或是篡改后再转送（中间人攻击，<code>man-in-the-middle attack</code>）。攻击者亦可将ARP数据包导到不存在的MAC地址以达到阻断服务攻击的效果。</p>
<h2 id="防治方法"><a href="#防治方法" class="headerlink" title="防治方法"></a>防治方法</h2><p>最理想的防制方法是网上内的每台计算机的ARP一律改用静态的方式，不过这在大型的网上是不可行的，因为需要经常更新每台计算机的ARP表。</p>
]]></content>
      <categories>
        <category>原理以及基础</category>
      </categories>
      <tags>
        <tag>TCP/IP</tag>
      </tags>
  </entry>
  <entry>
    <title>快速生成Mac App icns 图标</title>
    <url>/2020/10/16/%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%20Mac%20App%20icns%E5%9B%BE%E6%A0%87.html</url>
    <content><![CDATA[<ol>
<li><p>准备一个 1024 * 1024 的png图片，假设名字为 <code>pic.png</code></p>
</li>
<li><p>命令行 <code>$ mkdir tmp.iconset</code>，创建一个临时目录存放不同大小的图片</p>
</li>
<li><p>把原图片转为不同大小的图片，并放入上面的临时目录</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 全部拷贝到命令行回车执行，执行结束之后去tmp.iconset查看十张图片是否生成好</span></span><br><span class="line">sips -z <span class="number">16</span> <span class="number">16</span>     pic.png --out tmp.iconset/icon_16x16.png</span><br><span class="line">sips -z <span class="number">32</span> <span class="number">32</span>     pic.png --out tmp.iconset/icon_16x16@<span class="number">2</span>x.png</span><br><span class="line">sips -z <span class="number">32</span> <span class="number">32</span>     pic.png --out tmp.iconset/icon_32x32.png</span><br><span class="line">sips -z <span class="number">64</span> <span class="number">64</span>     pic.png --out tmp.iconset/icon_32x32@<span class="number">2</span>x.png</span><br><span class="line">sips -z <span class="number">128</span> <span class="number">128</span>   pic.png --out tmp.iconset/icon_128x128.png</span><br><span class="line">sips -z <span class="number">256</span> <span class="number">256</span>   pic.png --out tmp.iconset/icon_128x128@<span class="number">2</span>x.png</span><br><span class="line">sips -z <span class="number">256</span> <span class="number">256</span>   pic.png --out tmp.iconset/icon_256x256.png</span><br><span class="line">sips -z <span class="number">512</span> <span class="number">512</span>   pic.png --out tmp.iconset/icon_256x256@<span class="number">2</span>x.png</span><br><span class="line">sips -z <span class="number">512</span> <span class="number">512</span>   pic.png --out tmp.iconset/icon_512x512.png</span><br><span class="line">sips -z <span class="number">1024</span> <span class="number">1024</span>   pic.png --out tmp.iconset/icon_512x512@<span class="number">2</span>x.png</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>通过<code>iconutil</code>生成icns文件 <code>$ iconutil -c icns tmp.iconset -o Icon.icns</code></li>
</ol>
]]></content>
      <categories>
        <category>MacOS</category>
      </categories>
      <tags>
        <tag>MacOS</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei USG防火墙与Cisco ASA防火墙IPSec对接</title>
    <url>/2020/10/16/Huawei%20USG%E9%98%B2%E7%81%AB%E5%A2%99%E4%B8%8ECisco%20ASA%E9%98%B2%E7%81%AB%E5%A2%99%E5%AF%B9%E6%8E%A5.html</url>
    <content><![CDATA[<p>Cisco ASA防火墙与USG设备分别为两企业内部网络的出口网关，通过在它们之间建立点到点的IPSec隧道，保证内网用户安全互访。 组网需求 如图所示，某公司有两个研究所，分别为研究所A和研究所B，其中USG作为研究所A内部网络的出口网关连接Internet；Cisco ASA 5510作为研究所B内部网络的出口网关连接Internet。 要求两个研究所的内部网络用户能通过Internet网络互相通信，且要保证数据在Internet上传输的安全性。</p>
<img src="../../../../images/%E5%8D%8E%E4%B8%BAUSG%E9%98%B2%E7%81%AB%E5%A2%99%E4%B8%8ECisco%20ASA%E9%98%B2%E7%81%AB%E5%A2%99%E5%AF%B9%E6%8E%A5/image-20201018032001190.png" alt="image-20201018032001190" style="zoom:50%;" />

<h2 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h2><ol>
<li>两个研究所之间需要互访，而两个研究所之间路由不可达，所以需要建立VPN隧道来实现。</li>
<li>由于两个研究所之间传输数据需要加密，所以采用IPSec VPN方式建立隧道，且研究所之间需要相互访问，所以只能用策略方式。</li>
<li>配置IPSec VPN隧道时，对等体之间建立隧道的参数需要保持统一，如加密算法、认证算法、协商模式、预共享密钥、IKE版本等都需要配置一致。</li>
</ol>
<h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><h3 id="配置USG"><a href="#配置USG" class="headerlink" title="配置USG"></a>配置USG</h3><ol>
<li><p>配置接口的IP地址，并将接口加入安全区域。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置GigabitEthernet 0/0/1的IP地址。</span></span><br><span class="line">&lt;USG&gt; system-view</span><br><span class="line">[USG] interface GigabitEthernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] ip address <span class="number">202.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] quit</span><br><span class="line"><span class="comment"># 配置GigabitEthernet 0/0/0的IP地址。</span></span><br><span class="line">[USG] interface GigabitEthernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>] ip address <span class="number">10.100</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>] quit</span><br><span class="line"><span class="comment"># 将GigabitEthernet 0/0/0加入Trust安全区域。</span></span><br><span class="line">[USG] firewall zone trust</span><br><span class="line">[USG-zone-trust] add interface GigabitEthernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[USG-zone-trust] quit</span><br><span class="line"><span class="comment"># 将GigabitEthernet 0/0/1加入Untrust安全区域。</span></span><br><span class="line">[USG] firewall zone untrust</span><br><span class="line">[USG-zone-untrust] add interface GigabitEthernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[USG-zone-untrust] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>开启Trust与Local、Trust与Untrust、Untrust与Local的域间缺省包过滤.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[USG] firewall packet-filter default permit interzone local trust</span><br><span class="line">[USG] firewall packet-filter default permit interzone local untrust</span><br><span class="line">[USG] firewall packet-filter default permit interzone trust untrust</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置访问控制列表，定义要保护的数据流。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置ACL 3000，定义源地址为10.100.1.0/24、目的地址为172.16.104.0/24的规则。</span></span><br><span class="line">[USG] acl number <span class="number">3000</span></span><br><span class="line">[USGacl-adv<span class="number">-3000</span>] rule permit ip source <span class="number">10.100</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span> destination <span class="number">172.16</span><span class="number">.104</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[USGacl-adv<span class="number">-3000</span>] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置路由。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置USG到研究所B内部网络的路由，此处假设到达研究所B内部网络的下一跳地址为202.1.1.2。</span></span><br><span class="line">[USG] ip route-static <span class="number">172.16</span><span class="number">.104</span><span class="number">.0</span> <span class="number">255</span> <span class="number">255.255</span><span class="number">.0</span> <span class="number">202.1</span><span class="number">.1</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置IPSec安全提议。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置IPSec安全提议。</span></span><br><span class="line">[USG] ipsec proposal <span class="number">1</span></span><br><span class="line"><span class="comment"># 配置IPSec协议的封装模式为隧道模式。</span></span><br><span class="line">[USG-ipsec-proposal<span class="number">-1</span>] encapsulation-mode tunnel</span><br><span class="line"><span class="comment"># 配置IPSec的安全协议为ESP。</span></span><br><span class="line">[USG-ipsec-proposal<span class="number">-1</span>] transform esp</span><br><span class="line"><span class="comment"># 配置ESP方式采用的认证算法为sha1。</span></span><br><span class="line">[USG-ipsec-proposal<span class="number">-1</span>] esp authentication-algorithm md5</span><br><span class="line"><span class="comment"># 配置ESP协议使用的加密算法为des。</span></span><br><span class="line">[USG-ipsec-proposal<span class="number">-1</span>] esp encryption-algorithm aes<span class="number">-128</span></span><br><span class="line">[USG-ipsec-proposal<span class="number">-1</span>] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置IKE安全提议。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置IKE安全提议。</span></span><br><span class="line">[USG] ike proposal <span class="number">1</span></span><br><span class="line"><span class="comment"># 配置IKE的认证方式为预共享密钥方式（pre-share）。</span></span><br><span class="line">[USG-ike-proposal<span class="number">-1</span>] authentication-method pre-share</span><br><span class="line"><span class="comment"># 配置IKE的认证算法为SHA1。</span></span><br><span class="line">[USG-ike-proposal<span class="number">-1</span>] authentication-algorithm md5</span><br><span class="line"><span class="comment"># 配置IKE的加密算法为DES。</span></span><br><span class="line">[USG-ike-proposal<span class="number">-1</span>] encryption-algorithm aes<span class="number">-128</span></span><br><span class="line"><span class="comment"># 配置IKE的完整性算法为hmac-sha1-96。</span></span><br><span class="line">[USG-ike-proposal<span class="number">-1</span>] integrity-algorithm hmac-sha2<span class="number">-256</span></span><br><span class="line">[USG-ike-proposal<span class="number">-1</span>] prf hmac-sha2<span class="number">-256</span></span><br><span class="line"><span class="comment"># 配置Diffie-Hellman组标识为group2。</span></span><br><span class="line">[USG-ike-proposal<span class="number">-1</span>] dh group2</span><br><span class="line"><span class="comment"># 配置安全联盟生存周期为100000。</span></span><br><span class="line">[USG-ike-proposal<span class="number">-1</span>] sa duration <span class="number">86400</span></span><br><span class="line">[USG-ike-proposal<span class="number">-1</span>] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置IKE对等体。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置IKE对等体</span></span><br><span class="line">[USG] ike peer <span class="number">1</span></span><br><span class="line"><span class="comment"># 因为Cisco ASA 5510只支持IKEv1，所以USG上也要配置成IKEv1。</span></span><br><span class="line">[USGike-peer<span class="number">-1</span>] undo version <span class="number">2</span></span><br><span class="line"><span class="comment"># 配置IKEv1的协商模式为主模式。</span></span><br><span class="line">[USGike-peer<span class="number">-1</span>] exchange-mode main</span><br><span class="line"><span class="comment"># 配置本端IP地址为202.1.1.1。</span></span><br><span class="line">[USGike-peer<span class="number">-1</span>] local-id <span class="number">202.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"><span class="comment"># 引用IKE安全提议1。</span></span><br><span class="line">[USGike-peer<span class="number">-1</span>] ike-proposal <span class="number">1</span></span><br><span class="line"><span class="comment"># 配置预共享密钥为abcdefg。</span></span><br><span class="line">[USGike-peer<span class="number">-1</span>] pre-shared-key abcdefg</span><br><span class="line">[USGike-peer<span class="number">-1</span>] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建安全策略。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建名为policy1的安全文本，并进入安全策略视图。</span></span><br><span class="line">[USG] ipsec policy-template policy1 <span class="number">1</span></span><br><span class="line"><span class="comment"># 在安全策略中引用ACL 3000。</span></span><br><span class="line">[USG-ipsec-policy-isakmp-test<span class="number">-10</span>] security acl <span class="number">3000</span></span><br><span class="line"><span class="comment"># 在安全策略中引用IPSec安全提议1。</span></span><br><span class="line">[USG-ipsec-policy-isakmp-test<span class="number">-10</span>] proposal <span class="number">1</span></span><br><span class="line"><span class="comment"># 在安全策略中引用IKE Peer 1。</span></span><br><span class="line">[USG-ipsec-policy-isakmp-test<span class="number">-10</span>] ike-peer <span class="number">1</span></span><br><span class="line"><span class="comment"># 给ipsec策略名称命名为emfs</span></span><br><span class="line">[USG-ipsec-policy-isakmp-test<span class="number">-10</span>] alias emfs</span><br><span class="line"><span class="comment"># ipsec为点对点认证</span></span><br><span class="line">[USG-ipsec-policy-isakmp-test<span class="number">-10</span>] scenario point-to-point</span><br><span class="line">[USG-ipsec-policy-isakmp-test<span class="number">-10</span>] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>将policy1安全文本关联给test安全策略</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ipsec policy test <span class="number">10000</span> isakmp template policy1</span><br></pre></td></tr></table></figure>
</li>
<li><p>在接口引用IPSec安全策略</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在GigabitEthernet 0/0/1上引用安全策略test。</span></span><br><span class="line">[USG] interface GigabitEthernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] ipsec policy test</span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] quit</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="配置Cisco-ASA"><a href="#配置Cisco-ASA" class="headerlink" title="配置Cisco ASA"></a>配置Cisco ASA</h3><ol>
<li><p>配置接口的IP地址，并设置接口的安全级别。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置Ethernet 0/0的IP地址。</span></span><br><span class="line">ciscoasa enable</span><br><span class="line">ciscoasa<span class="comment"># configure terminal</span></span><br><span class="line">ciscoasa(config)<span class="comment"># interface ethernet 0/0</span></span><br><span class="line">ciscoasa(config-<span class="keyword">if</span>)<span class="comment"># ip address 172.16.104.1 255.255.255.0</span></span><br><span class="line">ciscoasa(config-<span class="keyword">if</span>)<span class="comment"># nameif Inside</span></span><br><span class="line">ciscoasa(config-<span class="keyword">if</span>)<span class="comment"># security-level 100</span></span><br><span class="line">ciscoasa(config-<span class="keyword">if</span>)<span class="comment"># quit</span></span><br><span class="line"><span class="comment"># 配置Ethernet 0/1的IP地址。</span></span><br><span class="line">ciscoasa(config)<span class="comment"># interface ethernet 0/1</span></span><br><span class="line">ciscoasa(config-<span class="keyword">if</span>)<span class="comment"># ip address 202.1.2.1 255.255.255.0</span></span><br><span class="line">ciscoasa(config-<span class="keyword">if</span>)<span class="comment"># nameif Outside</span></span><br><span class="line">ciscoasa(config-<span class="keyword">if</span>)<span class="comment"># security-level 0</span></span><br><span class="line">ciscoasa(config-<span class="keyword">if</span>)<span class="comment"># quit</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置访问控制列表，允许报文通过inside接口</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ciscoasa(config)<span class="comment"># access-list any extended permit ip any any</span></span><br><span class="line">ciscoasa(config)<span class="comment"># access-group any in interface outside</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置访问控制列表，定义要保护的数据流。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ciscoasa(config)<span class="comment"># access-list ipsec extended permit ip 172.16.104.0 255.255.255.0 10.100.1.0 255.255.255.0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置路由。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置Cisco ASA 5510到研究所A内部网络的路由，此处假设到达研究所B内部网络的下一跳地址为202.1.2.2。</span></span><br><span class="line">route outside <span class="number">10.100</span><span class="number">.1</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">202.1</span><span class="number">.2</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置第一阶段策略</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">crypto ikev1 policy <span class="number">10</span>       </span><br><span class="line">authentication pre-share </span><br><span class="line">encryption <span class="number">3</span>des </span><br><span class="line">hash md5 </span><br><span class="line">group <span class="number">2</span></span><br><span class="line">lifetime <span class="number">86400</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置协商模式为主模式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">isakmp am-disable</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置预共享密钥认证</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置Tunnel Group的类型为LAN-to-LAN。</span></span><br><span class="line">tunnel-group <span class="number">202.1</span><span class="number">.1</span><span class="number">.1</span> type ipsec-l2l</span><br><span class="line"><span class="comment"># 配置IPSec隧道的预共享密钥为abcdefg，需要与对端保持一致。</span></span><br><span class="line">tunnel-group <span class="number">202.1</span><span class="number">.1</span><span class="number">.1</span> ipsec-attributes</span><br><span class="line">	ikev1 pre-shared-key abcdefg</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置第二阶段策略，并应用在出接口上。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ciscoasa(config)<span class="comment"># crypto ipsec ikev1 transform-set aaccac esp-des esp-md5-hmac</span></span><br><span class="line">crypto map cry-map <span class="number">10</span> match address ipsec</span><br><span class="line">crypto map cry-map <span class="number">10</span> set peer <span class="number">202.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">crypto map cry-map <span class="number">10</span> set ikev1 transform-set aaccac</span><br><span class="line">crypto map cry-map interface Outside</span><br></pre></td></tr></table></figure>

</li>
</ol>
]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>IPSec</tag>
        <tag>Huawei</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei配置VRRP</title>
    <url>/2020/10/16/Huawei%E9%85%8D%E7%BD%AEVRRP.html</url>
    <content><![CDATA[<h2 id="拓扑"><a href="#拓扑" class="headerlink" title="拓扑"></a>拓扑</h2><img src="../../../../images/Cisco%E9%85%8D%E7%BD%AEVRRP/image-20201016023524270.png" alt="image-20201016023524270" style="zoom:50%;" />

<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><ol>
<li><p>按拓扑配置基础互联地址，在ISP设备上配置loopback0接口，地址为1.1.1.1/24. </p>
</li>
<li><p>在Outside1和Outside2上配置NAT转换，访问外部网络。 </p>
</li>
<li><p>在Outside1和Outside2互联接口上配置VRRP，需要配置两个VRRP组，实现PC5和PC6访问外部网络流量负载。</p>
</li>
<li><p>PC5和PC6分别配置网关为254和253实现流量负载，各走各的</p>
</li>
</ol>
<h3 id="VRRP组1配置需求"><a href="#VRRP组1配置需求" class="headerlink" title="VRRP组1配置需求"></a>VRRP组1配置需求</h3><ol>
<li><p>VRRP:IP=192.168.1.254 </p>
</li>
<li><p>明文认证，密码为Huawei</p>
</li>
<li><p>开启抢占，并配置抢占延时为10s </p>
</li>
<li><p>配置Outside1为组1的Master </p>
</li>
<li><p>在在Outside1上配置track SLA,目的地址为1.1.1.1。如果SLA失效，要求主备切换，Outside2升级为Master，SLA正常后可以回切到Outside1。 </p>
</li>
</ol>
<h3 id="VRRP组2配置需求"><a href="#VRRP组2配置需求" class="headerlink" title="VRRP组2配置需求"></a>VRRP组2配置需求</h3><ol>
<li>VRRP:IP=192.168.1.253 </li>
<li>MD5认证，密码为HCIP</li>
<li>开启抢占，并配置抢占延时为5s</li>
<li>配置Outside2为组2的Master </li>
<li>在Outside2上配置track SLA，目的地址为1.1.1.1。如果SLA失效，要求主备切换，Outside1升级为Master，SLA正常后可以回切到Outside2。 </li>
</ol>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="配置IP及路由"><a href="#配置IP及路由" class="headerlink" title="配置IP及路由"></a>配置IP及路由</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[ISP]display ip interface bri</span><br><span class="line">Interface                  IP-Address      OK? Method Status                Protocol</span><br><span class="line">Ethernet0/<span class="number">0</span>                <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span>        YES manual up                    up</span><br><span class="line">Ethernet0/<span class="number">1</span>                <span class="number">20.2</span><span class="number">.2</span><span class="number">.1</span>        YES manual up                    up</span><br><span class="line">Loopback0                  <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>         YES manual up                    up</span><br><span class="line">[Outside1]display ip interface bri</span><br><span class="line">Interface                  IP-Address      OK? Method Status                Protocol</span><br><span class="line">Ethernet0/<span class="number">0</span>                <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span>        YES manual up                    up</span><br><span class="line">Ethernet0/<span class="number">1</span>                <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>     YES manual up                    up</span><br><span class="line">[Outside2]display ip interface bri</span><br><span class="line">Interface                  IP-Address      OK? Method Status                Protocol</span><br><span class="line">Ethernet0/<span class="number">0</span>                <span class="number">20.2</span><span class="number">.2</span><span class="number">.3</span>        YES manual up                    up</span><br><span class="line">Ethernet0/<span class="number">1</span>                <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>     YES manual up                    up</span><br><span class="line">PC5&gt; show ip</span><br><span class="line"></span><br><span class="line">NAME        : PC5[<span class="number">1</span>]</span><br><span class="line">IP/MASK     : <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span>/<span class="number">24</span>   <span class="comment">#PC5的IP：192.168.1.101</span></span><br><span class="line">GATEWAY     : <span class="number">192.168</span><span class="number">.1</span><span class="number">.253</span>      <span class="comment">#PC5网关253</span></span><br><span class="line">DNS         :</span><br><span class="line">MAC         : <span class="number">00</span>:<span class="number">50</span>:<span class="number">79</span>:<span class="number">66</span>:<span class="number">68</span>:<span class="number">05</span></span><br><span class="line">LPORT       : <span class="number">20000</span></span><br><span class="line">RHOST:PORT  : <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">30000</span></span><br><span class="line">MTU         : <span class="number">1500</span></span><br><span class="line">PC6&gt; show ip</span><br><span class="line"></span><br><span class="line">NAME        : PC6[<span class="number">1</span>]</span><br><span class="line">IP/MASK     : <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>/<span class="number">24</span>    <span class="comment">#PC6的IP：192.168.1.102</span></span><br><span class="line">GATEWAY     : <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span>       <span class="comment">#PC6网关254</span></span><br><span class="line">DNS         :</span><br><span class="line">MAC         : <span class="number">00</span>:<span class="number">50</span>:<span class="number">79</span>:<span class="number">66</span>:<span class="number">68</span>:<span class="number">06</span></span><br><span class="line">LPORT       : <span class="number">20000</span></span><br><span class="line">RHOST:PORT  : <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">30000</span></span><br><span class="line">MTU         : <span class="number">1500</span></span><br><span class="line"></span><br><span class="line">[Outside1]ip routing-table <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">[Outside2]ip routing-table <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">20.2</span><span class="number">.2</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h3 id="配置NAT"><a href="#配置NAT" class="headerlink" title="配置NAT"></a>配置NAT</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Outside1&amp;Outside2</span></span><br><span class="line">acl number <span class="number">2000</span></span><br><span class="line">rule <span class="number">5</span> permit source <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">interface ethernet0/<span class="number">0</span></span><br><span class="line">nat outbound <span class="number">2000</span></span><br></pre></td></tr></table></figure>

<h3 id="配置VRRP"><a href="#配置VRRP" class="headerlink" title="配置VRRP"></a>配置VRRP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Outside1</span></span><br><span class="line">bfd</span><br><span class="line">bfd arm bind peer-ip <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> interface ethernet0/<span class="number">0</span> one-arm-echo</span><br><span class="line">discriminator local <span class="number">10</span></span><br><span class="line">commit</span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">1</span></span><br><span class="line">vrrp vrid <span class="number">1</span> virtual-ip <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line">vrrp vrid <span class="number">1</span> priority <span class="number">110</span></span><br><span class="line">vrrp vrid <span class="number">1</span> preempt-mode timer delay <span class="number">10</span></span><br><span class="line">vrrp vrid <span class="number">1</span> authentication-mode simple cipher Huawei</span><br><span class="line">vrrp vrid <span class="number">2</span> virtual-ip <span class="number">192.168</span><span class="number">.1</span><span class="number">.253</span></span><br><span class="line">vrrp vrid <span class="number">2</span> preempt-mode timer delay <span class="number">5</span></span><br><span class="line">vrrp vrid <span class="number">2</span> authentication-mode md5 HCIP</span><br><span class="line"></span><br><span class="line"><span class="comment">#Outside2</span></span><br><span class="line">bfd</span><br><span class="line">bfd double bind peer-ip <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> source-ip <span class="number">20.2</span><span class="number">.2</span><span class="number">.3</span> auto</span><br><span class="line">interface ethernet <span class="number">0</span>/<span class="number">1</span></span><br><span class="line">vrrp vrid <span class="number">1</span> virtual-ip <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line">vrrp vrid <span class="number">1</span> preempt-mode timer delay <span class="number">10</span></span><br><span class="line">vrrp vrid <span class="number">1</span> authentication-mode simple cipher Huawei</span><br><span class="line">vrrp vrid <span class="number">2</span> virtual-ip <span class="number">192.168</span><span class="number">.1</span><span class="number">.253</span></span><br><span class="line">vrrp vrid <span class="number">2</span> priority <span class="number">110</span></span><br><span class="line">vrrp vrid <span class="number">2</span> preempt-mode timer delay <span class="number">5</span></span><br><span class="line">vrrp vrid <span class="number">2</span> track bfd-session session-name double reduced <span class="number">20</span></span><br><span class="line">vrrp vrid <span class="number">2</span> authentication-mode md5 HCIP</span><br><span class="line"></span><br><span class="line"><span class="comment">#ISP</span></span><br><span class="line">bfd</span><br><span class="line">bfd double bind peer-ip <span class="number">23.2</span><span class="number">.2</span><span class="number">.3</span> source-ip <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> auto</span><br></pre></td></tr></table></figure>

<h3 id="检测状态"><a href="#检测状态" class="headerlink" title="检测状态"></a>检测状态</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">display vrrp brief             <span class="comment">#查看vrrp状态</span></span><br><span class="line">display bfd session all        <span class="comment">#查看bfd建立情况</span></span><br></pre></td></tr></table></figure>

<h3 id="禁止ping通vrrp的虚拟IP地址"><a href="#禁止ping通vrrp的虚拟IP地址" class="headerlink" title="禁止ping通vrrp的虚拟IP地址"></a>禁止ping通vrrp的虚拟IP地址</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">undo vrrp virtual-ip ping enable</span><br></pre></td></tr></table></figure>

<h3 id="查看nat转换"><a href="#查看nat转换" class="headerlink" title="查看nat转换"></a>查看nat转换</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">display nat session all</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Huawei</tag>
        <tag>VRRP</tag>
      </tags>
  </entry>
  <entry>
    <title>安全基础知识</title>
    <url>/2020/10/16/%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html</url>
    <content><![CDATA[<h1 id="网络安全"><a href="#网络安全" class="headerlink" title="网络安全"></a>网络安全</h1><p>&ensp;&ensp; 很多的公司和环境并未使用第三方审计系统，未能根据记录数据进行分形，并生成 审计报表。其实审计系统是很重要的，可以进行操作溯源，这可比你一张嘴说的话有用多了。</p>
<p>&ensp;&ensp; 其实网络安全范围很广，还有比如说你可以将设备惊醒ARP绑定，那就可以避免arp攻击等，也可以购买入侵检测设备、入侵防御设备，防火墙等，网络设备定期修改密码，网络设备配置鉴别失败登录处理功能，配置操作超时等功能，尽量使用https协议加密传输。</p>
<p>&ensp;&ensp; 除上述以外，应定期自检(漏洞扫描、弱口令扫描、基线配置信息等)，对主机的端 口、弱口令、安全漏洞进行扫描和发现，对已知业务应用漏洞进行扫描和发现，对已知木马进行扫描和发现，对扫描结果进行分析和提交，促进业务安全性管理和安全问题的解决。</p>
<h1 id="主机安全"><a href="#主机安全" class="headerlink" title="主机安全"></a>主机安全</h1><p>&ensp;&ensp; 在现在大多数的公司中，操作系统未安装主机入侵检测系统，未能检测到对重要服务器进行入侵的行为，能够记录攻击者的源IP、攻击类型、攻击目标、攻击时间等，未能够在发生严重入侵事件时提供报警。很多人说，这个需要购买硬件WAF或者入侵防御设备，这个的确是个不小的花销，一般的公司估计也买不起，像我们，也买不起。但是并不是说我们毫无办法。我们可以在操作系统安装实时检测与查杀恶意代码的软件产品，对恶意代码实时检测与查杀，如OSSEC和 HIDS等，这些产品都是免费开源的。</p>
<p>&ensp;&ensp; 主机安全还包括系统配置安全、验证安全等等。就比如操作系统提供身份鉴别措施、配置鉴别失败处理功能（也就是登录尝试失败次数，这个可以有效防止恶意破解）、加强口令复杂度要求，在原基础上还应不含有常用字符组合、数字组合、键盘顺序等可预测密码组合、重要服务器用使用资源强制访问控制策略（如用户、进程、文件内核级保护）、应限制默认账户的访问权限，修改这些账户的默认口令，条件允许下，应重命名默认账户；</p>
<h1 id="应用安全"><a href="#应用安全" class="headerlink" title="应用安全"></a>应用安全</h1><ol>
<li>建议应用系统采用了两种或两种以上的组合机制进行用户身份鉴别； </li>
<li>建议应用系统对账号口令复杂度进行限制，口令长度限制为8-20位；要求口令为数字、字母字符至少两种组合，限制口令周期不大于半年； </li>
<li>建议应用系统启用登录失败处理功能，限制次数不大于5次，并且对登录失败用户进行帐号处理；</li>
<li>建议应用系统应启用用户身份鉴别信息复杂度要求和登录失败处理功能； </li>
<li>建议应用系统对重要信息资源设置敏感标记，系统不支持设置敏感标记的，应采用专用安全设备生成敏感标记，用以支持强制访问控制机制； </li>
<li>建议应用系统开启安全审计功能，安全审计范围覆盖到每个用户以及其相关操作；</li>
<li>建议应用系统开启安全审计功能，且审计功能不能中断和安全记录非管理员无法删除、修改或覆盖； </li>
<li>建议限制应用系统一段时间的并发会话连接数； </li>
<li>建议应用系统限制一个访问账号或一个请求进程的最大限额； </li>
<li>建议应用系统提供服务优先级设定功能，根据安全策略设定访问帐户或请求进程的优先级，根据优先级分配系统资源； </li>
</ol>
<h1 id="数据安全及备份恢复"><a href="#数据安全及备份恢复" class="headerlink" title="数据安全及备份恢复"></a>数据安全及备份恢复</h1><ol>
<li>建议提供异地数据备份功能，利用通信网络将关键数据定时批量传送到备用场地；</li>
<li>建议提供主要网络设备、通信线路和数据处理系统的硬件冗余，保证系统的高可用性；</li>
<li>数据的开发、测试环境如果要导入生产数据，则需要指定数据脱敏流程，将敏感的个人信息，如银行卡、手机号等信息做脱敏； </li>
<li>数据的访问要有严格的流程，非运维人员如要访问数据，在走完权限申请流程后，可以给予他读取的权限，但是不能给他将数据备份至本地的权限，该操作可以通过windows堡垒机进行权限限制，通过管理员将该人员的剪贴板禁用即可；</li>
<li>数据库一年要升级一次，即使你的数据库是放在内网的，但是你不能保证你们开发人员的代码不会被入侵，只要代码被入侵，或者被植入后门，就可以通过你的程序扫描到数据库。数据库的漏洞可不止一两个，基本上一年下来，一个稳定版本的数据库可以有30个左右的高危漏洞，50个左右的中危漏洞，这些个漏洞，你靠打补丁的方式根本不是解决办法，最好的方式还是升级到数据库最新版本前一个稳定版； </li>
</ol>
<h1 id="Web业务安全"><a href="#Web业务安全" class="headerlink" title="Web业务安全"></a>Web业务安全</h1><ol>
<li>应设置合理的会话超时阀值，在合理范围内尽可能减小会话超时阀值，可以降低会话被劫持和重复攻击的风险，超过会话超时阀值后立刻销毁会话，清除会话的信息；</li>
<li>应限制会话并发连接数，限制同一用户的会话并发连接数，避免恶意用户创建多个并发的会话来消耗系统资源，影响业务可用性； </li>
<li>应确保敏感信息通信信道的安全，建议在客户端与web服务器之间使用SSL。并正确配置SSL，建议使用SSL3.0/TLS1.0以上版本，对称加密密钥长度不少于128位，非对称加密密钥长度不少于1024位，单向散列值位数不小于128位； </li>
<li>日志记录范围应覆盖到每个用户的关键操作、重要行为、业务资源使用情况等重要事件。如普通用户异常登录、发布恶意代码、异常修改账号信息等行为，以及管理员在业务功能及账号控制方面的关键操作； </li>
<li>Web程序上线前或升级后应进行代码审计，形成报告，并对审计出的问题进行代码升级完善； </li>
<li>应禁止明文传输用户密码，建议采用SSL加密隧道确保用户密码的传输安全； </li>
<li>应对关键业务操作，例如修改用户认证鉴权信息（如密码、密码取回问题及答案、绑定手机号码等），需要经过二次鉴权，以避免因用户身份被冒用，给用户造成损失；</li>
<li>应避免认证错误提示泄露信息，在认证失败时，应向用户提供通用的错误提示信息，不应区分是账号错误还是密码错误，避免这些错误提示信息被攻击者利用； </li>
<li>应支持密码策略设置，从业务系统层面支持强制的密码策略，包括密码长度、复杂度、更换周期等，特别是业务系统的管理员密码； </li>
<li>应支持账号锁定功能，系统应限制连续登录失败次数，在客户端多次尝试失败后，服务器端需要对用户账号进行短时锁定，且锁定策略支持配置解锁时长； </li>
<li>应采取会话保护措施防止软件与服务器之间的会话不可被篡改、伪造、重放等；</li>
</ol>
]]></content>
      <categories>
        <category>原理以及基础</category>
      </categories>
      <tags>
        <tag>Security</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco交换机配置端口镜像</title>
    <url>/2020/10/27/Cisco%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%85%8D%E7%BD%AE%E7%AB%AF%E5%8F%A3%E9%95%9C%E5%83%8F.html</url>
    <content><![CDATA[<h2 id="SPAN-本地设备端口监控"><a href="#SPAN-本地设备端口监控" class="headerlink" title="SPAN:本地设备端口监控"></a>SPAN:本地设备端口监控</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">monitor session <span class="number">1</span> source interface ethernet <span class="number">0</span>/<span class="number">1</span> tx  <span class="comment">#tx意思是监控0/1接口发送的流量，rx为接收的流量，默认为both，即监控收发的流量</span></span><br><span class="line">monitor session <span class="number">1</span>  destination interface ethernet <span class="number">0</span>/<span class="number">2</span>  <span class="comment">#session 1里面接口0/1的流量复制一份发送到0/2，destination e0/2接口不能正常收发流量，只能接收镜像过来的流量</span></span><br></pre></td></tr></table></figure>

<h2 id="RSPAN：远端的设备端口口监控"><a href="#RSPAN：远端的设备端口口监控" class="headerlink" title="RSPAN：远端的设备端口口监控"></a>RSPAN：远端的设备端口口监控</h2><h3 id="在源端口交换机上配置："><a href="#在源端口交换机上配置：" class="headerlink" title="在源端口交换机上配置："></a>在源端口交换机上配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Switch1(config)<span class="comment">#vlan100  //vlan号必须独立于现网使用的vlan，不能和业务vlan相同，</span></span><br><span class="line">Switch1(config-vlan)<span class="comment">#name SPAN-VLAN  //为vlan 100名字配置为SPAN-VLAN</span></span><br><span class="line">Switch1(config-vlan)<span class="comment">#remote-span  //模式改成RSPAN，特殊vlan用来做端口镜像</span></span><br><span class="line">Switch1(config)<span class="comment">#monitor session 2 source interface Gig 0/1  //配置要抓取原端口的流量</span></span><br><span class="line">Switch1(config)<span class="comment">#monitor session 2 destination remote vlan 100  //目的端口配置为SPAN的vlan</span></span><br></pre></td></tr></table></figure>

<h3 id="在目的端口交换机上配置："><a href="#在目的端口交换机上配置：" class="headerlink" title="在目的端口交换机上配置："></a>在目的端口交换机上配置：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Switch2(config)<span class="comment">#vlan100  //vlan要和被抓取流量端口的交换机vlan要一致</span></span><br><span class="line">Switch2(config-vlan)<span class="comment">#name SPAN-VLAN  //为vlan 100名字配置为SPAN-VLAN</span></span><br><span class="line">Switch2(config-vlan)<span class="comment">#remote-span  //模式改成RSPAN，特殊vlan用来做端口镜像</span></span><br><span class="line">Switch2(config)<span class="comment">#monitor session 3 destination interface Gig 0/2  //配置要抓取原端口的流量，这里的session 号不需要和Switch1的一致</span></span><br><span class="line">Switch1(config)<span class="comment">#monitor session 3 source remote vlan 100  //目的端口配置为SPAN的vlan号</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>Monitor</tag>
      </tags>
  </entry>
  <entry>
    <title>如何用EXCEL函数把多行多列按顺序转为多行一列</title>
    <url>/2020/09/22/%E5%A6%82%E4%BD%95%E7%94%A8EXCEL%E5%87%BD%E6%95%B0%E6%8A%8A%E5%A4%9A%E8%A1%8C%E5%A4%9A%E5%88%97%E6%8C%89%E9%A1%BA%E5%BA%8F%E8%BD%AC%E4%B8%BA%E5%A4%9A%E8%A1%8C%E4%B8%80%E5%88%97.html</url>
    <content><![CDATA[<h1 id="使用环境"><a href="#使用环境" class="headerlink" title="使用环境"></a>使用环境</h1><ul>
<li>Office 2013</li>
<li>Windows 10</li>
</ul>
<h1 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h1><ul>
<li><p>将岗位列按顺序转为一列</p>
</li>
<li><p>目前每行列数不一致</p>
</li>
<li><p>如下图所示</p>
</li>
</ul>
<p><img src="../../../../images/%E5%A6%82%E4%BD%95%E7%94%A8EXCEL%E5%87%BD%E6%95%B0%E6%8A%8A%E5%A4%9A%E8%A1%8C%E5%A4%9A%E5%88%97%E6%8C%89%E9%A1%BA%E5%BA%8F%E8%BD%AC%E4%B8%BA%E5%A4%9A%E8%A1%8C%E4%B8%80%E5%88%97/image-20200922020853515.png" alt="image-20200922020853515"></p>
<h1 id="操作："><a href="#操作：" class="headerlink" title="操作："></a>操作：</h1><ul>
<li>从表中可以看出岗位列数最多为10列</li>
<li>C6单元格输入：（任意地方都可以。找个空白区域，只能在本文件操作）</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">=OFFSET(C$<span class="number">2</span>,INT((ROW(A1)<span class="number">-1</span>)/<span class="number">10</span>),MOD(ROW(A1)<span class="number">-1</span>,<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># C$2为开始的地方，在上面表中为张三的第一个岗位，</span></span><br><span class="line"><span class="comment"># A1不用改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果数据区域是4列的，公式就改为：=OFFSET(C$2,INT((ROW(A1)-1)/4),MOD(ROW(A1)-1,4))</span></span><br><span class="line"><span class="comment">#数据区域是5列的，公式改为；=OFFSET(C$2,INT((ROW(A1)-1)/5),MOD(ROW(A1)-1,5))，如此类推。</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>按下回车键，得出：<img src="../../../../images/%E5%A6%82%E4%BD%95%E7%94%A8EXCEL%E5%87%BD%E6%95%B0%E6%8A%8A%E5%A4%9A%E8%A1%8C%E5%A4%9A%E5%88%97%E6%8C%89%E9%A1%BA%E5%BA%8F%E8%BD%AC%E4%B8%BA%E5%A4%9A%E8%A1%8C%E4%B8%80%E5%88%97/image-20200922021522062.png" alt="image-20200922021522062"></p>
</li>
<li><p>然后，往下拉，填充公式。<img src="../../../../images/%E5%A6%82%E4%BD%95%E7%94%A8EXCEL%E5%87%BD%E6%95%B0%E6%8A%8A%E5%A4%9A%E8%A1%8C%E5%A4%9A%E5%88%97%E6%8C%89%E9%A1%BA%E5%BA%8F%E8%BD%AC%E4%B8%BA%E5%A4%9A%E8%A1%8C%E4%B8%80%E5%88%97/image-20200922021743427.png" alt="image-20200922021743427"></p>
</li>
<li><p>可以看出每行都会转为10列出来，岗位为空的会显示为0</p>
</li>
<li><p>然后将姓名和性别分别复制，每个十行，<font color="#dd00">李四多复制了两个，王二少了两个，图中姓名列有错误。</font><img src="../../../../images/%E5%A6%82%E4%BD%95%E7%94%A8EXCEL%E5%87%BD%E6%95%B0%E6%8A%8A%E5%A4%9A%E8%A1%8C%E5%A4%9A%E5%88%97%E6%8C%89%E9%A1%BA%E5%BA%8F%E8%BD%AC%E4%B8%BA%E5%A4%9A%E8%A1%8C%E4%B8%80%E5%88%97/image-20200922022033621.png" alt="image-20200922022033621"></p>
</li>
<li><p>最后进行筛选<img src="../../../../images/%E5%A6%82%E4%BD%95%E7%94%A8EXCEL%E5%87%BD%E6%95%B0%E6%8A%8A%E5%A4%9A%E8%A1%8C%E5%A4%9A%E5%88%97%E6%8C%89%E9%A1%BA%E5%BA%8F%E8%BD%AC%E4%B8%BA%E5%A4%9A%E8%A1%8C%E4%B8%80%E5%88%97/image-20200922022147904.png" alt="image-20200922022147904"></p>
</li>
<li><p>选中C列</p>
</li>
</ul>
<p>  <img src="../../../../images/%E5%A6%82%E4%BD%95%E7%94%A8EXCEL%E5%87%BD%E6%95%B0%E6%8A%8A%E5%A4%9A%E8%A1%8C%E5%A4%9A%E5%88%97%E6%8C%89%E9%A1%BA%E5%BA%8F%E8%BD%AC%E4%B8%BA%E5%A4%9A%E8%A1%8C%E4%B8%80%E5%88%97/image-20200922022310139.png" alt="image-20200922022310139"></p>
<ul>
<li><p>选中完成的区域，复制，然后黏贴到新的工作薄。</p>
<p><img src="../../../../images/%E5%A6%82%E4%BD%95%E7%94%A8EXCEL%E5%87%BD%E6%95%B0%E6%8A%8A%E5%A4%9A%E8%A1%8C%E5%A4%9A%E5%88%97%E6%8C%89%E9%A1%BA%E5%BA%8F%E8%BD%AC%E4%B8%BA%E5%A4%9A%E8%A1%8C%E4%B8%80%E5%88%97/image-20200922022607127.png" alt="image-20200922022607127"></p>
</li>
</ul>
]]></content>
      <categories>
        <category>办公小窍门</category>
      </categories>
      <tags>
        <tag>Office</tag>
      </tags>
  </entry>
  <entry>
    <title>snmp命令说明</title>
    <url>/2020/10/21/snmp%E5%91%BD%E4%BB%A4%E8%AF%B4%E6%98%8E.html</url>
    <content><![CDATA[<h1 id="SNMP命令"><a href="#SNMP命令" class="headerlink" title="SNMP命令"></a>SNMP命令</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">snmp-server community                  <span class="comment">#设置团体名及访问权限。</span></span><br><span class="line">snmp-server contact                    <span class="comment">#设置网络管理人员的标识及联系方法。</span></span><br><span class="line">snmp-server enable traps               <span class="comment">#禁止或允许系统发送Trap。</span></span><br><span class="line">snmp-server host                       <span class="comment">#设置Trap目标主机的IP地址。</span></span><br><span class="line">snmp-server location                   <span class="comment">#设置路由器的物理位置描述。</span></span><br><span class="line">snmp-server trap-authentication snmpv1 <span class="comment">#允许或禁止路由器发送Authentication Trap。</span></span><br><span class="line">show snmp                              <span class="comment">#查看snmp信息</span></span><br></pre></td></tr></table></figure>

<h2 id="snmp-server-community-ro-rw-community-name"><a href="#snmp-server-community-ro-rw-community-name" class="headerlink" title="snmp-server community { ro | rw } community-name"></a>snmp-server community { ro | rw } community-name</h2><h3 id="【参数说明】"><a href="#【参数说明】" class="headerlink" title="【参数说明】"></a>【参数说明】</h3><p>community-name为团体名，类型为字符串。<br>ro和rw表示该团体的访问权限有只读（read-only）和读写（read-write）两种。</p>
<h3 id="【缺省情况】"><a href="#【缺省情况】" class="headerlink" title="【缺省情况】"></a>【缺省情况】</h3><p>系统缺省认为具有只读权限的团体名为public，具有读写权限的团体名为private。</p>
<h3 id="【命令模式】"><a href="#【命令模式】" class="headerlink" title="【命令模式】"></a>【命令模式】</h3><p>全局配置模式</p>
<h3 id="【使用指南】"><a href="#【使用指南】" class="headerlink" title="【使用指南】"></a>【使用指南】</h3><p>SNMP v1 采用团体名认证方案，与设备认可的团体名不符的 SNMP 报文将被丢弃。不同的团体可具有只读（read-only）或读写（read-write）两种访问权限。具有只读权限的团体只能对设备信息进行查询，而具有读写权限的团体还可以对设备进行配置。</p>
<h3 id="【举例】"><a href="#【举例】" class="headerlink" title="【举例】"></a>【举例】</h3><p>设置public团体具有只读权限，private团体具有读写权限<br>Quidway(config)#snmp-server community ro public?<br>Quidway(config)#snmp-server community rw private?</p>
<h2 id="snmp-server-contact"><a href="#snmp-server-contact" class="headerlink" title="snmp-server contact"></a>snmp-server contact</h2><p>设置网络管理人员的标识及联系方法。<br>snmp-server contact sysContact</p>
<h3 id="【参数说明】-1"><a href="#【参数说明】-1" class="headerlink" title="【参数说明】"></a>【参数说明】</h3><p>sysContact为一字符串，表示网络管理人员的标识和联系方法。</p>
<h3 id="【缺省情况】-1"><a href="#【缺省情况】-1" class="headerlink" title="【缺省情况】"></a>【缺省情况】</h3><p>系统缺省的sysContact为SysAdmin。</p>
<h3 id="【命令模式】-1"><a href="#【命令模式】-1" class="headerlink" title="【命令模式】"></a>【命令模式】</h3><p>全局配置模式</p>
<h3 id="【使用指南】-1"><a href="#【使用指南】-1" class="headerlink" title="【使用指南】"></a>【使用指南】</h3><p>当网络出现故障时，可以根据此信息与网络管理人员进行联系。</p>
<h3 id="【举例】-1"><a href="#【举例】-1" class="headerlink" title="【举例】"></a>【举例】</h3><p>Quidway(config)#snmp-server contact sysadmin:XXX(Tel:1234)</p>
<h2 id="snmp-server-enable-traps"><a href="#snmp-server-enable-traps" class="headerlink" title="snmp-server enable traps"></a>snmp-server enable traps</h2><p>禁止或允许系统发送Trap。<br>[ no ] snmp-server enable traps</p>
<h3 id="【缺省情况】-2"><a href="#【缺省情况】-2" class="headerlink" title="【缺省情况】"></a>【缺省情况】</h3><p>系统缺省为允许发送Trap。</p>
<h3 id="【命令模式】-2"><a href="#【命令模式】-2" class="headerlink" title="【命令模式】"></a>【命令模式】</h3><p>全局配置模式</p>
<h3 id="【使用指南】-2"><a href="#【使用指南】-2" class="headerlink" title="【使用指南】"></a>【使用指南】</h3><p>Trap是被管理设备主动向NMS发送的不经请求的信息，用于报告一些紧急的重要事件。</p>
<h3 id="【举例】-2"><a href="#【举例】-2" class="headerlink" title="【举例】"></a>【举例】</h3><p>禁止系统发送Trap。<br>Quidway(config)#no snmp-server enable traps</p>
<h3 id="【相关命令】"><a href="#【相关命令】" class="headerlink" title="【相关命令】"></a>【相关命令】</h3><p>  snmp-server host</p>
<h2 id="snmp-server-host"><a href="#snmp-server-host" class="headerlink" title="snmp-server host"></a>snmp-server host</h2><p>设置Trap目标主机的IP地址。<br>snmp-server host host-ip-address</p>
<h3 id="【参数说明】-2"><a href="#【参数说明】-2" class="headerlink" title="【参数说明】"></a>【参数说明】</h3><p>host-ip-address为Trap目标主机的IP地址，为点分十进制格式。</p>
<h3 id="【命令模式】-3"><a href="#【命令模式】-3" class="headerlink" title="【命令模式】"></a>【命令模式】</h3><p>全局配置模式</p>
<h3 id="【使用指南】-3"><a href="#【使用指南】-3" class="headerlink" title="【使用指南】"></a>【使用指南】</h3><p>在允许系统发送Trap后，必须设置Trap目标主机的IP地址。</p>
<h3 id="【举例】-3"><a href="#【举例】-3" class="headerlink" title="【举例】"></a>【举例】</h3><p>设置Trap目标主机IP地址为129.102.0.1。<br>Quidway(config)#snmp-server host 129.102.0.1</p>
<h3 id="【相关命令】-1"><a href="#【相关命令】-1" class="headerlink" title="【相关命令】"></a>【相关命令】</h3><p>snmp-server enable traps</p>
<h2 id="snmp-server-location"><a href="#snmp-server-location" class="headerlink" title="snmp-server location"></a>snmp-server location</h2><p>设置路由器的物理位置描述。<br>snmp-server location sysLocation</p>
<h3 id="【参数说明】-3"><a href="#【参数说明】-3" class="headerlink" title="【参数说明】"></a>【参数说明】</h3><p>sysLocation为路由器所在物理位置的描述。</p>
<h3 id="【命令模式】-4"><a href="#【命令模式】-4" class="headerlink" title="【命令模式】"></a>【命令模式】</h3><p>全局配置模式</p>
<h3 id="【使用指南】-4"><a href="#【使用指南】-4" class="headerlink" title="【使用指南】"></a>【使用指南】</h3><p>为了便于网络管理人员能够很快找到路由器，可以查看此关于路由器物理位置的描述。</p>
<h3 id="【举例】-4"><a href="#【举例】-4" class="headerlink" title="【举例】"></a>【举例】</h3><p>Quidway(config)#snmp-server location beijing-huawei-401</p>
<h2 id="snmp-server-trap-authentication-snmpv1"><a href="#snmp-server-trap-authentication-snmpv1" class="headerlink" title="snmp-server trap-authentication snmpv1"></a>snmp-server trap-authentication snmpv1</h2><p>允许或禁止路由器发送Authentication Trap。<br>[ no ] snmp-server trap-authentication snmpv1</p>
<h3 id="【缺省情况】-3"><a href="#【缺省情况】-3" class="headerlink" title="【缺省情况】"></a>【缺省情况】</h3><p>系统缺省设置为允许发送Authentication Trap。</p>
<h3 id="【命令模式】-5"><a href="#【命令模式】-5" class="headerlink" title="【命令模式】"></a>【命令模式】</h3><p>全局配置模式</p>
<h3 id="【使用指南】-5"><a href="#【使用指南】-5" class="headerlink" title="【使用指南】"></a>【使用指南】</h3><p>Authentication Trap 是 Trap 的一种。如果允许发送 Authentication Trap，则当被管设备收到含有错误团体名的请求时，可向 NMS 发送验证失败报告（Authentication Trap）。</p>
<h3 id="【举例】-5"><a href="#【举例】-5" class="headerlink" title="【举例】"></a>【举例】</h3><p>禁止发送Authentication Trap。<br>Quidway(config)#no snmp-ser</p>
]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>SNMP</tag>
      </tags>
  </entry>
  <entry>
    <title>虚拟路由冗余协议VRRP原理介绍</title>
    <url>/2020/10/16/%E8%99%9A%E6%8B%9F%E8%B7%AF%E7%94%B1%E5%86%97%E4%BD%99%E5%8D%8F%E8%AE%AEVRRP%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D.html</url>
    <content><![CDATA[<h1 id="一、概述："><a href="#一、概述：" class="headerlink" title="一、概述："></a>一、概述：</h1><h2 id="产生背景"><a href="#产生背景" class="headerlink" title="产生背景"></a>产生背景</h2><p>&ensp;&ensp;随着Internet的发展，人们对网络可靠性的要求越来越高。特别是对于终端用户来说，能够实时与网络其他部分保持联系是非常重要的。一般来说，主机通过设置默认网关来与外部网络联系，如图所示：<img src="../../../../images/%E8%99%9A%E6%8B%9F%E8%B7%AF%E7%94%B1%E5%86%97%E4%BD%99%E5%8D%8F%E8%AE%AEVRRP%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D/image-20201016020248009.png" alt="image-20201016020248009" style="zoom:50%;" /></p>
<p>&ensp;&ensp;主机将发送给外部网络的报文发送给网关，由网关传递给外部网络，从而实现主机与外部网络的通信。正常的情况下，主机可以完全信赖网关的工作，但是当网关坏掉时，主机与外部的通信就会中断。要解决网络中断的问题，可以依靠再添加网关的方式解决，不过由于大多数主机只允许配置一个默认网关，此时需要网络管理员进行手工干预网络配置，才能使得主机使用新的网关进行通信；有时，人们运用动态路由协议的方法来解决网络出 现故障这一问题，如运行RIP、OSPF等，或者使用IRDP。然而，这些协议由于配置过于复杂，或者安全性能不好等原因都不能满足用户的需求。 </p>
<p>&ensp;&ensp;为了更好地解决网络中断的问题，网络开发者提出了VRRP，它既不需要改变组网情况，也不需要在主机上做任何配置，只需要在相关路由器上配置极少的几条命令，就能实现下一跳网关的备份，并且不会给主机带来任何负担。和其他方法比较起来，VRRP更加能够满足用户的需求。 </p>
<h2 id="技术优点"><a href="#技术优点" class="headerlink" title="技术优点"></a>技术优点</h2><p>&ensp;&ensp;VRRP是一种容错协议，它保证当主机的下一跳路由器出现故障时，由另一台路由器来代替出现故障的路由器进行工作，从而保持网络通信的连续性和可靠性。 </p>
<p>&ensp;&ensp;VRRP具有如下优点： </p>
<ul>
<li>简化网络管理。在具有多播或广播能力的局域网（如以太网）中，借助VRRP 能在某台设备出现故障时仍然提供高可靠的缺省链路，有效避免单一链路发生故障后网络中断的问题，而无需修改动态路由协议、路由发现协议等配置信息，也无需修改主机的默认网关配置。 </li>
<li>适应性强。VRRP 报文封装在IP 报文中，支持各种上层协议。 </li>
<li>网络开销小。VRRP 只定义了一种报文——VRRP 通告报文，并且只有处于Master 状态的路由器可以发送VRRP 报文。 </li>
</ul>
<h1 id="VRRP协议介绍："><a href="#VRRP协议介绍：" class="headerlink" title="VRRP协议介绍："></a>VRRP协议介绍：</h1><h2 id="相关术语"><a href="#相关术语" class="headerlink" title="相关术语"></a>相关术语</h2><ul>
<li><p>虚拟路由器：由一个 Master 路由器和多个Backup 路由器组成。主机将虚拟路由器当作默认网关。 </p>
</li>
<li><p>VRID：虚拟路由器的标识。有相同VRID 的一组路由器构成一个虚拟路由器。 </p>
</li>
<li><p>Master 路由器：虚拟路由器中承担报文转发任务的路由器。 </p>
</li>
<li><p>Backup 路由器：Master 路由器出现故障时，能够代替Master 路由器工作的路由器。 </p>
</li>
<li><p>虚拟 IP 地址：虚拟路由器的IP 地址。一个虚拟路由器可以拥有一个或多个IP 地址。 </p>
</li>
<li><p>IP 地址拥有者：接口IP 地址与虚拟IP 地址相同的路由器被称为IP 地址拥有者。 </p>
</li>
<li><p>虚拟 MAC 地址：一个虚拟路由器拥有一个虚拟MAC 地址。虚拟MAC 地址的格式为00-00-5E-00-01-{VRID}。通常情况下，虚拟路由器回应ARP 请求使用的是虚拟MAC 地址，只有虚拟路由器做特殊配置的时候，才回应接口的真实MAC 地址。 </p>
</li>
<li><p>优先级：VRRP 根据优先级来确定虚拟路由器中每台路由器的地位。 </p>
</li>
<li><p>非抢占方式：如果 Backup 路由器工作在非抢占方式下，则只要Master 路由器没有出现故障，Backup 路由器即使随后被配置了更高的优先级也不会成为Master 路由器。抢占方式：如果Backup 路由器工作在抢占方式下，当它收到VRRP 报文后，会将自己的优先级与通告报文中的优先级进行比较。如果自己的优先级比当前的Master 路由器的优先级高，就会主动抢占成为Master 路由器；否则，将保持Backup 状态。 </p>
</li>
<li><p>抢占方式：如果Backup 路由器工作在抢占方式下，当它收到VRRP 报文后，会将自己的优先级与通告报文中的优先级进行比较。如果自己的优先级比当前的Master 路由器的优先级高，就会主动抢占成为Master 路由器；否则，将保持Backup 状态。</p>
</li>
</ul>
<h2 id="虚拟路由器简介"><a href="#虚拟路由器简介" class="headerlink" title="虚拟路由器简介"></a>虚拟路由器简介</h2><p>&ensp;&ensp;VRRP将局域网内的一组路由器划分在一起，形成一个VRRP备份组，它在功能上相当于一台虚拟路由器，使用虚拟路由器号进行标识。以下使用虚拟路由器代替VRRP备份组进行描述。</p>
<p>&ensp;&ensp;虚拟路由器有自己的虚拟IP地址和虚拟MAC地址，它的外在表现形式和实际的物理路由器完全一样。局域网内的主机将虚拟路由器的IP地址设置为默认网关，通过虚拟路由器与外部网络进行通信。</p>
<p>&ensp;&ensp;虚拟路由器是工作在实际的物理路由器之上的。它由多个实际的路由器组成，包括一个Master路由器和多个Backup路由器。Master路由器正常工作时，局域网内的主机通过Master与外界通信。当Master路由器出现故障时，Backup路由器中的一台设备将成为新的Master路由器，接替转发报文的工作，如图所示:</p>
<img src="../../../../images/%E8%99%9A%E6%8B%9F%E8%B7%AF%E7%94%B1%E5%86%97%E4%BD%99%E5%8D%8F%E8%AE%AEVRRP%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D/image-20201016020639735.png" alt="image-20201016020639735" style="zoom:50%;" />

<h2 id="VRRP工作过程"><a href="#VRRP工作过程" class="headerlink" title="VRRP工作过程"></a>VRRP工作过程</h2><p>&ensp;&ensp;VRRP的工作过程为： </p>
<ol>
<li><p>虚拟路由器中的路由器根据优先级选举出Master。Master 路由器通过发送免费ARP 报文，将自己的虚拟MAC 地址通知给与它连接的设备或者主机，从而承担报文转发任务； </p>
</li>
<li><p>Master 路由器周期性发送VRRP 报文，以公布其配置信息（优先级等）和工作状况； </p>
</li>
<li><p>如果Master 路由器出现故障，虚拟路由器中的Backup 路由器将根据优先级重新选举新的Master； </p>
</li>
<li><p>虚拟路由器状态切换时，Master 路由器由一台设备切换为另外一台设备，新的Master 路由器只是简单地发送一个携带虚拟路由器的MAC 地址和虚拟IP地址信息的免费ARP 报文，这样就可以更新与它连接的主机或设备中的ARP 相关信息。网络中的主机感知不到Master 路由器已经切换为另外一台设备。 </p>
</li>
<li><p>Backup 路由器的优先级高于Master 路由器时，由Backup 路由器的工作方式（抢占方式和非抢占方式）决定是否重新选举Master。由此可见，为了保证Master路由器和Backup路由器能够协调工作，VRRP需要实现以下功能： </p>
<ul>
<li><p>Master 路由器的选举； </p>
</li>
<li><p>Master 路由器状态的通告； </p>
</li>
<li><p>同时，为了提高安全性，VRRP 还提供了认证功能； </p>
</li>
</ul>
</li>
</ol>
<h4 id="Master路由器的选举"><a href="#Master路由器的选举" class="headerlink" title="Master路由器的选举"></a>Master路由器的选举</h4><p>&ensp;&ensp;VRRP根据优先级来确定虚拟路由器中每台路由器的角色（Master路由器或Backup路由器）。优先级越高，则越有可能成为Master路由器。 </p>
<p>&ensp;&ensp;初始创建的路由器工作在Backup状态，通过VRRP报文的交互获知虚拟路由器中其他成员的优先级： </p>
<ul>
<li><p>如果 VRRP 报文中Master 路由器的优先级高于自己的优先级，则路由器保持在Backup 状态； </p>
</li>
<li><p>如果 VRRP 报文中Master 路由器的优先级低于自己的优先级，采用抢占工作方式的路由器将抢占成为Master 状态，周期性地发送VRRP 报文，采用非抢占工作方式的路由器仍保持Backup 状态； </p>
</li>
<li><p>如果在一定时间内没有收到 VRRP 报文，则路由器切换为Master 状态。VRRP优先级的取值范围为0到255（数值越大表明优先级越高），可配置的范围是1到254，优先级0为系统保留给路由器放弃Master位置时候使用，255则是系统保留给IP地址拥有者使用。当路由器为IP地址拥有者时，其优先级始终为255。因此，当虚拟路由器内存在IP地址拥有者时，只要其工作正常，则为Master路由器。 </p>
</li>
</ul>
<h4 id="Master路由器状态的通告"><a href="#Master路由器状态的通告" class="headerlink" title="Master路由器状态的通告"></a>Master路由器状态的通告</h4><p>&ensp;&ensp;Master路由器周期性地发送VRRP报文，在虚拟路由器中公布其配置信息（优先级等）和工作状况。Backup路由器通过接收到VRRP报文的情况来判断Master路由器是否工作正常。 </p>
<p>&ensp;&ensp;Master路由器主动放弃Master地位（如Master路由器退出虚拟路由器）时，会发送优先级为0的VRRP报文，致使Backup路由器快速切换变成Master路由器。这个切换的时间称为Skew time，计算方式为：（256－Backup路由器的优先级）/256，单位为秒。 </p>
<p>&ensp;&ensp;当Master路由器发生网络故障而不能发送VRRP报文的时候，Backup路由器并不能立即知道其工作状况。Backup路由器等待一段时间之后，如果还没有接收到VRRP报文，那么会认为Master路由器无法正常工作，而把自己升级为Master路由器，周期性发送VRRP报文。如果此时多个Backup路由器竞争Master路由器的位置，将通过优先级来选举Master路由器。Backup路由器默认等待的时间称为Master_Down_Interval，取值为：（3×VRRP报文的发送时间间隔）＋Skewtime，单位为秒。</p>
<p>&ensp;&ensp;在性能不够稳定的网络中， Backup 路由器可能因为网络堵塞而在Master_Down_Interval期间没有收到Master路由器的报文，而主动抢占为Master位置，如果此时原Master路由器的报文又到达了，就会出现虚拟路由器的成员频繁的进行Master抢占现象。为了缓解这种现象的发生，特制定了延迟等待定时器。它可以使得Backup路由器在等待了Master_Down_Interval后，再等待延迟等待时间。如在此期间仍然没有收到VRRP报文，则此Backup路由器才会切换为Master路由器，对外发送VRRP报文。 </p>
<h4 id="认证方式"><a href="#认证方式" class="headerlink" title="认证方式"></a>认证方式</h4><p>&ensp;&ensp; VRRP提供了三种认证方式： </p>
<ul>
<li><p>无认证：不进行任何 VRRP 报文的合法性认证，不提供安全性保障。 </p>
</li>
<li><p>简单字符认证： 在一个有可能受到安全威胁的网络中，可以将认证方式设置为简单字符认证。发送VRRP报文的路由器将认证字填入到VRRP 报文中，而收到VRRP 报文的路由器会将收到的VRRP 报文中的认证字和本地配置的认证字进行比较。如果认证字相同，则认为接收到的报文是合法的VRRP 报文；否则认为接收到的报文是一个非法报文。 </p>
</li>
<li><p>MD5 认证：在一个非常不安全的网络中，可以将认证方式设置为MD5 认证。发送VRRP 报文的路由器利用认证字和MD5 算法对VRRP 报文进行加密，加密后的报文保存在Authentication Header（认证头）中。收到VRRP报文的路由器会利用认证字解密报文，检查该报文的合法性。 </p>
</li>
</ul>
]]></content>
      <categories>
        <category>原理以及基础</category>
      </categories>
      <tags>
        <tag>VRRP</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei Wlan配置</title>
    <url>/2020/10/27/Huawei%20Wlan%E9%85%8D%E7%BD%AE.html</url>
    <content><![CDATA[<h1 id="WLAN基本业务配置流程图"><a href="#WLAN基本业务配置流程图" class="headerlink" title="WLAN基本业务配置流程图"></a>WLAN基本业务配置流程图</h1><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE/image-20201110225018915.png" alt="image-20201110225018915" style="zoom:50%;" />



<h1 id="AP上线及配置"><a href="#AP上线及配置" class="headerlink" title="AP上线及配置"></a>AP上线及配置</h1><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE/image-20201110181956613.png" alt="image-20201110181956613" style="zoom:50%;" />

<ul>
<li>AP只有存在IP地址时，才会与AC通信</li>
<li>AP软件版本要与AC版本互相兼容，否则无法管理</li>
<li>AP一般设备较多，通常使用dhcp地址</li>
<li>若dhcp配置option 43，则AP可通过optin 43发现AC（三层组网）</li>
</ul>
<h1 id="AC升级"><a href="#AC升级" class="headerlink" title="AC升级"></a>AC升级</h1><ul>
<li>确认AC有足够的空间存放新的系统软件包（dir）<ul>
<li>若空间不足，需要执行命令delete /unreserved删除当前不用的文件确保有空间存放相关升级文件。</li>
</ul>
</li>
<li>准备好软件包（验证MD5值）</li>
<li>准备TFTP Server\FTP Server\SFTP Server任意一种</li>
<li>需要备份的文件有：<ul>
<li>系统软件.cc</li>
<li>配置文件.cfg</li>
<li>补丁文件.pat</li>
<li>License文件.dat</li>
</ul>
</li>
</ul>
<h2 id="命令行升级"><a href="#命令行升级" class="headerlink" title="命令行升级"></a>命令行升级</h2><h3 id="保存配置文件"><a href="#保存配置文件" class="headerlink" title="保存配置文件"></a>保存配置文件</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;AC6605&gt;save</span><br><span class="line">  The current configuration will be written to the device. </span><br><span class="line">  Are you sure to continue? (y/n)[n]:y</span><br><span class="line">  It will take several minutes to save configuration file, please wait.........</span><br><span class="line">  Configuration file has been saved successfully</span><br><span class="line">  Note: The configuration file will take effect after being activated</span><br><span class="line">&lt;AC6605&gt;</span><br></pre></td></tr></table></figure>

<h3 id="备份文件"><a href="#备份文件" class="headerlink" title="备份文件"></a>备份文件</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[AC6605]sftp <span class="number">192.168</span><span class="number">.10</span><span class="number">.11</span>      <span class="comment">#输入sftp地址</span></span><br><span class="line">Please input the username:    <span class="comment">#根据提示输入用户名和密码</span></span><br><span class="line">sftp-client&gt;put vrpcfg.cfg vrpcfg-bak.cfg  <span class="comment">#备份配置文件并重命名为vrpcfg-bak.cfg</span></span><br><span class="line">sftp-client&gt;put AC6605V200R006C10SPC200.cc AC6605V200R006C10SPC200-bak.cc <span class="comment">#备份系统文件并重命名为AC6605V200R006C10SPC200-bak.cc</span></span><br><span class="line">sftp-client&gt;put AC6605V200R006C10SPH203.pat AC6605V200R006C10SPH203-bak.pat <span class="comment">#备份补丁文件并重命名为AC6605V200R006C10SPH203-bak.pat</span></span><br><span class="line">sftp-client&gt;put xxxxx.dat xxxxx-bak.dat  <span class="comment">#备份License文件并重命名</span></span><br></pre></td></tr></table></figure>

<h2 id="配置文件转换"><a href="#配置文件转换" class="headerlink" title="配置文件转换"></a>配置文件转换</h2><ul>
<li>V2R3和V2R5的配置文件不能直接作用于V2R6，需要进行转换后才能使用</li>
<li>只能转换cfg格式的文件</li>
</ul>
<h2 id="升级设备"><a href="#升级设备" class="headerlink" title="升级设备"></a>升级设备</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;AC6605&gt;startup system-software xxxxxxx.cc   <span class="comment">#指定设备启动时加载的新系统软件</span></span><br><span class="line">&lt;AC6605&gt;startup saved-configuration xxxxxxx.cfg  <span class="comment">#指定设备启动时加载的新配置文件</span></span><br><span class="line">&lt;AC6605&gt;reboot fast          <span class="comment">#重启生效</span></span><br></pre></td></tr></table></figure>

<ul>
<li>重启设备前，执行命令display startup 查看下次启动所用的系统软件和配置文件是否为新的</li>
<li>直接reboot fast即可，不要再次保存配置文件</li>
</ul>
<h1 id="AP升级"><a href="#AP升级" class="headerlink" title="AP升级"></a>AP升级</h1><ul>
<li>请确保AP的版本文件已经成功上传到AC、SFTP服务器或FTP服务器上。</li>
</ul>
<h2 id="AC模式"><a href="#AC模式" class="headerlink" title="AC模式"></a>AC模式</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">ap update mode  AC <span class="comment">#缺省为AC模式</span></span><br></pre></td></tr></table></figure>

<h2 id="FTP模式"><a href="#FTP模式" class="headerlink" title="FTP模式"></a>FTP模式</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">ap update mode ftp-mode</span><br><span class="line">ap update ftp-server &#123; ip-address //server-ip-address// | ipv6-address //server-ipv6-address// &#125; ftp-username //ftp-username// ftp-password cipher //ftp-password// <span class="comment">#当前AP密码不支持特殊字符“"”</span></span><br><span class="line">ap update ftp-server max-connect-number max-connect-number &#123; ipv4 | ipv6 &#125; <span class="comment">#配置能够同时升级的AP最大数目。缺省情况下，FTP升级模式下能同时升级的AP最大数目为50个。</span></span><br><span class="line">ap update update-filename //filename// ap-type //type-id// [ ap-group //ap-group-name// ]<span class="comment">#配置指定AP类型的AP对应的升级文件。</span></span><br></pre></td></tr></table></figure>

<h2 id="SFTP模式"><a href="#SFTP模式" class="headerlink" title="SFTP模式"></a>SFTP模式</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">ap update mode sftp-mode</span><br><span class="line">ap update sftp-server &#123; ip-address //server-ip-address// | ipv6-address //server-ipv6-address// &#125; sftp-username //sftp-username// sftp-password cipher //sftp-password// <span class="comment">#当前AP密码不支持特殊字符“"”</span></span><br><span class="line">ap update sftp-server max-connect-number //max-connect-number// &#123; ipv4 | ipv6 &#125; <span class="comment">#配置能够同时升级的AP最大数目。缺省情况下，FTP升级模式下能同时升级的AP最大数目为50个。</span></span><br><span class="line">ap update update-filename //filename// ap-type //type-id// [ ap-group //ap-group-name// ]<span class="comment">#配置指定AP类型的AP对应的升级文件。</span></span><br></pre></td></tr></table></figure>

<h1 id="数据转发模式"><a href="#数据转发模式" class="headerlink" title="数据转发模式"></a>数据转发模式</h1><h2 id="隧道转发（集中转发）"><a href="#隧道转发（集中转发）" class="headerlink" title="隧道转发（集中转发）"></a>隧道转发（集中转发）</h2><ul>
<li>用户的数据报文到达AP后，需要经过CAPWAP数据隧道封装后发送给AC，然后由AC再转发到上层网络</li>
</ul>
<h2 id="直接转发（本地转发）"><a href="#直接转发（本地转发）" class="headerlink" title="直接转发（本地转发）"></a>直接转发（本地转发）</h2><ul>
<li>用户的数据报文到达AP后，不需要经过CAPWAP数据隧道封装后发送给AC，然后由AC再转发到上层网络</li>
</ul>
<h1 id="配置AP组"><a href="#配置AP组" class="headerlink" title="配置AP组"></a>配置AP组</h1><blockquote>
<p>每个AP都会加入并且只能加入到一个AP组中，AP组通常用于多个AP的通用配置，同时在单个AP下也可以配置AP的独有配置。</p>
</blockquote>
<blockquote>
<p>如果不手动配置AP加入到指定AP组中，则AP会自动加入到名为<strong>default</strong>的缺省AP组中。缺省的AP组不能被删除，但是可以进行修改。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">ap-group name wifi</span><br></pre></td></tr></table></figure>

<h1 id="添加AP设备"><a href="#添加AP设备" class="headerlink" title="添加AP设备"></a>添加AP设备</h1><p>添加AP有三种方式：离线导入AP、自动发现AP以及手工确认未认证列表中的AP。</p>
<ul>
<li>离线导入AP：预先配置AP的MAC地址和SN，当AP与AC连接时，如果AC发现AP和预先增加的AP的MAC地址和SN匹配，则AC开始与AP建立连接。</li>
<li>自动发现AP：当配置AP的认证模式为不认证或配置AP的认证模式为MAC或SN认证且将AP加入AP白名单中，则当AP与AC连接时，AP将被AC自动发现并正常上线。</li>
<li>手工确认未认证列表中的AP：当配置AP的认证模式为MAC或SN认证但AP没有离线导入且不在已设置的AP白名单中，则该AP会被记录到未授权的AP列表中。需要用户手工确认后，此AP才能正常上线。</li>
</ul>
<p>AC上可以管理的AP数量受以下因素限制：</p>
<ul>
<li>License资源项：普通AP+中心AP的总数不超过AC本地License资源项数目，远端单元数量不占用License资源。</li>
<li>AC可管理AP的最大数：AC可管理中心AP的最大数和可管理普通AP+远端单元的最大数是独立的。<ul>
<li>普通AP+远端单元的总数不超过AC可管理普通AP+远端单元的最大数。</li>
<li>中心AP的总数不超过AC可管理中心AP的最大数。</li>
</ul>
</li>
</ul>
<h2 id="离线导入AP"><a href="#离线导入AP" class="headerlink" title="离线导入AP"></a>离线导入AP</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">system-view</span><br><span class="line">wlan</span><br><span class="line">ap auth-mode &#123;mac-auth | sn-auth&#125;   <span class="comment">#配置AP认证模式为MAC认证或SN认证。</span></span><br><span class="line">ap-id 1 ?</span><br><span class="line">  ap-mac   AP MAC address</span><br><span class="line">  ap-sn    AP SN</span><br><span class="line">  ap-type  AP type</span><br><span class="line">  type-id  AP type ID</span><br><span class="line">  &lt;cr&gt;     Please press ENTER to execute command </span><br><span class="line">ap-name name      <span class="comment">#配置AP的名称。缺省情况下，未配置单个AP的名称。</span></span><br><span class="line">ap-group name     <span class="comment">#配置AP加入AP组。缺省情况下，未配置AP加入的组。</span></span><br></pre></td></tr></table></figure>

<h2 id="自动发现AP"><a href="#自动发现AP" class="headerlink" title="自动发现AP"></a>自动发现AP</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">system-view</span><br><span class="line">wlan</span><br><span class="line">ap auth-mode no-auth      <span class="comment">#配置AP认证方式为不认证</span></span><br></pre></td></tr></table></figure>

<h2 id="手工确认未认证列表中的AP"><a href="#手工确认未认证列表中的AP" class="headerlink" title="手工确认未认证列表中的AP"></a>手工确认未认证列表中的AP</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">system-view</span><br><span class="line">wlan</span><br><span class="line">ap auth-mode &#123;mac-auth | sn-auth&#125;   <span class="comment">#配置AP认证模式为MAC认证或SN认证。</span></span><br><span class="line">display ap unauthorized record  <span class="comment">#查看未认证通过的AP信息。</span></span><br><span class="line">ap-confirm &#123; all | mac ap-mac | sn ap-sn &#125;  <span class="comment">#确认未认证通过的AP，确认后，AP将进入“normal”状态。</span></span><br></pre></td></tr></table></figure>

<h2 id="查看所有在线AP"><a href="#查看所有在线AP" class="headerlink" title="查看所有在线AP"></a>查看所有在线AP</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">display ap all</span><br></pre></td></tr></table></figure>

<h1 id="配置基础业务"><a href="#配置基础业务" class="headerlink" title="配置基础业务"></a>配置基础业务</h1><h2 id="创建安全模版（默认为default）"><a href="#创建安全模版（默认为default）" class="headerlink" title="创建安全模版（默认为default）"></a>创建安全模版（默认为default）</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">security<span class="literal">-profile</span> name ssid_name  <span class="comment">#安全认证模板名称</span></span><br><span class="line">security wpa<span class="literal">-wpa2</span> psk pass<span class="literal">-phrase</span> a1234567 aes  <span class="comment">#便是加密类型wpa-wpa2 认证密码为a1234567</span></span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<h2 id="创建SSID模板："><a href="#创建SSID模板：" class="headerlink" title="创建SSID模板："></a>创建SSID模板：</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ssid<span class="literal">-profile</span> name ssid_name</span><br><span class="line">ssid ssid_name</span><br><span class="line">Info: This operation may take a few seconds, please wait.done.</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<h2 id="创建VAP模板："><a href="#创建VAP模板：" class="headerlink" title="创建VAP模板："></a>创建VAP模板：</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">vap<span class="literal">-profile</span> name ssid_name</span><br><span class="line">forward<span class="literal">-mode</span> direct<span class="literal">-forward</span></span><br><span class="line">service<span class="literal">-vlan</span> vlan<span class="literal">-id</span> <span class="number">3</span>  <span class="comment">#配置VAP的业务VLAN</span></span><br><span class="line">security<span class="literal">-profile</span> ssid_name</span><br><span class="line">Info: This operation may take a few seconds, please wait.done.</span><br><span class="line">ssid<span class="literal">-profile</span> ssid_name</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<h2 id="配置AP组引用VAP模板，并在射频0和1上引用VAP模板："><a href="#配置AP组引用VAP模板，并在射频0和1上引用VAP模板：" class="headerlink" title="配置AP组引用VAP模板，并在射频0和1上引用VAP模板："></a>配置AP组引用VAP模板，并在射频0和1上引用VAP模板：</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ap<span class="literal">-group</span> name ap<span class="literal">-group1</span></span><br><span class="line">vap<span class="literal">-profile</span> ssid_name wlan <span class="number">1</span> radio <span class="number">0</span></span><br><span class="line">vap<span class="literal">-profile</span> ssid_name wlan <span class="number">1</span> radio <span class="number">1</span></span><br><span class="line">quit</span><br></pre></td></tr></table></figure>



<h1 id="射频管理"><a href="#射频管理" class="headerlink" title="射频管理"></a>射频管理</h1><ul>
<li><p>缺省情况下，射频的工作带宽为20MHz，未配置指定射频的信道。</p>
</li>
<li><p>为了避免信号干扰，请确保相邻AP工作在非重叠信道上。</p>
</li>
<li><p>如果AP工作在双5G，两个5G射频工作的信道之间至少相隔一个信道</p>
</li>
</ul>
<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE/image-20201110220735781.png" alt="image-20201110220735781" style="zoom:50%;" />

<h2 id="射频调优功能有三种模式"><a href="#射频调优功能有三种模式" class="headerlink" title="射频调优功能有三种模式"></a>射频调优功能有三种模式</h2><ul>
<li><p>自动模式</p>
<ul>
<li>缺省时间60分钟调优一次，由参数interval指定</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">calibrate enable auto</span><br></pre></td></tr></table></figure>
</li>
<li><p>手动模式</p>
<ul>
<li>不会主动调优，需要执行calibrate manual startup来触发全局调优</li>
</ul>
</li>
<li><p>定时模式</p>
<ul>
<li>仅在指定时刻触发全局调优（推荐）</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">calibrate enable schedule time <span class="number">20</span>:<span class="number">30</span>:<span class="number">00</span>  <span class="comment">#配置定时调优时间为20:30</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="配置射频调优"><a href="#配置射频调优" class="headerlink" title="配置射频调优"></a>配置射频调优</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">calibrate enable schedule time <span class="number">20</span>:<span class="number">30</span>:<span class="number">00</span>  <span class="comment">#配置定时调优时间为20:30</span></span><br><span class="line">rrm-profile name wlan-net  <span class="comment">#创建RRM模版wlan-net</span></span><br><span class="line">undo calibrate auto-channel-select disable  <span class="comment">#开启信道自动选择</span></span><br><span class="line">undo calibrate auto-txpower-select disable  <span class="comment">#开启发射功率自动选择信道</span></span><br><span class="line">quit</span><br><span class="line">radio<span class="number">-2</span>g-profile name radio-profile1   <span class="comment">#进入2G或5G射频模版视图</span></span><br><span class="line">rrm-profile wlan-net    <span class="comment">#将RRM模版wlan-net绑定到2G或5G射频模版</span></span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<h2 id="配置调优扫描功能"><a href="#配置调优扫描功能" class="headerlink" title="配置调优扫描功能"></a>配置调优扫描功能</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">air-scan-profile name wlan-airscan  <span class="comment">#创建空口扫描模版wlan-airscan</span></span><br><span class="line">scan-channel-set country-channel    <span class="comment">#配置空口扫描信道集合</span></span><br><span class="line">scan-period <span class="number">80</span>                      <span class="comment">#配置空口扫描持续时间</span></span><br><span class="line">scan-interval <span class="number">80000</span>                 <span class="comment">#配置空口扫描间隔时间</span></span><br><span class="line">quit</span><br><span class="line">radio<span class="number">-2</span>g-profile name radio-profile1   <span class="comment">#进入2G或5G射频模版视图 </span></span><br><span class="line">air-scan-profile wlan-airscan   <span class="comment">#将空口扫描模版wlan-airscan绑定到2G或5G射频模版</span></span><br></pre></td></tr></table></figure>

<h2 id="将指定射频模版和域管理模版绑定到AP组或指定AP"><a href="#将指定射频模版和域管理模版绑定到AP组或指定AP" class="headerlink" title="将指定射频模版和域管理模版绑定到AP组或指定AP"></a>将指定射频模版和域管理模版绑定到AP组或指定AP</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">ap-group name ap-group1             <span class="comment">#进入指定AP组</span></span><br><span class="line">regulatory-domain-profile domain1   <span class="comment">#将指定域管理模版绑定到AP组</span></span><br><span class="line">radio<span class="number">-5</span>g-profile radio5g     <span class="comment">#将2G或5G射频模版绑定到AP组  </span></span><br><span class="line">radio<span class="number">-2</span>g-profile radio2g     <span class="comment">#将2G或5G射频模版绑定到AP组  </span></span><br><span class="line">quit</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">wlan</span><br><span class="line">ap-specific name specific-name <span class="comment">#进入指定AP个性视图</span></span><br><span class="line">regulatory-domain-profile domain1   <span class="comment">#将指定域管理模版绑定到AP</span></span><br><span class="line">radio<span class="number">-5</span>g-profile radio5g     <span class="comment">#将2G或5G射频模版绑定到AP </span></span><br><span class="line">radio<span class="number">-2</span>g-profile radio2g     <span class="comment">#将2G或5G射频模版绑定到AP </span></span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<h1 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h1><h2 id="静态负载均衡"><a href="#静态负载均衡" class="headerlink" title="静态负载均衡"></a>静态负载均衡</h2><blockquote>
<p>将提供相同业务的一些AP通过手工配置加入到一个负载均衡组中。</p>
</blockquote>
<ul>
<li>一个AP的同一个射频只能加入到一个负载均衡组。（2.4G一个组，5G一个组）</li>
<li>每个负载均衡组成员有限，最多支持16个成员</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">sta-load-balance static-group name static<span class="number">-1</span>   <span class="comment">#创建静态负载均衡组并进入视图 </span></span><br><span class="line">member ap-name office radio <span class="number">0</span>        <span class="comment">#向负载均衡组中添加AP射频</span></span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<h2 id="动态负载均衡"><a href="#动态负载均衡" class="headerlink" title="动态负载均衡"></a>动态负载均衡</h2><blockquote>
<p>AC将所有上报同一个STA的AP动态组成一个组。STA上线之前，发送广播的Probe Request报文，扫描周围的AP，AP收到STA探测信号后，上报AC，AC将所有上报该STA的AP动态组成一个组，然后根据负载均衡算法是否允许接入</p>
</blockquote>
<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE/image-20201110223852637.png" alt="image-20201110223852637" style="zoom:100%;" />

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">rrm-profile name profile-name      <span class="comment">#创建RRM模版</span></span><br><span class="line">sta-load-balance dynamic enable    <span class="comment">#开启动态负载均衡</span></span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<h1 id="WLAN接入认证"><a href="#WLAN接入认证" class="headerlink" title="WLAN接入认证"></a>WLAN接入认证</h1><h2 id="Portal认证"><a href="#Portal认证" class="headerlink" title="Portal认证"></a>Portal认证</h2><blockquote>
<p>portal协议主要用于Web服务器和其他设备之间的信息交互.</p>
</blockquote>
<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE/image-20201110230517014.png" alt="image-20201110230517014" style="zoom:200%;" />

<blockquote>
<p>又称Web认证，方案首先需要给用户分配一个地址，用于访问门户网站，在登陆窗口上键入用户名与密码，然后通过Radius客户端去Radius服务器认证，如认证通过，则触发客户端重新发起地址分配请求，给用户分配可以访问外网的权限。用户下线时通过客户端发起离线请求 </p>
</blockquote>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE/image-20201110231150621.png" alt="image-20201110231150621"></p>
<h2 id="802-1x认证"><a href="#802-1x认证" class="headerlink" title="802.1x认证"></a>802.1x认证</h2><h3 id="认证过程"><a href="#认证过程" class="headerlink" title="认证过程"></a>认证过程</h3><ol>
<li><p>客户端向接入设备发送一个EAPoL-Start报文，开始802.1x认证接入;</p>
</li>
<li><p>接入设备向客户端发送EAP-Request/Identity报文，要求客户端将用户名送上来;</p>
</li>
<li><p>客户端回应一个EAP-Response/Identity给接入设备的请求，其中包括用户名;</p>
</li>
<li><p>接入设备将EAP-Response/Identity报文封装到RADIUS Access-Request报文中，发送给认证服务器;</p>
</li>
<li><p>认证服务器产生一个Challenge，通过接入设备将RADIUS Access-Challenge报文发送给客户端，其中包含有EAP-Request/MD5-Challenge;</p>
</li>
<li><p>接入设备通过EAP-Request/MD5-Challenge发送给客户端，要求客户端进行认证</p>
</li>
<li><p>客户端收到EAP-Request/MD5-Challenge报文后，将密码和Challenge做MD5算法后的Challenged-Pass-word，在EAP-Response/MD5-Challenge回应给接入设备</p>
</li>
<li><p>接入设备将Challenge，Challenged Password和用户名一起送到RADIUS服务器，由RADIUS服务器进行认证</p>
</li>
<li><p>RADIUS服务器根据用户信息，做MD5算法，判断用户是否合法，然后回应认证成功/失败报文到接入设备。如果成功，携带协商参数，以及用户的相关业务属性给用户授权。如果认证失败，则流程到此结束;</p>
</li>
<li><p>如果认证通过，用户通过标准的DHCP协议 (可以是DHCP Relay) ，通过接入设备获取规划的IP地址;</p>
</li>
<li><p>如果认证通过，接入设备发起计费开始请求给RADIUS用户认证服务器;</p>
</li>
<li><p>RADIUS用户认证服务器回应计费开始请求报文，用户上线完毕。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Huawei</tag>
        <tag>Wlan</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco配置SSH登陆</title>
    <url>/2020/10/27/Cisco%E9%85%8D%E7%BD%AESSH%E7%99%BB%E9%99%86.html</url>
    <content><![CDATA[<h2 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">username cisco privilege <span class="number">15</span> password <span class="number">0</span> cisco</span><br></pre></td></tr></table></figure>

<h2 id="设置远程登陆"><a href="#设置远程登陆" class="headerlink" title="设置远程登陆"></a>设置远程登陆</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">line vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line"> transport input telnet ssh               <span class="comment">#允许telnet、ssh远程登陆此设备</span></span><br><span class="line"> login local                              <span class="comment">#使用本地用户登陆</span></span><br></pre></td></tr></table></figure>

<h2 id="设置ssh"><a href="#设置ssh" class="headerlink" title="设置ssh"></a>设置ssh</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ip ssh version <span class="number">2</span>                          <span class="comment">#ssh使用version 2（默认是1.99，即同时使用v1和v2）//可选</span></span><br><span class="line">hostname Cisco                            <span class="comment">#给交换机重命名</span></span><br><span class="line">ip domain name test.com                   <span class="comment">#域名</span></span><br><span class="line">crypto key generate rsa modulus <span class="number">2048</span> label r1sshkey  <span class="comment">#不配置主机名或域名的情况下，在生成密钥的时候可以使用label后面跟上密钥的名字</span></span><br><span class="line">crypto key zeroize rsa                    <span class="comment">#清除原有rsa密码 //可选</span></span><br><span class="line">crypto key generate rsa modulus <span class="number">2048</span>      <span class="comment">#配置生成密钥使用2048长度（新设备要求2048以上）</span></span><br><span class="line">ip ssh authentication-retries <span class="number">5</span>           <span class="comment">#重试次数改成5次（默认3次）//可选 </span></span><br><span class="line">ip ssh time-out <span class="number">30</span>                        <span class="comment">#配置超时时间为30秒（默认120秒）//可选</span></span><br><span class="line">ip ssh maxstartups <span class="number">5</span>                      <span class="comment">#设置同时最大登陆数量5</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>SSH</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei AP状态解读</title>
    <url>/2020/10/27/Huawei%20AP%E7%8A%B6%E6%80%81%E8%A7%A3%E8%AF%BB.html</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th>AP状态</th>
<th>描述</th>
<th>可能原因</th>
<th align="left">处理过程</th>
</tr>
</thead>
<tbody><tr>
<td>commit-failed（cmtfa）</td>
<td>AP上线后WLAN业务配置下发失败状态。</td>
<td>AP在AC上正常上线之后，在AC上对AP进行WLAN业务配置，如果AC和AP之间存在链路不通或者对端设备无回应等情况，AC下发WLAN业务配置给AP失败。</td>
<td align="left">请检查网络连接是否正常。</td>
</tr>
<tr>
<td>committing（cmt）</td>
<td>AP上线后WLAN业务配置正在下发状态。</td>
<td>AP在AC上正常上线之后，在AC上对AP进行WLAN业务配置，AC给AP下发这些配置的过程就是committing状态。</td>
<td align="left">正常过程状态，无需关注。</td>
</tr>
<tr>
<td>config（cfg）</td>
<td>AP上线过程中WLAN业务配置正在下发状态。</td>
<td>当AP和AC建链成功后，在AC下发业务配置给AP的阶段，AP的状态为config。</td>
<td align="left">正常过程状态，无需关注。</td>
</tr>
<tr>
<td>config-failed（cfgfa）</td>
<td>AP上线过程中的WLAN业务配置下发失败状态。</td>
<td>当AP和AC建链成功后，AC下发业务配置给AP，如果存在链路不通等原因，下发失败，AP的状态为config-failed。</td>
<td align="left">请检查网络连接是否正常</td>
</tr>
<tr>
<td>download（dload)</td>
<td>AP正在升级状态。</td>
<td>AP执行升级操作时，会切换到download状态。</td>
<td align="left">AP升级状态，请确认AP升级结束后，再次查看AP状态。</td>
</tr>
<tr>
<td>fault</td>
<td>AP上线失败状态。</td>
<td>常见的导致AP上线失败的原因包含以下几种。<br />1、AP在获取地址阶段未分配到IP地址或者配置了错误的地址。2、 AP和AC之间的网络不通。 AP认证不通过。3、 AC上接入的AP数超过了AC允许接入的最大AP数量。4、 AP设备故障。</td>
<td align="left"></td>
</tr>
<tr>
<td>idle</td>
<td>AP和AC建链前的初始状态。</td>
<td>如果AP从未和当前AC建立过CAPWAP链路，当首次建立链路前AP处于idle状态或离线添加AP时配置的MAC和SN与真实AP不一致。或者License资源不足导致AC无法管理AP。</td>
<td align="left">处理过程如下。<br />检查AP是否接入网络中，如果AP接入正常，则进行下一步检查。<br />检查离线添加的AP的MAC或SN是否和当前接入的真实的AP的MAC或SN一致，如果不一致执行以下操作修改：<br />1、  执行命令<strong>display ap</strong> <strong>all</strong>，获取到AP信息。2、 执行命令<strong>undo ap</strong> { <strong>ap-name</strong> <em>ap-name</em> | <strong>ap-id</strong> <em>ap-id</em> | <strong>ap-mac</strong> <em>ap-mac</em> | <strong>ap-group*</strong>group-name* | <strong>all</strong> }，删除AP。 3、执行命令<strong>ap-id</strong> <em>ap-id</em> [ [ <strong>type-id</strong> <em>type-id</em> | <strong>ap-type</strong> <em>ap-type</em> ] { <strong>ap-mac</strong> <em>ap-mac</em> | <strong>ap-sn</strong> <em>ap-sn</em> | <strong>ap-mac</strong> <em>ap-mac</em> <strong>ap-sn</strong> <em>ap-sn</em> } ]或<strong>ap-mac</strong> <em>ap-mac</em> [ <strong>type-id</strong> <em>type-id</em> | <strong>ap-type</strong> <em>ap-type</em> ] [ <strong>ap-id</strong> <em>ap-id</em> ] [ <strong>ap-sn</strong> <em>ap-sn</em>]，添加正确的AP信息。<br />如果仍未解决，请进行License扩容，需注意AC管理的远端单元数量不占用AC的License资源。</td>
</tr>
<tr>
<td>name-conflicted（namec）</td>
<td>AP名称重名冲突状态。</td>
<td>AP的名称和AC上上线过的AP名称冲突。</td>
<td align="left">执行命令<strong>ap-rename</strong> <strong>ap-id</strong> <em>ap-id</em> <strong>new-name*</strong>ap-new-name*更改AP名称。</td>
</tr>
<tr>
<td>normal（nor）</td>
<td>AP正常状态。</td>
<td>AP在AC上成功上线。</td>
<td align="left">正常过程状态，无需关注。</td>
</tr>
<tr>
<td>standby（stdby）</td>
<td>AP在备AC上的正常状态。</td>
<td>在双机热备份、双链路冷备份和N+1备份场景下，主备AC链路建立正常，AP正常上线之后在备AC上的状态是standby状态，在主AC上是normal状态。</td>
<td align="left">正常过程状态，无需关注。</td>
</tr>
<tr>
<td>ver-mismatch（vmiss）</td>
<td>AC和AP的版本不匹配状态。</td>
<td>AC和AP的版本不匹配。</td>
<td align="left">登录华为技术支持网站下载对应版本的版本说明书，查看版本配套说明，将AC或AP的版本升级到配套版本。</td>
</tr>
<tr>
<td>countryCode-mismatch（cmiss）</td>
<td>AC和AP的国家码不匹配状态。</td>
<td>AP当前版本不支持AC上配置的国家码。</td>
<td align="left">AP不支持该国家码，请升级AP或者修改AC的国家码配置。</td>
</tr>
<tr>
<td>type-mismatch（tmiss）</td>
<td>AP类型不匹配状态。</td>
<td>配置的AP类型和实际不匹配。</td>
<td align="left">请修改AP类型配置。</td>
</tr>
<tr>
<td>unauth</td>
<td>AP未认证状态。</td>
<td>AP未通过认证。</td>
<td align="left">可使用命令<strong>display ap unauthorized record</strong>查询未通过认证的AP。执行命令<strong>ap-confirm</strong>，确认认证未通过的AP，可允许其上线。</td>
</tr>
</tbody></table>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Huawei</tag>
        <tag>Ap</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei交换机配置发生变化时，自动备份到FTP</title>
    <url>/2020/10/27/Huawei%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96%E6%97%B6%EF%BC%8C%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD%E5%88%B0FTP.html</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>有时候，事情一多，你们是否也常常这样：ping通了，就走了。干完就撤了！交换机修改过的配置，常常忘记保存了。万一刚刚又遇到停电，交换机重启了，结果辛辛苦苦做的配置就丢失了，要恢复的话，就会给自己增加了不少的工作量和时间成本。</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li>电脑一台使用ftp程序作为ftp服务器。设置用户名密码和ftp目录</li>
<li>Huawei交换机一台</li>
<li>网络互通</li>
</ul>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#设置当交换机配置发生变化后，延迟1分钟后自动备份，</span></span><br><span class="line">set save-configuration delay <span class="number">1</span></span><br><span class="line"><span class="comment">#设置自动备份文件存到ftp服务器上</span></span><br><span class="line">set save-configuration backup-to-server server <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span> transport-type ftp user ftp-username password  ftp-password</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><blockquote>
<p>这是最重要的一步，保证FTP配置正确</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#更改hostname后查看FTP文件夹是否更新</span></span><br><span class="line">syname test</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Huawei</tag>
        <tag>FTP</tag>
      </tags>
  </entry>
  <entry>
    <title>MacOS下SSH命令Invalid key length错误的原因</title>
    <url>/2020/10/27/MacOS%E4%B8%8BSSH%E5%91%BD%E4%BB%A4Invalid%20key%20length%E9%94%99%E8%AF%AF%E7%9A%84%E5%8E%9F%E5%9B%A0.html</url>
    <content><![CDATA[<p>升级到Macos 10.13.2后，使用ssh以key方式登陆一个12年配置的服务器的时候，ssh命令报告了<code>ssh_dispatch_run_fatal:Invalid key length</code>的错误。</p>
<p>很是纳闷，服务器和本地的key都是配置好后就没动过的，key pair本身肯定没问题啊，怎么会报错了呢?</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>Google了一下，发现是MacOS使用的OpenSSH版本升级到了7.6，小于1024bits的RSA keys已经不被支持了。</p>
<p>使用<code>ssh-keygen</code>查看了一下public key，发现是1023bit的。所以ssh时候报了<code>Invalid key length</code>的错误。</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">$ ssh-keygen -lf carl.pub</span><br><span class="line"><span class="number">1023</span> <span class="number">82</span>:<span class="number">3</span>e:bc:<span class="number">4</span>c:e8:<span class="number">34</span>:<span class="number">0</span>e:f1:<span class="number">5</span>b:<span class="number">44</span>:e3:db:<span class="number">9</span>b:c2:<span class="number">11</span>:<span class="number">88</span> carl.pub (RSA)</span><br></pre></td></tr></table></figure>

<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>重新生成了一个长度为2048bit的新ssh keypair，并将公钥添加到服务器端，就可以解决该问题。</p>
<p><strong>这个<code>Invalid key length</code>的错误，只是Macos的ssh客户端的行为，如果不换key，而使用一个允许小于1024bit的ssh客户端，原有的key仍然是可以登陆服务器的。</strong></p>
<h3 id="小测试"><a href="#小测试" class="headerlink" title="小测试"></a>小测试</h3><h4 id="试验1024bit-key-length"><a href="#试验1024bit-key-length" class="headerlink" title="试验1024bit key length"></a>试验1024bit key length</h4><p>使用<code>ssh-keygen -t rsa -b 1024 -C &quot;carl.shen@hello_aws&quot; -f carl_1024</code>生成key length为1024的keypair</p>
<p>使用私钥carl_1024登陆服务器，ssh客户端不会报告<code>Invalid key length</code> 的错误</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>ssh -i carl_1024 carl.shen<span class="variable">@hello_aws</span></span><br><span class="line">carl.shen<span class="variable">@hello_aws</span>: Permission denied (publickey).</span><br></pre></td></tr></table></figure>

<h4 id="试验2048bit-key-length"><a href="#试验2048bit-key-length" class="headerlink" title="试验2048bit key length"></a>试验2048bit key length</h4><p>使用<code>ssh-keygen -t rsa -b 2048 -C &quot;carl.shen@hello_aws&quot; -f carl_2048</code>生成key length为2048的keypair</p>
<p>使用私钥carl_2048登陆服务器，ssh客户端就不会报告<code>Invalid key length</code>的错误</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>ssh -i carl_2048 carl.shen<span class="variable">@hello_aws</span></span><br><span class="line">carl.shen<span class="variable">@hello_aws</span>: Permission denied (publickey).</span><br></pre></td></tr></table></figure>

<h4 id="试验4096bit-key-length"><a href="#试验4096bit-key-length" class="headerlink" title="试验4096bit key length"></a>试验4096bit key length</h4><p>使用<code>ssh-keygen -t rsa -b 4096 -C &quot;carl.shen@hello_aws&quot; -f carl_4096</code>生成key length为4096的keypair</p>
<p>使用私钥carl_4096登陆服务器，ssh客户端就不会报告<code>Invalid key length</code>的错误</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>ssh -i carl_4096 carl.shen<span class="variable">@hello_aws</span></span><br><span class="line">carl.shen<span class="variable">@hello_aws</span>: Permission denied (publickey).</span><br></pre></td></tr></table></figure>

<h4 id="尝试生成小于1024-bit的key失败"><a href="#尝试生成小于1024-bit的key失败" class="headerlink" title="尝试生成小于1024 bit的key失败"></a>尝试生成小于1024 bit的key失败</h4><figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -b <span class="number">1023</span> -C <span class="string">"carl.shen@hello_aws"</span> -f carl_1023</span><br><span class="line">Invalid RSA <span class="built_in">key</span> <span class="built_in">length</span>: minimum <span class="built_in">is</span> <span class="number">1024</span> bits</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MacOS</category>
      </categories>
      <tags>
        <tag>MacOS</tag>
        <tag>SSH</tag>
      </tags>
  </entry>
  <entry>
    <title>Juniper SRX防火墙简明配置手册</title>
    <url>/2020/10/27/Juniper%20SRX%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%80%E6%98%8E%E9%85%8D%E7%BD%AE%E6%89%8B%E5%86%8C.html</url>
    <content><![CDATA[<h1 id="Juniper-SRX防火墙简明配置手册"><a href="#Juniper-SRX防火墙简明配置手册" class="headerlink" title="Juniper SRX防火墙简明配置手册"></a>Juniper SRX防火墙简明配置手册</h1><blockquote>
<p>SRX系列防火墙是Juniper公司基于JUNOS操作系统的安全系列产品，JUNOS集成了路由、交换、安全性和一系列丰富的网络服务。目前Juniper公司的全系列路由器产品、交换机产品和SRX安全产品均采用统一源代码的JUNOS操作系统，JUNOS是全球首款将转发与控制功能相隔离，并采用模块化软件架构的网络操作系统。JUNOS作为电信级产品的精髓是Juniper真正成功的基石，它让企业级产品同样具有电信级的不间断运营特性，更好的安全性和管理特性，JUNOS软件创新的分布式架构为高性能、高可用、高可扩展的网络奠定了基础。基于NP架构的SRX系列产品产品同时提供性能优异的防火墙、NAT、IPSEC、IPS、SS*VPN和UTM等全系列安全功能，其安全功能主要来源于已被广泛证明的ScreenOS操作系统。</p>
<p>  本文旨在为熟悉Netscreen防火墙ScreenOS操作系统的工程师提供SRX防火墙参考配置，以便于大家能够快速部署和维护SRX防火墙，文档介绍JUNOS操作系统，并参考ScreenOS配置介绍SRX防火墙配置方法，最后对SRX防火墙常规操作与维护做简要说明。</p>
</blockquote>
<h1 id="JUNOS-操作系统介绍"><a href="#JUNOS-操作系统介绍" class="headerlink" title="JUNOS 操作系统介绍"></a>JUNOS 操作系统介绍</h1><h2 id="层次化配置结构"><a href="#层次化配置结构" class="headerlink" title="层次化配置结构"></a>层次化配置结构</h2><p>JUNOS采用基于FreeBSD内核的软件模块化操作系统，支持CLI命令行和WEBUI两种接口配置方式，本文主要对CLI命令行方式进行配置说明。JUNOS CLI使用层次化配置结构，分为操作（operational）和配置（configure）两类模式，在操作模式下可对当前配置、设备运行状态、路由及会话表等状态进行查看及设备运维操作，并通过执行config或edit命令进入配置模式，在配置模式下可对各相关模块进行配置并能够执行操作模式下的所有命令（run）。在配置模式下JUNOS采用分层分级模块下配置结构，如下图所示，edit命令进入下一级配置（类似unix cd命令）,exit命令退回上一级，top命令回到根级。</p>
<h2 id="JunOS配置管理"><a href="#JunOS配置管理" class="headerlink" title="JunOS配置管理"></a>JunOS配置管理</h2><p>​    JUNOS通过set语句进行配置，配置输入后并不会立即生效，而是作为候选配置（Candidate Config）等待管理员提交确认，管理员通过输入commit命令来提交配置，配置内容在通过SRX语法检查后才会生效，一旦commit通过后当前配置即成为有效配置（Active config）。另外，JUNOS允许执行commit命令时要求管理员对提交的配置进行两次确认，如执行commit confirmed 2命令要求管理员必须在输入此命令后2分钟内再次输入commit以确认提交，否则2分钟后配置将自动回退，这样可以避免远程配置变更时管理员失去对SRX的远程连接风险。</p>
<p>​    在执行commit命令前可通过配置模式下show命令查看当前候选配置（Candidate Config），在执行commit后配置模式下可通过run show config命令查看当前有效配置（Active config）。此外可通过执行show  |  compare比对候选配置和有效配置的差异。</p>
<p>​    SRX上由于配备大容量硬盘存储器，缺省按先后commit顺序自动保存50份有效配置，并可通过执行rolback和commit命令返回到以前配置（如rollback 0/commit可返回到前一commit配置）；也可以直接通过执行save <em>configname.conf*手动保存当前配置，并执行load override *configname.conf</em> / commit调用前期手动保存的配置。执行load factory-default / commit命令可恢复到出厂缺省配置。</p>
<p>​    SRX可对模块化配置进行功能关闭与激活，如执行deactivate security nat/comit命令可使NAT相关配置不生效，并可通过执行activate security nat/commit使NAT配置再次生效。</p>
<p>​    SRX通过set语句来配置防火墙，通过delete语句来删除配置，如delete security nat和edit security nat / delete一样，均可删除security防火墙层级下所有NAT相关配置，删除配置和ScreenOS不同，配置过程中需加以留意。</p>
<h2 id="SRX主要配置内容"><a href="#SRX主要配置内容" class="headerlink" title="SRX主要配置内容"></a>SRX主要配置内容</h2><p>部署SRX防火墙主要有以下几个方面需要进行配置：</p>
<p><strong>System</strong>：主要是系统级内容配置，如主机名、管理员账号口令及权限、时钟时区、Syslog、SNMP、系统级开放的远程管理服务（如telnet）等内容。</p>
<p><strong>Interface</strong>:接口相关配置内容。</p>
<p><strong>Security</strong>: 是SRX防火墙的主要配置内容，安全相关部分内容全部在Security层级下完成配置，如NAT、Zone、Policy、Address-book、Ipsec、Screen、Idp等，可简单理解为ScreenOS防火墙安全相关内容都迁移至此配置层次下，除了Application自定义服务。</p>
<p><strong>Application</strong>：自定义服务单独在此进行配置，配置内容与ScreenOS基本一致。</p>
<p><strong>routing-options</strong>： 配置静态路由或router-id等系统全局路由属性配置。</p>
<h1 id="SRX防火墙配置对照说明"><a href="#SRX防火墙配置对照说明" class="headerlink" title="SRX防火墙配置对照说明"></a>SRX防火墙配置对照说明</h1><h2 id="初始安装"><a href="#初始安装" class="headerlink" title="初始安装"></a>初始安装</h2><h3 id="登陆"><a href="#登陆" class="headerlink" title="登陆"></a>登陆</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Console口(通用超级终端缺省配置)连接SRX，root用户登陆，密码为空</span></span><br><span class="line">login: root</span><br><span class="line">Password:</span><br><span class="line">— JUNOS <span class="number">9.5</span>R1<span class="number">.8</span> built <span class="number">2009</span><span class="number">-07</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">04</span>:<span class="number">30</span> UTC</span><br><span class="line">root% cli          <span class="comment">#进入操作模式</span></span><br><span class="line">root&gt;</span><br><span class="line">root&gt; configure</span><br><span class="line">Entering configuration mode  <span class="comment">#进入配置模式</span></span><br><span class="line">[edit]</span><br><span class="line">Root<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h3 id="设置root用户口令"><a href="#设置root用户口令" class="headerlink" title="设置root用户口令"></a>设置root用户口令</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#设置root用户口令</span></span><br><span class="line">root<span class="comment"># set system root-authentication plain-text-password</span></span><br><span class="line">root<span class="comment"># new password : root123   </span></span><br><span class="line">root<span class="comment"># retype new password: root123</span></span><br><span class="line"><span class="comment">#密码将以密文方式显示</span></span><br><span class="line">root<span class="comment"># show system root-authentication</span></span><br><span class="line">encrypted-password “$<span class="number">1</span>$xavDeUe6$fNM6olGU<span class="number">.8</span>.M7B62u05D6.”; <span class="comment"># SECRET-DATA</span></span><br></pre></td></tr></table></figure>

<p>注意：强烈建议不要使用其它加密选项来加密root和其它user口令(如encrypted-password加密方式)，此配置参数要求输入的口令应是经加密算法加密后的字符串，采用这种加密方式手工输入时存在密码无法通过验证风险。</p>
<p>注：root用户仅用于<strong>console</strong>连接本地管理SRX，不能通过远程登陆管理SRX，必须成功设置root口令后，才能执行commit提交后续配置命令。</p>
<h3 id="设置远程登陆管理用户"><a href="#设置远程登陆管理用户" class="headerlink" title="设置远程登陆管理用户"></a>设置远程登陆管理用户</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">root<span class="comment"># set system login user *lab* class super-user authentication plain-text-password</span></span><br><span class="line">root<span class="comment"># new password : lab123</span></span><br><span class="line">root<span class="comment"># retype new password: lab123</span></span><br></pre></td></tr></table></figure>

<p>注：此lab用户拥有超级管理员权限，可用于console和远程管理访问，另也可自行灵活定义其它不同管理权限用户。</p>
<h3 id="远程管理SRX相关配置"><a href="#远程管理SRX相关配置" class="headerlink" title="远程管理SRX相关配置"></a>远程管理SRX相关配置</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">run set date YYYYMMDDhhmm.ss　　　　　　<span class="comment">#设置系统时钟</span></span><br><span class="line">set system time-zone Asia/Shanghai　　　<span class="comment">#设置时区为上海</span></span><br><span class="line">set system host-name SRX3400-A　　　　　<span class="comment">#设置主机名</span></span><br><span class="line">set system name-server <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>  　　 <span class="comment">#设置DNS服务器</span></span><br><span class="line">set system services ftp　　　　　　　　</span><br><span class="line">set system services telnet      </span><br><span class="line">set system services web-management http</span><br><span class="line"><span class="comment">#在系统级开启ftp/telnet/http远程接入管理服务</span></span><br><span class="line">set interfaces ge<span class="number">-0</span>/<span class="number">0</span>/<span class="number">0.0</span> family inet address <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span>/<span class="number">24</span></span><br><span class="line"><span class="comment">#或</span></span><br><span class="line">set interfaces ge<span class="number">-0</span>/<span class="number">0</span>/<span class="number">0</span> unit <span class="number">0</span> family inet address <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span>/<span class="number">24</span></span><br><span class="line">set interfaces ge<span class="number">-0</span>/<span class="number">0</span>/<span class="number">1</span> unit <span class="number">0</span> family inet address <span class="number">10.1</span><span class="number">.2</span><span class="number">.1</span>/<span class="number">24</span></span><br><span class="line">set routing-options static route <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span> next-hop <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"><span class="comment">#配置逻辑接口地址及缺省路由，SRX接口要求IP地址必须配置在逻辑接口下（类似ScreenOS的子接口），通常使用逻辑接口0即可</span></span><br><span class="line">set security zones security-zone untrust interfaces ge<span class="number">-0</span>/<span class="number">0</span>/<span class="number">0.0</span></span><br><span class="line"><span class="comment">#将ge-0/0/0.0接口放到untrust zone去，类似ScreenOS</span></span><br><span class="line">set security zones security-zone untrust host-inbound-traffic system-services ping</span><br><span class="line">set security zones security-zone untrust host-inbound-traffic system-services http</span><br><span class="line">set security zones security-zone untrust host-inbound-traffic system-services telnet</span><br><span class="line"><span class="comment">#在untrust zone打开允许远程登陆管理服务，ScreenOS要求基于接口开放服务，SRX要求基于Zone开放，从SRX主动访问出去流量开启服务，类似ScreenOS</span></span><br></pre></td></tr></table></figure>

<h2 id="Policy"><a href="#Policy" class="headerlink" title="Policy"></a>Policy</h2><p>Policy配置方法与ScreenOS基本一致，仅在配置命令上有所区别，其中策略的允许/拒绝的动作（Action）需要额外配置一条then语句(将ScreenOS的一条策略分解成两条及以上配置语句)。Policy需要手动配置policy name，policy name可以是字符串，也可以是数字（与ScreenOS的policy ID类似,只不过需要手工指定）。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set security zones security-zone trust address-book address pc1 <span class="number">10.1</span><span class="number">.1</span><span class="number">.10</span>/<span class="number">32</span></span><br><span class="line">set security zones security-zone untrust address-book address server1 <span class="number">10.0</span><span class="number">.2</span><span class="number">.1</span>/<span class="number">32</span></span><br><span class="line"><span class="comment">#与ScreenOS一样，在trust和untrust zone下分别定义地址对象便于策略调用，地址对象的名称可以是地址/掩码形式</span></span><br><span class="line">set security zones security-zone trust address-book address-set addr-group1 address pc1</span><br><span class="line"><span class="comment">#在trust zone下定义名称为add-group1的地址组，并将pc1地址放到该地址组中</span></span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">001</span> match source-address addr-group1 destination-address server1 application any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">001</span> then permit</span><br><span class="line"><span class="comment">#定义从trust 到untrust方向permit策略，允许addr-group1组的源地址访问server1地址any服务</span></span><br></pre></td></tr></table></figure>

<h2 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h2><p>SRX NAT较ScreenOS在功能实现方面基本保持一致，但在功能配置上有较大区别，配置的主要差异在于ScreenOS的NAT与policy是绑定的，无论是MIP/VIP/DIP还是基于策略的NAT，在policy中均要体现出NAT内容（除了缺省基于untrust接口的Souec-NAT模式外），而SRX 的NAT则作为网络层面基础内容进行独立配置（独立定义地址映射的方向、映射关系及地址范围），Policy中不再包含NAT相关配置信息，这样的好处是易于理解、简化运维，当网络拓朴和NAT映射关系发生改变时，无需调整Policy配置内容。</p>
<p>SRX NAT和Policy执行先后顺序为：目的地址转换－目的地址路由查找－执行策略检查－源地址转换，结合这个执行顺序，在配置Policy时需注意：Policy中源地址应是转换前的源地址，而目的地址应该是转换后的目的地址，换句话说，Policy中的源和目的地址应该是源和目的两端的真实IP地址，这一点和ScreenOS存在区别，需要加以注意。</p>
<p>SRX中不再使用MIP/VIP/DIP这些概念，其中MIP被Static静态地址转换取代，两者在功能上完全一致；DIP被Source NAT取代；基于Policy的目的地址转换及VIP被 Destination NAT取代。ScreenOS中基于Untrust zone接口的源地址转换被保留下来，但在SRX中不再是缺省模式（SRX中Trust Zone接口没有NAT模式概念），需要手工配置。类似ScreenOS，Static属于双向NAT，其他类型均属于单向NAT，</p>
<p>此外，SRX还多了一个proxy-arp概念，如果定义的IP Pool（可用于源或目的地址转换）与接口IP在同一子网时，需配置SRX对这个Pool内的地址提供ARP代理功能，这样对端设备能够解析到IP Pool地址的MAC地址（使用接口MAC地址响应对方），以便于返回报文能够送达SRX。下面是配置举例及相关说明：</p>
<h3 id="Interface-based-NAT"><a href="#Interface-based-NAT" class="headerlink" title="Interface based NAT"></a>Interface based NAT</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#NAT：</span></span><br><span class="line">set security nat source rule-set <span class="number">1</span> <span class="keyword">from</span> zone trust</span><br><span class="line">set security nat source rule-set <span class="number">1</span> to zone untrust</span><br><span class="line">set security nat source rule-set <span class="number">1</span> rule rule1 match source-address <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span> destination-address <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span></span><br><span class="line">set security nat source rule-set <span class="number">1</span> rule rule1 then source-nat interface</span><br><span class="line"><span class="comment">#上述配置定义NAT源地址映射规则，从Trust Zone访问Untrust Zone的所有流量用Untrust Zone接口IP做源地址转换。</span></span><br><span class="line"><span class="comment">#Policy:</span></span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match source-address <span class="number">10.1</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match destination-address any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match application any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> then permit</span><br><span class="line"><span class="comment">#上述配置定义Policy策略，允许Trust zone 10.1.2.2地址访问Untrust方向任何地址，根据前面的NAT配置，SRX在建立session时自动执行接口源地址转换。</span></span><br></pre></td></tr></table></figure>

<h3 id="Poo-based-Source-NAT"><a href="#Poo-based-Source-NAT" class="headerlink" title="Poo*based Source NAT"></a>Poo*based Source NAT</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#NAT：</span></span><br><span class="line">set security nat source poo*pool<span class="number">-1</span> address <span class="number">100.1</span><span class="number">.1</span><span class="number">.10</span> to <span class="number">100.1</span><span class="number">.1</span><span class="number">.20</span></span><br><span class="line">set security nat source rule-set <span class="number">1</span> <span class="keyword">from</span> zone trust</span><br><span class="line">set security nat source rule-set <span class="number">1</span> to zone untrust</span><br><span class="line">set security nat source rule-set <span class="number">1</span> rule rule1 match source-address <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span> destination-address <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span></span><br><span class="line">set security nat source rule-set <span class="number">1</span> rule rule1 then source-nat poo*pool<span class="number">-1</span></span><br><span class="line">set security nat proxy-arp interface ge<span class="number">-0</span>/<span class="number">0</span>/<span class="number">2</span> address <span class="number">100.1</span><span class="number">.1</span><span class="number">.10</span> to <span class="number">100.1</span><span class="number">.1</span><span class="number">.20</span></span><br><span class="line"><span class="comment">#上述配置表示从trust方向（any）到untrust方向(any)访问时提供源地址转换，源地址池为pool1(100.1.1.10 -100.1.1.20)，同时ge-0/0/2接口为此poo*IP提供ARP代理。需要注意的是：定义Pool时不需要与Zone及接口进行关联。配置proxy-arp目的是让返回包能够送达SRX，如果Pool与出接口IP不在同一子网，则对端设备需要配置指向100.1.1.1的Pool地址路由。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Policy：</span></span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match source-address <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match destination-address any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match application any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> then permit</span><br><span class="line"><span class="comment">#上述配置定义Policy策略，允许Trust zone 10.1.2.2地址访问Untrust方向任何地址，根据前面的NAT配置，SRX在建立session时自动执行源地址转换。</span></span><br></pre></td></tr></table></figure>

<h3 id="Poo-base-destination-NAT"><a href="#Poo-base-destination-NAT" class="headerlink" title="Poo*base destination NAT"></a>Poo*base destination NAT</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#NAT：</span></span><br><span class="line">set security nat destination poo*<span class="number">111</span> address <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>/<span class="number">32</span></span><br><span class="line">set security nat destination rule-set <span class="number">1</span> <span class="keyword">from</span> zone untrust</span><br><span class="line">set security nat destination rule-set <span class="number">1</span> rule <span class="number">111</span> match source-address <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span></span><br><span class="line">set security nat destination rule-set <span class="number">1</span> rule <span class="number">111</span> match destination-address <span class="number">100.100</span><span class="number">.100</span><span class="number">.100</span>/<span class="number">32</span></span><br><span class="line">set security nat destination rule-set <span class="number">1</span> rule <span class="number">111</span> then destination-nat poo*<span class="number">111</span></span><br><span class="line"><span class="comment">#上述配置将外网any访问100.100.100.100地址映射到内网192.168.1.100地址，注意：定义的Dst Pool是内网真实IP地址，而不是映射前的公网地址。这点和Src-NAT Pool有所区别。</span></span><br><span class="line"><span class="comment">#Policy：</span></span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match source-address any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match destination-address <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match application any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> then permit</span><br><span class="line"><span class="comment">#上述配置定义Policy策略，允许Untrust方向任何地址访问Trust方向192.168.1.100，根据前面的NAT配置，公网访问100.100.100.100时，SRX自动执行到192.168.1.100的目的地址转换。</span></span><br><span class="line"><span class="comment">#ScreenOS VIP功能对应的SRX Dst-nat配置：</span></span><br><span class="line">set security nat destination poo*<span class="number">222</span> address <span class="number">192.168</span><span class="number">.1</span><span class="number">.200</span>/<span class="number">32</span> port <span class="number">8000</span></span><br><span class="line">set security nat destination rule-set <span class="number">1</span> <span class="keyword">from</span> zone untrust</span><br><span class="line">set security nat destination rule-set <span class="number">1</span> rule <span class="number">111</span> match source-address <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span></span><br><span class="line">set security nat destination rule-set <span class="number">1</span> rule <span class="number">111</span> match destination-address <span class="number">100.100</span><span class="number">.100</span><span class="number">.100</span>/<span class="number">32</span></span><br><span class="line">set security nat destination rule-set <span class="number">1</span> rule <span class="number">111</span> match destination-port <span class="number">8000</span></span><br><span class="line">set security nat destination rule-set <span class="number">1</span> rule <span class="number">111</span> then destination-nat poo*<span class="number">222</span></span><br><span class="line"><span class="comment">#上述NAT配置定义：访问100.100.100.100地址8000端口映射至192.168.1.200地址8000端口，功能与ScreenOS VIP端口映射一致。</span></span><br></pre></td></tr></table></figure>

<h3 id="Poo-base-Static-NAT"><a href="#Poo-base-Static-NAT" class="headerlink" title="Poo*base Static NAT"></a>Poo*base Static NAT</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#NAT：</span></span><br><span class="line">set security nat static rule-set static-nat <span class="keyword">from</span> zone untrust</span><br><span class="line">set security nat static rule-set static-nat rule rule1 match destination-address <span class="number">100.100</span><span class="number">.100</span><span class="number">.100</span></span><br><span class="line">set security nat static rule-set static-nat rule rule1 then static-nat prefix <span class="number">192.168</span><span class="number">.1</span><span class="number">.200</span></span><br><span class="line"><span class="comment">#Policy:</span></span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match source-address any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match destination-address <span class="number">192.168</span><span class="number">.1</span><span class="number">.200</span></span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> match application any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy <span class="number">1</span> then permit</span><br><span class="line"><span class="comment">#Static NAT概念与ScreenOS MIP一致，属于静态双向一对一NAT，上述配置表示访问100.100.100.100时转换为192.168.1.200，当192.168.1.200访问Internet时自动转换为100.100.100.100。</span></span><br></pre></td></tr></table></figure>

<h2 id="IPSEC-VPN"><a href="#IPSEC-VPN" class="headerlink" title="IPSEC VPN"></a>IPSEC VPN</h2><p>SRX IPSEC VPN支持Site-to-Site VPN 和基于NS-remote的拨号VPN，和ScreenOS一样，site-to-site VPN也支持路由模式和Policy模式，在配置方面也和ScreenOS基本一致。SRX中的加密/验证算法在命名上和ScreenOS存在一些区别，配置过程中建议选择ike和ipsec的proposal为 standard模式，standard中包含SRX支持的全部加密/验证算法，只要对端设备支持其中任何一种即可。SRX中通道接口使用st0接口，对应ScreenOS中的tunnel虚拟接口。</p>
<p>下面是图中左侧SRX基于路由方式Site-to-site VPN配置：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set interfaces st0 unit <span class="number">0</span> family inet address <span class="number">10.2</span><span class="number">.0</span><span class="number">.1</span>/<span class="number">24</span></span><br><span class="line">set security zones security-zone untrust interfaces st0<span class="number">.0</span></span><br><span class="line">set routing-options static route <span class="number">10.1</span><span class="number">.2</span><span class="number">.0</span>/<span class="number">24</span> next-hop st0<span class="number">.0</span></span><br><span class="line"><span class="comment">#定义st0 tunnel接口地址/Zone及通过VPN通道到对端网络路由</span></span><br><span class="line">set security ike policy ABC mode main</span><br><span class="line">set security ike policy ABC proposal-set standard</span><br><span class="line">set security ike policy ABC pre-shared-key ascii-text *juniper*</span><br><span class="line"><span class="comment">#定义IKE Phase1 policy参数，main mode，standard proposal及预共享密钥方式</span></span><br><span class="line">set security ike gateway gw1 ike-policy ABC</span><br><span class="line">set security ike gateway gw1 address <span class="number">10.0</span><span class="number">.2</span><span class="number">.1</span></span><br><span class="line">set security ike gateway gw1 external-interface ge<span class="number">-0</span>/<span class="number">0</span>/<span class="number">1.0</span></span><br><span class="line"><span class="comment">#定义IKE gaeway参数，预共享密钥认证，对端网关10.0.2.1，出接口ge-0/0/1（位于untrust zone）</span></span><br><span class="line">set security ipsec policy *AAA* proposal-set standard</span><br><span class="line">set security ipsec vpn vpn1 bind-interface st0<span class="number">.0</span></span><br><span class="line">set security ipsec vpn vpn1 ike gateway gw1</span><br><span class="line">set security ipsec vpn vpn1 ike ipsec-policy *AAA*</span><br><span class="line">set security ipsec vpn vpn1 establish-tunnels immediately</span><br><span class="line"><span class="comment">#定义ipsec Phase 2 VPN参数：standard proposal、与st0.0接口绑定，调用Phase 1 gw1 ike网关。</span></span><br><span class="line">set security policies <span class="keyword">from</span>-zone untrust to-zone trust policy vpn-policy match source-address any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone untrust to-zone trust policy vpn-policy match destination-address any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone untrust to-zone trust policy vpn-policy match application any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone untrust to-zone trust policy vpn-policy then permit</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy vpn-policy match source-address any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy vpn-policy match destination-address any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy vpn-policy match application any</span><br><span class="line">set security policies <span class="keyword">from</span>-zone trust to-zone untrust policy vpn-policy then permit</span><br><span class="line"><span class="comment">#开启双向policy以允许VPN流量通过</span></span><br></pre></td></tr></table></figure>

<h2 id="Application-and-ALG"><a href="#Application-and-ALG" class="headerlink" title="Application and ALG"></a>Application and ALG</h2><p>SRX中自定义服务及ALG使用方法与ScreenOS保持一致，系统缺省开启FTP ALG，为TCP 21服务提供FTP应用ALG。自定义服务如果属于FTP类应用，需要将此自定义服务（非TCP 21端口）与FTP应用进行关联。下面举例定义一个FTP类服务ftp-test，使用目的端口为TCP 2100，服务超时时间为3600秒，并将此自定义服务与FTP应用关联（ALG），系统将识别此服务为FTP应用并开启FTP ALG来处理该应用流量。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set applications application ftp-test protoco*tcp destination-port <span class="number">2100</span> inactivity-timeout <span class="number">3600</span></span><br><span class="line">set applications application ftp-test application-protoco*ftp</span><br></pre></td></tr></table></figure>

<h2 id="JSRP（HA配置）"><a href="#JSRP（HA配置）" class="headerlink" title="JSRP（HA配置）"></a>JSRP（HA配置）</h2><p>JSRP是Juniper SRX的私有HA协议，对应ScreenOS的NSRP双机集群协议，支持A/P和A/A模式，JSRP对ScreenOS NSRP协议和JUNOS Cluster集群技术进行了整合集成，熟悉NSRP协议有助于对JSRP协议的理解。JSRP和NSRP最大的区别在于JSRP是完全意义上的Cluster概念，两台设备完全当作一台设备来看待，两台设备的接口板卡顺序编号、运维变更将对两台设备同时进行操作，无需额外执行ScreenOS的配置和会话同步等操作，而ScreenOS NSRP可看作在同步配置和动态对象（session）基础上独立运行的两台单独设备。</p>
<p>JSRP要求两台设备在软件版本、硬件型号、板卡数量、插槽位置及端口使用方面严格一一对应。由于SRX 是转发与控制层面完全分裂架构，JSRP需要控制层面 (配置同步)和数据层面(Session同步)两个平面的互联，建议控制和数据层面互联链路使用光纤链路直连（部分平台强制要求光纤链路直连）。</p>
<p>JSRP接口命名方式采用多个机箱抽象成一个逻辑机箱之后再统一为各个槽位进行编号，如上所示的SRX5800，每个SRX5800机箱有12个业务槽位，节点0槽位号从0开始编号，节点1槽位号从12开始往后编。</p>
<h3 id="整个JSRP配置过程包括如下7个步骤："><a href="#整个JSRP配置过程包括如下7个步骤：" class="headerlink" title="整个JSRP配置过程包括如下7个步骤："></a>整个JSRP配置过程包括如下7个步骤：</h3><ul>
<li><p>配置Cluster id和Node id (对应ScreenOS NSRP 的cluster id并需手工指定设备使用节点id）</p>
</li>
<li><p>指定Contro*Port   （指定控制层面使用接口，用于配置同步及心跳）</p>
</li>
<li><p>指定Fabric Link Port      （指定数据层面使用接口，主要session等RTO同步）</p>
</li>
<li><p>配置Redundancy Group     （类似NSRP的VSD group，优先级与抢占等配置）</p>
</li>
<li><p>每个机箱的个性化配置     （单机无需同步的个性化配置，如主机名、带外管理口IP地址等）</p>
</li>
<li><p>配置Redundant Ethernet Interface （类似NSRP的Redundant冗余接口）</p>
</li>
<li><p>配置Interface Monitoring     （类似NSRP interface monitor，是RG数据层面切换依据）</p>
</li>
</ul>
<h3 id="SRX-JSRP配置样例："><a href="#SRX-JSRP配置样例：" class="headerlink" title="SRX JSRP配置样例："></a>SRX JSRP配置样例：</h3><h4 id="配置Cluster-id和Node-id"><a href="#配置Cluster-id和Node-id" class="headerlink" title="配置Cluster id和Node id"></a>配置Cluster id和Node id</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SRX-A&gt;set chassis cluster cluster-id <span class="number">1</span> node <span class="number">0</span> reboot（注意该命令需在operational模式下输入，Cluster ID取值范围为<span class="number">1</span> – <span class="number">15</span>，当Cluster ID = <span class="number">0</span>时将unsets the cluster）</span><br><span class="line">SRX-B&gt;set chassis cluster cluster-id <span class="number">1</span> node <span class="number">1</span> reboot</span><br></pre></td></tr></table></figure>

<h4 id="指定Contro-Port（如果主控板RE上有固定control-ports，则无需指定）："><a href="#指定Contro-Port（如果主控板RE上有固定control-ports，则无需指定）：" class="headerlink" title="指定Contro*Port（如果主控板RE上有固定control-ports，则无需指定）："></a>指定Contro*Port（如果主控板RE上有固定control-ports，则无需指定）：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set chassis cluster control-ports fpc <span class="number">11</span> port <span class="number">0</span></span><br><span class="line">set chassis cluster control-ports fpc <span class="number">23</span> port <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h4 id="指定Fabric-Link-Port"><a href="#指定Fabric-Link-Port" class="headerlink" title="指定Fabric Link Port"></a>指定Fabric Link Port</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set interfaces fab0 fabric-options member-interfaces ge<span class="number">-1</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">set interfaces fab1 fabric-options member-interfaces ge<span class="number">-13</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"><span class="comment">#Fabric Link中的Fab0固定用于node 0，Fab1固定用于node 1</span></span><br></pre></td></tr></table></figure>

<h4 id="配置Redundancy-Group"><a href="#配置Redundancy-Group" class="headerlink" title="配置Redundancy Group"></a>配置Redundancy Group</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#RG0固定用于主控板RE切换，RG1以后用于redundant interface切换，RE切换独立于接口切换</span></span><br><span class="line">set chassis cluster reth-count <span class="number">10</span> （指定整个Cluster中redundant ethernet interface最多数量）</span><br><span class="line">set chassis cluster redundancy-group <span class="number">0</span> node <span class="number">0</span> priority <span class="number">200</span> （高值优先，与NSRP相反）</span><br><span class="line">set chassis cluster redundancy-group <span class="number">0</span> node <span class="number">1</span> priority <span class="number">100</span></span><br><span class="line">set chassis cluster redundancy-group <span class="number">1</span> node <span class="number">0</span> priority <span class="number">200</span> （高值优先，与NSRP相反）</span><br><span class="line">set chassis cluster redundancy-group <span class="number">1</span> node <span class="number">1</span> priority <span class="number">100</span></span><br></pre></td></tr></table></figure>

<h4 id="每个机箱的个性化配置，便于对两台设备的区分与管理"><a href="#每个机箱的个性化配置，便于对两台设备的区分与管理" class="headerlink" title="每个机箱的个性化配置，便于对两台设备的区分与管理"></a>每个机箱的个性化配置，便于对两台设备的区分与管理</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set groups node0 system host-name SRX-A</span><br><span class="line">set groups node0 interfaces fxp0 unit <span class="number">0</span> family inet address <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>/<span class="number">24</span> （带外网管口名称为fxp0，区别ScreenOS的MGT口）</span><br><span class="line">set groups node1 system host-name SRX-B</span><br><span class="line">set groups node1 interfaces fxp0 unit <span class="number">0</span> family inet address <span class="number">1.1</span><span class="number">.1</span><span class="number">.2</span>/<span class="number">24</span></span><br><span class="line">set apply-groups $&#123;node&#125;   （应用上述groups配置）</span><br></pre></td></tr></table></figure>

<h4 id="配置Redundant-Ethernet-Interface"><a href="#配置Redundant-Ethernet-Interface" class="headerlink" title="配置Redundant Ethernet Interface"></a>配置Redundant Ethernet Interface</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Redundant Ethernet Interface类似ScreenOS里的redundant interface，只不过Redundant Ethernet interface是分布在不同的机箱上 (这一特性又类似ScreenOS 的VSI接口)。</span></span><br><span class="line">Set interface ge<span class="number">-0</span>/<span class="number">0</span>/<span class="number">0</span> gigether-options redundant-parent reth0 （node <span class="number">1</span>的ge<span class="number">-0</span>/<span class="number">0</span>/<span class="number">0</span>接口）</span><br><span class="line">Set interface ge<span class="number">-13</span>/<span class="number">0</span>/<span class="number">0</span> gigether-options redundant-parent reth0 （node <span class="number">1</span>的ge<span class="number">-0</span>/<span class="number">0</span>/<span class="number">0</span>接口）</span><br><span class="line">Set interface reth0 redundant-ether-options redundancy-group <span class="number">1</span>   （reth0属于RG1）</span><br><span class="line">Set interface reth0 unit <span class="number">0</span> family inet address <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<h4 id="配置Interface-Monitoring，被监控的接口Down掉后，RG1将自动进行主备切换（与ScreenOS类似），"><a href="#配置Interface-Monitoring，被监控的接口Down掉后，RG1将自动进行主备切换（与ScreenOS类似），" class="headerlink" title="配置Interface Monitoring，被监控的接口Down掉后，RG1将自动进行主备切换（与ScreenOS类似），"></a>配置Interface Monitoring，被监控的接口Down掉后，RG1将自动进行主备切换（与ScreenOS类似），</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Set cluster redundancy-group <span class="number">1</span> interface-monitor ge<span class="number">-0</span>/<span class="number">0</span>/<span class="number">0</span> weight <span class="number">255</span></span><br><span class="line">Set cluster redundancy-group <span class="number">1</span> interface-monitor ge<span class="number">-0</span>/<span class="number">0</span>/<span class="number">1</span> weight <span class="number">255</span></span><br><span class="line">Set cluster redundancy-group <span class="number">1</span> interface-monitor ge<span class="number">-13</span>/<span class="number">0</span>/<span class="number">0</span> weight <span class="number">255</span></span><br><span class="line">Set cluster redundancy-group <span class="number">1</span> interface-monitor ge<span class="number">-13</span>/<span class="number">0</span>/<span class="number">1</span> weight <span class="number">255</span></span><br></pre></td></tr></table></figure>

<h3 id="JSRP维护命令"><a href="#JSRP维护命令" class="headerlink" title="JSRP维护命令"></a>JSRP维护命令</h3><ul>
<li>手工切换JSRP Master，RG1 原backup将成为Master</li>
</ul>
<p>root@srx5800a&gt; request chassis cluster failover redundancy-group 1 node 1</p>
<ul>
<li>手工恢复JSRP状态，按照优先级重新确定主备关系（高值优先）</li>
</ul>
<p>root@srx5800b&gt; request chassis cluster failover reset redundancy-group 1</p>
<ul>
<li>查看cluster interface</li>
</ul>
<p>root@router&gt; show chassis cluster interfaces</p>
<ul>
<li>查看cluster 状态、节点状态、主备关系</li>
</ul>
<p>lab@srx5800a# run show chassis cluster status</p>
<ul>
<li>取消cluster配置</li>
</ul>
<p>srx5800a# set chassis cluster disable reboot</p>
<ul>
<li>升级JSRP软件版本<br>SRX目前暂不支持软件在线升级（ISSU），升级过程会中断业务。<ul>
<li>升级步骤如下：<ul>
<li>升级node 0，注意不要重启系统</li>
<li>升级node 1，注意不要重启系统.</li>
<li>同时重启两个系统</li>
<li>恢复处于disabled状态的node</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>当contro*port或fabric link出现故障时，为避免出现双master (split-brain)现象，JSRP会把出现故障前状态为secdonary的node设为disabled状态，即除了RE，其余部件都不工作。想要恢复必须reboot该node。</p>
<h1 id="SRX防火墙常规操作与维护"><a href="#SRX防火墙常规操作与维护" class="headerlink" title="SRX防火墙常规操作与维护"></a>SRX防火墙常规操作与维护</h1><h2 id="设备关机"><a href="#设备关机" class="headerlink" title="设备关机"></a>设备关机</h2><p>SRX因为主控板上有大容量硬盘，为防止强行断电关机造成硬件故障，要求设备关机必须按照下面的步骤进行操作：</p>
<ol>
<li><p>管理终端连接SRX console口。</p>
</li>
<li><p>使用具有足够权限的用户名和密码登陆CLI命令行界面。</p>
</li>
<li><p>在提示符下输入下面的命令：</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user@host&gt; request system halt</span><br><span class="line">…</span><br><span class="line">The operating system has halted.</span><br><span class="line">Please press any key to reboot(除非需要重启设备，此时不要敲任何键，否则设备将进行重启)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>等待console输出上面提示信息后，确认操作系统已停止运行，关闭机箱背后电源模块电源。</li>
</ol>
<h2 id="设备重启"><a href="#设备重启" class="headerlink" title="设备重启"></a>设备重启</h2><p>SRX重启必须按照下面的步骤进行操作：</p>
<ol>
<li><p>管理终端连接SRX console口。</p>
</li>
<li><p>使用具有足够权限的用户名和密码登陆CLI命令行界面。</p>
</li>
<li><p>在提示符下输入下面的命令：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user@host&gt; request system reboot</span><br></pre></td></tr></table></figure>
</li>
<li><p>等待console设备的输出，操作系统已经重新启动。</p>
</li>
</ol>
<h2 id="操作系统升级"><a href="#操作系统升级" class="headerlink" title="操作系统升级"></a>操作系统升级</h2><p>SRX操作系统软件升级必须按照下面的步骤进行操作：</p>
<ol>
<li><p>管理终端连接SRX console口，便于升级过程中查看设备重启和软件加载状态。</p>
</li>
<li><p>SRX上开启FTP服务，并使用具有超级用户权限的非root用户通过FTP客户端将下载的升级软件介质上传到SRX上。</p>
</li>
<li><p>升级前，执行下面的命令备份旧的软件及设定：</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user@host&gt; request system snapshot</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>加载新的SRX软件：</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user@host&gt;request system software add validate *filename.tgz reboot*</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>软件加载成功后， SRX将自动重启，重启完成后检查系统当前软件版本号：</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user@host&gt; show system software</span><br></pre></td></tr></table></figure>

<h2 id="密码恢复"><a href="#密码恢复" class="headerlink" title="密码恢复"></a>密码恢复</h2><p>SRX Root密码丢失，并且没有其他的超级用户权限，那么就需要执行密码恢复，该操作需要中断设备正常运行，但不会丢失配置信息，这点与ScreenOS存在区别。</p>
<p>要进行密码恢复，请按照下面操作进行：</p>
<ol>
<li><p>Console口连接SRX，然后重启SRX。</p>
</li>
<li><p>在启动过程中，console上出现下面的提示的时候，按空格键中断正常启动方式，然后再进入单用户状态，并输入：boot -s</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Loading /boot/defaults/loader.conf</span><br><span class="line">/kerne*data=… … syms=[… …]</span><br><span class="line">Hit [Enter] to boot immediately, <span class="keyword">or</span> space bar <span class="keyword">for</span> command prompt.</span><br><span class="line">loader&gt; </span><br><span class="line">loader&gt; boot -s</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>执行密码恢复：在以下提示文字后输入recovery，设备将自动进行重启</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Enter ful*pathname of shel*<span class="keyword">or</span> ‘recovery’ <span class="keyword">for</span> root password recovery <span class="keyword">or</span> RETURN <span class="keyword">for</span> /bin/sh: recovery</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>进入配置模式，删除root密码，并重现设置root密码：</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user@host&gt; configure</span><br><span class="line">Entering configuration mode</span><br><span class="line">user@host<span class="comment">#delete system root-authentication</span></span><br><span class="line">user@host<span class="comment">#set system root-authentication plain-text-password</span></span><br><span class="line">user@host<span class="comment">#New password:</span></span><br><span class="line">user@host<span class="comment">#Retype new password:</span></span><br><span class="line">user@host<span class="comment"># commit</span></span><br><span class="line">commit complete</span><br></pre></td></tr></table></figure>

<h2 id="常用监控维护命令"><a href="#常用监控维护命令" class="headerlink" title="常用监控维护命令"></a>常用监控维护命令</h2><p>下列操作命令在操作模式下使用，或在配置模式下run show…</p>
<ul>
<li><p>show system software 查看当前软件版本号</p>
</li>
<li><p>show system uptime    查看系统启动时间</p>
</li>
<li><p>show chassis haredware  查看硬件板卡及序列号</p>
</li>
<li><p>show chassis environment 查看硬件板卡当前状态</p>
</li>
<li><p>show chassis routing-engine 查看主控板（RE）资源使用及状态</p>
</li>
<li><p>show route        查看路由表</p>
</li>
<li><p>show arp        查看ARP表</p>
</li>
<li><p>show log messages    查看系统日志</p>
</li>
<li><p>show interface terse    查看所有接口运行状态</p>
</li>
<li><p>show interface ge-x/y/z detai*查看接口运行细节信息</p>
</li>
<li><p>monitor interface ge-x/y/z   动态统计接口数据包转发信息</p>
</li>
<li><p>monitor traffic interface ge-x/y/z 动态报文抓取（Tcpdump，类似ScreenOS snoop命令）</p>
</li>
<li><p>show security flow session summary 查看当前防火墙并发会话数</p>
</li>
<li><p>show security flow session     查看当前防火墙具体并发会话</p>
</li>
<li><p>clear security flow session al*  清除当前session</p>
</li>
<li><p>show security alg status     检查全局ALG开启情况</p>
</li>
<li><p>SRX对应ScreenOS debug flow basic跟踪报文处理路径的命令：  </p>
<ul>
<li>set security flow traceoptions flag basic-datapath 开启SRX基本报文处理Debug</li>
<li>set security flow traceoptions file <em>filename.log</em>  将输出信息记录到指定文件中</li>
<li>set security flow traceoptions file <em>filename.log</em> size <file-size> 设置该文件大小，缺省128k</li>
<li>set security flow traceoptions packet-filter filter1 destination-prefix 5.5.5.2 </li>
</ul>
</li>
<li><p>设置报文跟踪过滤器</p>
<ul>
<li>run file show <em>filename.log</em> 查看该Log输出信息</li>
</ul>
</li>
<li><p>SRX对应ScreenOS get tech命令，开Case时需要抓取的信息：request support information</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Juniper</category>
      </categories>
      <tags>
        <tag>Juniper</tag>
        <tag>SRX</tag>
      </tags>
  </entry>
  <entry>
    <title>一文看懂！你绝对没见过的DHCP客户端配置及测试</title>
    <url>/2020/10/27/%E4%B8%80%E6%96%87%E7%9C%8B%E6%87%82%EF%BC%81%E4%BD%A0%E7%BB%9D%E5%AF%B9%E6%B2%A1%E8%A7%81%E8%BF%87%E7%9A%84DHCP%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE%E5%8F%8A%E6%B5%8B%E8%AF%95.html</url>
    <content><![CDATA[<p><strong>DHCP，DNS和HTTP是3种常见的高层协议。</strong></p>
<p><strong>什么是DHCP协议：</strong>DHCP（Dynamic Host Configuration Protocol ,动态主机配置协议）通常被用在大型的局域网络中，主要作用是集中的管理，分配IP地址，使网络环境中的主机动态的获得IP地址，Gateway地址，DNS服务器地址等信息，并能够提升地址的使用率。</p>
<h2 id="DHCP协议的工作过程？"><a href="#DHCP协议的工作过程？" class="headerlink" title="DHCP协议的工作过程？"></a>DHCP协议的工作过程？</h2><ol>
<li><p><strong>发现阶段：</strong>即DHCP客户机寻找DHCP服务器的阶段。DHCP客户机以广播的方式发送DHCP discover 发现信息来寻找DHCP服务器（因为DHCP服务器的IP地址对客户机来说是未知的），即向255.255.255.255发送特定的广播信息，网络上每一台安装了TCP/IP协议的主机都会接收到这种广播信息，但只有DHCP服务器才会作出响应。</p>
</li>
<li><p><strong>提供阶段：</strong>即DHCP服务器提供IP地址的阶段。在网络中收到DHCP discover发现信息的DHCP服务器都会作出响应，它从尚未出租的IP地址中挑选一个分配给DHCP客户机，向DHCP客户机发送一个包含出租的IP地址和其他设置额DHCP offer提供信息。</p>
</li>
<li><p><strong>选择阶段：</strong>DHCP客户机选择某台DHCP服务器提供的IP地址的阶段。 如果有多台DHCP服务器向DHCP客户机发来的DHCP offer，客户机只接收第一个收到的DHCP offer，然后它以广播的方式回答一个DHCP request请求信息。该信息中包含它所选定的DHCP服务器请求IP地址的内容。之所以要以广播的方式回答，是为了通知所有的DHCP服务器，它将选择某台DHCP服务器所提供的IP地址。</p>
</li>
<li><p><strong>确认阶段：</strong>即DHCP服务器确认所提供的IP地址的阶段。当DHCP服务器收到DHCP客户机回答的DHCP resquest请求后，它便向DHCP客户机发送一个包含它提供的IP地址和其他设置的DHCP ACK确认信息，告诉DHCP客户机可以使用它所提供的IP地址。然后DHCP客户机便将其TCP/IP协议与网卡绑定，除了DHCP客户机所选择的服务器IP外，其他的DHCP服务器都将收回曾提供的IP地址。</p>
</li>
<li><p><strong>重新登陆：</strong>以后DHCP客户机每次登陆网络时，就不需要再发送DHCP discover发现信息了。而是直接发送包含前一次所分配IP地址的DHCP resquest请求。当DHCP服务器收到这一信息后，它会尝试让客户机继续使用原来的IP并回答一个DHCP ACK确认信息，如果此IP地址无法分配个原来的DHCP客户机时（比如IP分配给其他DHCP客户机使用） ，则DHCP服务器给DHCP客户机回答一个DHCP NACK 否认消息，当原来的DHCP客户机收到此消息后，它就必须重新发送DHCP discover发现信息重新请求新的IP地址。</p>
</li>
<li><p><strong>更新租约：</strong>DHCP服务器向DHCP客户机出租的IP地址一般都由一个租借期限，期满后DHCP服务器会收回出租的IP地址。如果DHCP客户机要延长其IP租约，则必须更新其租约。DHCP客户机启动时和IP租约期限过一半时，DHCP客户机都会自动向DHCP服务器发送其更新租约的信息。</p>
</li>
</ol>
<h2 id="DHCP由三种机制分配IP地址"><a href="#DHCP由三种机制分配IP地址" class="headerlink" title="DHCP由三种机制分配IP地址"></a><strong>DHCP由三种机制分配IP地址</strong></h2><ol>
<li><p><strong>自动分配方式：</strong>DHCP服务器为主机指定一个永久性的IP地址，一旦DHCP客户端第一次成功从DHCP服务器租用到IP地址，就可以永久使用该地址。</p>
</li>
<li><p><strong>动态分配方式：</strong>DHCP服务器给主机指定一个有时间限制的IP地址， 时间到期或主机明确表示放弃该地址时，该地址可以被其他主机使用。</p>
</li>
<li><p><strong>手工分配方式：</strong>客户端的IP地址是由网络管理员指定的，DHCP服务器只是将指定的IP地址告诉客户端主机。 </p>
</li>
</ol>
<blockquote>
<p>三种地址分配方式中， 只有动态分配方式可以重复使用客户端不再需要的地址</p>
</blockquote>
<h2 id="DHCP服务配置"><a href="#DHCP服务配置" class="headerlink" title="DHCP服务配置"></a><strong>DHCP服务配置</strong></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在开始之前注意selinux状态disable防火墙关闭</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum install -y dhcp</span></span><br><span class="line"><span class="comment">##安装服务</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -qc dhcp</span></span><br><span class="line">/etc/dhcp/dhcpd.conf</span><br><span class="line">/etc/dhcp/dhcpd6.conf</span><br><span class="line">/etc/openldap/schema/dhcp.schema</span><br><span class="line">/etc/sysconfig/dhcpd</span><br><span class="line">/var/lib/dhcpd/dhcpd.leases</span><br><span class="line">/var/lib/dhcpd/dhcpd6.leases</span><br><span class="line">[root@localhost ~]<span class="comment"># cat/etc/dhcp/dhcpd.conf</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># DHCP Server Configuration file.</span></span><br><span class="line"><span class="comment">#		see /usr/share/doc/dhcp*/dhcpd.conf.example</span></span><br><span class="line"><span class="comment">#		see dhcpd.conf(5) man page</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cp /usr/share/doc/dhc*/dhcpd.conf.example /etc/dhcp/dhcpd.conf</span></span><br><span class="line">сp: overwrite '/etc/dhcp/dhcpd.conf'? y</span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/dhcp/dhcpd.conf</span></span><br><span class="line"><span class="number">7</span> option domain-name <span class="string">"test.com"</span>;           <span class="comment">##设置DNS域</span></span><br><span class="line"><span class="number">8</span> option domain-name-servers <span class="number">172.25</span><span class="number">.8</span><span class="number">.10</span>;  <span class="comment">##设置DNS服务器地址</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">10</span> default-lease-time <span class="number">600</span>;                  <span class="comment">##设置默认租约时间，单位为秒</span></span><br><span class="line"><span class="number">11</span> max-lease-time <span class="number">7200</span>;                     <span class="comment">##设置最大租约时间，单位为秒</span></span><br><span class="line"><span class="number">14</span> <span class="comment">#ddns-update-style none;                 ##设置dns的更新方式</span></span><br><span class="line"><span class="number">22</span> log-facility local7;                     <span class="comment">##指定日志设备</span></span><br><span class="line"><span class="comment">####注释前面的subnet修改最后一 个subnet声明</span></span><br><span class="line"><span class="number">27</span> <span class="comment">#subnet 10.152.187.0 netmask 255.255.255.0 (</span></span><br><span class="line"><span class="number">28</span> <span class="comment">#&#125;</span></span><br><span class="line"><span class="number">32</span> subnet <span class="number">172.25</span><span class="number">.8</span><span class="number">.0</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> [ <span class="comment">##子网网段和子网掩码 </span></span><br><span class="line"><span class="number">33</span> 	range <span class="number">172.25</span><span class="number">.8</span><span class="number">.100</span> <span class="number">172.25</span><span class="number">.8</span><span class="number">.105</span>;         <span class="comment">##设置ip地址池范围100-105</span></span><br><span class="line"><span class="number">34</span>	option routers <span class="number">172.25</span><span class="number">.8</span><span class="number">.254</span>;             <span class="comment">##设置客户机的默认网关</span></span><br><span class="line"><span class="number">35</span> ]</span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl restart dhcpd  ##重启服务</span></span><br></pre></td></tr></table></figure>

<h2 id="客户机的配置"><a href="#客户机的配置" class="headerlink" title="客户机的配置"></a>客户机的配置</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># vim /etc/sysconfig/network-scripts/ifcfg-etho</span></span><br><span class="line">BOOTPROTO=dhcp    <span class="comment">###找到BOOTPROTO改成dhcp</span></span><br><span class="line">[root@server ~]<span class="comment"># systemctl restart network     ##重启网络</span></span><br></pre></td></tr></table></figure>

<h3 id="重启之前客户端的IP（ps：不要在意主机名）"><a href="#重启之前客户端的IP（ps：不要在意主机名）" class="headerlink" title="重启之前客户端的IP（ps：不要在意主机名）"></a>重启之前客户端的IP（ps：不要在意主机名）</h3><p><img src="../../../../images/Linux-dhcp/640.png" alt="img"></p>
<h3 id="重启之后IP变成了设置的范围最小值-100-105-中的100"><a href="#重启之后IP变成了设置的范围最小值-100-105-中的100" class="headerlink" title="重启之后IP变成了设置的范围最小值(100-105)中的100"></a>重启之后IP变成了设置的范围最小值(100-105)中的100</h3><p><img src="../../../../images/Linux-dhcp/640.jpeg" alt="img"></p>
<h2 id="DHCP客户端配置及测试"><a href="#DHCP客户端配置及测试" class="headerlink" title="DHCP客户端配置及测试"></a><strong>DHCP客户端配置及测试</strong></h2><h3 id="步骤一：使用dhclient工具测试DHCP服务"><a href="#步骤一：使用dhclient工具测试DHCP服务" class="headerlink" title="步骤一：使用dhclient工具测试DHCP服务"></a>步骤一：使用dhclient工具测试DHCP服务</h3><ul>
<li><p>针对eth0网卡执行dhclient调试</p>
<p>如果DHCP服务可用且客户机之间的网络正常，则执行dhclient -d eth0操作后可以观察到DHCP通信获取地址的四个过程：DHCP Discover、DHCP Offer、DHCP Request、DHCP ACK。<img src="../../../../images/Linux-dhcp/640-20201028050545104.png" alt="img"></p>
</li>
<li><p>退出调试模式<br>若要退出dhclient调试模式，可以按Ctrl+c中断任务：</p>
</li>
</ul>
<p><img src="../../../../images/Linux-dhcp/640-20201028045736780.png" alt="img"></p>
<h3 id="步骤二：调整网卡配置的方式来验证DHCP服务"><a href="#步骤二：调整网卡配置的方式来验证DHCP服务" class="headerlink" title="步骤二：调整网卡配置的方式来验证DHCP服务"></a>步骤二：调整网卡配置的方式来验证DHCP服务</h3><ul>
<li>修改网卡配置文件，启用BOOTPROTO=dhcp<br>BOOTPROTO表示启动网络接口的协议或方式，如果设为none、auto，通常需要在配置中手动指定IP地址等参数；而改成dhcp的话，表示查找DHCP服务器并申请分配可用的IP地址等参数。</li>
</ul>
<p><img src="../../../../images/Linux-dhcp/640-20201028045931546.png" alt="img"></p>
<ul>
<li><p>重启network服务，并确认地址获取结果</p>
<p>重启network服务：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@pc205 ~]<span class="comment"># service network restart</span></span><br><span class="line">正在关闭接口 eth0：[确定]</span><br><span class="line">关闭环回接口：[确定]</span><br><span class="line">弹出环回接口：[确定]</span><br><span class="line">弹出界面 eth0：</span><br><span class="line">正在决定 eth0 的 IP 信息…完成。[确定]</span><br></pre></td></tr></table></figure>

<p>确认已获得DHCP服务器分配的IP地址：</p>
</li>
</ul>
<p><img src="../../../../images/Linux-dhcp/640-20201028045931617.png" alt="img"></p>
<p>确认已获得DHCP服务器分配的DNS服务器地址：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@pc205 ~]<span class="comment"># cat /etc/resolv.conf</span></span><br><span class="line">; generated by /sbin/dhclient-script</span><br><span class="line">search tedu.cn</span><br><span class="line">nameserver <span class="number">192.168</span><span class="number">.4</span><span class="number">.5</span></span><br></pre></td></tr></table></figure>

<ul>
<li>查看IP租约信息<br>DHCP服务器端查看地址分配情况：</li>
</ul>
<p><img src="../../../../images/Linux-dhcp/640-20201028045931570.png" alt="img"></p>
<h2 id="客户端查看已获取的IP地址租约："><a href="#客户端查看已获取的IP地址租约：" class="headerlink" title="客户端查看已获取的IP地址租约："></a>客户端查看已获取的IP地址租约：</h2><p><strong><img src="../../../../images/Linux-dhcp/640-20201028045931601.png" alt="img"></strong></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Dhcp</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco AP 1852无法正常登录ME，升级版本后显示空间不足解决方法</title>
    <url>/2020/09/28/Cisco%20AP%201852%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E7%99%BB%E5%BD%95ME%EF%BC%8C%E5%8D%87%E7%BA%A7%E7%89%88%E6%9C%AC%E5%90%8E%E6%98%BE%E7%A4%BA%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95.html</url>
    <content><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>客户处1台cisco 1852-H-K9，原为lightweight ap， 希望使用ME模式（mobility express，即这台AP自身可以做为控制器，可管理25个AP，适用于小型企业，）</p>
<h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><p>通过在瘦AP模式下，使用ap-type mobility-express t<a href="ftp://x.x.x.x/">ftp://x.x.x.x/</a> 升级完成后，发现无法访问WEB页面。升级的版本为8.4.110，后来尝试了多次，终于能够WEB登录，但发现每次AP射频SSID有时出不来，决定换个8.5的新版本。直接在WEB页面上使用http升级，但升级中途报错，“中止”，这时候再重启AP后console发现系统报错，no space on flash，所有配置丢失，要重新初始化。查看flash大小为54M，利用率已经为100%</p>
<h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><h2 id="换版本"><a href="#换版本" class="headerlink" title="换版本"></a>换版本</h2><p>直接在瘦AP模式下升级  ap-type mobility-express t<a href="ftp://x.x.x.x/">ftp://x.x.x.x/</a> ，但tftp传输失败</p>
<p>后使用archieve download方式升级成功</p>
<h2 id="配置IP"><a href="#配置IP" class="headerlink" title="配置IP"></a>配置IP</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">capwap ap ip address  <span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span>   <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h2 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ap<span class="comment"># archive download-sw/overwrite/create-space  tftp://192.168.1.254/AIR-AP1850-K9-ME-8-4-100-0.JA3.zip</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>Wlan</tag>
        <tag>Ap</tag>
      </tags>
  </entry>
  <entry>
    <title>Cisco接口下load-interval含义</title>
    <url>/2020/09/28/Cisco%E6%8E%A5%E5%8F%A3%E4%B8%8Bload-interval%E5%90%AB%E4%B9%89.html</url>
    <content><![CDATA[<h2 id="load-interval-接口数据统计的周期"><a href="#load-interval-接口数据统计的周期" class="headerlink" title="load-interval 接口数据统计的周期"></a>load-interval 接口数据统计的周期</h2><p>To change the length of time for which data is used to compute load statistics, use the load-intervalcommand in interface configuration mode or Frame Relay DLCI configuration mode. To revert to the default setting, use the no form of this command.</p>
<h2 id="查看默认周期"><a href="#查看默认周期" class="headerlink" title="查看默认周期"></a>查看默认周期</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SW<span class="number">-3560</span><span class="comment">#  show interfaces f0/17</span></span><br><span class="line">FastEthernet0/<span class="number">17</span> <span class="keyword">is</span> up, line protocol <span class="keyword">is</span> up (connected) </span><br><span class="line">  Hardware <span class="keyword">is</span> Fast Ethernet, address <span class="keyword">is</span> <span class="number">0023.3416</span>.a813 (bia <span class="number">0023.3416</span>.a813)</span><br><span class="line">  MTU <span class="number">1500</span> bytes, BW <span class="number">100000</span> Kbit, DLY <span class="number">100</span> usec, </span><br><span class="line">     reliability <span class="number">255</span>/<span class="number">255</span>, txload <span class="number">9</span>/<span class="number">255</span>, rxload <span class="number">2</span>/<span class="number">255</span></span><br><span class="line">  Queueing strategy: fifo</span><br><span class="line">  Output queue: <span class="number">0</span>/<span class="number">40</span> (size/max)</span><br><span class="line">  <span class="number">5</span> minute input rate <span class="number">1063000</span> bits/sec, <span class="number">208</span> packets/sec   <span class="comment">#默认为5分钟</span></span><br><span class="line">  <span class="number">5</span> minute output rate <span class="number">3892000</span> bits/sec, <span class="number">464</span> packets/sec</span><br></pre></td></tr></table></figure>

<h2 id="手动更改周期为30s"><a href="#手动更改周期为30s" class="headerlink" title="手动更改周期为30s"></a>手动更改周期为30s</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SW<span class="number">-3560</span>(config)<span class="comment">#int f0/17</span></span><br><span class="line">SW<span class="number">-3560</span>(config-<span class="keyword">if</span>)<span class="comment">#load-interval 30</span></span><br><span class="line">SW<span class="number">-3560</span>(config-<span class="keyword">if</span>)<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">SW<span class="number">-3560</span><span class="comment">#sh int f0/17 | in put rate</span></span><br><span class="line">  <span class="number">30</span> second input rate <span class="number">783000</span> bits/sec, <span class="number">203</span> packets/sec</span><br><span class="line">  <span class="number">30</span> second output rate <span class="number">3783000</span> bits/sec, <span class="number">463</span> packets/sec</span><br><span class="line">SW<span class="number">-3560</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Cisco</category>
      </categories>
      <tags>
        <tag>Cisco</tag>
        <tag>load-interval</tag>
      </tags>
  </entry>
  <entry>
    <title>macOS允许任何来源安装</title>
    <url>/2020/09/28/macOS%E5%85%81%E8%AE%B8%E4%BB%BB%E4%BD%95%E6%9D%A5%E6%BA%90.html</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sudo spctl --master-disable</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MacOS</category>
      </categories>
      <tags>
        <tag>MacOS</tag>
      </tags>
  </entry>
  <entry>
    <title>打不开telnet://这种格式的URL怎么解决？</title>
    <url>/2020/09/28/%E6%89%93%E4%B8%8D%E5%BC%80%20telnet:%20%E8%BF%99%E7%A7%8D%E6%A0%BC%E5%BC%8F%E7%9A%84%20URL%20%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%EF%BC%9F.html</url>
    <content><![CDATA[<p>最近在用 eve-ng 网络模拟器，需要从浏览器中打开 <a href="telnet://xxx">telnet://xxx</a> 这种格式的链接。</p>
<p>我用 homebrew 安装了 Telnet，终端中可以正常打开，但是无法打开 URL 链接，例如：open telnet://xxx</p>
<p><img src="../../../../images/%E6%89%93%E4%B8%8D%E5%BC%80%20telnet:%20%E8%BF%99%E7%A7%8D%E6%A0%BC%E5%BC%8F%E7%9A%84%20URL%20%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%EF%BC%9F/304C1AA4-98B4-4372-BA3A-D120CBE9AC4F.jpg" alt="304C1AA4-98B4-4372-BA3A-D120CBE9AC4F"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sudo launchctl config user path /usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin</span><br></pre></td></tr></table></figure>

<p>运行重启即可</p>
]]></content>
      <categories>
        <category>MacOS</category>
      </categories>
      <tags>
        <tag>Telnet</tag>
      </tags>
  </entry>
  <entry>
    <title>护网行动安全防守工作指南</title>
    <url>/2020/09/28/%E6%8A%A4%E7%BD%91%E8%A1%8C%E5%8A%A8%E5%AE%89%E5%85%A8%E9%98%B2%E5%AE%88%E5%B7%A5%E4%BD%9C%E6%8C%87%E5%8D%97.html</url>
    <content><![CDATA[<p>   本指南主要为了规避驻场工程师在护网防守期间出现违规行为，从保密要求、网络传播、个人终端安全、值守要求、关键个人行为等方面提出最基本的护网期间工作准则，规避驻场工程师、小白等被攻击者利用的风险。  </p>
<p>一、保密要求 </p>
<ol>
<li><p>禁止泄露任何与用户相关的信息、数据、文档等内容； </p>
</li>
<li><p>禁止将客户信息化系统账号、密码、敏感信息粘贴到物理 办公位置任何地方；</p>
</li>
<li><p>严格遵守和执行和客户签订的保密协议内容，对于其中的禁止事项必须严格执行。</p>
</li>
</ol>
<p>二、网络传播 </p>
<ol>
<li><p>禁止私自在社交平台、微信朋友圈发布传播客户任何 HW 相关信息、客户资料等内容； </p>
</li>
<li><p>禁止将客户系统设计文档、网络拓扑、网站或系统代码等 文件传播到互联网； </p>
</li>
<li><p>禁止在互联网上的外部网站或应用（如论坛、微博、即时 通信软件等）上使用与客户公司设备、系统上相同的账号或口 令； </p>
<ol start="4">
<li>禁止通过云盘（包括天翼云盘、百度云、360 云盘等）、 社交软件（包括微信、QQ、易信）等方式进行企业敏感信息的 共享、存储。 </li>
</ol>
</li>
</ol>
<p>三、个人终端 </p>
<ol>
<li><p>禁止将个人终端账号与口令告知他人和设置终端弱口令；</p>
</li>
<li><p>禁止离开工位不锁屏； </p>
</li>
<li><p>禁止个人终端裸奔现象（未安装杀毒软件或杀毒软件病毒 库未更新），个人终端基线需要进行自我检查和安全加固，避免 被攻击；</p>
</li>
<li><p>禁止个人终端设备存放客户任何口令类电子文件、网络拓 扑、系统源码等敏感文件；</p>
</li>
<li><p>禁止点击来路不明邮件中的链接或打开附件（邮件附件内 容不是常见的文件格式，如后缀名是 exe、 htm、html、chm、 txt，vba、vbs，bat，7z 等的邮件）；</p>
</li>
<li><p>禁止开启远程协助类工具，包括但不限于 Windows 远程 桌面功能、QQ 远程协助工具、TeamViewer、VNC 等；</p>
</li>
<li><p>禁止访问可疑网站网址域名不是以（.com、.cn、 com.cn、.net、.net.cn、.org ）的网站及浏览器反馈访问网站有 证书错误、域名过长、域名不是由明显汉语拼音或英文单词组 成的网站等；</p>
</li>
<li><p>禁止使用非工作邮箱代收工作邮件；</p>
</li>
<li><p>禁止将个人终端同时跨接内外网；</p>
</li>
<li><p>禁止在个人终端上搭建无线热点；</p>
</li>
<li><p>下班离开办公室前关闭终端计算机。</p>
</li>
</ol>
<p>四、值守要求 </p>
<ol>
<li><p>护网期间禁止擅离职守，全员必须 7*24 小时开机，并保持通讯畅通；  </p>
</li>
<li><p>护网期间禁止隐瞒和恶意利用已发现的木马程序和漏洞，发现问题随时上报； </p>
</li>
<li><p>护网值守期间禁止开展与HW无关的任何工作；</p>
</li>
<li><p>护网值守期间禁止在客户现场拍摄现场照片，包括“指挥 部”、“护网”字样的条幅、铭牌、办公室环境等；</p>
</li>
<li><p>护网值守期间禁止向公司内部攻击队成员或其他攻击队成 员打探当前防守客户的成绩，不允许向客户承诺“可以打探成 绩”。 </p>
</li>
</ol>
<p>五、关键操作行为</p>
<ol>
<li><p>禁止任何形式的未授权的扫描探测、漏洞验证、渗透测试 行为；</p>
</li>
<li><p>重要操作必须上报项目经理或用户同意后，方可执行。如 使用一个漏洞验证语句或任何安全工具等； </p>
</li>
<li><p>禁止在办公网络及其他内网中搭建无线热点；</p>
</li>
<li><p>禁止未经审批开放内部系统的互联网出口； </p>
</li>
<li><p>禁止来路不明的人员远程控制公司内各类设备或执行其告 知的各项指令； </p>
</li>
<li><p>禁止手机连入客户内部网络并点击任何不明链接； </p>
</li>
<li><p>禁止未经授权和安全检查直接向客户信息化系统设备私自 插入移动设备；</p>
</li>
<li><p>禁止在用户各类信息化系统上传木马后门程序； </p>
</li>
<li><p>禁止在具有投放屏幕的电脑上进行敏感业务操作； </p>
</li>
<li><p>禁止使用和下载任何来历不明的安全工具、软件等。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>标准</category>
      </categories>
      <tags>
        <tag>护网</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统安全配置制度</title>
    <url>/2020/09/28/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%E5%88%B6%E5%BA%A6.html</url>
    <content><![CDATA[<h1 id="Windows系统安全配置管理制度"><a href="#Windows系统安全配置管理制度" class="headerlink" title="Windows系统安全配置管理制度"></a>Windows系统安全配置管理制度</h1><p>在应用以下安全制度之前应根据业务系统的实际情况进行操作，注意实施操作后对业务的风险。</p>
<h2 id="补丁管理制度"><a href="#补丁管理制度" class="headerlink" title="补丁管理制度"></a>补丁管理制度</h2><ul>
<li><p>对于不能访问 Internet 的 Windows 系统，应采用手工打补丁的方式。</p>
</li>
<li><p>应及时进行补丁更新，补丁的更新前应在测试系统中进行验证，验证通过后方可在正式系统进行部署</p>
</li>
</ul>
<h2 id="帐户与口令制度"><a href="#帐户与口令制度" class="headerlink" title="帐户与口令制度"></a>帐户与口令制度</h2><ul>
<li><p>所有帐户均应设置口令。</p>
</li>
<li><p>应将系统管理员账号重命名,如windows系统的administrator,。</p>
</li>
<li><p>应禁止操作系统多余账号, 如windows系统的Guest。</p>
</li>
<li><p>应启用“密码必须符合复杂性要求”，设置“密码长度最小值”、“密码最长存留期”、“密码最短存留期”、“密码强制修改时间”， 要求密码强度为8位以上字母大小写、数字和特殊字符组合，设置定期更换时间少于90天。</p>
</li>
<li><p>应设置“登录失败次数”、“账户锁定时间”，“账户锁定阈值”，“复位账户锁定计数器”来防止远程密码猜测攻击。</p>
</li>
<li><p>在信息安全组批准下，应定期利用口令破解软件进行口令模拟破解测试，在发现脆弱性口令后及时通告并采取强制性的补救修改措施。</p>
</li>
</ul>
<h2 id="网络服务制度"><a href="#网络服务制度" class="headerlink" title="网络服务制度"></a>网络服务制度</h2><ul>
<li><p>应尽可能减少网络服务，关闭不必要的服务。</p>
</li>
<li><p>应通过修改注册表项，调整优化 TCP/IP 参数，来提高系统抵抗 DoS 攻击的能力。</p>
</li>
<li><p>应限制使用 SNMP 服务。如果的确需要，应使用 V3 版本替代 V1、V2 版本，并启用 MD5 校验等功能。</p>
</li>
</ul>
<h2 id="文件系统制度"><a href="#文件系统制度" class="headerlink" title="文件系统制度"></a>文件系统制度</h2><ul>
<li><p>所有分区均应使用 NTFS。</p>
</li>
<li><p>尽量使用磁盘配额管理、文件加密（EFS）等功能。</p>
</li>
<li><p>应将所有常用的管理工具放在 %systemroot% 外的特殊目录下，并对其进行严格的访问控制，保证只有管理员才具有执行这些工具的权限。</p>
</li>
<li><p>应关闭 NTFS 生成 8.3 文件名格式。</p>
</li>
<li><p>应设置访问控制列表（ACL），对重要的目录、文件进行访问权限的限制。</p>
</li>
</ul>
<h2 id="日志制度"><a href="#日志制度" class="headerlink" title="日志制度"></a>日志制度</h2><ul>
<li><p>应启用系统和文件审核功能，包括应用程序日志、安全日志、系统日志、以及各种服务的日志。</p>
</li>
<li><p>应更改日志存放的目录，并及时监控，特别是安全日志、系统日志。对于重要主机设备，应建立集中的日志管理服务器，实现对重要主机设备日志的统一管理，以利于对主机设备日志的审查分析。</p>
</li>
</ul>
<h2 id="安全性增强制度"><a href="#安全性增强制度" class="headerlink" title="安全性增强制度"></a>安全性增强制度</h2><ul>
<li><p>对于独立服务器应直接检查本地的制度和配置。对于属于域的服务器，应检查域控制器上对计算机的域管理制度。检查内容主要为用户、用户组及其权限管理制度。</p>
</li>
<li><p>应限制对注册表的访问，严禁对注册表的匿名访问，严禁远程访问注册表，并对关键注册表项进行访问控制，以防止它们被攻击者用于启动特洛伊木马等恶意程序。</p>
</li>
<li><p>应定期检查注册表启动项目，避免系统被安装非法的自启动程序。</p>
</li>
<li><p>应隐含最后登陆用户名，避免攻击者猜测系统内的用户信息。</p>
</li>
<li><p>在登录系统时应显示告警信息，防止用户对远程终端服务口令进行自动化的脚本猜测，并删除关机按钮。</p>
</li>
<li><p>应删除 Windows 主机上所有默认的网络共享。</p>
</li>
<li><p>应关闭对 Windows 主机的匿名连接。</p>
</li>
<li><p>对于不需要共享服务的主机，应彻底关闭文件和打印机共享服务。</p>
</li>
<li><p>应限制 Pcanywhere 等远程管理工具的使用，如确实需要，应使用最新版本，完整安装补丁程序并经过评测，获得信息安全工作组的许可；并使用 Pcanywhere 加密方式进行管理。</p>
</li>
<li><p>应安装防病毒软件，并及时更新软件版本和病毒库。</p>
</li>
<li><p>尽量安装防火墙。</p>
</li>
</ul>
<h1 id="UNIX系统安全管理制度"><a href="#UNIX系统安全管理制度" class="headerlink" title="UNIX系统安全管理制度"></a>UNIX系统安全管理制度</h1><h2 id="补丁管理制度-1"><a href="#补丁管理制度-1" class="headerlink" title="补丁管理制度"></a>补丁管理制度</h2><ul>
<li><p>应及时安装系统最新补丁。</p>
</li>
<li><p>应及时升级服务至最新版本，补丁的更新前应在测试系统中进行验证，验证通过后方可在正式系统进行部署。</p>
</li>
</ul>
<h2 id="帐户与口令制度-1"><a href="#帐户与口令制度-1" class="headerlink" title="帐户与口令制度"></a>帐户与口令制度</h2><ul>
<li><p>所有帐户均应设置口令。</p>
</li>
<li><p>去除不需要的帐户、修改默认帐号的 shell 变量，如operator、halt、news、shutdown等用户。</p>
</li>
<li><p>除 root 外，不应存在其他 uid=0 的帐户。</p>
</li>
<li><p>应设置超时自动注销登陆，减少安全隐患。</p>
</li>
<li><p>应限制可以 su 为 root 的组。</p>
</li>
<li><p>应禁止 root 远程登陆。</p>
</li>
<li><p>在信息安全组批准下，应定期利用口令破解软件进行口令模拟破解测试，在发现脆弱性口令后及时通告并采取强制性的补救修改措施。</p>
</li>
</ul>
<h2 id="网络服务制度-1"><a href="#网络服务制度-1" class="headerlink" title="网络服务制度"></a>网络服务制度</h2><ul>
<li><p>应尽可能减少网络服务，关闭不必要的服务。</p>
</li>
<li><p>应启用 inetd 进站连接日志记录，增强审计功能。</p>
</li>
<li><p>应调整优化 TCP/IP 参数，来提高系统抵抗 DoS 攻击的能力。</p>
</li>
<li><p>应调整TCP/IP 参数，禁止 IP 源路由。</p>
</li>
<li><p>应限制使用 SNMP 服务。如果的确需要，应使用 V3 版本替代 V1、V2 版本，并启用 MD5 校验等功能。</p>
</li>
<li><p>应调整内核参数打开“TCP随机序列号”功能。</p>
</li>
</ul>
<h2 id="文件系统制度-1"><a href="#文件系统制度-1" class="headerlink" title="文件系统制度"></a>文件系统制度</h2><ul>
<li><p>尽量使系统 root 用户初始创建权限(umask)为077。</p>
</li>
<li><p>尽量使用磁盘配额管理功能。</p>
</li>
<li><p>去除适当文件的 set-uid 和 set-gid 位。</p>
</li>
<li><p>应限制 /etc 目录的可写权限。</p>
</li>
<li><p>增强对关键文件的执行权限控制。</p>
</li>
<li><p>为不同的挂载点指派不同的属性。</p>
</li>
</ul>
<h2 id="日志制度-1"><a href="#日志制度-1" class="headerlink" title="日志制度"></a>日志制度</h2><ul>
<li><p>应对 ssh、su 登陆日志进行记录。</p>
</li>
<li><p>除日志服务器外，应禁止 syslogd 网络监听514端口。</p>
</li>
<li><p>对于重要主机设备，应建立集中的日志管理服务器，实现对重要主机设备日志的统一管理，以利于对主机设备日 志的审查分析。</p>
</li>
</ul>
<h2 id="安全性增强制度-1"><a href="#安全性增强制度-1" class="headerlink" title="安全性增强制度"></a>安全性增强制度</h2><ul>
<li><p>只允许 root 执行 crontab 命令。</p>
</li>
<li><p>应保证 bash shell 保存少量的（或不保存）命令。</p>
</li>
<li><p>应禁止 GUI 登陆。</p>
</li>
<li><p>应隐藏系统提示信息。</p>
</li>
<li><p>尽量安装第三方安全增强软件。</p>
</li>
<li><p>操作系统在作业正常或非正常结束以后，能清除分配给该作业的全部临时工作区域。</p>
</li>
<li><p>系统能像保护信息的原件一样，精确地保护信息的拷贝。</p>
</li>
</ul>
]]></content>
      <categories>
        <category>System</category>
      </categories>
      <tags>
        <tag>System</tag>
      </tags>
  </entry>
  <entry>
    <title>路由交换安全配置标准</title>
    <url>/2020/09/28/%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%E6%A0%87%E5%87%86.html</url>
    <content><![CDATA[<h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>《路由器/交换机安全配置标准》是信息系统安全标准的一部分，主要目的是根据信息安全管理政策的要求，为公司的路由器/交换机提供配置基准，并作为网络系统设计、实施及维护的技术和安全参考依据。</p>
<h1 id="范围"><a href="#范围" class="headerlink" title="范围"></a>范围</h1><p>《路由器/交换机安全配置标准》适用于公司所有在生产环境和办公环境中使用的路由器/交换机。</p>
<h1 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h1><h2 id="IOS版本及升级策略"><a href="#IOS版本及升级策略" class="headerlink" title="IOS版本及升级策略"></a>IOS版本及升级策略</h2><p>IOS默认采用较新的稳定版本。安全组负责跟踪厂商发布的相关安全更新，评估是否进行升级。</p>
<h2 id="账户及口令管理"><a href="#账户及口令管理" class="headerlink" title="账户及口令管理"></a>账户及口令管理</h2><h3 id="账号管理"><a href="#账号管理" class="headerlink" title="账号管理"></a>账号管理</h3><ul>
<li><p>在具备条件的情况下，路由器交换机必须启用AAA并清除本地帐号。</p>
</li>
<li><p>不允许多人共用一个帐号，不允许一人有多个帐号。</p>
</li>
<li><p>每个帐号均需有明确的属主，离职人员帐号应当天清除。</p>
</li>
<li><p>特殊帐号需向安全组报批。 </p>
</li>
</ul>
<h3 id="口令管理"><a href="#口令管理" class="headerlink" title="口令管理"></a>口令管理</h3><p>口令管理应遵循《密码口令管理制度》，在设备支持的前提下使用enable密码为Console，Aux，VTY最后的认证方式。</p>
<h2 id="认证授权"><a href="#认证授权" class="headerlink" title="认证授权"></a>认证授权</h2><h3 id="管理界面"><a href="#管理界面" class="headerlink" title="管理界面"></a>管理界面</h3><ul>
<li>在具备条件的设备上仅允许ssh与https这两种远程管理方式，禁止使用telnet、http等。</li>
<li>为VTY配置ACL，限制远程管理源地址范围。</li>
<li>配置Console，Aux，VTY登录超时时间为15分钟。 </li>
</ul>
<h2 id="通用安全配置"><a href="#通用安全配置" class="headerlink" title="通用安全配置"></a>通用安全配置</h2><ul>
<li><p>启用Service Password-encryption。</p>
</li>
<li><p>启用NTP，确保设备时间的准确性。NTP server必须选择同机房由 OPS维护的服务器。</p>
</li>
<li><p>SNMP设置符合复杂度要求的Community String，且设置为只读权限，并建立ACL限制访问源地址范围。</p>
</li>
<li><p>启用Syslog，将日志导出并保存到同机房的日志集中存储服务器。</p>
</li>
<li><p>关闭不必要的服务：</p>
<ul>
<li><strong>在边界路由器对外接口禁用CDP</strong></li>
<li><strong>禁用TCP Small Servers</strong></li>
<li><strong>禁用UDP Small Servers</strong></li>
<li><strong>禁用Finger Server</strong></li>
<li><strong>禁用HTTP Server</strong></li>
<li><strong>禁用Bootp Server</strong></li>
<li><strong>禁用Configuration Auto-Loading</strong></li>
<li><strong>禁用IP Source Routing</strong></li>
<li><strong>禁用Proxy ARP</strong></li>
<li><strong>禁用IP Directed Broadcast</strong></li>
<li><strong>禁用IP Unreachables，Redirects，Mask Replies</strong></li>
<li><strong>禁用Router Name and DNS Name Resolution</strong></li>
</ul>
</li>
<li><p>在边界路由器或交换机的对外接口上对进入内网的下列数据包进行过滤：</p>
<ul>
<li><strong>原地址是非法地址（如：内部网地址，internet</strong> <strong>保留地址等）</strong></li>
<li><strong>目的地址是非法地址（如：内部网不存在的地址）</strong></li>
<li><strong>目的端口是非法或危险端口（SNMP，135-139等）</strong></li>
</ul>
</li>
<li><p>在边界路由器或交换机的对外接口上对流出内网的下列数据包进行过滤：</p>
<ul>
<li><strong>原地址是非法地址（如：内部网不存在的地址）</strong></li>
<li><strong>目的地址是非法地址（内部网地址，internet</strong> <strong>保留地址等）</strong></li>
<li><strong>目的端口是非法或危险端口（SNMP，135-139等）</strong></li>
</ul>
</li>
</ul>
<h2 id="仅适用于交换机的安全配置"><a href="#仅适用于交换机的安全配置" class="headerlink" title="仅适用于交换机的安全配置"></a>仅适用于交换机的安全配置</h2><ul>
<li><p>启用spanning Tree，防止二层环路。</p>
</li>
<li><p>网络增加新交换机时，注意其Bridge ID的设置不能小于运行网络中核心交换机的Bridge ID值。</p>
</li>
<li><p>新建网络禁止将native vlan作为普通的数据网络使用。</p>
</li>
<li><p>交换机端口除与其它交换机相连且需要使用trunk模式以外，其它所有端口关闭trunk协商。</p>
</li>
<li><p>设置VTP transparent模式防止新交换机无意中对网络中VLAN的设置产生的影响，在必须设置为server或client模式的交换机上配置符合复杂度要求的VTP口令。</p>
</li>
</ul>
]]></content>
      <categories>
        <category>标准</category>
      </categories>
      <tags>
        <tag>配置标准</tag>
      </tags>
  </entry>
  <entry>
    <title>S2750+S5700+S6720+snmp+配置指南-网络管理与监控</title>
    <url>/2020/09/28/%E5%8D%8E%E4%B8%BAsnmp%E9%85%8D%E7%BD%AE.html</url>
    <content><![CDATA[<h2 id="Snmp简介"><a href="#Snmp简介" class="headerlink" title="Snmp简介"></a>Snmp简介</h2><p>简单网络管理协议SNMP是广泛用于TCP/IP网络的网络管理标准协议。SNMP提供了一种通过运行网络管理软件的中心计算机（即网络管理工作站）来管理网元的方法。共有三个版本SNMPv1、SNMPv2c和SNMPv3，用户可以根据情况选择配置一个或多个版本。</p>
<h2 id="Snmp原理"><a href="#Snmp原理" class="headerlink" title="Snmp原理"></a>Snmp原理</h2><h3 id="Snmp管理模型"><a href="#Snmp管理模型" class="headerlink" title="Snmp管理模型"></a>Snmp管理模型</h3><p>SNMP系统包括网络管理系统NMS（Network Management System）、代理进程Agent、被管对象Management object和管理信息库MIB（Management Information Base）四部分组成。</p>
<p><strong>NMS作为整个网络的网管中心，对设备进行管理。</strong></p>
<p>每个被管理设备中都包含驻留在设备上的Agent进程、MIB和多个被管对象。NMS通过与运行在被管理设备上的Agent交互，由Agent通过对设备端的MIB的操作，完成NMS的指令。</p>
<img src="../../../../images/S2750,+S5700,+S6720+snmp+%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7/image-20200929000017562.png" alt="image-20200929000017562" style="zoom:50%;" />

<h4 id="NMS"><a href="#NMS" class="headerlink" title="NMS"></a>NMS</h4><p>NMS在网络中扮演管理者角色，是一个采用SNMP协议对网络设备进行管理/监视的系统，运行在NMS服务器上。</p>
<ul>
<li>NMS可以向设备上的Agent发出请求，查询或修改一个或多个具体的参数值。</li>
<li>NMS可以接收设备上的Agent主动发送的Trap信息，以获知被管理设备当前的状态。</li>
</ul>
<h4 id="Agent"><a href="#Agent" class="headerlink" title="Agent"></a>Agent</h4><p>Agent是被管理设备中的一个代理进程，用于维护被管理设备的信息数据并响应来自NMS的请求，把管理数据汇报给发送请求的NMS。 </p>
<ul>
<li>Agent接收到NMS的请求信息后，通过MIB表完成相应指令后，并把操作结果响应给NMS。</li>
<li>当设备发生故障或者其它事件时，设备会通过Agent主动发送信息给NMS，向NMS报告设备当前的状态变化。</li>
</ul>
<h4 id="Management-object"><a href="#Management-object" class="headerlink" title="Management object"></a>Management object</h4><p>Management object指被管理对象。每一个设备可能包含多个被管理对象，被管理对象可以是设备中的某个硬件，也可以是在硬件、软件（如路由选择协议）上配置的参数集合。</p>
<h4 id="MIB"><a href="#MIB" class="headerlink" title="MIB"></a>MIB</h4><p>MIB是一个数据库，指明了被管理设备所维护的变量（即能够被Agent查询和设置的信息）。MIB在数据库中定义了被管理设备的一系列属性：对象的名称、对象的状态、对象的访问权限和对象的数据类型等。</p>
<p>通过MIB，可以完成以下功能：</p>
<ul>
<li><p>Agent通过查询MIB，可以获知设备当前的状态信息。</p>
</li>
<li><p>Agent通过修改MIB，可以设置设备的状态参数。</p>
</li>
</ul>
<h3 id="SNMPv1-SNMPv2c"><a href="#SNMPv1-SNMPv2c" class="headerlink" title="SNMPv1/SNMPv2c"></a>SNMPv1/SNMPv2c</h3><h4 id="SNMPv1-SNMPv2c-报文结构"><a href="#SNMPv1-SNMPv2c-报文结构" class="headerlink" title="SNMPv1/SNMPv2c 报文结构"></a>SNMPv1/SNMPv2c 报文结构</h4><p>SNMPv1/SNMPv2c报文主要由版本、团体名、SNMP PDU三部分构成。</p>
<img src="../../../../images/S2750,+S5700,+S6720+snmp+%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7/image-20200929000559918.png" alt="image-20200929000559918" style="zoom:50%;" />

<p>报文中的主要字段定义如下：</p>
<ul>
<li><p>版本：表示SNMP的版本，如果是SNMPv1报文则对应字段值为0，SNMPv2c则为1。 </p>
</li>
<li><p>团体名：用于在Agent与NMS之间完成认证，字符串形式，用户可自行定义。团体名包括“可读”和“可写”两种，执行GetRequest、GetNextRequest操作时，采用“可读团体名”进行认证；执行Set操作时，则采用“可写团体名”认证。</p>
</li>
<li><p>SNMPv1/SNMPv2c PDU：包含PDU类型、请求标识符、变量绑定列表等信息。其中SNMPv1 PDU包括GetRequest PDU、GetNextRequest PDU、SetRequest PDU、Response PDU和Trap PDU几种类型，SNMPv2c PDU在SNMPv1的基础上新增了GetBulkRequest PDU和InformRequest PDU两种类型。</p>
</li>
</ul>
<h4 id="SNMPv1-SNMPv2c-操作类型"><a href="#SNMPv1-SNMPv2c-操作类型" class="headerlink" title="SNMPv1/SNMPv2c 操作类型"></a>SNMPv1/SNMPv2c 操作类型</h4><p>SNMPv1/SNMPv2c规定了7种操作类型，用来完成NMS和Agent之间的信息交换。</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Get</strong></td>
<td>Get操作可以从Agent中提取一个或多个参数值。</td>
</tr>
<tr>
<td><strong>GetNext</strong></td>
<td>GetNext操作可以从Agent中按照字典序提取下一个参数值。</td>
</tr>
<tr>
<td><strong>Set</strong></td>
<td>Set操作可以设置Agent的一个或多个参数值。</td>
</tr>
<tr>
<td><strong>Response</strong></td>
<td>Response操作可以返回一个或多个参数值。这个操作是由Agent发出的，它是GetRequest、GetNextRequest、SetRequest和GetBulkRequest四种操作的响应操作。Agent接收到来自NMS的Get/Set指令后，通过MIB完成相应的查询/修改操作，然后利用Response操作将信息回</td>
</tr>
<tr>
<td><strong>Trap</strong></td>
<td>Trap信息是Agent主动向NMS发出的信息，告知管理进程设备端出现的情况。</td>
</tr>
<tr>
<td><strong>GetBulk</strong></td>
<td>GetBulk操作实现了NMS对被管理设备的信息群查询。</td>
</tr>
<tr>
<td><strong>Inform</strong></td>
<td>InformRequest也是被管理设备向NMS主动发送告警。与Trap告警不同的是，被管理设备发送Inform告警后，需要NMS回复InformResponse来进行确认。</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>SNMPv1版本不支持</strong>GetBulk<strong>和</strong>Inform<strong>操作。</strong></p>
</blockquote>
<h4 id="SNMPv1和SNMPv2c的工作原理"><a href="#SNMPv1和SNMPv2c的工作原理" class="headerlink" title="SNMPv1和SNMPv2c的工作原理"></a>SNMPv1和SNMPv2c的工作原理</h4><p>SNMPv1和SNMPv2c的工作原理基本一致。基本操作类型如下：</p>
<img src="../../../../images/S2750,+S5700,+S6720+snmp+%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7/image-20200929001305159.png" alt="image-20200929001305159" style="zoom:50%;" />

<ul>
<li><p>Get操作<br>假定NMS想要获取被管理设备MIB节点sysContact的值，使用可读团体名为public，过程如下所示：</p>
<ul>
<li>NMS：向Agent发送Get请求报文。报文中各字段的设置如下：版本号为所使用的SNMP版本；团体名为public；PDU中PDU类型为Get类型，绑定变量填入MIB节点名sysContact。</li>
<li>Agent：首先对报文中携带版本号和团体名进行认证，认证成功后，Agent根据请求查询MIB中的sysContact节点，得到sysContact的值并将其封装到Response报文中的PDU，向NMS发送响应；如果查询不成功，Agent会向NMS发送出错响应。</li>
</ul>
</li>
<li><p>GetNext操作<br>假定NMS想要获取被管理设备MIB节点sysContact的下一个节点sysName值，使用可读团体名为public，过程如下所示：</p>
<ul>
<li>NMS：向Agent发送GetNext请求报文。报文中各字段的设置如下：版本号为所使用的SNMP版本；团体名为public；PDU中PDU类型为GetNext类型，绑定变量填入MIB节点名sysContact。</li>
<li>Agent：首先对报文中携带版本号和团体名进行认证，认证成功后，Agent根据请求查询MIB中的sysContact的下一个节点sysName，得到sysName的值并将其封装到Response报文中的PDU，向NMS发送响应；如果查询不成功，Agent会向NMS发送出错响应。</li>
</ul>
</li>
<li><p>Set操作<br>假定NMS想要设置被管理设备MIB节点sysName的值为HUAWEI，使用可写团体名为private，过程如下所示：</p>
<ul>
<li>NMS：向Agent发送Set请求报文。报文中各字段的设置如下：版本号为所使用的SNMP版本；团体名为private；PDU中PDU类型为Set类型，绑定变量填入MIB节点名sysContact和需要设置的值HUAWEI。</li>
<li>Agent：首先对报文中携带版本号和团体名进行认证，认证成功后，Agent根据请求设置管理变量在管理信息库MIB中对应的节点，设置成功后向NMS发送响应；如果设置不成功，Agent会向NMS发送出错响应。</li>
</ul>
</li>
<li><p>Trap操作<br>Trap不属于NMS对被管理设备的基本操作，它是被管理设备的自发行为。当被管理设备达到告警的触发条件时，会通过Agent向NMS发送Trap消息，告知设备侧出现的异常情况，便于网络管理人员及时处理。例如被管理设备热启动后，Agent会 向NMS发送warmStart的Trap。</p>
<blockquote>
<p>这种Trap信息是受限制的。只有在设备端的模块达到模块预定义的告警触发条件时，Agent才会向管理进程报告。这种方法有其好处是仅在严重事件发生时才发送Trap信息，减少报文交互产生的流量。</p>
</blockquote>
</li>
</ul>
<p>SNMPv2c新增的操作如下图所示：</p>
<img src="../../../../images/S2750,+S5700,+S6720+snmp+%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7/image-20200929001721005.png" alt="image-20200929001721005" style="zoom:50%;" />

<ul>
<li><p>GetBulk操作<br>基于GetNext实现，相当于连续执行多次GetNext操作。在NMS上可以设置被管理设备在一次GetBulk报文交互时，执行GetNext操作的次数。</p>
</li>
<li><p>Inform操作<br>Inform操作也是被管理设备向NMS主动发送告警。与trap告警不同的是，被管理设备发送Inform告警后，需要NMS进行接收确认。如果被管设备没有收到确认信息则：</p>
<ul>
<li><p>将告警暂时保存在Inform缓存中。</p>
</li>
<li><p>重复发送该告警，直到NMS确认收到该告警或者发送次数达到最大重传次数。</p>
</li>
<li><p>被管设备上会生成相应的告警日志。</p>
<blockquote>
<p>由此可知，使用Inform告警可能会占用较多的系统资源。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="SNMPv3"><a href="#SNMPv3" class="headerlink" title="SNMPv3"></a>SNMPv3</h3><p>SNMPv3定义了新的报文格式:</p>
<img src="../../../../images/S2750,+S5700,+S6720+snmp+%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7/image-20200929001845909.png" alt="image-20200929001845909" style="zoom:50%;" />

<p>SNMP报文中的主要字段定义如下：</p>
<ul>
<li><p>版本：表示SNMP的版本，SNMPv3报文则对应字段值为2。 </p>
</li>
<li><p>报头数据：主要包含消息发送者所能支持的最大消息尺寸、消息采用的安全模式等描述内容。</p>
</li>
<li><p>安全参数：包含SNMP实体引擎的相关信息、用户名、认证参数、加密参数等安全信息。</p>
</li>
<li><p>Context EngineID：SNMP唯一标识符，和PDU类型一起决定应该发往哪个应用程序。</p>
</li>
<li><p>Context Name：用于确定Context EngineID对被管理设备的MIB视图。</p>
</li>
<li><p>SNMPv3 PDU：包含PDU类型、请求标识符、变量绑定列表等信息。其中SNMPv3PDU包括GetRequest PDU、GetNextRequest PDU、SetRequest PDU、ResponsePDU、Trap PDU、GetBulkRequest PDU和InformRequest PDU。</p>
</li>
</ul>
<h4 id="SNMPv3的工作原理"><a href="#SNMPv3的工作原理" class="headerlink" title="SNMPv3的工作原理"></a>SNMPv3的工作原理</h4><p>SNMPv3的实现原理和SNMPv1/SNMPv2c基本一致，唯一的区别是SNMPv3增加了身份验证和加密处理。</p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>要在组网中配置SNMP协议，需要在管理端配置SNMP管理程序NMS，同时在被管理设备端配置SNMP代理程序Agent。</p>
<p>通过SNMP协议：</p>
<ul>
<li><p>网络管理系统NMS可以通过Agent在任何时候及时地获得设备的状态信息，实现远端控制被管理设备。</p>
</li>
<li><p>Agent可以及时地向NMS报告设备的当前状态信息。</p>
</li>
</ul>
<h2 id="SNMP-支持的特性功能介绍"><a href="#SNMP-支持的特性功能介绍" class="headerlink" title="SNMP 支持的特性功能介绍"></a>SNMP 支持的特性功能介绍</h2><table>
<thead>
<tr>
<th>特性</th>
<th><strong>功能描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>访问控制</td>
<td>访问控制主要用来限制管理设备的用户的权限。通过该功能可以限制指定的用户管理设备上的指定节点，从而提升精细化管理。</td>
</tr>
<tr>
<td>认证加密</td>
<td>认证加密主要是通过对网管和被管理设备传送的报文进行认证和加密，避免数据报文被窃取或篡改，从而提升数据传输的安全性。</td>
</tr>
<tr>
<td>错误码</td>
<td>错误码用来标识特定的故障现象，有助于管理员快速定位和解决故障，因此错误码越丰富越有利于管理员对设备进行管理。</td>
</tr>
<tr>
<td>Trap告警</td>
<td>Trap告警是被管理设备主动向网管发送告警。以便管理员能够及时发现设备的异常。<br />被管理设备发送Trap告警后，不需要网管进行接收确认。</td>
</tr>
<tr>
<td>Inform告警</td>
<td>Inform告警也是被管理设备向网管主动发送告警。<br />被管理设备发送Inform告警后，需要网管进行接收确认。</td>
</tr>
<tr>
<td>GetBulk</td>
<td>GetBulk主要方便管理员进行批量的Get-Next操作。网络规模较大时，以节省管理员的工作量，提升管理效率。</td>
</tr>
</tbody></table>
<blockquote>
<p>网管重启后可以接收到重启期间发送的Inform告警。</p>
</blockquote>
<h2 id="SNMP-各版本支持的特性概况"><a href="#SNMP-各版本支持的特性概况" class="headerlink" title="SNMP 各版本支持的特性概况"></a>SNMP 各版本支持的特性概况</h2><table>
<thead>
<tr>
<th>特性</th>
<th>SNMPv1</th>
<th>SNMPv2c</th>
<th>SNMPv3</th>
</tr>
</thead>
<tbody><tr>
<td>访问控制</td>
<td>基于团体名和MIBView进行访问控制</td>
<td>基于团体名和MIBView进行访问控制</td>
<td>基于用户、用户组和MIB view进行访问控制</td>
</tr>
<tr>
<td>认证加密</td>
<td>基于团体名的认证</td>
<td>基于团体名的认证</td>
<td>支持认证和加密，认证和加密的方式如下：<br />认证：<br />* MD5<br />* SHA<br />加密：<br />* DES56<br />* 3DES<br />* AES256<br />* AES192<br />* AES128</td>
</tr>
<tr>
<td>错误码</td>
<td>支持6个错误码</td>
<td>支持16个错误码</td>
<td>支持16个错误码</td>
</tr>
<tr>
<td>Trap告警</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>Inform告警</td>
<td>不支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>GetBulk</td>
<td>不支持</td>
<td>支持</td>
<td>支持</td>
</tr>
</tbody></table>
<h2 id="SNMP-各版本的应用场景"><a href="#SNMP-各版本的应用场景" class="headerlink" title="SNMP 各版本的应用场景"></a>SNMP 各版本的应用场景</h2><table>
<thead>
<tr>
<th>版本</th>
<th>应用场景</th>
</tr>
</thead>
<tbody><tr>
<td>SNMPv1</td>
<td>适用于小型网络，组网简单，对网络安全性要求不高或者网络环境本身比较安全，且比较稳定的网络，比如校园网，小型企业网。</td>
</tr>
<tr>
<td>SNMPv2c</td>
<td>适用于大中型网络，对网络安全性要求不高或者网络环境本身比较安全（比如VPN网络），但业务比较繁忙，有可能发生流量拥塞的网络。通过配置Inform告警可以确保被管理设备发送的告警能够被网管收到。</td>
</tr>
<tr>
<td>SNMPv3</td>
<td>适用于各种规模的网络，尤其是对网络的安全性要求较高，确保合法的管理员才能对网络设备进行管理的网络。比如网管和被管理设备间的通信数据需要在公网上进行传输。</td>
</tr>
</tbody></table>
<h2 id="配置SNMP"><a href="#配置SNMP" class="headerlink" title="配置SNMP"></a>配置SNMP</h2><h3 id="配置SNMPv1-SNMPv2c"><a href="#配置SNMPv1-SNMPv2c" class="headerlink" title="配置SNMPv1/SNMPv2c"></a>配置SNMPv1/SNMPv2c</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">system-view <span class="comment">#进入系统视图。</span></span><br><span class="line">(*)snmp-agent <span class="comment">#使能SNMP Agent服务。</span></span><br><span class="line">(*)snmp-agent udp-port port-num <span class="comment">#修改SNMP Agent与网管连接所使用的端口号。</span></span><br><span class="line"><span class="comment">#缺省情况下，SNMP Agent与网管连接所使用的端口号为161。</span></span><br><span class="line">snmp-agent sys-info version v1/v2c <span class="comment">#配置SNMP的协议版本为SNMPv1/SNMPv2c。</span></span><br><span class="line"><span class="comment">#缺省情况下，SNMP的协议版本为SNMPv3。</span></span><br><span class="line">snmp-agent community &#123; read | write &#125; &#123; community-name | cipher community-name &#125; [ alias alias-name ] <span class="comment">#配置设备的读写团体名。</span></span><br><span class="line"><span class="comment">#缺省情况下，系统中没有配置团体名。</span></span><br><span class="line">snmp-agent target-host trap address udp-domain ip-address [ udp-port port-number</span><br><span class="line">| source interface-type interface-number | [ public-net | vpn-instance vpn-instance-name ] ] * params securityname &#123; security-name | cipher security-name &#125; [ v1 |</span><br><span class="line">private-netmanager | notify-filter-profile profile-name | ext-vb ] *</span><br><span class="line"><span class="comment"># 目的UDP端口号缺省是162，如果有特殊需求（比如避免知名端口号被攻击），可以配置udp-port将UDP端口号更改为非知名端口号，保证网管和被管理设备的正常通信。</span></span><br><span class="line"><span class="comment"># securityname用来在网管上标识和区别发送告警的源设备，方便用户识别告警的发送方。</span></span><br><span class="line"><span class="comment"># 当网管和被管理设备是华为设备时，可以选择配置private-netmanager，使告警中携带更丰富的信息，比如告警的类型、发送告警的序号和告警发送的时间，以便能更加快速的定位和解决问题。</span></span><br><span class="line"><span class="comment"># 如果被管理设备发送的告警需要通过私网传递给网管时，选择参数vpn-instancevpn-instance-name，指定告警需要穿越的VPN实例。</span></span><br><span class="line">(*)snmp-agent sys-info &#123; contact contact | location location &#125; <span class="comment">#配置设备管理员的联系方式和位置。</span></span><br><span class="line">(*)snmp-agent packet max-size byte-count <span class="comment">#配置SNMP报文的最大尺寸。</span></span><br><span class="line"><span class="comment">#缺省情况下，SNMP报文最大尺寸为12000字节。</span></span><br><span class="line">(*)snmp-agent protocol source-interface interface-type interface-number <span class="comment">#配置设备接收和响应网管请求报文的源接口信息。缺省情况下，设备对网管请求报文的接收和响应源接口是随机的，任意可用的接口都可以接收和响应网管请求报文。</span></span><br><span class="line"><span class="comment"># 当前只支持将Loopback接口配置成网管请求报文的接收和响应源接口。</span></span><br><span class="line">(*)snmp-agent protocol server [ ipv4 | ipv6 ] disable <span class="comment">#关闭SNMP IPv4或IPv6的侦听端口。</span></span><br><span class="line"><span class="comment"># 缺省情况下，SNMP IPv4或IPv6的侦听端口处于关闭状态。</span></span><br></pre></td></tr></table></figure>

<h3 id="检查配置结果"><a href="#检查配置结果" class="headerlink" title="检查配置结果"></a><strong>检查配置结果</strong></h3><ul>
<li>执行<strong>display snmp-agent community</strong>命令，查看当前配置的团体名。</li>
<li>执行<strong>display snmp-agent sys-info version</strong>命令，查看SNMP使能的版本信息。</li>
<li>执行<strong>display acl</strong> <em>acl-number</em>命令，显示配置的访问控制列表的规则。</li>
<li>执行<strong>display snmp-agent mib-view</strong>命令，查看MIB视图信息。</li>
<li>执行<strong>display snmp-agent sys-info contact</strong>命令，查看管理员的联系方式。</li>
<li>执行<strong>display snmp-agent sys-info location</strong>命令，查看交换机的位置。</li>
<li>执行<strong>display current-configuration</strong> | <strong>include max-size</strong>命令，查看SNMP报文的最大尺寸。</li>
<li>执行<strong>display current-configuration</strong> | <strong>include trap</strong>命令，查看Trap配置信息。</li>
<li>执行<strong>display snmp-agent trap all</strong>命令，查看所有特性下所有Trap开关当前的状态和缺省状态。</li>
<li>执行<strong>display snmp-agent target-host</strong>命令，查看目标主机的信息。</li>
<li>执行<strong>display snmp-agent inform</strong> [ <strong>address udp-domain</strong> <em>ip-address</em> [ <strong>vpn-instance <em>*vpn-instance-name</em> ] **params securityname</strong> { <em>security-name</em> | <strong>cipher</strong> <em>security-name</em> } ]命令，查看全局或指定目标主机的Inform参数。</li>
<li>执行<strong>display snmp-agent extend error-code status</strong>命令，查看设备向网管发送扩展错误码的功能是否使能。</li>
<li>执行<strong>display snmp-agent notification-log</strong>命令，查看告警日志缓冲区中告警日志的内容。</li>
</ul>
<h3 id="配置SNMPv3"><a href="#配置SNMPv3" class="headerlink" title="配置SNMPv3"></a>配置SNMPv3</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">system-view <span class="comment">#进入系统视图。</span></span><br><span class="line">(*)snmp-agent <span class="comment">#使能SNMP Agent服务。</span></span><br><span class="line">(*)snmp-agent udp-port port-num <span class="comment">#修改SNMP Agent与网管连接所使用的端口号。</span></span><br><span class="line"><span class="comment">#缺省情况下，SNMP Agent与网管连接所使用的端口号为161。</span></span><br><span class="line">snmp-agent sys-info version v3 <span class="comment">#配置SNMP的协议版本为SNMP.</span></span><br><span class="line">(*)snmp-agent local-engineid engineid <span class="comment">#配置本地SNMP实体的引擎ID。</span></span><br><span class="line">snmp-agent group v3 group-name &#123; authentication | privacy | noauthentication &#125; <span class="comment">#配置SNMPv3用户组。</span></span><br><span class="line">snmp-agent [ remote-engineid engineid ] usm-user v3 user-name [ group group-name | acl acl-name ] * <span class="comment">#配置SNMPv3用户。</span></span><br><span class="line">snmp-agent [ remote-engineid engineid ] usm-user v3 user-name authentication-mode &#123; md5 | sha &#125; [ cipher password ] <span class="comment">#配置SNMPv3用户认证密码。</span></span><br><span class="line">snmp-agent [ remote-engineid engineid ] usm-user v3 user-name privacy-mode &#123; des56 | aes128 |aes192 | aes256 | <span class="number">3</span>des &#125; [ cipher password ] <span class="comment">#配置SNMPv3用户加密密码。</span></span><br><span class="line"><span class="comment">#配置设备发送Trap告警和错误码的目的IP地址，请执行命令：</span></span><br><span class="line">snmp-agent target-host trap address udp-domain ip-address [ udp-port portnumber | source interface-type interface-number | [ public-net | vpn-instance vpninstance-name ] ] * params securityname security-name v3 [ authentication |</span><br><span class="line">privacy ] [ private-netmanager | notify-filter-profile profile-name | ext-vb ] *</span><br><span class="line"><span class="comment">#配置设备发送Inform告警和错误码的目的IP地址，请执行命令：</span></span><br><span class="line">snmp-agent target-host inform address udp-domain ip-address [ udp-port portnumber | source interface-type interface-number | [ vpn-instance vpn-instancename | public-net ] ]* params securityname security-name v3 [ authentication |</span><br><span class="line">privacy ] [ notify-filter-profile profile-name | ext-vb ] *</span><br><span class="line">(*)snmp-agent sys-info &#123; contact contact | location location &#125; <span class="comment">#配置设备管理员的联系方式和位置。</span></span><br><span class="line">(*)snmp-agent packet max-size byte-count <span class="comment">#配置SNMP报文的最大尺寸。</span></span><br><span class="line"><span class="comment">#缺省情况下，SNMP报文最大尺寸为12000字节。</span></span><br><span class="line">(*)snmp-agent protocol source-interface interface-type interface-number <span class="comment">#配置设备接收和响应网管请求报文的源接口信息。缺省情况下，设备对网管请求报文的接收和响应源接口是随机的，任意可用的接口都可以接收和响应网管请求报文。</span></span><br><span class="line"><span class="comment"># 当前只支持将Loopback接口配置成网管请求报文的接收和响应源接口。</span></span><br><span class="line">(*)snmp-agent protocol server [ ipv4 | ipv6 ] disable <span class="comment">#关闭SNMP IPv4或IPv6的侦听端口。</span></span><br><span class="line"><span class="comment"># 缺省情况下，SNMP IPv4或IPv6的侦听端口处于关闭状态。</span></span><br></pre></td></tr></table></figure>

<h3 id="查看配置结果"><a href="#查看配置结果" class="headerlink" title="查看配置结果"></a>查看配置结果</h3><ul>
<li>执行<strong>display snmp-agent usm-user</strong> [ <strong>engineid</strong> <em>engineid</em> | <strong>group</strong> <em>group-name</em> |<strong>username</strong> <em>user-name</em> ] *命令，查看用户信息。</li>
<li>执行<strong>display snmp-agent sys-info version</strong>命令，查看SNMP使能的版本信息。</li>
<li>执行<strong>display acl</strong> <em>acl-number</em>命令，显示配置的访问控制列表的规则。</li>
<li>执行<strong>display snmp-agent mib-view</strong>命令，查看MIB视图信息。</li>
<li>执行<strong>display snmp-agent sys-info contact</strong>命令，查看管理员的联系方式。</li>
<li>执行<strong>display snmp-agent sys-info location</strong>命令，查看交换机的位置。</li>
<li>执行<strong>display current-configuration</strong> | <strong>include max-size</strong>命令，查看SNMP报文的最大尺寸。</li>
<li>执行<strong>display current-configuration</strong> | <strong>include trap</strong>命令，查看Trap配置信息。</li>
<li>执行<strong>display snmp-agent trap all</strong>命令，查看所有特性下所有Trap开关当前的状态和缺省状态。</li>
<li>执行<strong>display snmp-agent target-host</strong>命令，查看目标主机的信息。</li>
<li>执行<strong>display snmp-agent inform</strong> [ <strong>address udp-domain</strong> <em>ip-address</em> [ <strong>vpn-instance <em>*vpn-instance-name</em> ] **params securityname</strong> { <em>security-name</em> | <strong>cipher</strong> <em>security-name</em> } ]命令，查看全局或指定目标主机的Inform参数。</li>
<li>执行<strong>display snmp-agent extend error-code status</strong>命令，查看设备向网管发送扩展错误码的功能是否使能。</li>
</ul>
<h2 id="实验配置举例"><a href="#实验配置举例" class="headerlink" title="实验配置举例"></a>实验配置举例</h2><h3 id="配置设备使用-SNMPv1-与网管通信示例"><a href="#配置设备使用-SNMPv1-与网管通信示例" class="headerlink" title="配置设备使用 SNMPv1 与网管通信示例"></a><strong>配置设备使用</strong> <strong>SNMPv1</strong> 与网管通信示例</h3><p>现在由于扩容需要，新增一台Switch，并由网管NMS2对其进行监管。用户希望通过利用现有的网络资源对Switch进行监管，并且对发生故障能够快速对故障定位和排除。根据用户业务需要，网管站需要对Switch的除RMON的之外的节点管理。</p>
<img src="../../../../images/S2750,+S5700,+S6720+snmp+%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7/image-20200929010225287.png" alt="image-20200929010225287" style="zoom:50%;" />

<ul>
<li><p>配置Switch的接口IP地址，使其和网管站之间路由可达</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname Switch</span><br><span class="line">[Switch] vlan <span class="number">100</span></span><br><span class="line">[Switch-vlan100] quit</span><br><span class="line">[Switch] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port link-type hybrid</span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port hybrid pvid vlan <span class="number">100</span></span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port hybrid untagged vlan <span class="number">100</span></span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] quit</span><br><span class="line">[Switch] interface vlanif <span class="number">100</span></span><br><span class="line">[Switch-Vlanif100] ip address <span class="number">10.1</span><span class="number">.2</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line">[Switch-Vlanif100] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置Switch的SNMP版本为SNMPv1</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent sys-info version v1</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置访问权限</p>
<ul>
<li><p>配置ACL，使NMS2可以管理Switch，NMS1不允许管理Switch。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] acl <span class="number">2001</span></span><br><span class="line">[Switch-acl-basic<span class="number">-2001</span>] rule <span class="number">5</span> permit source <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">[Switch-acl-basic<span class="number">-2001</span>] rule <span class="number">6</span> deny source <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">[Switch-acl-basic<span class="number">-2001</span>] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置MIB视图，限制NMS2可以管理Switch上除RMON之外的节点。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent mib-view excluded allextrmon <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.16</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置团体名并引用ACL和MIB视图。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent community write adminnms2 mib-view allextrmon acl <span class="number">2001</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>配置告警主机</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent target-host trap address udp-domain <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span> params securityname adminnms2</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置网管站（NMS2）:网管系统的认证参数配置必须和设备上保持一致，否则网管系统无法管理设备。</p>
</li>
<li><p>验证配置结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] display snmp-agent sys-info version</span><br><span class="line"> SNMP version running <span class="keyword">in</span> the system: </span><br><span class="line"> SNMPv1 SNMPv3</span><br><span class="line">[Switch] display acl <span class="number">2001</span></span><br><span class="line">Basic ACL <span class="number">2001</span>, <span class="number">2</span> rules </span><br><span class="line">Acl<span class="string">'s step is 5 </span></span><br><span class="line"><span class="string"> rule 5 permit source 10.1.1.2 0 (match-counter 0) </span></span><br><span class="line"><span class="string"> rule 6 deny source 10.1.1.1 0 (match-counter 0)</span></span><br><span class="line"><span class="string">[Switch] display snmp-agent target-host</span></span><br><span class="line"><span class="string">Target-host NO. 1 </span></span><br><span class="line"><span class="string">----------------------------------------------------------- </span></span><br><span class="line"><span class="string"> IP-address : 10.1.1.2 </span></span><br><span class="line"><span class="string"> Source interface : - </span></span><br><span class="line"><span class="string"> VPN instance : - </span></span><br><span class="line"><span class="string"> Security name : %^%#uq/!YZfvW4*vf[~C|.:Cl&#125;UqS(vXd#wwqR~5M(rU%%^</span></span><br><span class="line"><span class="string">%# </span></span><br><span class="line"><span class="string"> Port : 162 </span></span><br><span class="line"><span class="string"> Type : trap </span></span><br><span class="line"><span class="string"> Version : v1 </span></span><br><span class="line"><span class="string"> Level : No authentication and privacy </span></span><br><span class="line"><span class="string"> NMS type : NMS </span></span><br><span class="line"><span class="string"> With ext-vb : No </span></span><br><span class="line"><span class="string">-----------------------------------------------------------</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="配置设备使用-SNMPv2-与网管通信示例"><a href="#配置设备使用-SNMPv2-与网管通信示例" class="headerlink" title="配置设备使用 SNMPv2 与网管通信示例"></a><strong>配置设备使用</strong> SNMPv2 与网管通信示例</h3><blockquote>
<p>需求与拓扑与v1一致</p>
</blockquote>
<ul>
<li><p>配置交换机的接口IP地址，使其和网管站之间路由可达</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname Switch</span><br><span class="line">[Switch] vlan <span class="number">100</span></span><br><span class="line">[Switch-vlan100] quit</span><br><span class="line">[Switch] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port link-type hybrid</span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port hybrid pvid vlan <span class="number">100</span></span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port hybrid untagged vlan <span class="number">100</span></span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] quit</span><br><span class="line">[Switch] interface vlanif <span class="number">100</span></span><br><span class="line">[Switch-Vlanif100] ip address <span class="number">10.1</span><span class="number">.2</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line">[Switch-Vlanif100] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置交换机的SNMP版本为SNMPv2c</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent sys-info version v2c</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置访问权限</p>
<ul>
<li><p>配置ACL，使NMS2可以管理Switch，NMS1不允许管理Switch。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] acl <span class="number">2001</span></span><br><span class="line">[Switch-acl-basic<span class="number">-2001</span>] rule <span class="number">5</span> permit source <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">[Switch-acl-basic<span class="number">-2001</span>] rule <span class="number">6</span> deny source <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">[Switch-acl-basic<span class="number">-2001</span>] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置MIB视图，限制NMS2可以管理Switch上除RMON之外的节点。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent mib-view excluded allextrmon <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.16</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置团体名并引用ACL和MIB视图。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent community write adminnms2 mib-view allextrmon acl <span class="number">2001</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>配置告警主机</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent target-host inform address udp-domain <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span> params securityname adminnms2 v2c</span><br><span class="line">[Switch] snmp-agent inform timeout <span class="number">5</span> resend-times <span class="number">6</span> pending <span class="number">7</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置网管站（NMS2）:网管系统的认证参数配置必须和设备上保持一致，否则网管系统无法管理设备。</p>
</li>
<li><p>验证配置结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] display snmp-agent sys-info version</span><br><span class="line"> SNMP version running <span class="keyword">in</span> the system: </span><br><span class="line"> SNMPv2c SNMPv3</span><br><span class="line">[Switch] display acl <span class="number">2001</span></span><br><span class="line">Basic ACL <span class="number">2001</span>, <span class="number">2</span> rules </span><br><span class="line">Acl<span class="string">'s step is 5 </span></span><br><span class="line"><span class="string"> rule 5 permit source 10.1.1.2 0 (match-counter 0) </span></span><br><span class="line"><span class="string"> rule 6 deny source 10.1.1.1 0 (match-counter 0)</span></span><br><span class="line"><span class="string">[Switch] display snmp-agent target-host</span></span><br><span class="line"><span class="string">Target-host NO. 1</span></span><br><span class="line"><span class="string">-----------------------------------------------------------</span></span><br><span class="line"><span class="string"> IP-address : 10.1.1.2</span></span><br><span class="line"><span class="string"> Source interface : - </span></span><br><span class="line"><span class="string"> VPN instance : - </span></span><br><span class="line"><span class="string"> Security name : %^%#uq/!YZfvW4*vf[~C|.:Cl&#125;UqS(vXd#wwqR~5M(rU%%^%#</span></span><br><span class="line"><span class="string"> Port : 162</span></span><br><span class="line"><span class="string"> Type : inform</span></span><br><span class="line"><span class="string"> Version : v2c</span></span><br><span class="line"><span class="string"> Level : No authentication and privacy</span></span><br><span class="line"><span class="string"> NMS type : NMS</span></span><br><span class="line"><span class="string"> With ext-vb : No</span></span><br><span class="line"><span class="string">-----------------------------------------------------------</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="配置设备使用-SNMPv3-与网管通信示例"><a href="#配置设备使用-SNMPv3-与网管通信示例" class="headerlink" title="配置设备使用 SNMPv3 与网管通信示例"></a><strong>配置设备使用</strong> SNMPv3 与网管通信示例</h3><blockquote>
<p>需求与拓扑与v1一致</p>
</blockquote>
<ul>
<li><p>配置交换机的接口IP地址，使其和网管站之间路由可达</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname Switch</span><br><span class="line">[Switch] vlan <span class="number">100</span></span><br><span class="line">[Switch-vlan100] quit</span><br><span class="line">[Switch] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port link-type hybrid</span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port hybrid pvid vlan <span class="number">100</span></span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port hybrid untagged vlan <span class="number">100</span></span><br><span class="line">[Switch-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] quit</span><br><span class="line">[Switch] interface vlanif <span class="number">100</span></span><br><span class="line">[Switch-Vlanif100] ip address <span class="number">10.1</span><span class="number">.2</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line">[Switch-Vlanif100] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置交换机的SNMP版本为SNMPv3</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent sys-info version v3</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置访问权限</p>
<ul>
<li><p>配置ACL，使NMS2可以管理Switch，NMS1不允许管理Switch。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] acl <span class="number">2001</span></span><br><span class="line">[Switch-acl-basic<span class="number">-2001</span>] rule <span class="number">5</span> permit source <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">[Switch-acl-basic<span class="number">-2001</span>] rule <span class="number">6</span> deny source <span class="number">10.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">[Switch-acl-basic<span class="number">-2001</span>] quit</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置MIB视图，限制NMS2可以管理Switch上除RMON之外的节点。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent mib-view included isoview iso</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置用户组</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent group v3 admin privacy write-view isoview acl <span class="number">2001</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置用户</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent usm-user v3 nms2-admin group admin</span><br></pre></td></tr></table></figure>
</li>
<li><p>对用户的数据进行认证，认证密码为Authe@1234</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent usm-user v3 nms2-admin authentication-mode sha</span><br><span class="line">Please configure the authentication password (<span class="number">8</span><span class="number">-64</span>) </span><br><span class="line">Enter Password: //输入认证密码，本例的认证密码为：Authe@<span class="number">1234</span>。</span><br><span class="line">Confirm Password: //输入认证密码，本例的认证密码为：Authe@<span class="number">1234</span>。</span><br></pre></td></tr></table></figure>
</li>
<li><p>对用户的数据进行加密，加密密码为Priva@1234.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent usm-user v3 nms2-admin privacy-mode aes128</span><br><span class="line">Please configure the privacy password (<span class="number">8</span><span class="number">-64</span>) </span><br><span class="line">Enter Password: //输入加密密码，本例的加密密码为：Priva@<span class="number">1234</span>。 </span><br><span class="line">Confirm Password: //输入加密密码，本例的加密密码为：Priva@<span class="number">1234</span>。</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>配置告警主机</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent target-host trap address udp-domain <span class="number">10.1</span><span class="number">.1</span><span class="number">.2</span> params securityname nms2-admin v3 privacy</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置设备管理员联系方式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[Switch] snmp-agent sys-info contact call Operator at <span class="number">010</span><span class="number">-12345678</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置网管站:网管系统的认证参数配置必须和设备上保持一致，否则网管系统无法管理设备。</p>
</li>
<li><p>验证配置结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看SNMP版本。</span></span><br><span class="line">[Switch] display snmp-agent sys-info version</span><br><span class="line"> SNMP version running <span class="keyword">in</span> the system: </span><br><span class="line"> SNMPv3</span><br><span class="line"><span class="comment"># 查看用户组信息。</span></span><br><span class="line">[Switch] display snmp-agent group admin</span><br><span class="line"> Group name: admin</span><br><span class="line"> Security model: v3 AuthPriv</span><br><span class="line"> Readview: ViewDefault</span><br><span class="line"> Writeview: isoview</span><br><span class="line"> Notifyview :&lt;no specified&gt;</span><br><span class="line"> Storage-type: nonVolatile</span><br><span class="line"> Acl:<span class="number">2001</span></span><br><span class="line"><span class="comment"># 查看ACL配置。</span></span><br><span class="line">[Switch] display acl <span class="number">2001</span></span><br><span class="line">Basic ACL <span class="number">2001</span>, <span class="number">2</span> rules </span><br><span class="line">Acl<span class="string">'s step is 5 </span></span><br><span class="line"><span class="string"> rule 5 permit source 10.1.1.2 0 (match-counter 0) </span></span><br><span class="line"><span class="string"> rule 6 deny source 10.1.1.1 0 (match-counter 0)</span></span><br><span class="line"><span class="string"># 查看MIB视图。</span></span><br><span class="line"><span class="string">[Switch] display snmp-agent mib-view viewname isoview</span></span><br><span class="line"><span class="string"> View name:isoview </span></span><br><span class="line"><span class="string"> MIB Subtree:iso </span></span><br><span class="line"><span class="string"> Subtree mask:FC(Hex)</span></span><br><span class="line"><span class="string"> Storage-type: nonVolatile </span></span><br><span class="line"><span class="string"> View Type:included </span></span><br><span class="line"><span class="string"> View status:active</span></span><br><span class="line"><span class="string"># 查看告警的目标主机。</span></span><br><span class="line"><span class="string">[Switch] display snmp-agent target-host</span></span><br><span class="line"><span class="string">Target-host NO. 1</span></span><br><span class="line"><span class="string">-----------------------------------------------------------</span></span><br><span class="line"><span class="string"> IP-address : 10.1.1.2</span></span><br><span class="line"><span class="string"> Source interface : - </span></span><br><span class="line"><span class="string"> VPN instance : -</span></span><br><span class="line"><span class="string"> Security name : nms2-admin</span></span><br><span class="line"><span class="string"> Port : 162</span></span><br><span class="line"><span class="string"> Type : trap</span></span><br><span class="line"><span class="string"> Version : v3</span></span><br><span class="line"><span class="string"> Level : Privacy</span></span><br><span class="line"><span class="string"> NMS type : NMS</span></span><br><span class="line"><span class="string"> With ext-vb : No</span></span><br><span class="line"><span class="string">-----------------------------------------------------------</span></span><br><span class="line"><span class="string"># 配置设备管理员联系方式。</span></span><br><span class="line"><span class="string">[Switch] display snmp-agent sys-info contact</span></span><br><span class="line"><span class="string"> The contact person for this managed node: </span></span><br><span class="line"><span class="string"> call Operator at 010-12345678</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="常见配置错误"><a href="#常见配置错误" class="headerlink" title="常见配置错误"></a>常见配置错误</h2><h3 id="SNMP-主机无法与网管连接"><a href="#SNMP-主机无法与网管连接" class="headerlink" title="SNMP 主机无法与网管连接"></a><strong>SNMP</strong> 主机无法与网管连接</h3><p>执行<strong>display logbuffer</strong>命令查看主机上是否有SNMP用户登录失败的日志。</p>
<table>
<thead>
<tr>
<th>日志</th>
<th>日志解释</th>
<th>处理建议</th>
</tr>
</thead>
<tbody><tr>
<td>Failed to loginthrough SNMP.(Ip=10.1.1.1,Times=2, Reason=the version was incorrect,VPN= )</td>
<td>SNMP主机和网管使用的SNMP协议版本不一致</td>
<td>执行命令<strong>display snmp-agent sys-info**</strong>version**查看主机是否支持网管发送登录请求所使用的SNMP协议版本。</td>
</tr>
<tr>
<td>Failed to login through SNMP.(Ip=10.135.180.98,Times=2, Reason=the packet was too large,VPN= )</td>
<td>网管发送的报文太大，超过设备设置的阈值。</td>
<td>执行命令<strong>snmp-agent packet max-size</strong>增大报文阈值。</td>
</tr>
<tr>
<td>Failed to login through SNMP. (Ip=10.1.1.1, Times=2, Reason=the messages was failed to be added to the message list, VPN= )</td>
<td>网管侧发送的请求报文速率超过了设备的处理能力。</td>
<td>降低网管侧请求报文的发送速率。</td>
</tr>
<tr>
<td>Failed to login through SNMP. (Ip=10.1.1.1, Times=2, Reason=the community was incorrect, VPN= )</td>
<td>网管侧和设备侧配置的团体名不一致。</td>
<td>执行命令<strong>display snmp-agent community</strong>查看主机配置的团体字。</td>
</tr>
<tr>
<td>Failed to login through SNMP.(Ip=10.1.1.1, Times=2, Reason=decoded PDU error, VPN= )</td>
<td>解码错误，可能原因有：<br />设备配置的SNMPv3用户名与网管侧配置的不一致。<br />设备的SNMP引擎ID和网管侧获得的引擎ID不一致。<br />网管侧使用的SNMPv3用户名的认证密码或者加密密码错误。</td>
<td>执行命令<strong>display snmp-agent usm</strong>  user，查看SNMPv3用户信息。<br />执行命令<strong>display current configuration include snmp</strong>，查看设备的SNMP引擎ID。获取SNMP报文的报文头，查看报文中的设备SNMP引擎ID是否和设备显示一致<br />请使用正确的SNMPv3用户名的认证密码或者加密密码。</td>
</tr>
<tr>
<td>Failed to login through SNMP.(Ip=10.1.1.1, Times=2,Reason=the ACL filter function,VPN= )</td>
<td>该IP地址被ACL禁止。</td>
<td>执行<strong>display acl</strong> {<em>acl-number</em> <em>name</em>  | <strong>all</strong> }命令查看主机ACL配置。</td>
</tr>
<tr>
<td>Failed to login through SNMP.(Ip=10.1.1.1, Times=2,Reason=the contextname was incorrect, VPN= )</td>
<td>网管侧的contextname设置错误。</td>
<td>将网管侧的contextname修改为空或短横线。</td>
</tr>
</tbody></table>
<h3 id="网管无法收到-Trap-告警消息"><a href="#网管无法收到-Trap-告警消息" class="headerlink" title="网管无法收到 Trap 告警消息"></a><strong>网管无法收到</strong> <strong>Trap</strong> <strong>告警消息</strong></h3><h4 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h4><p>设备配置了使用SNMPv3与网管通信，但是配置接收Trap消息的目的地时未指定Trap消息发送版本，设备发送Trap消息缺省情况下是SNMPv1版本。因此设备配置的SNMP版本与设备配置的Trap消息发送版本不一致导致SNMP模块不发送Trap报文，而信息中心Trap缓冲区是只要有Trap消息就会生成相应的记录。</p>
<h4 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>检查当前系统中运行的SNMP版本。</li>
<li>检查Trap消息发送版本。</li>
</ol>
]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Huawei</tag>
        <tag>Snmp</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei Wlan配置802.1X认证示例</title>
    <url>/2020/11/10/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B.html</url>
    <content><![CDATA[<h2 id="业务需求"><a href="#业务需求" class="headerlink" title="业务需求"></a>业务需求</h2><p>用户接入WLAN网络，使用802.1X客户端进行认证，输入正确的用户名和密码后可以无线上网。且在覆盖区域内移动发生漫游时，不影响用户的业务使用。</p>
<h2 id="组网需求"><a href="#组网需求" class="headerlink" title="组网需求"></a>组网需求</h2><ul>
<li><p>AC组网方式：旁挂二层组网。</p>
</li>
<li><p>DHCP部署方式：AC作为DHCP服务器为AP分配IP地址，SwitchB作为DHCP服务器为STA分配IP地址。</p>
</li>
<li><p>业务数据转发方式：直接转发。</p>
</li>
<li><p>WLAN认证方式：WPA-WPA2+802.1X+AES。</p>
<p>配置802.1X认证组网图<br><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054308.png" alt="img"></p>
</li>
</ul>
<h2 id="数据规划"><a href="#数据规划" class="headerlink" title="数据规划"></a>数据规划</h2><p> AC数据规划表</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>数据</th>
</tr>
</thead>
<tbody><tr>
<td>管理VLAN</td>
<td>VLAN100</td>
</tr>
<tr>
<td>业务VLAN</td>
<td>VLAN101</td>
</tr>
<tr>
<td>AC的源接口</td>
<td>VLANIF100：10.23.100.1/24</td>
</tr>
<tr>
<td>DHCP服务器</td>
<td>AC作为DHCP服务器为AP分配IP地址，SwitchB作为DHCP服务器为STA分配IP地址</td>
</tr>
<tr>
<td>AP的IP地址池</td>
<td>10.23.100.2～10.23.100.254/24</td>
</tr>
<tr>
<td>STA的IP地址池</td>
<td>10.23.101.2～10.23.101.254/24</td>
</tr>
<tr>
<td>RADIUS认证参数</td>
<td>RADIUS服务器模板名称：wlan-netIP地址：10.23.103.1认证端口号：1812共享密钥：huawei@123认证方案：wlan-net</td>
</tr>
<tr>
<td>802.1X接入模板</td>
<td>名称：wlan-net认证方式：EAP</td>
</tr>
<tr>
<td>认证模板</td>
<td>名称：wlan-net引用模板和认证方案：802.1X接入模板wlan-net、RADIUS服务器模板wlan-net、认证方案wlan-net</td>
</tr>
<tr>
<td>AP组</td>
<td>名称：ap-group1引用模板：VAP模板wlan-net、域管理模板default</td>
</tr>
<tr>
<td>域管理模板</td>
<td>名称：default国家码：中国</td>
</tr>
<tr>
<td>SSID模板</td>
<td>名称：wlan-netSSID名称：wlan-net</td>
</tr>
<tr>
<td>安全模板</td>
<td>名称：wlan-net安全策略：WPA-WPA2+802.1X+AES</td>
</tr>
<tr>
<td>VAP模板</td>
<td>名称：wlan-net转发模式：直接转发业务VLAN：VLAN101引用模板：SSID模板wlan-net、安全模板wlan-net、认证模板wlan-net</td>
</tr>
</tbody></table>
<h2 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h2><ol>
<li>配置AP、AC和周边网络设备之间实现网络互通。</li>
<li>使用配置向导，配置AC系统参数。</li>
<li>使用配置向导，配置AP在AC上线。</li>
<li>使用配置向导在AC上配置WLAN相关业务。在配置安全策略时，选择802.1X和RADIUS认证，设置RADIUS服务器参数。</li>
<li>配置第三方服务器。</li>
</ol>
<blockquote>
<p>AC侧配置的RADIUS共享密钥需要和服务器侧保持一致。</p>
</blockquote>
<h2 id="配置注意事项"><a href="#配置注意事项" class="headerlink" title="配置注意事项"></a>配置注意事项</h2><ul>
<li><p>纯组播报文由于协议要求在无线空口没有ACK机制保障，且无线空口链路不稳定，为了纯组播报文能够稳定发送，通常会以低速报文形式发送。如果网络侧有大量异常组播流量涌入，则会造成无线空口拥堵。为了减小大量低速组播报文对无线网络造成的冲击，建议配置组播报文抑制功能。配置前请确认是否有组播业务，如果有，请谨慎配置限速值。</p>
<ul>
<li>业务数据转发方式采用直接转发时，建议在直连AP的交换机接口上配置组播报文抑制。</li>
<li>业务数据转发方式采用隧道转发时，建议在AC的流量模板下配置组播报文抑制。</li>
</ul>
<p>配置方法请参见：<a href="http://support.huawei.com/hedex/hdx.do?docid=EDOC1100025388&id=ZH-CN_TOPIC_0117428937&text=null&lang=zh" target="_blank" rel="noopener">如何配置组播报文抑制，减小大量低速组播报文对无线网络造成的冲击？</a></p>
</li>
<li><p>建议在与AP直连的设备接口上配置端口隔离，如果不配置端口隔离，尤其是业务数据转发方式采用直接转发时，可能会在VLAN内形成大量不必要的广播报文，导致网络阻塞，影响用户体验。</p>
</li>
<li><p>隧道转发模式下，管理VLAN和业务VLAN不能配置为同一VLAN，且AP和AC之间只能放通管理VLAN，不能放通业务VLAN。</p>
</li>
</ul>
<h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><h3 id="配置周边设备"><a href="#配置周边设备" class="headerlink" title="配置周边设备"></a>配置周边设备</h3><ul>
<li>配置接入交换机SwitchA的接口GE0/0/1和GE0/0/2加入VLAN100和VLAN101。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch <span class="number">100</span> <span class="number">101</span></span><br><span class="line">[SwitchA] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port trunk pvid vlan <span class="number">100</span></span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">100</span> <span class="number">101</span></span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port-isolate enable</span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] quit</span><br><span class="line">[SwitchA] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">100</span> <span class="number">101</span></span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] quit</span><br></pre></td></tr></table></figure>

<ul>
<li>配置汇聚交换机SwitchB的接口GE0/0/1加入VLAN100和VLAN101，GE0/0/2加入VLAN100和VLAN102，GE0/0/3加入VLAN103，GE0/0/4加入VLAN104，创建VLANIF102、VLANIF103和VLANIF104接口，并配置下一跳为Router的缺省路由。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchB</span><br><span class="line">[SwitchB] vlan batch <span class="number">100</span> to <span class="number">104</span></span><br><span class="line">[SwitchB] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port link-type trunk</span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">100</span> <span class="number">101</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] quit</span><br><span class="line">[SwitchB] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] port link-type trunk</span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">100</span> <span class="number">102</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] quit</span><br><span class="line">[SwitchB] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">3</span>] port link-type trunk</span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">3</span>] port trunk pvid vlan <span class="number">103</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">3</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">103</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">3</span>] quit</span><br><span class="line">[SwitchB] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">4</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">4</span>] port link-type trunk</span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">4</span>] port trunk pvid vlan <span class="number">104</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">4</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">104</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">4</span>] quit</span><br><span class="line">[SwitchB] interface vlanif <span class="number">102</span></span><br><span class="line">[SwitchB-Vlanif102] ip address <span class="number">10.23</span><span class="number">.102</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line">[SwitchB-Vlanif102] quit</span><br><span class="line">[SwitchB] interface vlanif <span class="number">103</span></span><br><span class="line">[SwitchB-Vlanif103] ip address <span class="number">10.23</span><span class="number">.103</span><span class="number">.2</span> <span class="number">24</span></span><br><span class="line">[SwitchB-Vlanif103] quit</span><br><span class="line">[SwitchB] interface vlanif <span class="number">104</span></span><br><span class="line">[SwitchB-Vlanif104] ip address <span class="number">10.23</span><span class="number">.104</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line">[SwitchB-Vlanif104] quit</span><br><span class="line">[SwitchB] ip route-static <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">10.23</span><span class="number">.104</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>

<ul>
<li>配置Router的接口GE0/0/1的IP地址，并配置指向STA网段的静态路由。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;Huawei&gt; system-view</span><br><span class="line">[Huawei] sysname Router</span><br><span class="line">[Router] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[Router-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] ip address <span class="number">10.23</span><span class="number">.104</span><span class="number">.2</span> <span class="number">24</span></span><br><span class="line">[Router-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] quit</span><br><span class="line">[Router] ip route-static <span class="number">10.23</span><span class="number">.101</span><span class="number">.0</span> <span class="number">24</span> <span class="number">10.23</span><span class="number">.104</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h3 id="配置DHCP服务器为STA分配IP地址"><a href="#配置DHCP服务器为STA分配IP地址" class="headerlink" title="配置DHCP服务器为STA分配IP地址"></a>配置DHCP服务器为STA分配IP地址</h3><ul>
<li>在SwitchB上配置VLANIF101接口为STA提供IP地址。</li>
</ul>
<blockquote>
<p>DNS服务器地址请根据实际需要配置。常用配置方法如下：</p>
<ul>
<li>接口地址池场景，需要在VLANIF接口视图下执行命令<code>dhcp server dns-list</code> <em>ip-address</em> &amp;&lt;1-8&gt;。</li>
<li>全局地址池场景，需要在IP地址池视图下执行命令<code>dns-list</code> <em>ip-address</em> &amp;&lt;1-8&gt;。</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[SwitchB] dhcp enable</span><br><span class="line">[SwitchB] interface vlanif <span class="number">101</span></span><br><span class="line">[SwitchB-Vlanif101] ip address <span class="number">10.23</span><span class="number">.101</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line">[SwitchB-Vlanif101] dhcp select interface</span><br><span class="line">[SwitchB-Vlanif101] quit</span><br></pre></td></tr></table></figure>

<h3 id="配置AC系统参数"><a href="#配置AC系统参数" class="headerlink" title="配置AC系统参数"></a>配置AC系统参数</h3><h4 id="配置AC基本参数。"><a href="#配置AC基本参数。" class="headerlink" title="配置AC基本参数。"></a>配置AC基本参数。</h4><ul>
<li><p>单击“配置 &gt; 配置向导 &gt; AC”，进入“AC基本配置”页面。</p>
</li>
<li><p>“所在国家/地区”按实际情况选择，以“中国”为例。“系统时间”配置为“手动设置”。“日期和时间”配置为“使用PC当前时间”。</p>
</li>
</ul>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054347.png" alt="点击放大"></p>
<ul>
<li>单击页面下方的“下一步”，进入“端口配置”页面。</li>
</ul>
<h4 id="配置端口。"><a href="#配置端口。" class="headerlink" title="配置端口。"></a>配置端口。</h4><ul>
<li>选择接口“GigabitEthernet0/0/1”，展开“批量修改”，选择“接口类型”为“Trunk”，将“GigabitEthernet0/0/1”加入VLAN100（管理VLAN）和VLAN102。</li>
</ul>
<blockquote>
<p>如果AC直接连接AP，需要在AC直连AP的接口上配置缺省VLAN为管理VLAN100。</p>
</blockquote>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054414.png" alt="点击放大"></p>
<ul>
<li><p>单击“应用”，在弹出的提示对话框中单击“确定”，完成配置。</p>
</li>
<li><p>单击“下一步”，进入“网络互联配置”页面。</p>
</li>
</ul>
<h4 id="配置网络互联。"><a href="#配置网络互联。" class="headerlink" title="配置网络互联。"></a>配置网络互联。</h4><ul>
<li><p>配置“DHCP状态”为“ON”。</p>
</li>
<li><p>单击“接口配置”下的“新建”，进入“新建接口配置”页面。</p>
</li>
<li><p>配置接口VLANIF100的IP地址为10.23.100.1/24。</p>
</li>
</ul>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054374.png" alt="img"></p>
<ul>
<li>单击“DHCPv4地址池列表”下的“新建”，采用“接口地址池”，选择接口VLANIF100。</li>
</ul>
<blockquote>
<p>DNS服务器地址请根据实际需要配置。</p>
</blockquote>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054399.png" alt="点击放大"></p>
<ul>
<li><p>单击“确定”，完成VLANIF100接口地址池的配置。</p>
</li>
<li><p>以同样的方式配置虚拟接口VLANIF102的IP地址为10.23.102.2/24。</p>
</li>
<li><p>单击“静态路由表”下的“新建”，进入“新建静态路由表”页面。</p>
</li>
<li><p>配置“目的IP地址”为“10.23.103.0”，“子网掩码”为“24(255.255.255.0)”，“下一跳”为“10.23.102.1”。</p>
</li>
</ul>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054476.png" alt="img"></p>
<ul>
<li><p>单击“确定”，完成静态路由表的配置。</p>
</li>
<li><p>单击“下一步”。</p>
</li>
<li><p>单击“下一步”，进入“AC源地址”页面。</p>
</li>
</ul>
<h3 id="配置AC源地址。"><a href="#配置AC源地址。" class="headerlink" title="配置AC源地址。"></a>配置AC源地址。</h3><ul>
<li><p>“AC源地址”选择“VLANIF”，单击选择按钮，选择“Vlanif100”。<br><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054505.png" alt="点击放大"></p>
</li>
<li><p>单击“下一步”，进入“配置确认”页面。</p>
</li>
</ul>
<h3 id="配置确认。"><a href="#配置确认。" class="headerlink" title="配置确认。"></a>配置确认。</h3><ul>
<li>确认配置，单击“完成并继续AP上线配置”。</li>
</ul>
<h3 id="配置AP上线"><a href="#配置AP上线" class="headerlink" title="配置AP上线"></a>配置AP上线</h3><h4 id="配置AP上线。"><a href="#配置AP上线。" class="headerlink" title="配置AP上线。"></a>配置AP上线。</h4><ul>
<li>单击“批量导入”，进入“批量导入”页面。单击<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054465.png" alt="img">，下载批量添加AP模板文件到本地。</li>
</ul>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054480.png" alt="img"></p>
<ul>
<li>在AP模板文件中填写AP信息，示例如下。如需添加多个AP，可以参照该示例在AP模板文件中填写多条AP信息。<ul>
<li>AP MAC地址：60de-4476-e360</li>
<li>AP SN：210235419610CB002287</li>
<li>AP名称：area_1</li>
<li>AP组：ap-group1</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><p>当选择“AP认证方式”为“MAC认证”时，AP MAC地址为必填项，AP SN可不填。</p>
</li>
<li><p>当选择“AP认证方式”为“SN认证”时，AP SN为必填项，AP MAC地址可不填。</p>
</li>
</ul>
<p>建议使用网络规划工具WLAN Planner将规划好的射频ID、AP信道、频宽、功率导出成.csv格式的表格，将表格中的这些信息填写到AP文件模板中，经度和纬度请根据实际情况配置。</p>
</blockquote>
<ul>
<li><p>单击“导入AP文件”后的<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054549.png" alt="img">，选择填写后的模板文件，单击“导入”。</p>
</li>
<li><p>导入完成后，页面显示导入结果信息，单击“确定”，完成添加。</p>
</li>
<li><p>单击“下一步”，进入“AP分组”页面。</p>
</li>
<li><p>AP模板文件中已添加AP组信息，直接单击“下一步”，进入“配置确认”页面。</p>
</li>
</ul>
<h4 id="配置确认。-1"><a href="#配置确认。-1" class="headerlink" title="配置确认。"></a>配置确认。</h4><ul>
<li>确认配置，单击“完成并继续无线业务配置”。</li>
</ul>
<h3 id="配置WLAN业务"><a href="#配置WLAN业务" class="headerlink" title="配置WLAN业务"></a>配置WLAN业务</h3><ul>
<li><p>单击“新建”，进入“基本信息”页面。</p>
</li>
<li><p>配置SSID名称、转发模式、业务VLAN ID等信息。<br><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054541.png" alt="img"></p>
</li>
<li><p>单击“下一步”，进入“安全认证”页面。</p>
</li>
<li><p>配置“安全配置”为802.1x认证，并配置外置Radius服务器的相关参数。<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054598.png" alt="点击放大"></p>
</li>
<li><p>单击“下一步”，进入“接入控制”页面。</p>
</li>
<li><p>选择“绑定AP组”为“ap-group1”。</p>
</li>
<li><p>单击“完成”。</p>
</li>
</ul>
<h3 id="配置AP的信道和功率"><a href="#配置AP的信道和功率" class="headerlink" title="配置AP的信道和功率"></a>配置AP的信道和功率</h3><ul>
<li>关闭AP射频的信道和功率自动调优功能，并手动配置AP的信道和功率。</li>
</ul>
<blockquote>
<p>射频的信道和功率自动调优功能默认开启，如果不关闭此功能则会导致手动配置不生效。</p>
</blockquote>
<ul>
<li><p>选择“配置 &gt; AP配置 &gt; AP配置 &gt; AP信息”，进入“AP列表”页面。</p>
</li>
<li><p>单击需要配置信道和功率的AP ID，进入“AP个性化配置”页面。</p>
</li>
<li><p>单击“射频管理”前的<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054563.png" alt="img" style="zoom:200%;" />，显示当前射频管理下的模板。</p>
</li>
<li><p>单击“射频0”，进入射频0配置页面。在射频0配置页面关闭信道自动调优和功率自动调优功能，并设置信道为带宽20MHz信道6，发送功率为127dBm。</p>
</li>
</ul>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE802.1X%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112194054627.png" alt="点击放大"></p>
<ul>
<li><p>“射频1”上关闭信道自动调优和功率自动调优功能，并设置信道带宽20MHz信道149，发送功率127dBm的步骤与“射频0”类似，此处不再赘述。</p>
</li>
<li><p>单击“应用”，在弹出的提示对话框中单击“确定”，完成配置。</p>
</li>
</ul>
<h3 id="检查配置结果"><a href="#检查配置结果" class="headerlink" title="检查配置结果"></a>检查配置结果</h3><ul>
<li><p>完成配置后，用户可通过无线终端搜索到SSID为<code>wlan-net</code>的无线网络。</p>
</li>
<li><p>用户关联到无线网络上后，无线PC能够被分配相应的IP地址。</p>
</li>
<li><p>在STA上使用802.1X客户端进行认证，输入正确的用户名和密码后，STA认证成功，正常访问WLAN网络。需要根据设置的认证方式</p>
<p>PEAP</p>
<p>对客户端进行相应的配置。</p>
<ul>
<li>Windows XP系统下的配置<ol>
<li>首先在无线网络属性中，添加SSID为<code>wlan-net</code>，并选择认证方式为<code>WPA2</code>，加密使用的算法<code>AES</code>。</li>
<li>在“验证”选项卡中，选择EAP类型为<code>PEAP</code>，单击“属性”，去掉验证服务器证书选项（此处不验证服务器证书），单击“配置”，去掉自动使用Windows登录名和密码选项，然后单击“确定”。</li>
</ol>
</li>
<li>Windows 7系统下的配置<ol>
<li>进入管理无线网络页面，单击“添加”，选择手动创建网络配置文件，添加SSID为<code>wlan-net</code>，并选择认证方式为<code>WPA2-企业</code>，加密使用的算法<code>AES</code>，单击“下一步”。</li>
<li>单击“更改连接设置”，进入“无线网络属性”界面，选择“安全”页签，单击“设置”，取消勾选“验证服务器证书”（此处不验证服务器证书），单击“配置”，取消勾选“自动使用Windows登录名和密码”，单击“确定”。</li>
<li>单击“确定”，返回“无线网络属性”界面，单击“高级设置”，在“高级设置”界面，勾选“指定身份验证模式”，并选择身份验证模式为“用户身份验证”，单击“确定”。</li>
</ol>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Huawei</tag>
        <tag>Wlan</tag>
        <tag>Radius</tag>
        <tag>802.1x</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei Wlan FAT AP配置WPA2-PSK-AES安全策略示例</title>
    <url>/2020/11/08/Huawei%20Wlan%20FAT%20AP%E9%85%8D%E7%BD%AEWPA2-PSK-AES%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E7%A4%BA%E4%BE%8B.html</url>
    <content><![CDATA[<h2 id="业务需求"><a href="#业务需求" class="headerlink" title="业务需求"></a>业务需求</h2><p>由于无线网络开放性的特点，若无线网络不采取适当的安全策略，业务数据就存在安全风险。用户对WLAN网络的安全性要求不高，不需要使用认证服务器，此时可以使用WEP或者WPA/WPA2（预共享密钥认证）的安全策略。考虑到用户的WLAN终端设备都为较新的款型，能够支持WPA/WPA2及其使用的TKIP和AES加密，所以不使用易被破解的WEP安全策略，采用WPA2的预共享密钥和AES加密，保证业务数据的安全。</p>
<h2 id="组网需求"><a href="#组网需求" class="headerlink" title="组网需求"></a>组网需求</h2><ul>
<li>DHCP部署方式：AP作为DHCP服务器为STA分配IP地址。</li>
</ul>
<p><strong>图2-4</strong> 配置WPA2-PSK-AES安全策略组网图<br><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AEWPA2-PSK-AES%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E7%A4%BA%E4%BE%8B/download-20201112182755910.png" alt="img"></p>
<h2 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h2><table>
<thead>
<tr>
<th>项目</th>
<th>数据</th>
</tr>
</thead>
<tbody><tr>
<td>STA业务VLAN</td>
<td>VLAN101</td>
</tr>
<tr>
<td>DHCP服务器</td>
<td>AP作为STA的DHCP服务器</td>
</tr>
<tr>
<td>STA地址池</td>
<td>10.23.101.2～10.23.101.254/24</td>
</tr>
<tr>
<td>SSID模板</td>
<td>名称：wlan-netSSID名称：wlan-net</td>
</tr>
<tr>
<td>安全模板</td>
<td>名称：wlan-net安全策略：WPA-WPA2+PSK+AES密码：a1234567</td>
</tr>
<tr>
<td>VAP模板</td>
<td>名称：wlan-net业务VLAN：VLAN101引用模板：SSID模板wlan-net、安全模板wlan-net</td>
</tr>
</tbody></table>
<h2 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h2><p>采用如下的思路进行WLAN配置：</p>
<ol>
<li>使用WLAN配置向导，配置WLAN基本业务。在配置安全策略时，选择WPA-WPA2 PSK和AES。</li>
<li>配置射频调优功能。</li>
<li>STA关联WLAN网络，完成业务验证。</li>
</ol>
<h4 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>配置WLAN基本业务</p>
<ul>
<li><p>单击“向导 &gt; 配置向导”，进入“Wi-Fi信号设置”页面。</p>
<ul>
<li>配置Wi-Fi信号。<ul>
<li>单击“新建”，进入“基本信息配置”页面。</li>
<li>配置SSID基本信息。<br><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AEWPA2-PSK-AES%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E7%A4%BA%E4%BE%8B/download-20201112182756005.png" alt="img"></li>
<li>单击“下一步”，进入“地址及速率配置”页面。</li>
<li>配置地址参数。(DNS服务器地址请根据实际需要配置。)<br><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AEWPA2-PSK-AES%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E7%A4%BA%E4%BE%8B/download-20201112182755951.png" alt="img"></li>
<li>单击“完成”</li>
</ul>
</li>
</ul>
</li>
<li><p>配置上网连接参数</p>
<ul>
<li>单击“下一步”，进入“上网连接设置”页面。</li>
<li>将接口以Tagged方式加入VLAN101.</li>
</ul>
</li>
</ul>
<blockquote>
<p>如果PC登录Web网管所连接的以太网接口和正在修改的以太网接口一致，请不要删掉接口上已有的VLAN配置，保证登录Web网管的PC和设备网络互通。如下图所示，接口上默认加入VLAN1和用户通信，用户可以通过默认的IP地址登录Web网管。若用户需要用默认的地址登录，不要删除原有的VLAN1.</p>
</blockquote>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AEWPA2-PSK-AES%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E7%A4%BA%E4%BE%8B/download-20201112182755901.png" alt="img"></p>
<ul>
<li>单击“完成”</li>
</ul>
</li>
<li><p>配置AP的信道和功率</p>
<ul>
<li><p>关闭AP射频的信道和功率自动调优功能，并手动配置AP的信道和功率</p>
<ul>
<li><p>射频的信道和功率自动调优功能默认开启，如果不关闭此功能则会导致手动配置不生效</p>
</li>
<li><p>依次单击“配置 &gt; WLAN业务 &gt; 无线业务配置 &gt; 射频0”，进入“射频0”页面</p>
</li>
<li><p>单击“射频管理”，进入“射频0配置(2.4G)”页面</p>
</li>
<li><p>在“射频0配置(2.4G)”页面关闭信道自动调优和功率自动调优功能，并设置信道为带宽20MHz信道6，发送功率为127dBm</p>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AEWPA2-PSK-AES%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E7%A4%BA%E4%BE%8B/download-20201112184242641.png" alt="img"></p>
</li>
<li><p>“射频1”上关闭信道自动调优和功率自动调优功能，并设置信道带宽20MHz信道149，发送功率127dBm的步骤与“射频0”类似，此处不再赘述</p>
</li>
<li><p>单击“应用”，在弹出的提示对话框中单击“确定”，完成配置</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>检查配置结果</p>
<ol>
<li>无线用户可以搜索到SSID为“wlan-net”的无线网络。</li>
<li>无线用户可以关联到无线网络中，获取到的IP地址为10.23.101.x/24，网关为10.23.101.1<br><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AEWPA2-PSK-AES%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E7%A4%BA%E4%BE%8B/download-20201112182755965.png" alt="img"></li>
<li>单击“监控 &gt; 终端管理 &gt; 终端用户管理”。在“终端用户列表”中可以看到STA正常上线，并且获得IP地址</li>
<li>用户输入密码后可以访问无线网络</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Huawei</tag>
        <tag>Wlan</tag>
        <tag>Psk</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei Wlan配置本地用户的内置Portal认证示例</title>
    <url>/2020/11/10/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B.html</url>
    <content><![CDATA[<h2 id="业务需求"><a href="#业务需求" class="headerlink" title="业务需求"></a>业务需求</h2><p>某企业为了提高WLAN网络的安全性，采用portal认证方式，为了降低成本，将AC部署为Portal服务器，并选择本地认证方式，在AC上完成认证。</p>
<h2 id="组网需求"><a href="#组网需求" class="headerlink" title="组网需求"></a>组网需求</h2><ul>
<li>AC组网方式：旁挂二层组网。</li>
<li>DHCP部署方式：<ul>
<li>AC作为DHCP服务器为AP分配IP地址。</li>
<li>汇聚交换机SwitchB作为DHCP服务器为STA分配IP地址。</li>
</ul>
</li>
<li>业务数据转发方式：隧道转发。</li>
<li>认证方式：内置Portal认证。</li>
<li>安全策略：开放认证。</li>
</ul>
<p>配置WLAN本地用户的内置Portal认证示例组网图：</p>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112191710019.png" alt="img"></p>
<h2 id="数据规划"><a href="#数据规划" class="headerlink" title="数据规划"></a>数据规划</h2><p>AC数据规划表</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>数据</th>
</tr>
</thead>
<tbody><tr>
<td>AP管理VLAN</td>
<td>VLAN100</td>
</tr>
<tr>
<td>STA业务VLAN</td>
<td>VLAN101</td>
</tr>
<tr>
<td>DHCP服务器</td>
<td>AC作为DHCP服务器为AP分配IP地址汇聚交换机SwitchB作为DHCP服务器为STA分配IP地址，STA的默认网关为10.23.101.2</td>
</tr>
<tr>
<td>AP的IP地址池</td>
<td>10.23.100.2～10.23.100.254/24</td>
</tr>
<tr>
<td>STA的IP地址池</td>
<td>10.23.101.4～10.23.101.254/24</td>
</tr>
<tr>
<td>AC的源接口IP地址</td>
<td>VLANIF100：10.23.100.1/24</td>
</tr>
<tr>
<td>AP组</td>
<td>名称：ap-group1绑定模板：VAP模板wlan-net、域管理模板default</td>
</tr>
<tr>
<td>域管理模板</td>
<td>名称：default国家码：中国</td>
</tr>
<tr>
<td>SSID模板</td>
<td>名称：wlan-netSSID名称：wlan-net</td>
</tr>
<tr>
<td>安全模板</td>
<td>名称：wlan-net安全策略：开放认证</td>
</tr>
<tr>
<td>本地用户</td>
<td>用户名：guest密码：guest@123</td>
</tr>
<tr>
<td>认证方案</td>
<td>名称：wlan-net认证方案：本地认证</td>
</tr>
<tr>
<td>Portal接入模板</td>
<td>名称：wlan-net使用内置Portal服务器，其中内置Portal服务器的IP地址：10.23.101.3/24使用的SSL策略：default_policy端口号：20000</td>
</tr>
<tr>
<td>免认证规则模板</td>
<td>名称：default_free_rule免认证资源：DNS服务器的地址（8.8.8.8）</td>
</tr>
<tr>
<td>认证模板</td>
<td>名称：wlan-net绑定的模板和认证方案：Portal接入模板wlan-net、免认证规则模板default_free_rule、认证方案wlan-net</td>
</tr>
<tr>
<td>VAP模板</td>
<td>名称：wlan-net转发模式：隧道转发业务VLAN：VLAN101绑定模板：SSID模板wlan-net、安全模板wlan-net、认证模板wlan-net</td>
</tr>
</tbody></table>
<h2 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h2><p>采用如下的思路进行WLAN配置：</p>
<ol>
<li>配置AP、AC和周边网络设备之间实现网络互通。</li>
<li>使用配置向导，配置AC系统参数。</li>
<li>使用配置向导，配置AP在AC上线。</li>
<li>使用配置向导在AC上配置WLAN相关业务及内置Portal认证的相关参数。</li>
<li>在AP组下配置免认证规则。</li>
<li>用户完成业务验证。</li>
</ol>
<h2 id="配置注意事项"><a href="#配置注意事项" class="headerlink" title="配置注意事项"></a>配置注意事项</h2><ul>
<li><p>纯组播报文由于协议要求在无线空口没有ACK机制保障，且无线空口链路不稳定，为了纯组播报文能够稳定发送，通常会以低速报文形式发送。如果网络侧有大量异常组播流量涌入，则会造成无线空口拥堵。为了减小大量低速组播报文对无线网络造成的冲击，建议配置组播报文抑制功能。配置前请确认是否有组播业务，如果有，请谨慎配置限速值。</p>
<ul>
<li>业务数据转发方式采用直接转发时，建议在直连AP的交换机接口上配置组播报文抑制。</li>
<li>业务数据转发方式采用隧道转发时，建议在AC的流量模板下配置组播报文抑制。</li>
</ul>
<p>配置方法请参见：<a href="http://support.huawei.com/hedex/hdx.do?docid=EDOC1100025388&id=ZH-CN_TOPIC_0117428937&text=null&lang=zh" target="_blank" rel="noopener">如何配置组播报文抑制，减小大量低速组播报文对无线网络造成的冲击？</a></p>
</li>
<li><p>建议在与AP直连的设备接口上配置端口隔离，如果不配置端口隔离，尤其是业务数据转发方式采用直接转发时，可能会在VLAN内形成大量不必要的广播报文，导致网络阻塞，影响用户体验。</p>
</li>
<li><p>隧道转发模式下，管理VLAN和业务VLAN不能配置为同一VLAN，且AP和AC之间只能放通管理VLAN，不能放通业务VLAN。</p>
</li>
</ul>
<h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><h3 id="配置周边设备"><a href="#配置周边设备" class="headerlink" title="配置周边设备"></a>配置周边设备</h3><p>配置接入交换机SwitchA的GE0/0/1和GE0/0/2接口加入VLAN100，GE0/0/1的缺省VLAN为VLAN100。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch <span class="number">100</span></span><br><span class="line">[SwitchA] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port trunk pvid vlan <span class="number">100</span></span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">100</span></span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port-isolate enable</span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] quit</span><br><span class="line">[SwitchA] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">100</span></span><br><span class="line">[SwitchA-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] quit</span><br></pre></td></tr></table></figure>

<p>配置汇聚交换机SwitchB的接口GE0/0/1和GE0/0/2加入VLAN100，接口GE0/0/2和GE0/0/3加入VLAN101。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchB</span><br><span class="line">[SwitchB] vlan batch <span class="number">100</span> <span class="number">101</span></span><br><span class="line">[SwitchB] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port link-type trunk</span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">100</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>] quit</span><br><span class="line">[SwitchB] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] port link-type trunk</span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">100</span> <span class="number">101</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>] quit</span><br><span class="line">[SwitchB] interface gigabitethernet <span class="number">0</span>/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">3</span>] port link-type trunk</span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">3</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">101</span></span><br><span class="line">[SwitchB-GigabitEthernet0/<span class="number">0</span>/<span class="number">3</span>] quit</span><br></pre></td></tr></table></figure>

<p>配置Router的接口GE1/0/0加入VLAN101，创建接口VLANIF101并配置IP地址为10.23.101.2/24。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;Huawei&gt; system-view</span><br><span class="line">[Huawei] sysname Router</span><br><span class="line">[Router] vlan batch <span class="number">101</span></span><br><span class="line">[Router] interface gigabitethernet <span class="number">1</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[Router-GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span>] port link-type trunk</span><br><span class="line">[Router-GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span>] port trunk allow-<span class="keyword">pass</span> vlan <span class="number">101</span></span><br><span class="line">[Router-GigabitEthernet1/<span class="number">0</span>/<span class="number">0</span>] quit</span><br><span class="line">[Router] interface vlanif <span class="number">101</span></span><br><span class="line">[Router-Vlanif101] ip address <span class="number">10.23</span><span class="number">.101</span><span class="number">.2</span> <span class="number">24</span></span><br><span class="line">[Router-Vlanif101] quit</span><br></pre></td></tr></table></figure>

<h3 id="配置DHCP服务器为STA分配IP地址并指定STA网关"><a href="#配置DHCP服务器为STA分配IP地址并指定STA网关" class="headerlink" title="配置DHCP服务器为STA分配IP地址并指定STA网关"></a>配置DHCP服务器为STA分配IP地址并指定STA网关</h3><p>在SwitchB上配置VLANIF101接口为STA提供IP地址，并指定10.23.101.2作为STA的默认网关地址。</p>
<blockquote>
<p>DNS服务器地址请根据实际需要配置。常用配置方法如下：</p>
<ul>
<li>接口地址池场景，需要在VLANIF接口视图下执行命令<strong>dhcp server dns-list</strong> <em>ip-address</em> &amp;&lt;1-8&gt;。</li>
<li>全局地址池场景，需要在IP地址池视图下执行命令<strong>dns-list</strong> <em>ip-address</em> &amp;&lt;1-8&gt;。</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[SwitchB] dhcp enable</span><br><span class="line">[SwitchB] interface vlanif <span class="number">101</span></span><br><span class="line">[SwitchB-Vlanif101] ip address <span class="number">10.23</span><span class="number">.101</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line">[SwitchB-Vlanif101] dhcp select interface</span><br><span class="line">[SwitchB-Vlanif101] dhcp server gateway-list <span class="number">10.23</span><span class="number">.101</span><span class="number">.2</span></span><br><span class="line">[SwitchB-Vlanif101] quit</span><br></pre></td></tr></table></figure>

<h3 id="配置AC系统参数"><a href="#配置AC系统参数" class="headerlink" title="配置AC系统参数"></a>配置AC系统参数</h3><h4 id="配置AC基本参数。"><a href="#配置AC基本参数。" class="headerlink" title="配置AC基本参数。"></a>配置AC基本参数。</h4><ul>
<li><p>单击“配置 &gt; 配置向导 &gt; AC”，进入“AC基本配置”页面。</p>
</li>
<li><p>“所在国家/地区”按实际情况选择，以“中国”为例。“系统时间”配置为“手动设置”。“日期和时间”配置为“使用PC当前时间”。</p>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112192052000.png" alt="点击放大"></p>
</li>
<li><p>单击页面下方的“下一步”，进入“端口配置”页面。</p>
</li>
</ul>
<h4 id="配置端口"><a href="#配置端口" class="headerlink" title="配置端口"></a>配置端口</h4><ul>
<li><p>选择接口“GigabitEthernet0/0/1”，展开“批量修改”，选择“接口类型”为“Trunk”，将“GigabitEthernet0/0/1”加入VLAN100（管理VLAN）和VLAN101（业务VLAN）。</p>
<blockquote>
<p>如果AC直接连接AP，需要在AC直连AP的接口上配置缺省VLAN为管理VLAN100。</p>
</blockquote>
<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112192311550.png" alt="点击放大" style="zoom:75%;" />
</li>
<li><p>单击“应用”，在弹出的提示对话框中单击“确定”，完成配置。</p>
</li>
<li><p>单击“下一步”，进入“网络互联配置”页面。</p>
</li>
</ul>
<h4 id="配置网络互联。"><a href="#配置网络互联。" class="headerlink" title="配置网络互联。"></a>配置网络互联。</h4><ul>
<li><p>配置“DHCP状态”为“ON”。</p>
</li>
<li><p>单击“接口配置”下的“新建”，进入“新建接口配置”页面。</p>
</li>
<li><p>配置接口VLANIF100的IP地址为10.23.100.1/24。</p>
<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112192405403.png" alt="img" style="zoom:75%;" />
</li>
<li><p>单击“DHCPv4地址池列表”下的“新建”，采用“接口地址池”，选择接口VLANIF100。</p>
<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112192422946.png" alt="点击放大" style="zoom:75%;" />
</li>
<li><p>单击“确定”，完成VLANIF100接口地址池的配置。</p>
</li>
<li><p>单击“接口配置”下的“新建”，进入“新建接口配置”页面。选择“接口类型”为“Loopback”，“接口编号”为“1”，配置Loopback1接口的IP地址为10.23.101.3/24。</p>
</li>
<li><p>单击“确定”，完成Loopback1接口地址池的配置。</p>
</li>
<li><p>单击“静态路由表”下的“新建”，进入“新建静态路由表”页面。</p>
</li>
<li><p>配置缺省路由，指定下一跳为10.23.101.2。</p>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112192537902.png" alt="img"></p>
</li>
<li><p>单击“确定”，完成静态路由的配置。</p>
</li>
<li><p>单击“下一步”。</p>
</li>
<li><p>单击“下一步”，进入“AC源地址”页面。</p>
</li>
</ul>
<h4 id="配置AC源地址。"><a href="#配置AC源地址。" class="headerlink" title="配置AC源地址。"></a>配置AC源地址。</h4><ul>
<li><p>“AC源地址”选择“VLANIF”，单击选择按钮，选择“Vlanif100”。</p>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112192904858.png" alt="点击放大"></p>
</li>
<li><p>单击“下一步”，进入“配置确认”页面。</p>
<h4 id="配置确认。"><a href="#配置确认。" class="headerlink" title="配置确认。"></a>配置确认。</h4></li>
<li><p>确认配置，单击“完成并继续AP上线配置”。</p>
</li>
</ul>
<h3 id="配置AP上线"><a href="#配置AP上线" class="headerlink" title="配置AP上线"></a>配置AP上线</h3><h4 id="配置AP上线。"><a href="#配置AP上线。" class="headerlink" title="配置AP上线。"></a>配置AP上线。</h4><ul>
<li>单击“批量导入”，进入“批量导入”页面。单击<img src="https://download.huawei.com/mdl/image/download?uuid=02672a0109cf4136b51bb9ceb30c300d" alt="img">，下载批量添加AP模板文件到本地。</li>
</ul>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112193031840.png" alt="img"></p>
<ul>
<li><p>在AP模板文件中填写AP信息，示例如下。如需添加多个AP，可以参照该示例在AP模板文件中填写多条AP信息。</p>
<ul>
<li>AP MAC地址：60de-4476-e360</li>
<li>AP SN：210235419610CB002287</li>
<li>AP名称：area_1</li>
<li>AP组：ap-group1</li>
</ul>
<blockquote>
<ul>
<li><p>当选择“AP认证方式”为“MAC认证”时，AP MAC地址为必填项，AP SN可不填。</p>
</li>
<li><p>当选择“AP认证方式”为“SN认证”时，AP SN为必填项，AP MAC地址可不填。</p>
<p>建议使用网络规划工具WLAN Planner将规划好的射频ID、AP信道、频宽、功率导出成.csv格式的表格，将表格中的这些信息填写到AP文件模板中，经度和纬度请根据实际情况配置。</p>
</li>
</ul>
</blockquote>
</li>
<li><p>单击“导入AP文件”后的<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112193253572.png" alt="img">，选择填写后的模板文件，单击“导入”。</p>
</li>
<li><p>导入完成后，页面显示导入结果信息，单击“确定”，完成添加。</p>
</li>
<li><p>单击“下一步”，进入“AP分组”页面。</p>
</li>
<li><p>AP模板文件中已添加AP组信息，直接单击“下一步”，进入“配置确认”页面。</p>
</li>
</ul>
<h4 id="配置确认。-1"><a href="#配置确认。-1" class="headerlink" title="配置确认。"></a>配置确认。</h4><ul>
<li>确认配置，单击“完成并继续无线业务配置”。</li>
</ul>
<h3 id="配置无线业务"><a href="#配置无线业务" class="headerlink" title="配置无线业务"></a>配置无线业务</h3><ul>
<li><p>单击“新建”，进入“基本信息”页面。</p>
</li>
<li><p>配置SSID名称、转发模式、业务VLAN ID等信息。</p>
</li>
</ul>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112193326026.png" alt="img"></p>
<ul>
<li><p>单击“下一步”，进入“安全认证”页面。</p>
</li>
<li><p>选择“安全配置”为“Portal认证（企业网络适用）”，“Portal服务器”为“内置Portal服务器”。在“内置Portal服务器配置”页签下配置服务器IP地址和端口号，并选择“SSL策略”为“default_policy”，其中，IP地址为设备上与用户路由可达的三层接口的IP地址，该举例中配置的服务器IP地址为10.23.101.3。</p>
</li>
</ul>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112193332252.png" alt="点击放大"></p>
<ul>
<li><p>点击“本地用户”右边的“管理”，进入“本地用户”配置页面。 </p>
</li>
<li><p>单击“新建”，进入“创建本地用户”页面。</p>
</li>
<li><p>选择“配置方式”为“手动添加”，配置本地用户的用户名和密码。</p>
</li>
</ul>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112193338093.png" alt="img"></p>
<ul>
<li><p>单击“确定”。</p>
</li>
<li><p>在“本地用户”页面选择新建的本地用户名，单击“确定”。</p>
</li>
<li><p>单击“下一步”，进入“接入控制”页面。</p>
</li>
<li><p>选择“绑定AP组”为“ap-group1”。</p>
</li>
<li><p>单击“完成”。</p>
</li>
</ul>
<h3 id="配置用户免认证时可以访问的网络资源"><a href="#配置用户免认证时可以访问的网络资源" class="headerlink" title="配置用户免认证时可以访问的网络资源"></a>配置用户免认证时可以访问的网络资源</h3><ul>
<li><p>依次单击“配置 &gt; AP配置 &gt; 模板管理”，进入“模板管理”页面。</p>
</li>
<li><p>依次选择“无线业务 &gt; VAP模板 &gt; wlan-net &gt; 认证模板 &gt; 免认证规则模板”，进入“免认证规则模板”界面。</p>
</li>
<li><p>选择“免认证规则模板”为“default_free_rule”。</p>
</li>
<li><p>在“控制方式”处选择“免认证规则”。</p>
</li>
<li><p>单击“新建”，进入“新建免认证规则”页面，配置“规则编号”为“1”，免认证的目的IP地址为DNS服务器的IP地址。<br><img src="https://download.huawei.com/mdl/image/download?uuid=5d50e68c21d04f2586e2b2707e0c5d42" alt="img"></p>
</li>
<li><p>单击“确定”。</p>
</li>
<li><p>选中规则编号为1的免认证规则，单击“应用”，在弹出的提示页面中单击“确定”，完成配置。</p>
</li>
</ul>
<h3 id="检查配置结果"><a href="#检查配置结果" class="headerlink" title="检查配置结果"></a>检查配置结果</h3><ul>
<li><p>无线用户可以搜索到SSID为“wlan-net”的无线网络。</p>
</li>
<li><p>无线用户可以关联到无线网络中，获取到的IP地址为10.23.101.x/24，网关为10.23.101.2。</p>
</li>
</ul>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112193444882.png" alt="img"></p>
<ul>
<li><p>无线用户浏览网页时，浏览器自动跳转到Portal认证页面，输入正确的用户名和密码后，认证成功，用户可以正常访问网页。</p>
</li>
<li><p>选择“监控 &gt; 用户 &gt; 上线用户统计”。在“用户列表”中可以看到所有上线的用户，使用筛选功能可以过滤显示结果。例如找到<strong>SSID</strong>列，单击“<img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112193442529.png" alt="img">”，设置筛选条件，输入“wlan-net”，单击“确定”，可以看到连接在该SSID的用户。筛选功能支持多列组合筛选，可以精确查找上线用户。</p>
</li>
</ul>
<p><img src="../../../../images/Huawei%20Wlan%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%86%85%E7%BD%AEPortal%E8%AE%A4%E8%AF%81%E7%A4%BA%E4%BE%8B/download-20201112193447516.png" alt="img"></p>
]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Huawei</tag>
        <tag>Wlan</tag>
        <tag>Portal</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei Wlan二层架构配置psk认证举例</title>
    <url>/2020/10/27/Huawei%20Wlan%E4%BA%8C%E5%B1%82%E6%9E%B6%E6%9E%84%E9%85%8D%E7%BD%AEpsk%E8%AE%A4%E8%AF%81%E4%B8%BE%E4%BE%8B.html</url>
    <content><![CDATA[<h1 id="拓扑如下"><a href="#拓扑如下" class="headerlink" title="拓扑如下"></a>拓扑如下</h1><img src="../../../../images/Huawei%E4%BA%8C%E5%B1%82%E5%8D%95SSID%E9%85%8D%E7%BD%AE%E4%B8%BE%E4%BE%8B/image-20201107001500903.png" alt="image-20201107001500903" style="zoom:50%;" />

<h1 id="配置Router"><a href="#配置Router" class="headerlink" title="配置Router"></a>配置Router</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dhcp enable           <span class="comment">##开启dhcp服务</span></span><br><span class="line">interface vlanif <span class="number">1</span></span><br><span class="line">ip add <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">dhcp select <span class="keyword">global</span>    <span class="comment">##配置全局dhcp</span></span><br><span class="line"><span class="comment">#配置地址池</span></span><br><span class="line">ip pool <span class="number">1</span></span><br><span class="line"> gateway-list <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> </span><br><span class="line"> network <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> mask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> </span><br><span class="line"> dns-list <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"> excluded-ip-address <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"> option <span class="number">43</span> hex <span class="number">01060104</span>C0A80102   <span class="comment">##当Ac与Ap不在同一网段时使用</span></span><br></pre></td></tr></table></figure>

<h1 id="配置AC"><a href="#配置AC" class="headerlink" title="配置AC"></a>配置AC</h1><h2 id="配置IP地址"><a href="#配置IP地址" class="headerlink" title="配置IP地址"></a>配置IP地址</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">interface vlanif <span class="number">1</span></span><br><span class="line">ip add <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h2 id="配置AP组"><a href="#配置AP组" class="headerlink" title="配置AP组"></a>配置AP组</h2><blockquote>
<p>每个AP都会加入并且只能加入到一个AP组中，AP组通常用于多个AP的通用配置，同时在单个AP下也可以配置AP的独有配置。</p>
</blockquote>
<blockquote>
<p>如果不手动配置AP加入到指定AP组中，则AP会自动加入到名为<strong>default</strong>的缺省AP组中。缺省的AP组不能被删除，但是可以进行修改。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">ap-group name wifi</span><br></pre></td></tr></table></figure>

<h2 id="添加AP设备"><a href="#添加AP设备" class="headerlink" title="添加AP设备"></a>添加AP设备</h2><p>添加AP有三种方式：离线导入AP、自动发现AP以及手工确认未认证列表中的AP。</p>
<ul>
<li>离线导入AP：预先配置AP的MAC地址和SN，当AP与AC连接时，如果AC发现AP和预先增加的AP的MAC地址和SN匹配，则AC开始与AP建立连接。</li>
<li>自动发现AP：当配置AP的认证模式为不认证或配置AP的认证模式为MAC或SN认证且将AP加入AP白名单中，则当AP与AC连接时，AP将被AC自动发现并正常上线。</li>
<li>手工确认未认证列表中的AP：当配置AP的认证模式为MAC或SN认证但AP没有离线导入且不在已设置的AP白名单中，则该AP会被记录到未授权的AP列表中。需要用户手工确认后，此AP才能正常上线。</li>
</ul>
<p>AC上可以管理的AP数量受以下因素限制：</p>
<ul>
<li>License资源项：普通AP+中心AP的总数不超过AC本地License资源项数目，远端单元数量不占用License资源。</li>
<li>AC可管理AP的最大数：AC可管理中心AP的最大数和可管理普通AP+远端单元的最大数是独立的。<ul>
<li>普通AP+远端单元的总数不超过AC可管理普通AP+远端单元的最大数。</li>
<li>中心AP的总数不超过AC可管理中心AP的最大数。</li>
</ul>
</li>
</ul>
<h3 id="离线导入AP"><a href="#离线导入AP" class="headerlink" title="离线导入AP"></a>离线导入AP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">system-view</span><br><span class="line">wlan</span><br><span class="line">ap auth-mode &#123;mac-auth | sn-auth&#125;   <span class="comment">#配置AP认证模式为MAC认证或SN认证。</span></span><br><span class="line">ap-id 1 ?</span><br><span class="line">  ap-mac   AP MAC address</span><br><span class="line">  ap-sn    AP SN</span><br><span class="line">  ap-type  AP type</span><br><span class="line">  type-id  AP type ID</span><br><span class="line">  &lt;cr&gt;     Please press ENTER to execute command </span><br><span class="line">ap-name name      <span class="comment">#配置AP的名称。缺省情况下，未配置单个AP的名称。</span></span><br><span class="line">ap-group name     <span class="comment">#配置AP加入AP组。缺省情况下，未配置AP加入的组。</span></span><br></pre></td></tr></table></figure>

<h3 id="自动发现AP"><a href="#自动发现AP" class="headerlink" title="自动发现AP"></a>自动发现AP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">system-view</span><br><span class="line">wlan</span><br><span class="line">ap auth-mode no-auth      <span class="comment">#配置AP认证方式为不认证</span></span><br></pre></td></tr></table></figure>

<h3 id="手工确认未认证列表中的AP"><a href="#手工确认未认证列表中的AP" class="headerlink" title="手工确认未认证列表中的AP"></a>手工确认未认证列表中的AP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">system-view</span><br><span class="line">wlan</span><br><span class="line">ap auth-mode &#123;mac-auth | sn-auth&#125;   <span class="comment">#配置AP认证模式为MAC认证或SN认证。</span></span><br><span class="line">display ap unauthorized record  <span class="comment">#查看未认证通过的AP信息。</span></span><br><span class="line">ap-confirm &#123; all | mac ap-mac | sn ap-sn &#125;  <span class="comment">#确认未认证通过的AP，确认后，AP将进入“normal”状态。</span></span><br></pre></td></tr></table></figure>

<h2 id="查看所有在线AP"><a href="#查看所有在线AP" class="headerlink" title="查看所有在线AP"></a>查看所有在线AP</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">display ap all</span><br></pre></td></tr></table></figure>

<h2 id="创建安全模版（默认为default）"><a href="#创建安全模版（默认为default）" class="headerlink" title="创建安全模版（默认为default）"></a>创建安全模版（默认为default）</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">security<span class="literal">-profile</span> name ssid_name  <span class="comment">#安全认证模板名称</span></span><br><span class="line">security wpa<span class="literal">-wpa2</span> psk pass<span class="literal">-phrase</span> a1234567 aes  <span class="comment">#便是加密类型wpa-wpa2 认证密码为a1234567</span></span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<h2 id="创建SSID模板："><a href="#创建SSID模板：" class="headerlink" title="创建SSID模板："></a>创建SSID模板：</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ssid<span class="literal">-profile</span> name ssid_name</span><br><span class="line">ssid ssid_name</span><br><span class="line">Info: This operation may take a few seconds, please wait.done.</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<h2 id="创建VAP模板："><a href="#创建VAP模板：" class="headerlink" title="创建VAP模板："></a>创建VAP模板：</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">vap<span class="literal">-profile</span> name ssid_name</span><br><span class="line">forward<span class="literal">-mode</span> direct<span class="literal">-forward</span></span><br><span class="line">service<span class="literal">-vlan</span> vlan<span class="literal">-id</span> <span class="number">3</span>  <span class="comment">#配置VAP的业务VLAN</span></span><br><span class="line">security<span class="literal">-profile</span> ssid_name</span><br><span class="line">Info: This operation may take a few seconds, please wait.done.</span><br><span class="line">ssid<span class="literal">-profile</span> ssid_name</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<h2 id="配置AP组引用VAP模板，并在射频0和1上引用VAP模板："><a href="#配置AP组引用VAP模板，并在射频0和1上引用VAP模板：" class="headerlink" title="配置AP组引用VAP模板，并在射频0和1上引用VAP模板："></a>配置AP组引用VAP模板，并在射频0和1上引用VAP模板：</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ap<span class="literal">-group</span> name ap<span class="literal">-group1</span></span><br><span class="line">vap<span class="literal">-profile</span> ssid_name wlan <span class="number">1</span> radio <span class="number">0</span></span><br><span class="line">vap<span class="literal">-profile</span> ssid_name wlan <span class="number">1</span> radio <span class="number">1</span></span><br><span class="line">quit</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Huawei</tag>
        <tag>Wlan</tag>
        <tag>Ap</tag>
        <tag>Psk</tag>
      </tags>
  </entry>
  <entry>
    <title>Huawei Wlan维护</title>
    <url>/2020/10/27/Huawei%20Wlan%E7%BB%B4%E6%8A%A4.html</url>
    <content><![CDATA[<h3 id="检测AP与STA间的无线链路质量"><a href="#检测AP与STA间的无线链路质量" class="headerlink" title="检测AP与STA间的无线链路质量"></a>检测AP与STA间的无线链路质量</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">rf-ping  mac-address</span><br></pre></td></tr></table></figure>

<h3 id="检测AP与网络设备之间的联通性"><a href="#检测AP与网络设备之间的联通性" class="headerlink" title="检测AP与网络设备之间的联通性"></a>检测AP与网络设备之间的联通性</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wlan</span><br><span class="line">ap-ping ap-name ap-name  host</span><br><span class="line">ap-ping ap-name ap<span class="number">-1</span> <span class="number">10.0</span><span class="number">.11</span><span class="number">.254</span></span><br></pre></td></tr></table></figure>

<h3 id="维护AP的统计信息"><a href="#维护AP的统计信息" class="headerlink" title="维护AP的统计信息"></a>维护AP的统计信息</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看AP的运行信息</span></span><br><span class="line">disaply ap run-info </span><br><span class="line"><span class="comment">#查看射频上的报文统计信息</span></span><br><span class="line">disaply ap traffic statistics wireless ap-name ap-name radio radio-id [ssid ssid]</span><br><span class="line"><span class="comment">#查看AP的射频信息</span></span><br><span class="line">disaply radio all</span><br><span class="line"><span class="comment">#查看AP性能统计信息</span></span><br><span class="line">disaply ap performance staristics</span><br><span class="line"><span class="comment">#查看AP上线失败和下线的记录信息</span></span><br><span class="line">disaply ap online-fail-record all</span><br><span class="line">disaply ap offline-record all</span><br><span class="line"><span class="comment">#清除AP上线失败和下线的记录信息</span></span><br><span class="line">reset ap online-fail-record all</span><br><span class="line">reset ap offline-record all</span><br><span class="line"><span class="comment">#查看STA的接入信息和统计信息</span></span><br><span class="line">disaply station</span><br><span class="line">disaply station statistics</span><br><span class="line"><span class="comment">#查看STA的上线失败和下线的记录信息</span></span><br><span class="line">disaply station online-fail-record all</span><br><span class="line">disaply station offline-record all</span><br><span class="line"><span class="comment">#清除STA的上线失败和下线的记录信息</span></span><br><span class="line">reset station online-fail-record all</span><br><span class="line">reset station offline-record all</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Huawei</category>
      </categories>
      <tags>
        <tag>Huawei</tag>
        <tag>Wlan</tag>
      </tags>
  </entry>
  <entry>
    <title>Python学习笔记2-Python基础</title>
    <url>/2020/11/12/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02-Python%E5%9F%BA%E7%A1%80.html</url>
    <content><![CDATA[<h1 id="注释的使用"><a href="#注释的使用" class="headerlink" title="注释的使用"></a>注释的使用</h1><h2 id="单行注释"><a href="#单行注释" class="headerlink" title="单行注释"></a>单行注释</h2><p>以<code>#</code>开头的语句是注释，注释是给人看的，可以是任意内容，解释器会忽略掉注释。为单行注释，只对本行有效。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'hello,world'</span>) <span class="comment">#我是注释</span></span><br><span class="line">输出结果：</span><br><span class="line">hello,world</span><br></pre></td></tr></table></figure>

<h2 id="多行注释"><a href="#多行注释" class="headerlink" title="多行注释"></a>多行注释</h2><p>三个引号开始，三个引号结束，中间的内容也是注释，为多行注释，允许换行</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'hello,world'</span>) <span class="comment">#我是注释</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">我是注释</span></span><br><span class="line"><span class="string">多行注释</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">输出结果：</span><br><span class="line">hello,world</span><br><span class="line"><span class="comment">#Ctrl + / 快捷键给代码添加或删除注释（Mac中为command + /）</span></span><br></pre></td></tr></table></figure>

<p>Python程序是<strong>大小写敏感</strong>的，如果写错了大小写，程序会报错。</p>
<h1 id="常见的数据类型"><a href="#常见的数据类型" class="headerlink" title="常见的数据类型"></a>常见的数据类型</h1><p>在Python中，数据都有各自对应的类型：</p>
<h2 id="整数-int"><a href="#整数-int" class="headerlink" title="整数 int"></a>整数 int</h2><p>处理任意大小的整数，当然包括负整数，在程序中的表示方法和数学上的写法一模一样。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(type(<span class="number">12</span>))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">int</span>'&gt;         # <span class="title">int</span>整数类型</span></span><br></pre></td></tr></table></figure>

<h2 id="浮点数-float"><a href="#浮点数-float" class="headerlink" title="浮点数 float"></a>浮点数 float</h2><p>浮点数也就是小数,之所以称为浮点数，是因为按照科学记数法表示时，一个浮点数的小数点位置是可变的。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(type(<span class="number">1.2</span>))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">float</span>'&gt;         # <span class="title">float</span> 类型</span></span><br></pre></td></tr></table></figure>

<h2 id="复数类型-complex"><a href="#复数类型-complex" class="headerlink" title="复数类型 complex"></a>复数类型 complex</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(type((<span class="number">-1</span>) ** <span class="number">0.5</span>))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">complex</span>'&gt;       #<span class="title">complex</span>类型</span></span><br></pre></td></tr></table></figure>

<h2 id="字符串-str"><a href="#字符串-str" class="headerlink" title="字符串 str"></a>字符串 str</h2><p>字符串类型其实就是一段普通的文字，python里的字符串要求使用一对单引号或者双引号来包裹。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'今天天气好晴朗，处处好风光呀好风光'</span>)</span><br><span class="line">print(<span class="string">'56'</span>)  <span class="comment"># 这里的56是字符串类型</span></span><br><span class="line">print(<span class="number">56</span>)   <span class="comment">#这里的56是int类型</span></span><br></pre></td></tr></table></figure>

<h2 id="布尔值-bool"><a href="#布尔值-bool" class="headerlink" title="布尔值 bool"></a>布尔值 bool</h2><p>布尔值和布尔代数的表示完全一致，一个布尔值只有<code>True</code>、<code>False</code>两种值，要么是<code>True</code>，要么是<code>False</code> 。不能被赋值<br>在Python中，可以直接用<code>True</code>、<code>False</code>表示布尔值（<strong>请注意大小写</strong>），也可以通过布尔运算计算出来：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="literal">False</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> &gt; <span class="number">2</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> &gt; <span class="number">5</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="空值-none"><a href="#空值-none" class="headerlink" title="空值 none"></a>空值 none</h2><p>空值是Python里一个特殊的值，用<code>None</code>表示。<code>None</code>不能理解为<code>0</code>，因为<code>0</code>是有意义的，而<code>None</code>是一个特殊的空值。</p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>变量的概念基本上和初中代数的方程变量是一致的，只是在计算机程序中，变量不仅可以是数字，还可以是任意数据类型。</p>
<p>变量在程序中就是用一个变量名表示了，变量名必须是大小写英文、数字和<code>_</code>的组合，且不能用数字开头。也不可使用关键字，比如if/for/else/while/try等等</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span>            <span class="comment">#变量a是一个整数。</span></span><br><span class="line">t_007 = <span class="string">'T007'</span>   <span class="comment">#变量t_007是一个字符串。</span></span><br><span class="line">Answer = <span class="literal">True</span>    <span class="comment">#变量Answer是一个布尔值True。</span></span><br></pre></td></tr></table></figure>

<p>在Python中，等号<code>=</code>是赋值语句，可以把任意数据类型赋值给变量，同一个变量可以反复赋值，而且可以是不同类型的变量</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">123</span> <span class="comment"># a是整数</span></span><br><span class="line">print(a)</span><br><span class="line">a = <span class="string">'ABC'</span> <span class="comment"># a变为字符串</span></span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">123</span> </span><br><span class="line">ABC</span><br></pre></td></tr></table></figure>

<h2 id="dict-和-set"><a href="#dict-和-set" class="headerlink" title="dict 和 set"></a>dict 和 set</h2><p><code>dict</code>全称dictionary，在其他语言中也称为map，使用键-值（key-value）存储，具有极快的查找速度。</p>
<p>和<code>list</code>比较，<code>dict</code>有以下几个特点：</p>
<ul>
<li>查找和插入的速度极快，不会随着key的增加而变慢；</li>
<li>需要占用大量的内存，内存浪费多。</li>
</ul>
<p>而list相反：</p>
<ul>
<li><p>查找和插入的时间随着元素的增加而增加；</p>
</li>
<li><p>占用空间小，浪费内存很少。</p>
</li>
</ul>
<p>所以，<code>dict</code>是用空间来换取时间的一种方法。</p>
<p><code>dict</code>可以用在需要高速查找的很多地方，在Python代码中几乎无处不在，正确使用dict非常重要，需要牢记的第一条就是<code>dict</code>的key必须是<strong>不可变对象</strong>。</p>
<p>这是因为<code>dict</code>根据key来计算value的存储位置，如果每次计算相同的key得出的结果不同，那dict内部就完全混乱了。这个通过key计算位置的算法称为哈希算法（Hash）。</p>
<p>要保证hash的正确性，作为key的对象就不能变。在Python中，字符串、整数等都是不可变的，因此，可以放心地作为key。而<code>list</code>是可变的，就不能作为key：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">'Michael'</span>: <span class="number">95</span>, <span class="string">'Bob'</span>: <span class="number">75</span>, <span class="string">'Tracy'</span>: <span class="number">85</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">'Michael'</span>]</span><br><span class="line"><span class="number">95</span></span><br></pre></td></tr></table></figure>

<h2 id="list和tuple"><a href="#list和tuple" class="headerlink" title="list和tuple"></a>list和tuple</h2><p>Python内置的一种数据类型是列表：list。list是一种有序的集合，可以随时添加和删除其中的元素。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">L = [</span><br><span class="line">    [<span class="string">'Apple'</span>, <span class="string">'Google'</span>, <span class="string">'Microsoft'</span>],</span><br><span class="line">    [<span class="string">'Java'</span>, <span class="string">'Python'</span>, <span class="string">'Ruby'</span>, <span class="string">'PHP'</span>],</span><br><span class="line">    [<span class="string">'Adam'</span>, <span class="string">'Bart'</span>, <span class="string">'Lisa'</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印Apple:</span></span><br><span class="line">print(L[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"><span class="comment"># 打印Python:</span></span><br><span class="line">print(L[<span class="number">1</span>][<span class="number">1</span>])</span><br><span class="line"><span class="comment"># 打印Lisa:</span></span><br><span class="line">print(L[<span class="number">2</span>][<span class="number">2</span>])</span><br></pre></td></tr></table></figure>

<h2 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h2><h3 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">12</span></span><br><span class="line">print(bin(a))         <span class="comment">#使用bin内置函数可以将数字转换为二进制</span></span><br><span class="line">print(oct(a))         <span class="comment">#使用oct内置函数可以将数字转换为八进制</span></span><br><span class="line">print(hex(a))         <span class="comment">#使用hex内置函数可以将数字转换为十六进制</span></span><br></pre></td></tr></table></figure>

<h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><blockquote>
<p>因为不同的数据类型，在进行运算时，使用的运算规则时不一样的</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">int(x;[base])</td>
<td align="center">将x转换为一个整数</td>
</tr>
<tr>
<td align="center">float(x)</td>
<td align="center">将x转换为一个浮点数</td>
</tr>
<tr>
<td align="center">str(x)</td>
<td align="center">将对象x转换为字符串</td>
</tr>
<tr>
<td align="center">bool(x)</td>
<td align="center">将对象x转换为布尔值</td>
</tr>
</tbody></table>
<h1 id="查看数据类型"><a href="#查看数据类型" class="headerlink" title="查看数据类型"></a>查看数据类型</h1><p>使用type内置类可以查看一个变量对应的数据类型。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="string">'test'</span></span><br><span class="line">c = <span class="literal">True</span></span><br><span class="line">d = [<span class="string">'张三'</span>,<span class="string">'李四'</span>,<span class="string">'王二'</span>,<span class="string">'麻子'</span>]</span><br><span class="line">e = <span class="number">3.14</span></span><br><span class="line">print(type(a))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">int</span>'&gt;    #整数类型</span></span><br><span class="line"><span class="class"><span class="title">print</span><span class="params">(type<span class="params">(b)</span>)</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">str</span>'&gt;    #字符串类型</span></span><br><span class="line"><span class="class"><span class="title">print</span><span class="params">(type<span class="params">(c)</span>)</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">bool</span>'&gt;    #布尔类型</span></span><br><span class="line"><span class="class"><span class="title">print</span><span class="params">(type<span class="params">(d)</span>)</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">list</span>'&gt;    #列表类型</span></span><br><span class="line"><span class="class"><span class="title">print</span><span class="params">(type<span class="params">(e)</span>)</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">float</span>'&gt;    #浮点类型</span></span><br></pre></td></tr></table></figure>

<h1 id="输出语句"><a href="#输出语句" class="headerlink" title="输出语句"></a>输出语句</h1><h2 id="Print语句的使用"><a href="#Print语句的使用" class="headerlink" title="Print语句的使用"></a>Print语句的使用</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(value, ..., sep=<span class="string">' '</span>, end=<span class="string">'\n'</span>, file=sys.stdout, flush=<span class="literal">False</span>)</span><br><span class="line">    value ：复数，表示可以一次输出多个对象。输出多个对象时，需要用 , 分隔。</span><br><span class="line">    file:  a file-like object (stream); defaults to the current sys.stdout.</span><br><span class="line">    sep:   string inserted between values, default a space.</span><br><span class="line">    end:   string appended after the last value, default a newline.</span><br><span class="line">    flush: whether to forcibly flush the stream.</span><br></pre></td></tr></table></figure>

<ul>
<li>sep：表示输出时，每个值之间使用哪种字符作为分割符，默认使用空格作为分割符</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'hello'</span>,<span class="string">'world'</span>,<span class="string">'da'</span>,<span class="string">'jia'</span>,<span class="string">'hao'</span>,sep=<span class="string">'+'</span>)</span><br><span class="line">输出：</span><br><span class="line">hello+world+da+jia+hao</span><br></pre></td></tr></table></figure>

<ul>
<li>end：当执行完一个print语句以后，接下来要输出的字符。默认\n表示换行</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'hello'</span>,<span class="string">'world'</span>,<span class="string">'da'</span>,<span class="string">'jia'</span>,<span class="string">'hao'</span>,end=<span class="string">'---------'</span>)</span><br><span class="line">print(<span class="string">'大哥你好'</span>)</span><br><span class="line">输出：</span><br><span class="line">hello world da jia hao---------大哥你好</span><br></pre></td></tr></table></figure>

<ul>
<li>file：将输出内容写入到文件中</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = open(<span class="string">"1.txt"</span>, <span class="string">"w"</span>)    <span class="comment"># 打开文件以便写入</span></span><br><span class="line">print(<span class="string">"Correlation is "</span>, file=f)</span><br><span class="line">f.close  <span class="comment">#  关闭文件</span></span><br></pre></td></tr></table></figure>

<ul>
<li>flush：输出是否被缓存通常决定于 file，但如果 flush 关键字参数为 True，流会被强制刷新。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">print(<span class="string">"---RUNOOB EXAMPLE ： Loading 效果---"</span>)</span><br><span class="line">print(<span class="string">"Loading"</span>,end = <span class="string">""</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    print(<span class="string">"."</span>,end = <span class="string">''</span>,flush = <span class="literal">True</span>)</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">输出</span><br><span class="line">---RUNOOB EXAMPLE ： Loading 效果---</span><br><span class="line">Loading....................</span><br><span class="line">进程已结束，退出代码 <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">birth = input(<span class="string">'birth: '</span>)</span><br><span class="line"><span class="keyword">if</span> birth &lt; <span class="number">2000</span>:</span><br><span class="line">    print(<span class="string">'00前'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'00后'</span>)</span><br></pre></td></tr></table></figure>

<p>输入1982，结果报错：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: unorderable types: str() &gt; int()</span><br></pre></td></tr></table></figure>

<p>这是因为input()返回的数据类型是str，str不能直接和整数比较，必须先把str转换成整数。Python提供了int()函数来完成这件事情：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = input(<span class="string">'birth: '</span>)</span><br><span class="line">birth = int(s)</span><br><span class="line"><span class="keyword">if</span> birth &lt; <span class="number">2000</span>:</span><br><span class="line">    print(<span class="string">'00前'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'00后'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><h2 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h2><ul>
<li>Python2中两个整数相除得到的结果是一个整数，10/3=3</li>
<li>Python3中两个整数相除得到的结果是一个浮点数，10/3=3.3333333</li>
<li>在Python中，数字和字符串之间，不能做加法运算。</li>
</ul>
<p>以a = 10,b = 20为例计算</p>
<table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">描述</th>
<th align="center">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">+</td>
<td align="center">加</td>
<td align="center">a+b=30</td>
</tr>
<tr>
<td align="center">-</td>
<td align="center">减</td>
<td align="center">b-a=10</td>
</tr>
<tr>
<td align="center">*</td>
<td align="center">乘</td>
<td align="center">a*b=200</td>
</tr>
<tr>
<td align="center">/</td>
<td align="center">除</td>
<td align="center">b/a=2</td>
</tr>
<tr>
<td align="center">//</td>
<td align="center">取整数</td>
<td align="center">b//a=2</td>
</tr>
<tr>
<td align="center">%</td>
<td align="center">取余数</td>
<td align="center">b&amp;a=0</td>
</tr>
<tr>
<td align="center">**</td>
<td align="center">幂运算</td>
<td align="center">a**b=100000000000000000000</td>
</tr>
<tr>
<td align="center">()</td>
<td align="center">小括号</td>
<td align="center">提高运算优先级,比如（1+2）*3</td>
</tr>
</tbody></table>
<blockquote>
<p>注意：混合运算时，优先级顺序为<code>**</code>高于<code>*</code>,<code>/</code>,<code>%</code>,<code>//</code>高于<code>+</code>,<code>-</code>,为了避免歧义，建议使用（）处理运算符优先级，并且，不同类型的数字在进行混合运算时，整数将会转换为浮点数进行计算。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'hello'</span> + <span class="string">'world'</span>)   </span><br><span class="line">输出： <span class="comment">#加法运算符，将两个或多个字符串拼接为一个字符串</span></span><br><span class="line">helloworld</span><br><span class="line">print(<span class="string">'18'</span> + <span class="number">1</span>)       </span><br><span class="line">输出： <span class="comment">#在Python中，字符串和数字不能做加法运算</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/st/Desktop/Day1/1.py"</span>, line <span class="number">2</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    print(<span class="string">'18'</span> + <span class="number">1</span>)</span><br><span class="line">TypeError: can only concatenate str (<span class="keyword">not</span> <span class="string">"int"</span>) to str</span><br><span class="line">print(<span class="string">'hello'</span> * <span class="number">3</span>)</span><br><span class="line">输出： <span class="comment">#乘法运算符，可以用于数字和字符串之间，用来将一个字符串重复多次输出</span></span><br><span class="line">hellohellohello</span><br></pre></td></tr></table></figure>

<h2 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h2><p>以下假设变量a为10，变量b为20：</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">==</td>
<td align="left">等于 - 比较对象是否相等</td>
<td align="left">(a == b) 返回 False。</td>
</tr>
<tr>
<td align="left">!=</td>
<td align="left">不等于 - 比较两个对象是否不相等</td>
<td align="left">(a != b) 返回 true.</td>
</tr>
<tr>
<td align="left">&lt;&gt;</td>
<td align="left">不等于 - 比较两个对象是否不相等。<strong>python3 已废弃。</strong></td>
<td align="left">(a &lt;&gt; b) 返回 true。这个运算符类似 != 。</td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left">大于 - 返回x是否大于y</td>
<td align="left">(a &gt; b) 返回 False。</td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left">小于 - 返回x是否小于y。所有比较运算符返回1表示真，返回0表示假。这分别与特殊的变量True和False等价。</td>
<td align="left">(a &lt; b) 返回 true。</td>
</tr>
<tr>
<td align="left">&gt;=</td>
<td align="left">大于等于 - 返回x是否大于等于y。</td>
<td align="left">(a &gt;= b) 返回 False。</td>
</tr>
<tr>
<td align="left">&lt;=</td>
<td align="left">小于等于 - 返回x是否小于等于y。</td>
<td align="left">(a &lt;= b) 返回 true。</td>
</tr>
</tbody></table>
<h2 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h2><p>以下假设变量a为10，变量b为20：</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">=</td>
<td align="left">简单的赋值运算符</td>
<td align="left">c = a + b 将 a + b 的运算结果赋值为 c</td>
</tr>
<tr>
<td align="left">+=</td>
<td align="left">加法赋值运算符</td>
<td align="left">c += a 等效于 c = c + a</td>
</tr>
<tr>
<td align="left">-=</td>
<td align="left">减法赋值运算符</td>
<td align="left">c -= a 等效于 c = c - a</td>
</tr>
<tr>
<td align="left">*=</td>
<td align="left">乘法赋值运算符</td>
<td align="left">c *= a 等效于 c = c * a</td>
</tr>
<tr>
<td align="left">/=</td>
<td align="left">除法赋值运算符</td>
<td align="left">c /= a 等效于 c = c / a</td>
</tr>
<tr>
<td align="left">%=</td>
<td align="left">取模赋值运算符</td>
<td align="left">c %= a 等效于 c = c % a</td>
</tr>
<tr>
<td align="left">**=</td>
<td align="left">幂赋值运算符</td>
<td align="left">c *<em>= a 等效于 c = c *</em> a</td>
</tr>
<tr>
<td align="left">//=</td>
<td align="left">取整除赋值运算符</td>
<td align="left">c //= a 等效于 c = c // a</td>
</tr>
</tbody></table>
<h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><ul>
<li>and：只有所有运算都为True,结果才为True，只要有一个False，结果为False<ul>
<li>当前面一个False时，将不会计算后面的数值。</li>
</ul>
</li>
<li>or：只有所有的运算都为False，结果才为False，只要一个True，结果为True<ul>
<li>当前面一个True时，将不会计算后面的数值。</li>
</ul>
</li>
<li>not：当运算为True时，输出False，当运算为False时，输出True。</li>
</ul>
<p>以下假设变量 a 为 10, b为 20:</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">逻辑表达式</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">and</td>
<td align="left">x and y</td>
<td align="left">布尔”与” - 如果 x 为 False，x and y 返回 False，否则它返回 y 的计算值。</td>
<td align="left">(a and b) 返回 20。</td>
</tr>
<tr>
<td align="left">or</td>
<td align="left">x or y</td>
<td align="left">布尔”或” - 如果 x 是非 0，它返回 x 的值，否则它返回 y 的计算值。</td>
<td align="left">(a or b) 返回 10。</td>
</tr>
<tr>
<td align="left">not</td>
<td align="left">not x</td>
<td align="left">布尔”非” - 如果 x 为 True，返回 False 。如果 x 为 False，它返回 True。</td>
<td align="left">not(a and b) 返回 False</td>
</tr>
</tbody></table>
<h2 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h2><p>以下表格列出了从最高到最低优先级的所有运算符：</p>
<table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">**</td>
<td align="center">指数 (最高优先级)</td>
</tr>
<tr>
<td align="center">~ + -</td>
<td align="center">按位翻转, 一元加号和减号 (最后两个的方法名为 +@ 和 -@)</td>
</tr>
<tr>
<td align="center">* / % //</td>
<td align="center">乘，除，取模和取整除</td>
</tr>
<tr>
<td align="center">+ -</td>
<td align="center">加法减法</td>
</tr>
<tr>
<td align="center">&gt;&gt; &lt;&lt;</td>
<td align="center">右移，左移运算符</td>
</tr>
<tr>
<td align="center">&amp;</td>
<td align="center">位 ‘AND’</td>
</tr>
<tr>
<td align="center">^ |</td>
<td align="center">位运算符</td>
</tr>
<tr>
<td align="center">&lt;= &lt; &gt; &gt;=</td>
<td align="center">比较运算符</td>
</tr>
<tr>
<td align="center">&lt;&gt; == !=</td>
<td align="center">等于运算符</td>
</tr>
<tr>
<td align="center">= %= /= //= -= += <em>= *</em>=</td>
<td align="center">赋值运算符</td>
</tr>
<tr>
<td align="center">is is not</td>
<td align="center">身份运算符</td>
</tr>
<tr>
<td align="center">in not in</td>
<td align="center">成员运算符</td>
</tr>
<tr>
<td align="center">not and or</td>
<td align="center">逻辑运算符</td>
</tr>
</tbody></table>
<h1 id="字符串和编码"><a href="#字符串和编码" class="headerlink" title="字符串和编码"></a>字符串和编码</h1><h2 id="占位符"><a href="#占位符" class="headerlink" title="占位符"></a>占位符</h2><table>
<thead>
<tr>
<th>占位符</th>
<th align="center">替换内容</th>
</tr>
</thead>
<tbody><tr>
<td>%d</td>
<td align="center">整数</td>
</tr>
<tr>
<td>%f</td>
<td align="center">浮点数</td>
</tr>
<tr>
<td>%s</td>
<td align="center">字符串</td>
</tr>
<tr>
<td>%x</td>
<td align="center">十六进制整数</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#也可以用f格式</span></span><br><span class="line">month = <span class="number">8</span></span><br><span class="line">day = <span class="number">14</span></span><br><span class="line">print(<span class="string">f"今天是：2020年<span class="subst">&#123;month:<span class="number">02</span>d&#125;</span>月<span class="subst">&#123;day:<span class="number">2</span>d&#125;</span>日"</span>)</span><br><span class="line">今天是：<span class="number">2020</span>年<span class="number">08</span>月<span class="number">14</span>日</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Python学习笔记3-循环语句</title>
    <url>/2020/11/15/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04-%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5.html</url>
    <content><![CDATA[<h2 id="While：只要条件满足，就不断循环，条件不满足时退出循环。"><a href="#While：只要条件满足，就不断循环，条件不满足时退出循环。" class="headerlink" title="While：只要条件满足，就不断循环，条件不满足时退出循环。"></a>While：只要条件满足，就不断循环，条件不满足时退出循环。</h2><p>例如要计算100以内所有奇数之和：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sum = <span class="number">0</span></span><br><span class="line">n = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> n &lt;= <span class="number">100</span>:</span><br><span class="line">  sum = sum + n</span><br><span class="line">  n = n + <span class="number">2</span></span><br><span class="line">  print(sum)</span><br></pre></td></tr></table></figure>

<h3 id="Break：在循环中，break语句可以提前退出循环"><a href="#Break：在循环中，break语句可以提前退出循环" class="headerlink" title="Break：在循环中，break语句可以提前退出循环"></a>Break：在循环中，break语句可以提前退出循环</h3><blockquote>
<p>for…else语句：当循环里的break没有被执行的时候，就会自动执行else</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#求100-201之间数字属于质数还是合数</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>,<span class="number">201</span>):</span><br><span class="line">     <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>,i):</span><br><span class="line">          <span class="keyword">if</span> i % j == <span class="number">0</span>:</span><br><span class="line">               print(i,<span class="string">'是合数'</span>)</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">     <span class="keyword">else</span>:</span><br><span class="line"><span class="comment">#注意else位置，在for...else语句：当循环里的break没有被执行的时候，就会自动执行else</span></span><br><span class="line">          print(i,<span class="string">'是质数'</span>)</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sum = <span class="number">0</span></span><br><span class="line">n = <span class="number">99</span></span><br><span class="line"><span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">50</span>: <span class="comment">#当n &lt; 50时，条件满足，执行break语句</span></span><br><span class="line">        <span class="keyword">break</span> <span class="comment">#break语句会结束当前循环</span></span><br><span class="line">    sum = sum + n</span><br><span class="line">    n = n - <span class="number">2</span></span><br><span class="line">print(sum)</span><br></pre></td></tr></table></figure>

<h3 id="Continue-在循环过程中，也可以通过continue语句，跳过当前的这次循环，直接开始下一次循环。"><a href="#Continue-在循环过程中，也可以通过continue语句，跳过当前的这次循环，直接开始下一次循环。" class="headerlink" title="Continue:在循环过程中，也可以通过continue语句，跳过当前的这次循环，直接开始下一次循环。"></a>Continue:在循环过程中，也可以通过continue语句，跳过当前的这次循环，直接开始下一次循环。</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> n &lt; <span class="number">10</span>:</span><br><span class="line">    n = n + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>: <span class="comment"># 如果n是偶数，执行continue语句</span></span><br><span class="line">        <span class="keyword">continue</span> <span class="comment"># continue语句会直接继续下一轮循环，后续的print()语句不会执行</span></span><br><span class="line">    print(n)</span><br></pre></td></tr></table></figure>

<h2 id="for…in：依次把list或tuple中的每个元素迭代出来"><a href="#for…in：依次把list或tuple中的每个元素迭代出来" class="headerlink" title="for…in：依次把list或tuple中的每个元素迭代出来"></a>for…in：依次把list或tuple中的每个元素迭代出来</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">names = [<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>]</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">    print(name)</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Michael</span><br><span class="line">Bob</span><br><span class="line">Tracy</span><br></pre></td></tr></table></figure>

<p>例如计算1-10的整数之和：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sum = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]:</span><br><span class="line">  sum = sum + n</span><br><span class="line">  print(sum)</span><br></pre></td></tr></table></figure>

<p>但是要计算1-100的整数之和，从1写到100有点困难，Python提供了一个<code>range()</code>函数，可以生成一个整数序列，再通过<code>list()</code>函数可以转换为list。比如range(5)生成的序列就是从0开始小于5的整数：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(range(<span class="number">5</span>))</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>

<p>即计算1-100的和：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sum = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">101</span>):</span><br><span class="line">  sum = sum + n</span><br><span class="line">  print(sum)</span><br></pre></td></tr></table></figure>

<h2 id="pass-语句"><a href="#pass-语句" class="headerlink" title="pass 语句"></a>pass 语句</h2><p>Python pass是空语句，是为了保持程序结构的完整性。</p>
<p>pass 不做任何事情，一般用做占位语句，如下实例</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="keyword">while</span> <span class="literal">True</span>: ...     </span><br><span class="line">...		<span class="keyword">pass</span>  <span class="comment"># 等待键盘中断 (Ctrl+C)</span></span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Python学习笔记2-练习</title>
    <url>/2020/11/12/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02-%E7%BB%83%E4%B9%A0.html</url>
    <content><![CDATA[<ol>
<li><p>写出判断一个数是否能同时被3和7整除的条件语句，并打印结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#例如：输入 21 打印 True,输入 9 打印 False</span></span><br><span class="line">age = int(input(<span class="string">'age:'</span>))</span><br><span class="line"><span class="keyword">if</span> age%<span class="number">3</span> == <span class="number">0</span> <span class="keyword">and</span> age%<span class="number">7</span> == <span class="number">0</span>:</span><br><span class="line">   print(<span class="string">'True'</span>.format(age))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">   print(<span class="string">'False'</span>.format(age))</span><br></pre></td></tr></table></figure>
</li>
<li><p>写出判断一个数是否能同时被3或者7整除，但不能同时被3和7整除的条件语句，并打印结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#例如：输入 14 打印 True,输入 4 打印 False,输入 21 打印 False</span></span><br><span class="line">age = int(input(<span class="string">'age:'</span>))</span><br><span class="line"><span class="keyword">if</span> (age%<span class="number">3</span> == <span class="number">0</span> <span class="keyword">and</span> age%<span class="number">7</span> != <span class="number">0</span>) <span class="keyword">or</span> (age%<span class="number">3</span> != <span class="number">0</span> <span class="keyword">and</span> age%<span class="number">7</span> == <span class="number">0</span>):</span><br><span class="line">    print(<span class="string">'True'</span>.format(age))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'False'</span>.format(age))</span><br></pre></td></tr></table></figure>
</li>
<li><p>输入年，写代码判断输入的年是否为闰年，并且打印相应的结果。（闰年：能被4整除但是不能被100整除或者能被400整除的年）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#例如：输入 2020 打印 True,输入 2011 打印 False</span></span><br><span class="line">year = int(input(<span class="string">'year:'</span>))</span><br><span class="line"><span class="keyword">if</span> (year%<span class="number">4</span> == <span class="number">0</span> <span class="keyword">and</span> year%<span class="number">100</span> != <span class="number">0</span>) <span class="keyword">or</span> (year%<span class="number">400</span> == <span class="number">0</span>):</span><br><span class="line">    print(<span class="string">'True'</span>.format(year))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'False'</span>.format(year))</span><br></pre></td></tr></table></figure>
</li>
<li><p>假设今天的上课时间为15678秒，编程计算今天上课时间是多少小时，多少分钟，多少秒，以xx时xx分xx秒的方式表示出来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#例如：时间 67 秒 -&gt; 0 时 1 分 7 秒</span></span><br><span class="line">time_list = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">time  = int(input(<span class="string">'请输入时间:'</span>))</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> time != <span class="number">0</span> <span class="keyword">and</span> i&lt;<span class="number">3</span>:</span><br><span class="line">    time_list[i]=time % <span class="number">60</span></span><br><span class="line">    time = time // <span class="number">60</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">print(<span class="string">'今天上课时间为&#123;&#125;时&#123;&#125;分&#123;&#125;秒'</span>.format(time_list[<span class="number">2</span>],time_list[<span class="number">1</span>],time_list[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义两个变量保存一个人的身高和体重，编程实现判断这个人的身材是否正常！</p>
<p>公式：<code>体重Kg</code>/<code>身高m</code>的<code>平方值</code>在18.5~24.9之间属于正常</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#例如：输入体重：55，输入身高1.55，输出结果：True</span></span><br><span class="line">height  = float(input(<span class="string">'清除入您的身高：'</span>))</span><br><span class="line">weight  = float(input(<span class="string">'清除入您的体重：'</span>))</span><br><span class="line">result = weight/(height**<span class="number">2</span>)</span><br><span class="line"><span class="keyword">if</span>   <span class="number">24.9</span> &gt;= result &gt;=<span class="number">18.5</span>:</span><br><span class="line">    print(<span class="string">'正常'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'不正常'</span>)</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><p>石头剪刀布</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">player = int(input(<span class="string">'请输入（0）剪刀 （1）石头 （2）布:'</span>))</span><br><span class="line">print(<span class="string">'用户输入的是'</span>,player)</span><br><span class="line">computer = random.randint(<span class="number">0</span>,<span class="number">2</span>)</span><br><span class="line">print(<span class="string">'电脑出的是'</span>,computer)</span><br><span class="line"><span class="keyword">if</span> (player == <span class="number">0</span> <span class="keyword">and</span> computer ==<span class="number">2</span>) <span class="keyword">or</span> (player == <span class="number">1</span> <span class="keyword">and</span> computer == <span class="number">0</span>) <span class="keyword">or</span> (player == <span class="number">2</span> <span class="keyword">and</span> computer ==<span class="number">1</span>):</span><br><span class="line">    print(<span class="string">'You Win'</span>)</span><br><span class="line"><span class="keyword">elif</span> player == computer:</span><br><span class="line">    print(<span class="string">'平局'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'You Lost'</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Python学习笔记3-条件语句</title>
    <url>/2020/11/15/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03-%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5.html</url>
    <content><![CDATA[<h2 id="if-和-else"><a href="#if-和-else" class="headerlink" title="if 和 else"></a>if 和 else</h2><p>Python条件语句是通过一条或多条语句的执行结果（True或者False）来决定执行的代码块。</p>
<p>可以通过下图来简单了解条件语句的执行过程:</p>
<p><img src="../../../../images/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03-%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5/image-20201115043634001.png" alt="image-20201115043634001"></p>
<p>if 语句的判断条件可以用&gt;（大于）、&lt;(小于)、==（等于）、&gt;=（大于等于）、&lt;=（小于等于）来表示其关系。</p>
<p>当判断条件为多个值时，可以使用以下形式：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> &lt;条件判断<span class="number">1</span>&gt;:</span><br><span class="line">    &lt;执行<span class="number">1</span>&gt;</span><br><span class="line"><span class="keyword">elif</span> &lt;条件判断<span class="number">2</span>&gt;:</span><br><span class="line">    &lt;执行<span class="number">2</span>&gt;</span><br><span class="line"><span class="keyword">elif</span> &lt;条件判断<span class="number">3</span>&gt;:</span><br><span class="line">    &lt;执行<span class="number">3</span>&gt;</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    &lt;执行<span class="number">4</span>&gt;</span><br></pre></td></tr></table></figure>

<p><code>if</code>语句执行有个特点，它是从上往下判断，如果在某个判断上是<code>True</code>，把该判断对应的语句执行后，就忽略掉剩下的<code>elif</code>和<code>else</code></p>
<p>Python程序语言指定任何非0和非空（null）值为true，0 或者 null为false。</p>
<p>Python 编程中 if 语句用于控制程序的执行，基本形式为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> 判断条件：</span><br><span class="line">    执行语句……</span><br><span class="line"><span class="keyword">else</span>：</span><br><span class="line">    执行语句……</span><br></pre></td></tr></table></figure>

<p>其中”判断条件”成立时（非零），则执行后面的语句，而执行内容可以多行，以缩进来区分表示同一范围。</p>
<p>else 为可选语句，当需要在条件不成立时执行相关语句。</p>
<p>Gif 演示：</p>
<p><img src="../../../../images/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03-%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5/006faQNTgw1f5wnm0mcxrg30ci07o47l.gif" alt="img"></p>
<blockquote>
<p>当if有多个条件时可使用括号来区分判断的先后顺序，括号中的判断优先执行，此外 and 和 or 的优先级低于&gt;（大于）、&lt;（小于）等判断符号，即大于和小于在没有括号的情况下会比与或要优先判断。</p>
</blockquote>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Python学习笔记6-列表</title>
    <url>/2020/11/15/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06-%E5%88%97%E8%A1%A8.html</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>post</title>
    <url>/2020/11/15/post-4.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>post</title>
    <url>/2020/11/15/post-3.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>post</title>
    <url>/2020/11/15/post-2.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>post</title>
    <url>/2020/11/15/post-1%20(copy).html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Python学习笔记5-字符串</title>
    <url>/2020/11/15/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05-%E5%AD%97%E7%AC%A6%E4%B8%B2.html</url>
    <content><![CDATA[<p>字符串是 Python 中最常用的数据类型。我们可以使用引号( <strong>‘</strong> 或 <strong>“</strong> )来创建字符串。</p>
<p>创建字符串很简单，只要为变量分配一个值即可。例如：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">var1 = <span class="string">'Hello World!'</span> </span><br><span class="line">var2 = <span class="string">"你好，世界"</span></span><br><span class="line">var3 = <span class="string">'''hello，世界'''</span></span><br><span class="line">var4 = <span class="string">"""你好，world!"""</span></span><br></pre></td></tr></table></figure>

<h2 id="访问字符串中的值（下标）"><a href="#访问字符串中的值（下标）" class="headerlink" title="访问字符串中的值（下标）"></a>访问字符串中的值（下标）</h2><p>Python 不支持单字符类型，单字符在 Python 中也是作为一个字符串使用。</p>
<p>Python 访问子字符串，可以使用方括号 <strong>[]</strong> 来截取字符串，字符串的截取的语法格式如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">变量[头下标:尾下标]</span><br></pre></td></tr></table></figure>

<p>索引值以 <strong>0</strong> 为开始值，<strong>-1</strong> 为从末尾的开始位置。</p>
<p><img src="../../../../images/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05-%E5%AD%97%E7%AC%A6%E4%B8%B2/123456-20200923-1.svg" alt="img"></p>
<p>如下实例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3  </span></span><br><span class="line">var1 = <span class="string">'Hello World!'</span> </span><br><span class="line">var2 = <span class="string">"Runoob"</span>  </span><br><span class="line"><span class="keyword">print</span> (<span class="string">"var1[0]: "</span>, var1[<span class="number">0</span>]) </span><br><span class="line"><span class="keyword">print</span> (<span class="string">"var2[1:5]: "</span>, var2[<span class="number">1</span>:<span class="number">5</span>])</span><br></pre></td></tr></table></figure>

<p>以上实例执行结果：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">var1[<span class="number">0</span>]:  H</span><br><span class="line">var2[<span class="number">1</span>:<span class="number">5</span>]:  unoo</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="字符串更新-切片"><a href="#字符串更新-切片" class="headerlink" title="字符串更新(切片)"></a>字符串更新(切片)</h2><blockquote>
<p>语法：[start:end:step]<br>包含start,不包含end<br>step指的是步长，理解为间隔(默认为1,不能为0可以为负数)<br>如果只设置start，会截取到最后<br>如果只设置end，会从头开始截取<br>不包含start,不包含end,表示从头到尾复制<br>start和end如果为负数，会从右往左数</p>
</blockquote>
<p>你可以截取字符串的一部分并与其他字段拼接，如下实例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3  </span></span><br><span class="line">var1 = <span class="string">'Hello World!'</span>  </span><br><span class="line"><span class="keyword">print</span> (<span class="string">"已更新字符串 : "</span>, var1[:<span class="number">6</span>] + <span class="string">'Runoob!'</span>)</span><br></pre></td></tr></table></figure>

<p>以上实例执行结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">已更新字符串 :  Hello Runoob!</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h2><p>在需要在字符中使用特殊字符时，python 用反斜杠 <strong>\</strong> 转义字符。如下表：</p>
<table>
<thead>
<tr>
<th align="left">转义字符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">(在行尾时)</td>
<td align="left">续行符</td>
<td align="left">&gt;&gt;&gt; print(“line1 \ <br />… line2 \ <br />… line3”) <br />line1 line2 line3 <br />&gt;&gt;&gt;</td>
</tr>
<tr>
<td align="left">\</td>
<td align="left">反斜杠符号</td>
<td align="left">&gt;&gt;&gt; print(“\“)<br /> \</td>
</tr>
<tr>
<td align="left">&#39;</td>
<td align="left">单引号</td>
<td align="left">&gt;&gt;&gt; print(‘&#39;‘) <br />‘</td>
</tr>
<tr>
<td align="left">&quot;</td>
<td align="left">双引号</td>
<td align="left">&gt;&gt;&gt; print(“&quot;“)<br /> “</td>
</tr>
<tr>
<td align="left">\a</td>
<td align="left">响铃</td>
<td align="left">&gt;&gt;&gt; print(“\a”)<br />执行后电脑有响声。</td>
</tr>
<tr>
<td align="left">\b</td>
<td align="left">退格(Backspace)</td>
<td align="left">&gt;&gt;&gt; print(“Hello \b World!”) <br />Hello World!</td>
</tr>
<tr>
<td align="left">\000</td>
<td align="left">空</td>
<td align="left">&gt;&gt;&gt; print(“\000”)<br /> &gt;&gt;&gt;</td>
</tr>
<tr>
<td align="left">\n</td>
<td align="left">换行</td>
<td align="left">&gt;&gt;&gt; print(“\n”)  <br />&gt;&gt;&gt;</td>
</tr>
<tr>
<td align="left">\v</td>
<td align="left">纵向制表符</td>
<td align="left">&gt;&gt;&gt; print(“Hello \v World!”) <br />Hello<br />        World! &gt;&gt;&gt;</td>
</tr>
<tr>
<td align="left">\t</td>
<td align="left">横向制表符</td>
<td align="left">&gt;&gt;&gt; print(“Hello \t World!”) <br />Hello    World! <br />&gt;&gt;&gt;</td>
</tr>
<tr>
<td align="left">\r</td>
<td align="left">回车</td>
<td align="left">&gt;&gt;&gt; print(“Hello\rWorld!”) <br />World!</td>
</tr>
<tr>
<td align="left">\f</td>
<td align="left">换页</td>
<td align="left">&gt;&gt;&gt; print(“Hello \f World!”) <br />Hello<br />        World!<br /> &gt;&gt;&gt;</td>
</tr>
<tr>
<td align="left">\yyy</td>
<td align="left">八进制数，y 代表 0~7 的字符，例如：\012 代表换行。</td>
<td align="left">&gt;&gt;&gt; print(“\110\145\154\154\157\40\127\157\162\154\144\41”)<br /> Hello World!</td>
</tr>
<tr>
<td align="left">\xyy</td>
<td align="left">十六进制数，以 \x 开头，y 代表的字符，例如：\x0a 代表换行</td>
<td align="left">&gt;&gt;&gt; print(“\x48\x65\x6c\x6c\x6f\x20\x57\x6f\x72\x6c\x64\x21”)<br /> Hello World!</td>
</tr>
<tr>
<td align="left">\other</td>
<td align="left">其它的字符以普通格式输出</td>
<td align="left"></td>
</tr>
</tbody></table>
<hr>
<h2 id="字符串运算符"><a href="#字符串运算符" class="headerlink" title="字符串运算符"></a>字符串运算符</h2><p>下表实例变量 a 值为字符串 “Hello”，b 变量值为 “Python”：</p>
<table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">+</td>
<td align="left">字符串连接</td>
<td align="left">a + b 输出结果： HelloPython</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">重复输出字符串</td>
<td align="left">a*2 输出结果：HelloHello</td>
</tr>
<tr>
<td align="left">[]</td>
<td align="left">通过索引获取字符串中字符</td>
<td align="left">a[1] 输出结果 <strong>e</strong></td>
</tr>
<tr>
<td align="left">[ : ]</td>
<td align="left">截取字符串中的一部分，遵循<strong>左闭右开</strong>原则，str[0:2] 是不包含第 3 个字符的。</td>
<td align="left">a[1:4] 输出结果 <strong>ell</strong></td>
</tr>
<tr>
<td align="left">in</td>
<td align="left">成员运算符 - 如果字符串中包含给定的字符返回 True</td>
<td align="left"><strong>‘H’ in a</strong> 输出结果 True</td>
</tr>
<tr>
<td align="left">not in</td>
<td align="left">成员运算符 - 如果字符串中不包含给定的字符返回 True</td>
<td align="left"><strong>‘M’ not in a</strong> 输出结果 True</td>
</tr>
<tr>
<td align="left">r/R</td>
<td align="left">原始字符串 - 原始字符串：所有的字符串都是直接按照字面的意思来使用，没有转义特殊或不能打印的字符。 原始字符串除在字符串的第一个引号前加上字母 <strong>r</strong>（可以大小写）以外，与普通字符串有着几乎完全相同的语法。</td>
<td align="left"><code>print( r&#39;\n&#39; ) print( R&#39;\n&#39; )</code></td>
</tr>
<tr>
<td align="left">%</td>
<td align="left">格式字符串</td>
<td align="left"></td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3  </span></span><br><span class="line">a = <span class="string">"Hello"</span> </span><br><span class="line">b = <span class="string">"Python"</span>  </span><br><span class="line">print(<span class="string">"a + b 输出结果："</span>, a + b) </span><br><span class="line">print(<span class="string">"a * 2 输出结果："</span>, a * <span class="number">2</span>) </span><br><span class="line">print(<span class="string">"a[1] 输出结果："</span>, a[<span class="number">1</span>]) </span><br><span class="line">print(<span class="string">"a[1:4] 输出结果："</span>, a[<span class="number">1</span>:<span class="number">4</span>])  </span><br><span class="line"><span class="keyword">if</span>( <span class="string">"H"</span> <span class="keyword">in</span> a) :    </span><br><span class="line">	print(<span class="string">"H 在变量 a 中"</span>) </span><br><span class="line"><span class="keyword">else</span> :    </span><br><span class="line">	print(<span class="string">"H 不在变量 a 中"</span>)  </span><br><span class="line"><span class="keyword">if</span>( <span class="string">"M"</span> <span class="keyword">not</span> <span class="keyword">in</span> a) :    </span><br><span class="line">  print(<span class="string">"M 不在变量 a 中"</span>) </span><br><span class="line"><span class="keyword">else</span> :    </span><br><span class="line">  print(<span class="string">"M 在变量 a 中"</span>)  </span><br><span class="line"><span class="keyword">print</span> (<span class="string">r'\n'</span>) </span><br><span class="line"><span class="keyword">print</span> (R<span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>

<p>以上实例输出结果为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a + b 输出结果： HelloPython</span><br><span class="line">a * <span class="number">2</span> 输出结果： HelloHello</span><br><span class="line">a[<span class="number">1</span>] 输出结果： e</span><br><span class="line">a[<span class="number">1</span>:<span class="number">4</span>] 输出结果： ell</span><br><span class="line">H 在变量 a 中</span><br><span class="line">M 不在变量 a 中</span><br><span class="line">\n</span><br><span class="line">\n</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="字符串格式化"><a href="#字符串格式化" class="headerlink" title="字符串格式化"></a>字符串格式化</h2><p>Python 支持格式化字符串的输出 。尽管这样可能会用到非常复杂的表达式，但最基本的用法是将一个值插入到一个有字符串格式符 %s 的字符串中。</p>
<p>在 Python 中，字符串格式化使用与 C 中 sprintf 函数一样的语法。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3  </span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"我叫 %s 今年 %d 岁!"</span> % (<span class="string">'小明'</span>, <span class="number">10</span>))</span><br></pre></td></tr></table></figure>

<p>以上实例输出结果：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">我叫 小明 今年 <span class="number">10</span> 岁!</span><br></pre></td></tr></table></figure>

<p>python字符串格式化符号:</p>
<table>
<thead>
<tr>
<th align="left">符  号</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">%c</td>
<td align="left">格式化字符及其ASCII码</td>
</tr>
<tr>
<td align="left">%s</td>
<td align="left">格式化字符串</td>
</tr>
<tr>
<td align="left">%d</td>
<td align="left">格式化整数</td>
</tr>
<tr>
<td align="left">%u</td>
<td align="left">格式化无符号整型</td>
</tr>
<tr>
<td align="left">%o</td>
<td align="left">格式化无符号八进制数</td>
</tr>
<tr>
<td align="left">%x</td>
<td align="left">格式化无符号十六进制数</td>
</tr>
<tr>
<td align="left">%X</td>
<td align="left">格式化无符号十六进制数（大写）</td>
</tr>
<tr>
<td align="left">%f</td>
<td align="left">格式化浮点数字，可指定小数点后的精度</td>
</tr>
<tr>
<td align="left">%e</td>
<td align="left">用科学计数法格式化浮点数</td>
</tr>
<tr>
<td align="left">%E</td>
<td align="left">作用同%e，用科学计数法格式化浮点数</td>
</tr>
<tr>
<td align="left">%g</td>
<td align="left">%f和%e的简写</td>
</tr>
<tr>
<td align="left">%G</td>
<td align="left">%f 和 %E 的简写</td>
</tr>
<tr>
<td align="left">%p</td>
<td align="left">用十六进制数格式化变量的地址</td>
</tr>
</tbody></table>
<p>格式化操作符辅助指令:</p>
<table>
<thead>
<tr>
<th align="left">符号</th>
<th align="left">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="left">*</td>
<td align="left">定义宽度或者小数点精度</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">用做左对齐</td>
</tr>
<tr>
<td align="left">+</td>
<td align="left">在正数前面显示加号( + )</td>
</tr>
<tr>
<td align="left">&lt;<sp>sp&gt;</td>
<td align="left">在正数前面显示空格</td>
</tr>
<tr>
<td align="left">#</td>
<td align="left">在八进制数前面显示零(‘0’)，在十六进制前面显示’0x’或者’0X’(取决于用的是’x’还是’X’)</td>
</tr>
<tr>
<td align="left">0</td>
<td align="left">显示的数字前面填充’0’而不是默认的空格</td>
</tr>
<tr>
<td align="left">%</td>
<td align="left">‘%%’输出一个单一的’%’</td>
</tr>
<tr>
<td align="left">(var)</td>
<td align="left">映射变量(字典参数)</td>
</tr>
<tr>
<td align="left">m.n.</td>
<td align="left">m 是显示的最小总宽度,n 是小数点后的位数(如果可用的话)</td>
</tr>
</tbody></table>
<p>Python2.6 开始，新增了一种格式化字符串的函数 <a href="https://www.runoob.com/python/att-string-format.html" target="_blank" rel="noopener">str.format()</a>，它增强了字符串格式化的功能。</p>
<h2 id="format-格式化函数"><a href="#format-格式化函数" class="headerlink" title="format 格式化函数"></a>format 格式化函数</h2><p>基本语法是通过 <strong>{}</strong> 和 <strong>:</strong> 来代替以前的 <strong>%</strong> 。</p>
<p>format 函数可以接受不限个参数，位置可以不按顺序。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(<span class="string">"hello"</span>, <span class="string">"world"</span>)    <span class="comment"># 不设置指定位置，按默认顺序</span></span><br><span class="line"><span class="string">'hello world'</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"&#123;0&#125; &#123;1&#125;"</span>.format(<span class="string">"hello"</span>, <span class="string">"world"</span>)  <span class="comment"># 设置指定位置</span></span><br><span class="line"><span class="string">'hello world'</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"&#123;1&#125; &#123;0&#125; &#123;1&#125;"</span>.format(<span class="string">"hello"</span>, <span class="string">"world"</span>)  <span class="comment"># 设置指定位置</span></span><br><span class="line"><span class="string">'world hello world'</span></span><br></pre></td></tr></table></figure>

<p>也可以设置参数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"> </span><br><span class="line">print(<span class="string">"网站名：&#123;name&#125;, 地址 &#123;url&#125;"</span>.format(name=<span class="string">"菜鸟教程"</span>, url=<span class="string">"www.runoob.com"</span>))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 通过字典设置参数</span></span><br><span class="line">site = &#123;<span class="string">"name"</span>: <span class="string">"菜鸟教程"</span>, <span class="string">"url"</span>: <span class="string">"www.runoob.com"</span>&#125;</span><br><span class="line">print(<span class="string">"网站名：&#123;name&#125;, 地址 &#123;url&#125;"</span>.format(**site))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 通过列表索引设置参数</span></span><br><span class="line">my_list = [<span class="string">'菜鸟教程'</span>, <span class="string">'www.runoob.com'</span>]</span><br><span class="line">print(<span class="string">"网站名：&#123;0[0]&#125;, 地址 &#123;0[1]&#125;"</span>.format(my_list))  <span class="comment"># "0" 是必须的</span></span><br></pre></td></tr></table></figure>

<p>输出结果为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">网站名：菜鸟教程, 地址 www.runoob.com</span><br><span class="line">网站名：菜鸟教程, 地址 www.runoob.com</span><br><span class="line">网站名：菜鸟教程, 地址 www.runoob.com</span><br></pre></td></tr></table></figure>

<p>可以向 <strong>str.format()</strong> 传入对象：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AssignValue</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.value = value</span><br><span class="line">my_value = AssignValue(<span class="number">6</span>)</span><br><span class="line">print(<span class="string">'value 为: &#123;0.value&#125;'</span>.format(my_value))  <span class="comment"># "0" 是可选的</span></span><br></pre></td></tr></table></figure>

<p>输出结果为：</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">value 为: <span class="number">6</span></span><br></pre></td></tr></table></figure>

<h3 id="数字格式化"><a href="#数字格式化" class="headerlink" title="数字格式化"></a>数字格式化</h3><p>下表展示了 str.format() 格式化数字的多种方法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">"&#123;:.2f&#125;"</span>.format(<span class="number">3.1415926</span>));</span><br><span class="line"><span class="number">3.14</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">数字</th>
<th align="left">格式</th>
<th align="left">输出</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">3.1415926</td>
<td align="left">{:.2f}</td>
<td align="left">3.14</td>
<td align="left">保留小数点后两位</td>
</tr>
<tr>
<td align="left">3.1415926</td>
<td align="left">{:+.2f}</td>
<td align="left">+3.14</td>
<td align="left">带符号保留小数点后两位</td>
</tr>
<tr>
<td align="left">-1</td>
<td align="left">{:+.2f}</td>
<td align="left">-1.00</td>
<td align="left">带符号保留小数点后两位</td>
</tr>
<tr>
<td align="left">2.71828</td>
<td align="left">{:.0f}</td>
<td align="left">3</td>
<td align="left">不带小数</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">{:0&gt;2d}</td>
<td align="left">05</td>
<td align="left">数字补零 (填充左边, 宽度为2)</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">{:x&lt;4d}</td>
<td align="left">5xxx</td>
<td align="left">数字补x (填充右边, 宽度为4)</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">{:x&lt;4d}</td>
<td align="left">10xx</td>
<td align="left">数字补x (填充右边, 宽度为4)</td>
</tr>
<tr>
<td align="left">1000000</td>
<td align="left">{:,}</td>
<td align="left">1,000,000</td>
<td align="left">以逗号分隔的数字格式</td>
</tr>
<tr>
<td align="left">0.25</td>
<td align="left">{:.2%}</td>
<td align="left">25.00%</td>
<td align="left">百分比格式</td>
</tr>
<tr>
<td align="left">1000000000</td>
<td align="left">{:.2e}</td>
<td align="left">1.00e+09</td>
<td align="left">指数记法</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left">{:&gt;10d}</td>
<td align="left">13</td>
<td align="left">右对齐 (默认, 宽度为10)</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left">{:&lt;10d}</td>
<td align="left">13</td>
<td align="left">左对齐 (宽度为10)</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left">{:^10d}</td>
<td align="left">13</td>
<td align="left">中间对齐 (宽度为10)</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">‘{:b}’.format(11) <br />’{:d}’.format(11) <br />‘{:o}’.format(11) <br />’{:x}’.format(11) <br />‘{:#x}’.format(11)<br />‘{:#X}’.format(11)</td>
<td align="left">1011 <br />11 <br />13 <br />b <br />0xb <br />0XB</td>
<td align="left">进制</td>
</tr>
</tbody></table>
<p><strong>^</strong>, <strong>&lt;</strong>, <strong>&gt;</strong> 分别是居中、左对齐、右对齐，后面带宽度， <strong>:</strong> 号后面带填充的字符，只能是一个字符，不指定则默认是用空格填充。</p>
<p><strong>+</strong> 表示在正数前显示 <strong>+</strong>，负数前显示 <strong>-</strong>； （空格）表示在正数前加空格</p>
<p>b、d、o、x 分别是二进制、十进制、八进制、十六进制。</p>
<p>此外我们可以使用大括号 <strong>{}</strong> 来转义大括号，如下实例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python </span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-  </span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"&#123;&#125; 对应的位置是 &#123;&#123;0&#125;&#125;"</span>.format(<span class="string">"runoob"</span>))</span><br></pre></td></tr></table></figure>

<p>输出结果为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">runoob 对应的位置是 &#123;<span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三引号"><a href="#三引号" class="headerlink" title="三引号"></a>三引号</h2><p>python三引号允许一个字符串跨多行，字符串中可以包含换行符、制表符以及其他特殊字符。实例如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3  </span></span><br><span class="line">para_str = <span class="string">"""这是一个多行字符串的实例 </span></span><br><span class="line"><span class="string">多行字符串可以使用制表符 TAB ( \t )。 </span></span><br><span class="line"><span class="string">也可以使用换行符 [ \n ]。 </span></span><br><span class="line"><span class="string">"""</span> </span><br><span class="line"><span class="keyword">print</span> (para_str)</span><br></pre></td></tr></table></figure>

<p>以上实例执行结果为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">这是一个多行字符串的实例</span><br><span class="line">多行字符串可以使用制表符</span><br><span class="line">TAB (    )。</span><br><span class="line">也可以使用换行符 [ </span><br><span class="line"> ]。</span><br></pre></td></tr></table></figure>

<p>三引号让程序员从引号和特殊字符串的泥潭里面解脱出来，自始至终保持一小块字符串的格式是所谓的WYSIWYG（所见即所得）格式的。</p>
<p>一个典型的用例是，当你需要一块HTML或者SQL时，这时用字符串组合，特殊字符串转义将会非常的繁琐。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">errHTML = <span class="string">''' </span></span><br><span class="line"><span class="string">&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt; </span></span><br><span class="line"><span class="string">Friends CGI Demo&lt;/TITLE&gt;&lt;/HEAD&gt; </span></span><br><span class="line"><span class="string">&lt;BODY&gt;&lt;H3&gt;ERROR&lt;/H3&gt; </span></span><br><span class="line"><span class="string">&lt;B&gt;%s&lt;/B&gt;&lt;P&gt; </span></span><br><span class="line"><span class="string">&lt;FORM&gt;&lt;INPUT TYPE=button VALUE=Back </span></span><br><span class="line"><span class="string">ONCLICK="window.history.back()"&gt;&lt;/FORM&gt; </span></span><br><span class="line"><span class="string">&lt;/BODY&gt;&lt;/HTML&gt;</span></span><br><span class="line"><span class="string">'''</span> </span><br><span class="line">cursor.execute(<span class="string">''' </span></span><br><span class="line"><span class="string">CREATE TABLE users </span></span><br><span class="line"><span class="string">(   login VARCHAR(8),  </span></span><br><span class="line"><span class="string">uid INTEGER, </span></span><br><span class="line"><span class="string">prid INTEGER) </span></span><br><span class="line"><span class="string">'''</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="f-string"><a href="#f-string" class="headerlink" title="f-string"></a>f-string</h2><p>f-string 是 python3.6 之后版本添加的，称之为字面量格式化字符串，是新的格式化字符串的语法。</p>
<p>之前我们习惯用百分号 (%):</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">'Runoob'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'Hello %s'</span> % name</span><br><span class="line"><span class="string">'Hello Runoob'</span></span><br></pre></td></tr></table></figure>

<p>f-string 格式化字符串以 f 开头，后面跟着字符串，字符串中的表达式用大括号 {} 包起来，它会将变量或表达式计算后的值替换进去，实例如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">'Runoob'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f'Hello <span class="subst">&#123;name&#125;</span>'</span> <span class="comment"># 替换变量</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f'<span class="subst">&#123;<span class="number">1</span>+<span class="number">2</span>&#125;</span>'</span>     <span class="comment"># 使用表达式</span></span><br><span class="line"><span class="string">'3'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w = &#123;<span class="string">'name'</span>: <span class="string">'Runoob'</span>, <span class="string">'url'</span>: <span class="string">'www.runoob.com'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f'<span class="subst">&#123;w[<span class="string">"name"</span>]&#125;</span>: <span class="subst">&#123;w[<span class="string">"url"</span>]&#125;</span>'</span></span><br><span class="line"><span class="string">'Runoob: www.runoob.com'</span></span><br></pre></td></tr></table></figure>

<p>用了这种方式明显更简单了，不用再去判断使用 %s，还是 %d。</p>
<p>在 Python 3.8 的版本中可以使用 <strong>=</strong> 符号来拼接运算表达式与结果：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>**<span class="keyword">print</span>**(<span class="string">f'<span class="subst">&#123;x+<span class="number">1</span>&#125;</span>'</span>)  <span class="comment"># Python 3.6</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>**<span class="keyword">print</span>**(<span class="string">f'<span class="subst">&#123;x+<span class="number">1</span>=&#125;</span>'</span>)  <span class="comment"># Python 3.8</span></span><br><span class="line"><span class="string">'x+1=2'</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Unicode-字符串"><a href="#Unicode-字符串" class="headerlink" title="Unicode 字符串"></a>Unicode 字符串</h2><p>在Python2中，普通字符串是以8位ASCII码进行存储的，而Unicode字符串则存储为16位unicode字符串，这样能够表示更多的字符集。使用的语法是在字符串前面加上前缀 <strong>u</strong>。</p>
<p>在Python3中，所有的字符串都是Unicode字符串。</p>
<hr>
<h2 id="字符串内建函数"><a href="#字符串内建函数" class="headerlink" title="字符串内建函数"></a>字符串内建函数</h2><p>Python 的字符串常用内建函数如下：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-capitalize.html" target="_blank" rel="noopener">capitalize()</a> 将字符串的第一个字符转换为大写</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-center.html" target="_blank" rel="noopener">center(width, fillchar)</a> 返回一个指定的宽度 width 居中的字符串，fillchar 为填充的字符，默认为空格。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-count.html" target="_blank" rel="noopener">count(str, beg= 0,end=len(string))</a> 返回 str 在 string 里面出现的次数，如果 beg 或者 end 指定则返回指定范围内 str 出现的次数</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-decode.html" target="_blank" rel="noopener">bytes.decode(encoding=”utf-8”, errors=”strict”)</a> Python3 中没有 decode 方法，但我们可以使用 bytes 对象的 decode() 方法来解码给定的 bytes 对象，这个 bytes 对象可以由 str.encode() 来编码返回。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-encode.html" target="_blank" rel="noopener">encode(encoding=’UTF-8’,errors=’strict’)</a> 以 encoding 指定的编码格式编码字符串，如果出错默认报一个ValueError 的异常，除非 errors 指定的是’ignore’或者’replace’</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-endswith.html" target="_blank" rel="noopener">endswith(suffix, beg=0, end=len(string))</a> 检查字符串是否以 obj 结束，如果beg 或者 end 指定则检查指定的范围内是否以 obj 结束，如果是，返回 True,否则返回 False.</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-expandtabs.html" target="_blank" rel="noopener">expandtabs(tabsize=8)</a> 把字符串 string 中的 tab 符号转为空格，tab 符号默认的空格数是 8 。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-find.html" target="_blank" rel="noopener">find(str, beg=0, end=len(string))</a> 检测 str 是否包含在字符串中，如果指定范围 beg 和 end ，则检查是否包含在指定范围内，如果包含返回开始的索引值，否则返回-1</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-index.html" target="_blank" rel="noopener">index(str, beg=0, end=len(string))</a> 跟find()方法一样，只不过如果str不在字符串中会报一个异常。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-isalnum.html" target="_blank" rel="noopener">isalnum()</a> 如果字符串至少有一个字符并且所有字符都是字母或数字则返 回 True，否则返回 False</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-isalpha.html" target="_blank" rel="noopener">isalpha()</a> 如果字符串至少有一个字符并且所有字符都是字母或中文字则返回 True, 否则返回 False</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-isdigit.html" target="_blank" rel="noopener">isdigit()</a> 如果字符串只包含数字则返回 True 否则返回 False..</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-islower.html" target="_blank" rel="noopener">islower()</a> 如果字符串中包含至少一个区分大小写的字符，并且所有这些(区分大小写的)字符都是小写，则返回 True，否则返回 False</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-isnumeric.html" target="_blank" rel="noopener">isnumeric()</a> 如果字符串中只包含数字字符，则返回 True，否则返回 False</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-isspace.html" target="_blank" rel="noopener">isspace()</a> 如果字符串中只包含空白，则返回 True，否则返回 False.</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-istitle.html" target="_blank" rel="noopener">istitle()</a> 如果字符串是标题化的(见 title())则返回 True，否则返回 False</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-isupper.html" target="_blank" rel="noopener">isupper()</a> 如果字符串中包含至少一个区分大小写的字符，并且所有这些(区分大小写的)字符都是大写，则返回 True，否则返回 False</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-join.html" target="_blank" rel="noopener">join(seq)</a> 以指定字符串作为分隔符，将 seq 中所有的元素(的字符串表示)合并为一个新的字符串</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-len.html" target="_blank" rel="noopener">len(string)</a> 返回字符串长度</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-ljust.html" target="_blank" rel="noopener">ljust(width[, fillchar])</a> 返回一个原字符串左对齐,并使用 fillchar 填充至长度 width 的新字符串，fillchar 默认为空格。</td>
</tr>
<tr>
<td align="left">21</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-lower.html" target="_blank" rel="noopener">lower()</a> 转换字符串中所有大写字符为小写.</td>
</tr>
<tr>
<td align="left">22</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-lstrip.html" target="_blank" rel="noopener">lstrip()</a> 截掉字符串左边的空格或指定字符。</td>
</tr>
<tr>
<td align="left">23</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-maketrans.html" target="_blank" rel="noopener">maketrans()</a> 创建字符映射的转换表，对于接受两个参数的最简单的调用方式，第一个参数是字符串，表示需要转换的字符，第二个参数也是字符串表示转换的目标。</td>
</tr>
<tr>
<td align="left">24</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-max.html" target="_blank" rel="noopener">max(str)</a> 返回字符串 str 中最大的字母。</td>
</tr>
<tr>
<td align="left">25</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-min.html" target="_blank" rel="noopener">min(str)</a> 返回字符串 str 中最小的字母。</td>
</tr>
<tr>
<td align="left">26</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-replace.html" target="_blank" rel="noopener">replace(old, new [, max])</a> 把 将字符串中的 old 替换成 new,如果 max 指定，则替换不超过 max 次。</td>
</tr>
<tr>
<td align="left">27</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-rfind.html" target="_blank" rel="noopener">rfind(str, beg=0,end=len(string))</a> 类似于 find()函数，不过是从右边开始查找.</td>
</tr>
<tr>
<td align="left">28</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-rindex.html" target="_blank" rel="noopener">rindex( str, beg=0, end=len(string))</a> 类似于 index()，不过是从右边开始.</td>
</tr>
<tr>
<td align="left">29</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-rjust.html" target="_blank" rel="noopener">rjust(width,[, fillchar])</a> 返回一个原字符串右对齐,并使用fillchar(默认空格）填充至长度 width 的新字符串</td>
</tr>
<tr>
<td align="left">30</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-rstrip.html" target="_blank" rel="noopener">rstrip()</a> 删除字符串字符串末尾的空格.</td>
</tr>
<tr>
<td align="left">31</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-split.html" target="_blank" rel="noopener">split(str=””, num=string.count(str))</a> 以 str 为分隔符截取字符串，如果 num 有指定值，则仅截取 num+1 个子字符串,将一个字符串切割成一个列表</td>
</tr>
<tr>
<td align="left">32</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-splitlines.html" target="_blank" rel="noopener">splitlines([keepends])</a> 按照行(‘\r’, ‘\r\n’, \n’)分隔，返回一个包含各行作为元素的列表，如果参数 keepends 为 False，不包含换行符，如果为 True，则保留换行符。</td>
</tr>
<tr>
<td align="left">33</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-startswith.html" target="_blank" rel="noopener">startswith(substr, beg=0,end=len(string))</a> 检查字符串是否是以指定子字符串 substr 开头，是则返回 True，否则返回 False。如果beg 和 end 指定值，则在指定范围内检查。</td>
</tr>
<tr>
<td align="left">34</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-strip.html" target="_blank" rel="noopener">strip([chars])</a> 在字符串上执行 lstrip()和 rstrip()</td>
</tr>
<tr>
<td align="left">35</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-swapcase.html" target="_blank" rel="noopener">swapcase()</a> 将字符串中大写转换为小写，小写转换为大写</td>
</tr>
<tr>
<td align="left">36</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-title.html" target="_blank" rel="noopener">title()</a> 返回”标题化”的字符串,就是说所有单词都是以大写开始，其余字母均为小写(见 istitle())</td>
</tr>
<tr>
<td align="left">37</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-translate.html" target="_blank" rel="noopener">translate(table, deletechars=””)</a> 根据 str 给出的表(包含 256 个字符)转换 string 的字符, 要过滤掉的字符放到 deletechars 参数中</td>
</tr>
<tr>
<td align="left">38</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-upper.html" target="_blank" rel="noopener">upper()</a> 转换字符串中的小写字母为大写</td>
</tr>
<tr>
<td align="left">39</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-zfill.html" target="_blank" rel="noopener">zfill (width)</a> 返回长度为 width 的字符串，原字符串右对齐，前面填充0</td>
</tr>
<tr>
<td align="left">40</td>
<td align="left"><a href="https://www.runoob.com/python3/python3-string-isdecimal.html" target="_blank" rel="noopener">isdecimal()</a> 检查字符串是否只包含十进制字符，如果是返回 true，否则返回 false。</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
</search>
